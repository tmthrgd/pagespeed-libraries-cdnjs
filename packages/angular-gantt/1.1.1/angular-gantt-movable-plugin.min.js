/*
Project: angular-gantt v1.1.1 - Gantt chart component for AngularJS
Authors: Marco Schweighauser, RÃ©mi Alvergnat
License: MIT
Homepage: http://www.angular-gantt.com
Github: https://github.com/angular-gantt/angular-gantt.git
*/

!function(){"use strict";angular.module("gantt.movable",["gantt"]).directive("ganttMovable",["ganttMouseButton","ganttMouseOffset","ganttSmartEvent","ganttMovableOptions","ganttUtils","$window","$document","$timeout",function(a,b,c,d,e,f,g,h){return{restrict:"E",require:"^gantt",scope:{enabled:"=?",allowMoving:"=?",allowResizing:"=?",allowRowSwitching:"=?"},link:function(i,j,k,l){var m=l.gantt.api;if(i.options&&"object"==typeof i.options.movable)for(var n in i.options.movable)i[n]=i.options[n];d.initialize(i),m.registerEvent("tasks","move"),m.registerEvent("tasks","moveBegin"),m.registerEvent("tasks","moveEnd"),m.registerEvent("tasks","resize"),m.registerEvent("tasks","resizeBegin"),m.registerEvent("tasks","resizeEnd"),m.registerEvent("tasks","change");var o,p,q="ontouchstart"in f||f.DocumentTouch&&g[0]instanceof f.DocumentTouch,r="touchstart mousedown",s="touchmove mousemove",t="touchend mouseup",u=15,v=5,w=3,x=15,y=5;m.directives.on["new"](i,function(d,j,k){if("ganttTask"===d){var m,n=angular.element(f),z=j.row.rowsManager.gantt.body.$element,A=j.row.rowsManager.gantt.scroll.$element,B=!1,C=j.task.getForegroundElement();C.on(r,function(c){c.preventDefault(),q&&(c=b.getTouch(c));var d=j.task.model.movable,f=j.task.row.model.movable;"boolean"==typeof d&&(d={enabled:d}),"boolean"==typeof f&&(f={enabled:f});var g=e.firstProperty([d,f],"enabled",i.enabled),h=angular.isFunction(g)?g(c):g;if(h){var k=b.getOffset(c).x,l=H(k);if(""!==l&&1===a.getButton(c)){var m=b.getOffsetForElement(z[0],c).x;K(l,m)}j.$digest()}}),C.on("mousemove",function(a){var c=j.task.model.movable,d=j.task.row.model.movable;"boolean"==typeof c&&(c={enabled:c}),"boolean"==typeof d&&(d={enabled:d});var f=e.firstProperty([c,d],"enabled",i.enabled),g=angular.isFunction(f)?f(a):f;if(g&&!j.task.isMoving){var h=b.getOffset(a).x,k=H(h);""!==k&&"M"!==k?C.css("cursor",I(k)):C.css("cursor","")}});var D=function(a){j.task.isMoving&&!j.destroyed&&(G(),E(a),F(a))},E=function(a){var c=B,d=b.getOffsetForElement(z[0],a),f=d.x;j.task.mouseOffsetX=f;var h=j.task.row.rowsManager.gantt.options.value("taskOutOfRange"),k=j.task.model.movable,m=j.task.row.model.movable;if("boolean"==typeof k&&(k={enabled:k}),"boolean"==typeof m&&(m={enabled:m}),"M"===j.task.moveMode){var n=e.firstProperty([k,m],"allowRowSwitching",i.allowRowSwitching);if(n){var p=A[0].getBoundingClientRect(),q=p.left+p.width/2,r=angular.element(g[0].querySelectorAll(".gantt-body"));r.css("pointer-events","auto");var s=e.findElementFromPoint(q,a.clientY,function(a){return angular.element(a).hasClass("gantt-row")});r.css("pointer-events","");for(var t,u=l.gantt.rowsManager.rows,v=0,w=u.length;w>v;v++)if(s===u[v].$element[0]){t=u[v];break}var x=j.task.row;void 0!==t&&x!==t&&(t.moveTaskToRow(j.task,!0),x.$scope.$digest(),t.$scope.$digest(),B=!0)}var y=e.firstProperty([k,m],"allowMoving",i.allowMoving);y&&(f-=o,"truncate"!==h&&(0>f?f=0:f+j.task.width>=j.gantt.width&&(f=j.gantt.width-j.task.width)),j.task.moveTo(f,!0),j.$digest(),j.row.rowsManager.gantt.api.tasks.raise.move(j.task),B=!0)}else"E"===j.task.moveMode?(f<=j.task.left&&(f=j.task.left,j.task.moveMode="W",J(I(j.task.moveMode))),"truncate"!==h&&f>=j.gantt.width&&(f=j.gantt.width),j.task.setTo(f,!0),j.$digest(),j.row.rowsManager.gantt.api.tasks.raise.resize(j.task),B=!0):(f>j.task.left+j.task.width&&(f=j.task.left+j.task.width,j.task.moveMode="E",J(I(j.task.moveMode))),"truncate"!==h&&0>f&&(f=0),j.task.setFrom(f,!0),j.$digest(),j.row.rowsManager.gantt.api.tasks.raise.resize(j.task),B=!0);if(!c&&B){var C=j.task.getBackgroundElement();"M"===j.task.moveMode?(C.addClass("gantt-task-moving"),j.row.rowsManager.gantt.api.tasks.raise.moveBegin(j.task)):(C.addClass("gantt-task-resizing"),j.row.rowsManager.gantt.api.tasks.raise.resizeBegin(j.task))}},F=function(a){var c=b.getOffsetForElement(z[0],a),d=A[0].scrollLeft,e=A[0].offsetWidth,f=A[0].scrollWidth,g=d+e,i=!1;c.x<p?d>0&&c.x<=d+y&&(c.x-=x,i=!0,j.row.rowsManager.gantt.api.scroll.left(x)):f>g&&c.x>=g-y&&(c.x+=x,i=!0,j.row.rowsManager.gantt.api.scroll.right(x)),i&&(m=h(function(){D(a)},100,!0))},G=function(){void 0!==m&&(h.cancel(m),m=void 0)},H=function(a){var b=0,c=j.task.model.movable,d=j.task.row.model.movable;"boolean"==typeof c&&(c={enabled:c}),"boolean"==typeof d&&(d={enabled:d});var f=e.firstProperty([c,d],"allowResizing",i.allowResizing),g=e.firstProperty([c,d],"allowRowSwitching",i.allowRowSwitching),h=e.firstProperty([c,d],"allowMoving",i.allowMoving);return f&&(b=C[0].offsetWidth<u?w:v),f&&a>C[0].offsetWidth-b?"E":f&&b>a?"W":(h||g)&&a>=b&&a<=C[0].offsetWidth-b?"M":""},I=function(a){switch(a){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},J=function(a){k.css("cursor",a),angular.element(g[0].body).css({"-moz-user-select":""===a?"":"-moz-none","-webkit-user-select":""===a?"":"none","-ms-user-select":""===a?"":"none","user-select":""===a?"":"none",cursor:a})},K=function(a,d){void 0===j.task.originalModel&&(j.task.originalRow=j.task.row,j.task.originalModel=j.task.model,j.task.model=angular.copy(j.task.originalModel)),j.task.isMoving||j.task.isResizing||(p=d,o=d-j.task.modelLeft),B=!1,j.task.moveMode=a,j.task.isMoving=!0,j.task.active=!0;var e=function(a){a.stopImmediatePropagation(),q&&(a=b.getTouch(a)),D(a)},f=c(j,n,s,e);f.bind(),c(j,n,t,function(a){q&&(a=b.getTouch(a)),f.unbind(),L(a),j.$digest()}).bindOnce(),J(I(a))},L=function(){var a=j.task.getBackgroundElement();if(a.removeClass("gantt-task-moving"),a.removeClass("gantt-task-resizing"),void 0!==j.task.originalModel){if(angular.extend(j.task.originalModel,j.task.model),j.task.model=j.task.originalModel,j.task.row.model.id!==j.task.originalRow.model.id){var b=j.task.row;b.removeTask(j.task.model.id,!1,!0),j.task.row=j.task.originalRow,b.moveTaskToRow(j.task,!1)}delete j.task.originalModel,delete j.task.originalRow,j.$apply()}j.task.isMoving=!1,j.task.active=!1,G(),J(""),B===!0&&("M"===j.task.moveMode?j.row.rowsManager.gantt.api.tasks.raise.moveEnd(j.task):j.row.rowsManager.gantt.api.tasks.raise.resizeEnd(j.task),B=!1,j.task.row.sortTasks(),j.row.rowsManager.gantt.api.tasks.raise.change(j.task)),j.task.moveMode=void 0};j.$on("$destroy",function(){j.destroyed=!0,G()}),j.task.isResizing?(K("E",j.task.mouseOffsetX),delete j.task.isResizing):j.task.isMoving&&K("M",j.task.mouseOffsetX)}})}}}])}(),function(){"use strict";angular.module("gantt.movable").factory("ganttMovableOptions",[function(){return{initialize:function(a){return a.enabled=void 0!==a.enabled?!!a.enabled:!0,a.allowMoving=void 0!==a.allowMoving?!!a.allowMoving:!0,a.allowResizing=void 0!==a.allowResizing?!!a.allowResizing:!0,a.allowRowSwitching=void 0!==a.allowRowSwitching?!!a.allowRowSwitching:!0,a}}}])}();
//# sourceMappingURL=angular-gantt-movable-plugin.min.js.map