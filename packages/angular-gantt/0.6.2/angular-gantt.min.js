var gantt=angular.module("gantt",[]);gantt.directive("gantt",["Gantt","dateFunctions","mouseOffset","debounce","keepScrollPos",function(c,d,b,a,e){return{restrict:"EA",replace:true,templateUrl:function(f,g){if(g.templateUrl===undefined){return"template/gantt.tmpl.html"}else{return g.templateUrl}},scope:{sortMode:"=?",viewScale:"=?",width:"=?",columnWidth:"=?",columnSubScale:"=?",allowTaskMoving:"=?",allowTaskResizing:"=?",allowTaskRowSwitching:"=?",allowRowSorting:"=?",allowLabelsResizing:"=?",fromDate:"=?",toDate:"=?",currentDateValue:"=?",currentDate:"=?",firstDayOfWeek:"=?",weekendDays:"=?",showWeekends:"=?",workHours:"=?",showNonWorkHours:"=?",autoExpand:"=?",taskOutOfRange:"=?",maxHeight:"=?",labelsWidth:"=?",showTooltips:"=?",timespans:"=?",data:"=?",loadTimespans:"&",loadData:"&",removeData:"&",clearData:"&",centerDate:"&",onColumnDateClicked:"&",onColumnDateDblClicked:"&",onColumnDataContextClicked:"&",onLabelsResized:"&",onLabelClicked:"&",onLabelDblClicked:"&",onLabelContextClicked:"&",onLabelHeaderClicked:"&",onLabelHeaderDblClicked:"&",onLabelHeaderContextClicked:"&",onGanttReady:"&",onTimespanAdded:"&",onTimespanUpdated:"&",onRowAdded:"&",onRowClicked:"&",onRowDblClicked:"&",onRowContextClicked:"&",onRowUpdated:"&",onRowMouseDown:"&",onScroll:"&",onTaskClicked:"&",onTaskDblClicked:"&",onTaskContextClicked:"&",onTaskUpdated:"&",onTaskMoveBegin:"&",onTaskMoveEnd:"&",onTaskResizeBegin:"&",onTaskResizeEnd:"&"},controller:["$scope","$element",function(g,f){if(g.sortMode===undefined){g.sortMode="name"}if(g.viewScale===undefined){g.viewScale="day"}if(g.width===undefined){g.width=0}if(g.columnWidth===undefined){g.columnWidth=2}if(g.columnSubScale===undefined){g.columnSubScale=4}if(g.allowTaskMoving===undefined){g.allowTaskMoving=true}if(g.allowTaskResizing===undefined){g.allowTaskResizing=true}if(g.allowTaskRowSwitching===undefined){g.allowTaskRowSwitching=true}if(g.allowRowSorting===undefined){g.allowRowSorting=true}if(g.allowLabelsResizing===undefined){g.allowLabelsResizing=true}if(g.currentDateValue===undefined){g.currentDateValue=new Date()}if(g.currentDate===undefined){g.currentDate="line"}if(g.firstDayOfWeek===undefined){g.firstDayOfWeek=1}if(g.weekendDays===undefined){g.weekendDays=[0,6]}if(g.showWeekends===undefined){g.showWeekends=true}if(g.workHours===undefined){g.workHours=[8,9,10,11,12,13,14,15,16]}if(g.showNonWorkHours===undefined){g.showNonWorkHours=true}if(g.maxHeight===undefined){g.maxHeight=0}if(g.autoExpand===undefined){g.autoExpand="none"}if(g.taskOutOfRange===undefined){g.taskOutOfRange="expand"}if(g.labelsWidth===undefined){g.labelsWidth=0}if(g.showTooltips===undefined){g.showTooltips=true}g.gantt=new c(g.viewScale,g.autoExpand,g.taskOutOfRange,g.width,g.columnWidth,g.columnSubScale,g.firstDayOfWeek,g.weekendDays,g.showWeekends,g.workHours,g.showNonWorkHours);g.gantt.setDefaultDateRange(g.fromDate,g.toDate);g.gantt.setCurrentDate(g.currentDateValue);g.$watch("sortMode",function(i,h){if(!angular.equals(i,h)){g.sortRows()}});g.$watch("timespans",function(i,h){if(!angular.equals(i,h)){g.removeAllTimespans();g.setTimespans(i)}});g.$watch("data",function(i,h){if(!angular.equals(i,h)){g.removeAllData();g.setData(i)}});g.$watch("viewScale+autoExpand+taskOutOfRange+width+labelsWidth+columnWidth+columnSubScale+firstDayOfWeek+weekendDays+showWeekends+workHours+showNonWorkHours",function(i,h){if(!angular.equals(i,h)){g.gantt.setViewScale(g.viewScale,g.autoExpand,g.taskOutOfRange,g.width-g.labelsWidth/g.getPxToEmFactor(),g.columnWidth,g.columnSubScale,g.firstDayOfWeek,g.weekendDays,g.showWeekends,g.workHours,g.showNonWorkHours);if(!g.gantt.reGenerateColumns()){g.gantt.setDefaultDateRange(g.fromDate,g.toDate)}}});g.$watch("fromDate+toDate",function(i,h){if(!angular.equals(i,h)){g.gantt.setDefaultDateRange(g.fromDate,g.toDate)}});g.$watch("currentDate+currentDateValue",function(i,h){if(!angular.equals(i,h)){g.gantt.setCurrentDate(g.currentDateValue)}});g.getPxToEmFactor=function(){return g.ganttScroll.children()[0].offsetWidth/g.gantt.width};g.swapRows=function(i,h){g.gantt.swapRows(i,h);g.raiseRowUpdatedEvent(i,true);g.raiseRowUpdatedEvent(h,true);if(g.sortMode!=="custom"){g.sortMode="custom"}else{g.sortRows()}};g.sortRows=function(){g.gantt.sortRows(g.sortMode)};g.scrollTo=function(h){g.ganttScroll[0].scrollLeft=h;g.ganttScroll.triggerHandler("scroll")};g.scrollLeft=function(h){g.ganttScroll[0].scrollLeft-=h;g.ganttScroll.triggerHandler("scroll")};g.scrollRight=function(h){g.ganttScroll[0].scrollLeft+=h;g.ganttScroll.triggerHandler("scroll")};g.scrollToDate=function(i){var j=g.gantt.getColumnByDate(i);if(j!==undefined){var h=(j.left+j.width/2)*g.getPxToEmFactor();g.ganttScroll[0].scrollLeft=h-g.ganttScroll[0].offsetWidth/2}};g.autoExpandColumns=e(g,function(j,h,l){if(g.autoExpand!=="both"&&g.autoExpand!==true&&g.autoExpand!==l){return}var n,m;var k=1,i=31;if(l==="left"){n=g.viewScale==="hour"?d.addDays(h,-k,true):d.addDays(h,-i,true);m=h}else{n=h;m=g.viewScale==="hour"?d.addDays(h,k,true):d.addDays(h,i,true)}g.gantt.expandDefaultDateRange(n,m)});g.raiseColumnDateClickedEvent=function(h,i){g.onColumnDateClicked({event:{evt:h,column:i}})};g.raiseColumnDateDblClickedEvent=function(h,i){g.onColumnDateDblClicked({event:{evt:h,column:i}})};g.raiseColumnDateContextMenuEvent=function(h,i){g.onColumnDataContextClicked({event:{evt:h,column:i}})};g.raiseLabelsResized=function(h){g.onLabelsResized({event:{width:h}})};g.raiseLabelClickedEvent=function(h,i){g.onLabelClicked({event:{evt:h,row:i,userTriggered:true}})};g.raiseLabelDblClickedEvent=function(h,i){g.onLabelDblClicked({event:{evt:h,row:i,userTriggered:true}})};g.raiseLabelContextMenuEvent=function(h,i){g.onLabelContextClicked({event:{evt:h,row:i,userTriggered:true}})};g.raiseLabelHeaderClickedEvent=function(h){g.onLabelHeaderClicked({event:{evt:h,userTriggered:true}})};g.raiseLabelHeaderDblClickedEvent=function(h){g.onLabelHeaderDblClicked({event:{evt:h,userTriggered:true}})};g.raiseLabelHeaderContextMenuEvent=function(h){g.onLabelHeaderContextClicked({event:{evt:h,userTriggered:true}})};g.raiseRowAddedEvent=function(i,h){g.onRowAdded({event:{row:i,userTriggered:h}})};g.raiseDOMRowClickedEvent=function(l,m){var i=b.getOffset(l).x;var j=i/g.getPxToEmFactor();var h=g.gantt.getColumnByPosition(j);var k=g.gantt.getDateByPosition(j);g.raiseRowClickedEvent(l,m,h,k)};g.raiseRowClickedEvent=function(h,k,j,i){g.onRowClicked({event:{evt:h,row:k,column:j.clone(),date:i,userTriggered:true}})};g.raiseDOMRowDblClickedEvent=function(l,m){var i=b.getOffset(l).x;var j=i/g.getPxToEmFactor();var h=g.gantt.getColumnByPosition(j);var k=g.gantt.getDateByPosition(j);g.raiseRowDblClickedEvent(l,m,h,k)};g.raiseRowDblClickedEvent=function(h,k,j,i){g.onRowDblClicked({event:{evt:h,row:k,column:j.clone(),date:i,userTriggered:true}})};g.raiseDOMRowMouseDownEvent=function(l,m){var i=b.getOffset(l).x;var j=i/g.getPxToEmFactor();var h=g.gantt.getColumnByPosition(j);var k=g.gantt.getDateByPosition(j);g.raiseRowMouseDownEvent(l,m,h,k)};g.raiseRowMouseDownEvent=function(h,k,j,i){g.onRowMouseDown({event:{evt:h,row:k,column:j.clone(),date:i,userTriggered:true}})};g.raiseDOMRowClickedEvent=function(l,m){var i=b.getOffset(l).x;var j=i/g.getPxToEmFactor();var h=g.gantt.getColumnByPosition(j);var k=g.gantt.getDateByPosition(j);g.raiseRowClickedEvent(l,m,h,k)};g.raiseDOMRowContextMenuEvent=function(l,m){var i=b.getOffset(l).x;var j=i/g.getPxToEmFactor();var h=g.gantt.getColumnByPosition(j);var k=g.gantt.getDateByPosition(j);g.raiseRowContextMenuEvent(l,m,h,k)};g.raiseRowContextMenuEvent=function(h,k,j,i){g.onRowContextClicked({event:{evt:h,row:k,column:j.clone(),date:i,userTriggered:true}})};g.raiseRowUpdatedEvent=function(i,h){g.onRowUpdated({event:{row:i,userTriggered:h}})};g.raiseScrollEvent=a(function(){if(g.gantt.getDateRange()===undefined){return}var i=g.ganttScroll[0];var j;var h;if(i.scrollLeft===0){j="left";h=g.gantt.getDateRange().from}else{if(i.offsetWidth+i.scrollLeft>=i.scrollWidth){j="right";h=g.gantt.getDateRange().to}}if(h!==undefined){g.autoExpandColumns(i,h,j);g.onScroll({event:{date:h,direction:j,userTriggered:true}})}},5);g.raiseTaskUpdatedEvent=function(h,i){g.onTaskUpdated({event:{task:h,userTriggered:i}})};g.raiseTaskMoveStartEvent=function(h){g.onTaskMoveBegin({event:{task:h,userTriggered:true}})};g.raiseTaskMoveEndEvent=function(h){g.onTaskMoveEnd({event:{task:h,userTriggered:true}})};g.raiseTaskResizeStartEvent=function(h){g.onTaskResizeBegin({event:{task:h,userTriggered:true}})};g.raiseTaskResizeEndEvent=function(h){g.onTaskResizeEnd({event:{task:h,userTriggered:true}})};g.raiseTaskClickedEvent=function(k,l){var i=b.getOffset(k).x,j=i/g.getPxToEmFactor(),h=g.gantt.getColumnByPosition(j+l.left),m=g.gantt.getDateByPosition(j+l.left);g.onTaskClicked({event:{evt:k,task:l,column:h,date:m,userTriggered:true}})};g.raiseTaskDblClickedEvent=function(h,i){g.onTaskDblClicked({event:{evt:h,task:i,userTriggered:true}})};g.raiseTaskContextMenuEvent=function(h,i){g.onTaskContextClicked({event:{evt:h,task:i,userTriggered:true}})};g.setData=e(g,function(h){g.gantt.addData(h,function(i){g.raiseRowAddedEvent(i,false)},function(i){g.raiseRowUpdatedEvent(i,false)});g.sortRows()});g.removeData({fn:function(h){g.gantt.removeData(h,function(i){g.raiseRowUpdatedEvent(i,false)});g.sortRows()}});g.removeAllData=function(){g.gantt.removeAllRows();g.gantt.setDefaultDateRange(g.fromDate,g.toDate)};g.removeAllTimespans=function(){g.gantt.removeAllTimespans();g.gantt.expandDefaultDateRange(g.fromDate,g.toDate)};g.setTimespans=e(g,function(h){g.gantt.addTimespans(h,function(i){g.raiseTimespanAddedEvent(i,false)},function(i){g.raiseTimespanUpdatedEvent(i,false)});g.sortRows()});g.raiseTimespanAddedEvent=function(i,h){g.onTimespanAdded({event:{timespan:i,userTriggered:h}})};g.raiseTimespanUpdatedEvent=function(i,h){g.onTimespanUpdated({event:{timespan:i,userTriggered:h}})};g.loadData({fn:g.setData});g.loadTimespans({fn:g.setTimespans});g.clearData({fn:g.removeAllData});g.centerDate({fn:g.scrollToDate});g.onGanttReady()}]}}]);gantt.factory("Column",["dateFunctions",function(g){var c=function(i,j,k){return Math.round(j/i.width*k/(j/i.subScale))*(j/i.subScale)};var a=function(n,k,o,m,j,i){var l;if(k-n.date>0&&j!==i){l=1}else{l=Math.round(m/o*n.subScale)/n.subScale}return Math.round((n.left+n.width*l)*10)/10};var b=function(j,l,k,m){var i=this;i.date=j;i.left=l;i.width=k;i.subScale=m;i.getEndDate=function(){return i.getDateByPosition(i.width)};i.clone=function(){return new b(i.date,i.left,i.width,i.subScale)};i.equals=function(n){return i.date===n.date}};var e=function(i,l,k,m){var j=new b(i,l,k,m);j.daysInMonth=g.getDaysInMonth(j.date);j.clone=function(){return new b(j.date,j.left,j.width,j.subScale)};j.getDateByPosition=function(n){if(n<0){n=0}if(n>j.width){n=j.width}var o=g.clone(j.date);o.setDate(1+c(j,j.daysInMonth,n));return o};j.getPositionByDate=function(n){return a(j,n,j.daysInMonth,n.getDate(),n.getMonth(),j.date.getMonth())};return j};var d=function(n,m,l,j,i){var o=new b(n,m,l,j);o.week=g.getWeek(n);o.firstDayOfWeek=i;o.daysInWeek=7;o.clone=function(){var r=new b(o.date,o.left,o.width,o.subScale);r.week=o.week;return r};var q=function(r){return((o.daysInWeek-o.firstDayOfWeek)+r)%o.daysInWeek};var p=function(r){return(o.firstDayOfWeek+r)%o.daysInWeek};var k=function(r){if(o.firstDayOfWeek!==1){g.getWeek(g.addDays(r,1-o.firstDayOfWeek,true))}else{return g.getWeek(r)}};o.getDateByPosition=function(r){if(r<0){r=0}if(r>o.width){r=o.width}var t=g.clone(o.date);var s=Math.round(c(o,o.daysInWeek,r));var u=s!==7&&s<0?-1:1;g.setToDayOfWeek(t,s!==7?p(s):p(s)+7,false,u);return t};o.getPositionByDate=function(r){return a(o,r,o.daysInWeek,q(r.getDay()),k(r),k(o.date))};return o};var f=function(m,l,j,i,r,p,o,s,t){var n=new b(m,l,j,i);n.isWeekend=r;n.showNonWorkHours=t;var k=0;var q=24;if(arguments.length==9&&!t&&s.length>1){k=s[0];q=s[s.length-1]+1}n.clone=function(){var u=new b(n.date,n.left,n.width,n.subScale);u.isWeekend=n.isWeekend;return u};n.getDateByPosition=function(u,w){if(u<0){u=0}if(u>n.width){u=n.width}var x=g.clone(n.date);var v=k+c(n,(q-k),u);if(arguments.length==2){if(v===q&&w){x=g.addDays(x,p);v=k}else{if(v===k&&!w){x=g.addDays(x,-o);v=q}}}x.setHours(v);return x};n.getPositionByDate=function(u){if(g.setTimeZero(u,true)>g.setTimeZero(n.date,true)){return n.left+n.width}if(g.setTimeZero(u,true)<g.setTimeZero(n.date,true)){return n.left}var w=q-k;var v=u.getHours()-k;if(v<0){return n.left}else{if(v>w){return n.left+n.width}else{return a(n,u,w,v,u.getDate(),n.date.getDate())}}};return n};var h=function(m,l,j,i,p,q,o,k){var n=new b(m,l,j,i);n.isWeekend=p;n.isWorkHour=q;n.clone=function(){var r=new b(n.date,n.left,n.width,n.subScale);r.isWeekend=n.isWeekend;r.isWorkHour=n.isWorkHour;return r};n.getDateByPosition=function(r,s){if(r<0){r=0}if(r>n.width){r=n.width}var u=g.clone(n.date);var t=c(n,60,r);if(arguments.length==2){if(t===60&&s){u=g.addHours(u,o);t=0}else{if(t===0&&!s){u=g.addHours(u,-k);t=60}}}u.setMinutes(t);return u};n.getPositionByDate=function(r){if(g.setTimeZero(r,true)>g.setTimeZero(n.date,true)){return n.left+n.width}return a(n,r,60,r.getMinutes(),r.getHours(),n.date.getHours())};return n};return{Hour:h,Day:f,Week:d,Month:e}}]);gantt.factory("ColumnGenerator",["Column","dateFunctions",function(d,k){var b=function(p){var o={};for(var n=0,m=p.length;n<m;n++){o[p[n]]=true}return o};var j=function(m,l){return m[l]===true};var f=function(n){var p={};for(var o=0,m=n.length;o<m;o++){p[n[o]]=true}return p};var g=function(m,l){return m[l]===true};var i=function(n,o,l){if(n&&o&&l){var m=Math.abs(n/o);angular.forEach(l,function(p){p.left=m*p.left;p.width=m*p.width})}};var c=function(l,m,o,u,n,q,r){this.generate=function(I,J,w,v,E){if(!J&&!w){throw"to or maximumWidth must be defined"}var D=false;I=k.setTimeZero(I,true);if(J){D=s(J);J=k.setTimeZero(J,true)}var z=k.clone(I);var K=[];var y=0;var G=f(q);var A=b(u);while(true){if((w&&Math.abs(y)>w+m*24)){break}if(E){y-=m*24}var F=j(A,z.getDay());for(var C=0;C<24;C++){var L=new Date(z.getFullYear(),z.getMonth(),z.getDate(),C,0,0);var H=g(G,C);if((F&&n||!F)&&(!H&&r||H)){var B=1;var x=1;if(!r){B=t(G,L.getHours());x=p(G,L.getHours())}K.push(new d.Hour(L,v?y+v:y,m,o,F,H,B,x));y+=m}}if(E){y-=m*24}if(J){if(E){if(D&&z<J||!D&&z<=J){break}}else{if(D&&z>J||!D&&z>=J){break}}}z=k.addDays(z,E?-1:1)}i(l,y,K);return K};this.columnExpandNecessary=function(x,v,y,w){if(s(w)){w=k.addHours(w,-1,true)}return x>y||v<k.setTimeZero(w,true)};var s=function(v){return k.isTimeZero(v)};var t=function(y,v){for(var w=1;w<25;w++){var x=(v+w)%24;if(g(y,x)){return w}}return 1};var p=function(w,v){for(var x=1;x<25;x++){var y=(((v-x)%24)+24)%24;if(g(w,y)){return x}}return 1}};var h=function(l,m,o,u,n,q,s){this.generate=function(F,G,w,v,D){if(!G&&!w){throw"to or maximumWidth must be defined"}var C=false;F=k.setTimeZero(F,true);if(G){C=t(G);G=k.setTimeZero(G,true)}var z=k.clone(F);var H=[];var y=0;var A=b(u);while(true){if(w&&Math.abs(y)>w+m){break}var E=j(A,z.getDay());if(E&&n||!E){var B=1;var x=1;if(!n){B=r(A,z.getDay());x=p(A,z.getDay())}H.push(new d.Day(k.clone(z),v?y+v:y,m,o,E,B,x,q,s));if(D){y-=m}else{y+=m}}if(G){if(D){if(C&&z<G||!C&&z<=G){break}}else{if(C&&z>G||!C&&z>=G){break}}}z=k.addDays(z,D?-1:1)}if(D){if(t(F)){H.shift()}H.reverse()}i(l,y,H);return H};this.columnExpandNecessary=function(x,v,y,w){if(t(w)){w=k.addDays(w,-1,true)}return x>y||v<k.setTimeZero(w,true)};var t=function(v){return k.isTimeZero(v)};var r=function(y,v){for(var w=1;w<8;w++){var x=(v+w)%7;if(!j(y,x)){return w}}return 1};var p=function(y,v){for(var x=1;x<8;x++){var w=(((v-x)%7)+7)%7;if(!j(y,w)){return x}}return 1}};var e=function(n,p,o,m){this.generate=function(w,x,r,q,v){if(!x&&!r){throw"to or maximumWidth must be defined"}var u=false;w=k.setToDayOfWeek(k.setTimeZero(w,true),m,false);if(x){u=l(x);x=k.setToDayOfWeek(k.setTimeZero(x,true),m,false)}var t=k.clone(w);var y=[];var s=0;while(true){if(r&&Math.abs(s)>r+p){break}y.push(new d.Week(k.clone(t),q?s+q:s,p,o,m));if(v){s-=p}else{s+=p}if(x){if(v){if(u&&t<x||!u&&t<=x){break}}else{if(u&&t>x||!u&&t>=x){break}}}t=k.addWeeks(t,v?-1:1)}if(v){if(l(w)){y.shift()}y.reverse()}i(n,s,y);return y};this.columnExpandNecessary=function(s,q,t,r){if(l(r)){r=k.addWeeks(r,-1,true)}return s>t||q<k.setToDayOfWeek(k.setTimeZero(r,true),m)};var l=function(q){return q.getDay()===m&&k.isTimeZero(q)}};var a=function(m,o,n){this.generate=function(v,w,q,p,u){if(!w&&!q){throw"to or maximumWidth must be defined"}var t=false;v=k.setToFirstDayOfMonth(k.setTimeZero(v,true),false);if(w){t=l(w);w=k.setToFirstDayOfMonth(k.setTimeZero(w,true),false)}var s=k.clone(v);var x=[];var r=0;while(true){if(q&&Math.abs(r)>q+o){break}x.push(new d.Month(k.clone(s),p?r+p:r,o,n));if(u){r-=o}else{r+=o}if(w){if(u){if(t&&s<w||!t&&s<=w){break}}else{if(t&&s>w||!t&&s>=w){break}}}s=k.addMonths(s,u?-1:1)}if(u){if(l(v)){x.shift()}x.reverse()}i(m,r,x);return x};this.columnExpandNecessary=function(r,p,s,q){if(l(q)){q=k.addMonths(q,-1,true)}return r>s||p<k.setToFirstDayOfMonth(k.setTimeZero(q,true))};var l=function(p){return p.getDate()===1&&k.isTimeZero(p)}};return{HourGenerator:c,DayGenerator:h,WeekGenerator:e,MonthGenerator:a}}]);gantt.factory("Gantt",["Row","Timespan","ColumnGenerator","HeaderGenerator","dateFunctions","binarySearch",function(c,a,g,d,f,b){var e=function(h,n,C,z,p,D,x,q,y,E,F){var w=this;w.rowsMap={};w.rows=[];w.timespansMap={};w.timespans=[];w.columns=[];w.headers={};w.previousColumns=[];w.nextColumns=[];w.width=0;w.autoExpand=n;w.taskOutOfRange=C;var A;w.setViewScale=function(M,O,H,I,J,L,G,Q,K,N,P){w.autoExpand=O;w.taskOutOfRange=H;switch(M){case"hour":w.columnGenerator=new g.HourGenerator(I,J,L,Q,K,N,P);break;case"day":w.columnGenerator=new g.DayGenerator(I,J,L,Q,K,N,P);break;case"week":w.columnGenerator=new g.WeekGenerator(I,J,L,G);break;case"month":w.columnGenerator=new g.MonthGenerator(I,J,L);break;default:throw"Unsupported view scale: "+M}w.headerGenerator=new d.instance(M)};w.setViewScale(h,w.autoExpand,w.taskOutOfRange,z,p,D,x,q,y,E,F);w.setDefaultDateRange=function(H,G){if(H!==undefined&&G!==undefined){t(H,G);o(A.from,A.to)}};var t=function(H,G){H=f.clone(H);G=f.clone(G);if(A===undefined){A={};A.from=H;A.to=G}else{A.from=H;A.to=G}};w.expandDefaultDateRange=function(H,G){if(H!==undefined&&G!==undefined){u(H,G);l()}};var u=function(H,G){H=H?f.clone(H):H;G=G?f.clone(G):G;if(A===undefined&&H&&G){A={};A.from=H;A.to=G}else{if(A!==undefined){if(H&&H<A.from){A.from=H}if(G&&G>A.to){A.to=G}}}};var l=function(){if(A===undefined){throw"From and to date range cannot be undefined"}if(w.columns.length===0){o(A.from,A.to)}else{if(w.columnGenerator.columnExpandNecessary(w.getFirstColumn().date,w.getLastColumn().date,A.from,A.to)){var G=w.getFirstColumn().date>A.from?A.from:w.getFirstColumn().date;var H=w.getLastColumn().date<A.to?A.to:w.getLastColumn().date;o(G,H)}}};w.setCurrentDate=function(G){w._currentDate=G;angular.forEach(w.columns,function(H){if(G>=H.date&&G<H.getEndDate()){H.currentDate=G}else{delete H.currentDate}})};var o=function(I,H){w.columns=w.columnGenerator.generate(I,H);w.headers=w.headerGenerator.generate(w.columns);if(w._currentDate){w.setCurrentDate(w._currentDate)}w.previousColumns=[];w.nextColumns=[];var G=w.getLastColumn();w.width=G!==undefined?G.left+G.width:0;w.updateTasksPosAndSize();w.updateTimespansPosAndSize()};var B=function(G){if(G<0){var L=w.getFirstColumn();var M=L.date;var J=w.getFirstColumn(true);if(!J||J.left>G){w.previousColumns=w.columnGenerator.generate(M,null,-G,0,true)}return true}else{if(G>w.width){var H=w.getLastColumn();var K=H.getDateByPosition(H.width);var I=w.getLastColumn(true);if(!I||I.left+I.width<G){w.nextColumns=w.columnGenerator.generate(K,null,G-w.width,w.width,false)}return true}}return false};var v=function(H){var L=w.getFirstColumn();var M=null;if(L){M=L.date}var G=w.getLastColumn();var K=null;if(G){K=G.getDateByPosition(G.width)}if(M&&H<M){var J=w.getFirstColumn(true);if(!J||J.date>H){w.previousColumns=w.columnGenerator.generate(M,H,null,0,true)}return true}else{if(K&&H>K){var I=w.getLastColumn(true);if(!I||K<I){w.nextColumns=w.columnGenerator.generate(K,H,null,w.width,false)}return true}}return false};w.reGenerateColumns=function(){w.columns=[];w.previousColumns=[];w.nextColumns=[];if(A!==undefined){l();return true}else{return false}};w.updateTasksPosAndSize=function(){for(var J=0,G=w.rows.length;J<G;J++){for(var I=0,H=w.rows[J].tasks.length;I<H;I++){w.rows[J].tasks[I].updatePosAndSize()}}};w.updateTimespansPosAndSize=function(){for(var H=0,G=w.timespans.length;H<G;H++){w.timespans[H].updatePosAndSize()}};w.getLastColumn=function(G){var H=w.columns;if(G){H=w.nextColumns}if(H&&H.length>0){return H[H.length-1]}else{return undefined}};w.getFirstColumn=function(G){var H=w.columns;if(G){H=w.previousColumns}if(H&&H.length>0){return H[0]}else{return undefined}};w.getColumnByDate=function(G){v(G);var I=w.previousColumns.concat(w.columns,w.nextColumns);var H=b.get(I,G,function(J){return J.date});return H[0]!==undefined?H[0]:H[1]};w.getColumnByPosition=function(G){B(G);var H=w.previousColumns.concat(w.columns,w.nextColumns);return b.get(H,G,function(I){return I.left})[0]};w.getDateByPosition=function(G,H){var I=w.getColumnByPosition(G);if(I!==undefined){if(H!==undefined){return I.getDateByPosition(G-I.left,H)}else{return I.getDateByPosition(G-I.left)}}else{return undefined}};w.getPositionByDate=function(G){if(!G){return undefined}var H=w.getColumnByDate(G);if(H!==undefined){return H.getPositionByDate(G)}else{return undefined}};w.getDateRange=function(){if(A===undefined){return undefined}else{return{from:f.clone(A.from),to:f.clone(A.to)}}};w.getTasksDateRange=function(){if(w.rows.length===0){return undefined}else{var I,K;for(var H=0,G=w.rows.length;H<G;H++){var J=w.rows[H];if(I===undefined||J.minFromDate<I){I=J.minFromDate}if(K===undefined||J.maxToDate>K){K=J.maxToDate}}return{from:I,to:K}}};w.getActiveHeadersCount=function(){var H=0,G;for(G in w.headers){if(w.headers.hasOwnProperty(G)){H++}}return H};w.addData=function(L,I,N){for(var H=0,G=L.length;H<G;H++){var K=L[H];var J=i(K);var M=w.rowsMap[K.id];if(J===true&&N!==undefined){N(M)}else{if(I!==undefined){I(M)}}}if(A!==undefined){l()}};var i=function(L){var M,K=false;if(L.id in w.rowsMap){M=w.rowsMap[L.id];M.copy(L);K=true}else{var G=L.order;if(G===undefined){G=w.highestRowOrder}if(G>=w.highestRowOrder){w.highestRowOrder=G+1}M=new c(L.id,w,L.description,G,L.data);w.rowsMap[L.id]=M;w.rows.push(M)}if(L.tasks!==undefined&&L.tasks.length>0){for(var J=0,H=L.tasks.length;J<H;J++){var I=M.addTask(L.tasks[J]);if(w.taskOutOfRange==="expand"){u(I.from,I.to)}I.updatePosAndSize()}}return K};w.removeData=function(M,G){for(var K=0,H=M.length;K<H;K++){var L=M[K];if(L.tasks!==undefined&&L.tasks.length>0){if(L.id in w.rowsMap){var N=w.rowsMap[L.id];for(var J=0,I=L.tasks.length;J<I;J++){N.removeTask(L.tasks[J].id)}if(G!==undefined){G(N)}}}else{r(L.id)}}};var r=function(I){if(I in w.rowsMap){delete w.rowsMap[I];for(var H=0,G=w.rows.length;H<G;H++){var J=w.rows[H];if(J.id===I){w.rows.splice(H,1);return J}}}return undefined};w.removeAllRows=function(){w.rowsMap={};w.rows=[];w.highestRowOrder=0;w.columns=[];A=undefined};w.removeAllTimespans=function(){w.timespansMap={};w.timespans=[]};w.swapRows=function(I,H){var G=I.order;I.order=H.order;H.order=G};var k=function(H,G){if(H.minFromDate===undefined&&G.minFromDate===undefined){return m(H,G)}else{if(H.minFromDate===undefined){return 1}else{if(G.minFromDate===undefined){return -1}else{return H.minFromDate-G.minFromDate}}}};var m=function(H,G){if(H.description.toLowerCase()===G.description.toLowerCase()){return 0}else{return(H.description.toLowerCase()<G.description.toLowerCase())?-1:1}};var j=function(H,G){if(H.order===undefined&&G.order===undefined){return m(H,G)}else{if(H.order===undefined){return 1}else{if(G.order===undefined){return -1}else{return H.order-G.order}}}};w.sortRows=function(G){switch(G){case"name":w.rows.sort(m);break;case"-name":w.rows.reverse(m);break;case"date":w.rows.sort(k);break;case"-date":w.rows.reverse(k);break;case"custom":w.rows.sort(j);break;case"-custom":w.rows.reverse(j);break;default:w.rows.sort(k);break}};w.addTimespans=function(L,I,N){for(var H=0,G=L.length;H<G;H++){var K=L[H];var J=s(K);var M=w.timespansMap[K.id];if(J===true&&N!==undefined){N(M)}else{if(I!==undefined){I(M)}}u(M.from,M.to);M.updatePosAndSize()}if(A!==undefined){l()}};var s=function(H){var I,G=false;if(H.id in w.timespansMap){I=w.timespansMap[H.id];I.copy(H);G=true}else{I=new a(H.id,w,H.subject,H.color,H.classes,H.priority,H.from,H.to,H.data);w.timespansMap[H.id]=I;w.timespans.push(I)}return G}};return e}]);gantt.factory("HeaderGenerator",["Column","dateFunctions",function(a,f){var b=function(k){var m=[];var n;for(var j=0,g=k.length;j<g;j++){var h=k[j];if(j===0||k[j-1].date.getHours()!==h.date.getHours()){n=new a.Hour(f.clone(h.date),h.left,h.width,h.isWeekend,h.isWorkHour);m.push(n)}else{n.width+=h.width}}return m};var e=function(k){var m=[];var n;for(var j=0,g=k.length;j<g;j++){var h=k[j];if(j===0||k[j-1].date.getDay()!==h.date.getDay()){n=new a.Day(f.clone(h.date),h.left,h.width,h.isWeekend,h.daysToNextWorkingDay,h.daysToPrevWorkingDay);m.push(n)}else{n.width+=h.width}}return m};var d=function(k){var m=[];var n;for(var j=0,g=k.length;j<g;j++){var h=k[j];if(j===0||f.getWeek(k[j-1].date)!==f.getWeek(h.date)){n=new a.Week(f.clone(h.date),h.left,h.width,f.getWeek(h.date));m.push(n)}else{n.width+=h.width}}return m};var c=function(k){var m=[];var n;for(var j=0,g=k.length;j<g;j++){var h=k[j];if(j===0||k[j-1].date.getMonth()!==h.date.getMonth()){n=new a.Month(f.clone(h.date),h.left,h.width);m.push(n)}else{n.width+=h.width}}return m};return{instance:function(g){this.generate=function(h){var i={};switch(g){case"hour":i.hour=b(h);i.day=e(h);break;case"day":i.day=e(h);i.week=d(h);i.month=c(h);break;case"week":i.week=d(h);i.month=c(h);break;case"month":i.month=c(h);break;default:throw"Unsupported view scale: "+g}return i}}}}]);gantt.factory("Row",["Task","dateFunctions",function(c,b){var a=function(i,f,g,d,h){var e=this;e.id=i;e.gantt=f;e.description=g;e.order=d;e.tasksMap={};e.tasks=[];e.data=h;e.addTask=function(k){var j;if(k.id in e.tasksMap){j=e.tasksMap[k.id];j.copy(k)}else{j=new c(k.id,e,k.subject,k.color,k.classes,k.priority,k.from,k.to,k.data,k.est,k.lct);e.tasksMap[k.id]=j;e.tasks.push(j)}e.sortTasks();e.setMinMaxDateByTask(j);return j};e.moveTaskToRow=function(j){j.row.removeTask(j.id);e.tasksMap[j.id]=j;e.tasks.push(j);e.setTasksMinMaxDate();j.row=e;j.updatePosAndSize()};e.removeTask=function(n){if(n in e.tasksMap){delete e.tasksMap[n];for(var m=0,j=e.tasks.length;m<j;m++){var k=e.tasks[m];if(k.id===n){e.tasks.splice(m,1);if(e.minFromDate-k.from===0||e.maxToDate-k.to===0){e.setTasksMinMaxDate()}return k}}}};e.setTasksMinMaxDate=function(){e.minFromDate=undefined;e.maxToDate=undefined;for(var m=0,l=e.tasks.length;m<l;m++){e.setMinMaxDateByTask(e.tasks[m])}};e.setMinMaxDateByTask=function(j){if(e.minFromDate===undefined){e.minFromDate=b.clone(j.from)}else{if(j.from<e.minFromDate){e.minFromDate=b.clone(j.from)}}if(e.maxToDate===undefined){e.maxToDate=b.clone(j.to)}else{if(j.to>e.maxToDate){e.maxToDate=b.clone(j.to)}}};e.sortTasks=function(){e.tasks.sort(function(k,j){return k.left-j.left})};e.copy=function(j){e.description=j.description;e.data=j.data;if(j.order!==undefined){e.order=j.order}};e.clone=function(){var m=new a(e.id,e.gantt,e.description,e.order,e.data);for(var k=0,j=e.tasks.length;k<j;k++){m.addTask(e.tasks[k].clone())}return m}};return a}]);gantt.factory("Task",["dateFunctions",function(a){var b=function(c,n,g,e,d,h,i,j,f,k,m){var l=this;l.id=c;l.gantt=n.gantt;l.row=n;l.subject=g;l.color=e;l.classes=d;l.priority=h;l.from=a.clone(i);l.to=a.clone(j);l.truncatedLeft=false;l.truncatedRight=false;l.data=f;if(k!==undefined&&m!==undefined){l.est=a.clone(k);l.lct=a.clone(m)}l.checkIfMilestone=function(){l.isMilestone=l.from-l.to===0};l.checkIfMilestone();l.hasBounds=function(){return l.bounds!==undefined};l.updatePosAndSize=function(){l.modelLeft=l.gantt.getPositionByDate(l.from);l.modelWidth=l.gantt.getPositionByDate(l.to)-l.modelLeft;l.outOfRange=l.modelLeft+l.modelWidth<0||l.modelLeft>l.gantt.width;l.left=Math.min(Math.max(l.modelLeft,0),l.gantt.width);if(l.modelLeft<0){l.truncatedLeft=true;if(l.modelWidth+l.modelLeft>l.gantt.width){l.truncatedRight=true;l.width=l.gantt.width}else{l.truncatedRight=false;l.width=l.modelWidth+l.modelLeft}}else{if(l.modelWidth+l.modelLeft>l.gantt.width){l.truncatedRight=true;l.truncatedLeft=false;l.width=l.gantt.width-l.modelLeft}else{l.truncatedLeft=false;l.truncatedRight=false;l.width=l.modelWidth}}if(l.est!==undefined&&l.lct!==undefined){l.bounds={};l.bounds.left=l.gantt.getPositionByDate(l.est);l.bounds.width=l.gantt.getPositionByDate(l.lct)-l.bounds.left}};l.setFrom=function(o){if(l.gantt.taskOutOfRange!=="truncate"){if(o>l.left+l.width){o=l.left+l.width}else{if(o<0){o=0}}}l.from=l.gantt.getDateByPosition(o,true);l.row.setMinMaxDateByTask(l);l.updatePosAndSize();l.checkIfMilestone()};l.setTo=function(o){if(l.gantt.taskOutOfRange!=="truncate"){if(o<l.left){o=l.left}else{if(o>l.gantt.width){o=l.gantt.width}}}l.to=l.gantt.getDateByPosition(o,false);l.row.setMinMaxDateByTask(l);l.updatePosAndSize();l.checkIfMilestone()};l.moveTo=function(o){if(l.gantt.taskOutOfRange!=="truncate"){if(o<0){o=0}else{if(o+l.width>=l.gantt.width){o=l.gantt.width-l.width}}}l.from=l.gantt.getDateByPosition(o,true);l.to=l.gantt.getDateByPosition(o+l.modelWidth,false);l.row.setMinMaxDateByTask(l);l.updatePosAndSize()};l.copy=function(o){l.subject=o.subject;l.color=o.color;l.classes=o.classes;l.priority=o.priority;l.from=a.clone(o.from);l.to=a.clone(o.to);l.est=o.est!==undefined?a.clone(o.est):undefined;l.lct=o.lct!==undefined?a.clone(o.lct):undefined;l.data=o.data;l.isMilestone=o.isMilestone};l.clone=function(){return new b(l.id,l.row,l.subject,l.color,l.classes,l.priority,l.from,l.to,l.data,l.est,l.lct)}};return b}]);gantt.factory("Timespan",["dateFunctions",function(b){var a=function(c,d,h,f,e,i,j,k,g,l,n){var m=this;m.id=c;m.gantt=d;m.subject=h;m.color=f;m.classes=e;m.priority=i;m.from=b.clone(j);m.to=b.clone(k);m.data=g;if(l!==undefined&&n!==undefined){m.est=b.clone(l);m.lct=b.clone(n)}m.hasBounds=function(){return m.bounds!==undefined};m.updatePosAndSize=function(){m.left=m.gantt.getPositionByDate(m.from);m.width=Math.round((m.gantt.getPositionByDate(m.to)-m.left)*10)/10;if(m.est!==undefined&&m.lct!==undefined){m.bounds={};m.bounds.left=m.gantt.getPositionByDate(m.est);m.bounds.width=Math.round((m.gantt.getPositionByDate(m.lct)-m.bounds.left)*10)/10}};m.setFrom=function(o){if(o>m.left+m.width){o=m.left+m.width}else{if(o<0){o=0}}m.from=m.gantt.getDateByPosition(o,true);m.updatePosAndSize()};m.setTo=function(o){if(o<m.left){o=m.left}else{if(o>m.gantt.width){o=m.gantt.width}}m.to=m.gantt.getDateByPosition(o,false);m.updatePosAndSize()};m.moveTo=function(o){if(o<0){o=0}else{if(o+m.width>=m.gantt.width){o=m.gantt.width-m.width}}m.from=m.gantt.getDateByPosition(o,true);m.left=m.gantt.getPositionByDate(m.from);m.to=m.gantt.getDateByPosition(m.left+m.width,false);m.width=Math.round((m.gantt.getPositionByDate(m.to)-m.left)*10)/10};m.copy=function(o){m.subject=o.subject;m.color=o.color;m.classes=o.classes;m.priority=o.priority;m.from=b.clone(o.from);m.to=b.clone(o.to);m.est=o.est!==undefined?b.clone(o.est):undefined;m.lct=o.lct!==undefined?b.clone(o.lct):undefined;m.data=o.data};m.clone=function(){return new a(m.id,m.gantt,m.subject,m.color,m.classes,m.priority,m.from,m.to,m.data,m.est,m.lct)}};return a}]);gantt.service("binarySearch",[function(){return{getIndicesOnly:function(a,f,e){var d=-1,c=a.length;while(c-d>1){var b=Math.floor((d+c)/2);if(e(a[b])<=f){d=b}else{c=b}}if(a[d]!==undefined&&e(a[d])===f){c=d}return[d,c]},get:function(a,d,c){var b=this.getIndicesOnly(a,d,c);return[a[b[0]],a[b[1]]]}}}]);gantt.service("dateFunctions",[function(){return{isNumber:function(a){return !isNaN(parseFloat(a))&&isFinite(a)},isString:function(a){return typeof a=="string"||(typeof a=="object"&&a.constructor===String)},clone:function(a){if(this.isString(a)){return new Date(Date.parse(a))}else{if(this.isNumber(a)){return new Date(a)}else{return new Date(a.getTime())}}},setTimeZero:function(a,c){var b=c===true?this.clone(a):a;b.setHours(0);b.setMinutes(0);b.setMilliseconds(0);return b},setTimeComponent:function(b,a){return new Date(b.getFullYear(),b.getMonth(),b.getDate(),0,0,0,a)},setToFirstDayOfMonth:function(a,c){var b=c===true?this.clone(a):a;b.setDate(1);return b},setToDayOfWeek:function(c,a,f,b){var d=f===true?this.clone(c):c;if(d.getDay()===a){return d}else{b=b||-1;var e=(a-d.getDay()+7*(b||+1))%7;return this.addDays(d,(e===0)?e+=7*(b||+1):e)}},addMonths:function(a,c,d){var b=d===true?this.clone(a):a;b.setDate(1);b.setMonth(b.getMonth()+c);return b},addWeeks:function(a,c,d){var b=d===true?this.clone(a):a;b.setDate(b.getDate()+c*7);return b},addDays:function(a,c,d){var b=d===true?this.clone(a):a;b.setDate(b.getDate()+c);return b},addHours:function(a,c,d){var b=d===true?this.clone(a):a;b.setHours(b.getHours()+c);return b},addMinutes:function(a,c,d){var b=d===true?this.clone(a):a;b.setMinutes(b.getMinutes()+c);return b},addMilliseconds:function(a,c,d){var b=d===true?this.clone(a):a;b.setMilliseconds(b.getMilliseconds()+c);return b},isTimeZero:function(a){return a.getHours()===0&&a.getMinutes()===0&&a.getMinutes()===0&&a.getMilliseconds()===0},getDaysInMonth:function(a){return new Date(a.getYear(),a.getMonth()+1,0).getDate()},getWeek:function(k){var j,r,h;var u,t,q,p,o,m,l,i,x,v;j=k.getFullYear();r=k.getMonth()+1;h=k.getDate();if(r<=2){u=j-1;t=(u/4|0)-(u/100|0)+(u/400|0);q=((u-1)/4|0)-((u-1)/100|0)+((u-1)/400|0);x=t-q;o=0;m=h-1+(31*(r-1))}else{u=j;t=(u/4|0)-(u/100|0)+(u/400|0);q=((u-1)/4|0)-((u-1)/100|0)+((u-1)/400|0);x=t-q;o=x+1;m=h+((153*(r-3)+2)/5)+58+x}l=(u+t)%7;p=(m+l-o)%7;i=(m+3-p)|0;if(i<0){v=53-((l-x)/5|0)}else{if(i>364+x){v=1}else{v=(i/7|0)+1}}j=r=h=null;return v}}}]);gantt.filter("ganttColumnLimit",["binarySearch",function(a){return function(c,f,e){var d=function(h){return h.left};var g=a.getIndicesOnly(c,f,d)[0];var b=a.getIndicesOnly(c,f+e,d)[1];return c.slice(g,b)}}]);gantt.directive("ganttLimitUpdater",["$timeout",function(a){return{restrict:"A",controller:["$scope","$element",function(c,b){var d=b[0];var e=function(){c.scroll_start=d.scrollLeft/c.getPxToEmFactor();c.scroll_width=d.offsetWidth/c.getPxToEmFactor()};b.bind("scroll",function(){c.$apply(function(){e()})});c.$watch("gantt.width",function(g,f){a(function(){e()},20,true)})}]}}]);gantt.filter("ganttTaskLimit",[function(){return function(c,g,f){var e=[];for(var d=0,a=c.length;d<a;d++){var b=c[d];if(b.left>=g&&b.left<=g+f||b.left+b.width>=g&&b.left+b.width<=g+f||b.left<g&&b.left+b.width>g+f||b.isMoving===true){e.push(b)}}return e}}]);gantt.directive("ganttLabelsResize",["$document","debounce","mouseOffset",function(c,a,b){return{restrict:"A",scope:{enabled:"=ganttLabelsResize",width:"=ganttLabelsResizeWidth",minWidth:"=ganttLabelsResizeMinWidth",onResized:"&onLabelsResized"},controller:["$scope","$element",function(k,l){var e=5;var j="ew-resize";var h;l.bind("mousedown",function(m){if(k.enabled&&g(m)){i(m);m.preventDefault()}});l.bind("mousemove",function(m){if(k.enabled){if(g(m)){l.css("cursor",j)}else{l.css("cursor","")}}});var f=function(m){k.$apply(function(){if(k.width===0){k.width=l[0].offsetWidth}k.width+=m-h;if(k.width<k.minWidth){k.width=k.minWidth}});h=m};var g=function(n){var m=b.getOffset(n).x;return m>l[0].offsetWidth-e};var i=function(n){h=n.screenX;angular.element(c[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:j});var m=a(function(o){f(o.screenX)},5);angular.element(c[0].body).bind("mousemove",m);angular.element(c[0].body).one("mouseup",function(){angular.element(c[0].body).unbind("mousemove",m);d()})};var d=function(){l.css("cursor","");angular.element(c[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""});k.onResized({width:k.width})}}]}}]);gantt.directive("ganttRightClick",["$parse",function(a){return{restrict:"A",compile:function(c,b){var d=a(b.ganttRightClick);return function(f,e){e.on("contextmenu",function(g){f.$apply(function(){d(f,{$event:g})})})}}}}]);gantt.directive("ganttHorizontalScrollReceiver",function(){return{restrict:"A",require:"^scrollManager",controller:["$scope","$element",function(b,a){b.scrollManager.horizontal.push(a[0])}]}});gantt.directive("gantScrollManager",function(){return{restrict:"A",require:"^gantt",controller:["$scope",function(a){a.scrollManager={horizontal:[],vertical:[]}}]}});gantt.directive("ganttScrollSender",["$timeout",function(a){return{restrict:"A",require:"^scrollManager",controller:["$scope","$element",function(c,b){c.ganttScroll=b;c.ganttScroll.bind("scroll",c.raiseScrollEvent);var e=b[0];var d=function(){var h,g;for(h=0,g=c.scrollManager.vertical.length;h<g;h++){var f=c.scrollManager.vertical[h];if(f.style.top!==-e.scrollTop){f.style.top=-e.scrollTop+"px"}}for(h=0,g=c.scrollManager.horizontal.length;h<g;h++){var j=c.scrollManager.horizontal[h];if(j.style.left!==-e.scrollLeft){j.style.left=-e.scrollLeft+"px"}}};b.bind("scroll",d);c.$watch("gantt.width",function(g,f){if(g===0){a(function(){d()},0,true)}})}]}}]);gantt.directive("ganttVerticalScrollReceiver",function(){return{restrict:"A",require:"^scrollManager",controller:["$scope","$element",function(b,a){b.scrollManager.vertical.push(a[0])}]}});gantt.service("sortManager",[function(){return{startRow:undefined}}]);gantt.directive("ganttSortable",["$document","sortManager",function(b,a){return{restrict:"E",template:"<div ng-transclude></div>",replace:true,transclude:true,scope:{row:"=ngModel",swap:"&",active:"=?"},controller:["$scope","$element",function(d,c){c.bind("mousedown",function(){if(d.active!==true){return}e();var h=function(){d.$apply(function(){angular.element(b[0].body).unbind("mouseup",h);g()})};angular.element(b[0].body).bind("mouseup",h)});c.bind("mousemove",function(j){if(f()){var i=angular.element(b[0].elementFromPoint(j.clientX,j.clientY));var h=i.controller("ngModel").$modelValue;d.$apply(function(){d.swap({a:h,b:a.startRow})})}});var f=function(){return a.startRow!==undefined&&!angular.equals(d.row,a.startRow)};var e=function(){a.startRow=d.row;c.css("cursor","move");angular.element(b[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"no-drop"})};var g=function(){a.startRow=undefined;c.css("cursor","pointer");angular.element(b[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:"auto"})}}]}}]);gantt.directive("ganttBounds",[function(){return{restrict:"E",templateUrl:function(a,b){if(b.templateUrl===undefined){return"default.bounds.tmpl.html"}else{return b.templateUrl}},replace:true,scope:{task:"=ngModel"},controller:["$scope","$element",function(b,a){var c={};if(!b.task.hasBounds()){b.visible=false}b.getCss=function(){if(b.task.hasBounds()){c.width=b.task.bounds.width+"em";if(b.task.isMilestone===true||b.task.width===0){c.left=(b.task.bounds.left-(b.task.left-0.3))+"em"}else{c.left=(b.task.bounds.left-b.task.left)+"em"}}return c};b.getClass=function(){if(b.task.est===undefined||b.task.lct===undefined){return"gantt-task-bounds-in"}else{if(b.task.est>b.task.from){return"gantt-task-bounds-out"}else{if(b.task.lct<b.task.to){return"gantt-task-bounds-out"}else{return"gantt-task-bounds-in"}}}};b.$watch("task.isMouseOver",function(){if(b.task.hasBounds()&&!b.task.isMoving){b.visible=!(b.task.isMouseOver===undefined||b.task.isMouseOver===false)}});b.$watch("task.isMoving",function(e,d){if(b.task.hasBounds()){b.visible=e===true}})}]}}]);gantt.directive("ganttTask",["$window","$document","$timeout","smartEvent","debounce","dateFunctions","mouseOffset","mouseButton",function(h,g,c,d,b,f,e,a){return{restrict:"E",templateUrl:function(i,j){if(j.templateUrl===undefined){return"default.task.tmpl.html"}else{return j.templateUrl}},replace:true,controller:["$scope","$element",function(x,t){var B=5;var i=3;var u=15;var A=5;var k=angular.element(h);var D=t.parent().parent();var r=D.parent().parent();var z=false;var o;var v;var m;t.bind("mousedown",function(E){x.$apply(function(){var G=p(E);if(G!==""&&a.getButton(E)===1){var F=e.getOffsetForElement(D[0],E).x;s(G,F)}})});t.bind("click",function(E){x.$apply(function(){if(!z){x.raiseTaskClickedEvent(E,x.task)}E.stopPropagation()})});t.bind("dblclick",function(E){x.$apply(function(){if(!z){x.raiseTaskDblClickedEvent(E,x.task)}E.stopPropagation()})});t.bind("contextmenu",function(E){x.$apply(function(){if(!z){x.raiseTaskContextMenuEvent(E,x.task)}E.stopPropagation()})});t.bind("mousemove",b(function(E){var F=p(E);if(F!==""&&F!=="M"){t.css("cursor",j(F))}else{t.css("cursor","")}x.task.mouseX=E.clientX},5));t.bind("mouseenter",function(E){x.$apply(function(){x.task.mouseX=E.clientX;x.task.isMouseOver=true})});t.bind("mouseleave",function(){x.$apply(function(){x.task.isMouseOver=false})});var l=function(F,E){if(x.task.isMoving===false){return}w(F,E);q(F,E)};var w=function(H,E){x.task.mouseOffsetX=E.x;var F=E.x/x.getPxToEmFactor();if(H==="M"){if(x.allowTaskRowSwitching){var G=C(E.y);if(G!==undefined&&x.task.row.id!==G.id){G.moveTaskToRow(x.task)}}if(x.allowTaskMoving){x.task.moveTo(F-o)}}else{if(H==="E"){x.task.setTo(F)}else{x.task.setFrom(F)}}z=true};var q=function(J,E){var G=r[0].scrollLeft;var F=false;if(E.x<v){if(E.x<=G+A){E.x-=u;F=true;x.scrollLeft(u)}}else{var H=r[0].offsetWidth;var I=G+H;if(E.x>=I-A){E.x+=u;F=true;x.scrollRight(u)}}if(F){m=c(function(){l(J,E)},100,true)}};var y=function(){if(m!==undefined){c.cancel(m);m=undefined}};var C=function(G){var E=D[0].offsetHeight/x.task.row.gantt.rows.length;var F=Math.floor(G/E);return x.task.row.gantt.rows[F]};var p=function(F){var E=e.getOffset(F).x;var G=0;if(x.allowTaskResizing){G=t[0].offsetWidth<10?i:B}if(x.allowTaskResizing&&E>t[0].offsetWidth-G){return"E"}else{if(x.allowTaskResizing&&E<G){return"W"}else{if((x.allowTaskMoving||x.allowTaskRowSwitching)&&E>=G&&E<=t[0].offsetWidth-G){return"M"}else{return""}}}};var j=function(E){switch(E){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}};var s=function(H,E){if(!x.task.isMoving){if(H==="M"){x.raiseTaskMoveStartEvent(x.task)}else{x.raiseTaskResizeStartEvent(x.task)}}z=false;x.task.moveMode=H;x.task.isMoving=true;v=E;var F=v/x.getPxToEmFactor();o=F-x.task.modelLeft;var G=b(function(I){c(function(){var J=e.getOffsetForElement(D[0],I);y();l(H,J)})},5);d(x,k,"mousemove",G).bind();d(x,k,"mouseup",function(){x.$apply(function(){k.unbind("mousemove",G);n()})}).bindOnce();angular.element(g[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:j(H)})};var n=function(){x.task.isMoving=false;y();t.css("cursor","");angular.element(g[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""});if(x.task.moveMode==="M"){x.raiseTaskMoveEndEvent(x.task)}else{x.raiseTaskResizeEndEvent(x.task)}x.task.modeMode=null;if(z===true){x.task.row.sortTasks();x.raiseTaskUpdatedEvent(x.task,true)}};if(x.task.isCreating){delete x.task.isCreating;s("E",x.task.mouseOffsetX)}else{if(x.task.isMoving){s("M",x.task.mouseOffsetX)}}}]}}]);gantt.directive("ganttTooltip",["$timeout","$document","debounce","smartEvent",function(b,d,a,c){return{restrict:"E",templateUrl:function(e,f){if(f.templateUrl===undefined){return"default.tooltip.tmpl.html"}else{return f.templateUrl}},replace:true,scope:{task:"=ngModel"},controller:["$scope","$element",function(l,m){var g=angular.element(d[0].body);var k=m.parent();l.visible=false;l.css={};l.$watch("task.isMouseOver",function(o,n){if(o===true){j(l.task.mouseX)}else{if(o===false&&l.task.isMoving===false){i()}}});var h=c(l,g,"mousemove",a(function(n){if(l.visible===true){f(n.clientX)}else{j(n.clientX)}},1));l.$watch("task.isMoving",function(o,n){if(o===true){h.bind()}else{if(o===false){h.unbind();i()}}});var e=function(){var n=d[0];return n.documentElement.clientWidth||n.documentElement.getElementById("body")[0].clientWidth};var j=function(n){l.visible=true;b(function(){f(n);l.css.top=k[0].getBoundingClientRect().top+"px";l.css.marginTop=-m[0].offsetHeight-8+"px";l.css.opacity=1},1,true)};var f=function(n){m.removeClass("gantt-task-infoArrow");m.removeClass("gantt-task-infoArrowR");if(n+m[0].offsetWidth>e()){l.css.left=(n+20-m[0].offsetWidth)+"px";m.addClass("gantt-task-infoArrowR")}else{l.css.left=(n-20)+"px";m.addClass("gantt-task-infoArrow")}};var i=function(){l.css.opacity=0;l.visible=false}}]}}]);gantt.factory("debounce",["$timeout",function(b){function a(c,d){var e=0;return function(){var g=this;var h=arguments;e++;var f=(function(i){return function(){if(i===e){return c.apply(g,h)}}})(e);return b(f,d,true)}}return a}]);gantt.factory("keepScrollPos",["$timeout",function(a){function b(c,d){return function(){if(c.ganttScroll){var f=c.ganttScroll[0];var h=f.scrollLeft;var g=c.gantt.getFirstColumn();var e=c.getPxToEmFactor();d.apply(this,arguments);g=g===undefined?0:c.gantt.getColumnByDate(g.date).left*e;f.scrollLeft=g+h;if(f.scrollLeft!=g+h){a(function(){f.scrollLeft=g+h},0,false)}}else{d.apply(this,arguments)}}}return b}]);gantt.service("mouseButton",[function(){return{getButton:function(a){a=a||window.event;if(!a.which){return a.button<2?1:a.button==4?2:3}else{return a.which}}}}]);gantt.service("mouseOffset",[function(){return{getOffset:function(a){if(a.offsetX&&a.offsetY){return{x:a.offsetX,y:a.offsetY}}if(a.layerX&&a.layerY){return{x:a.layerX,y:a.layerY}}else{return this.getOffsetForElement(a.target,a)}},getOffsetForElement:function(b,a){var c=b.getBoundingClientRect();return{x:a.clientX-c.left,y:a.clientY-c.top}}}}]);gantt.factory("smartEvent",[function(){function a(c,b,e,d){c.$on("$destroy",function(){b.unbind(e,d)});return{bindOnce:function(){b.one(e,d)},bind:function(){b.bind(e,d)},unbind:function(){b.unbind(e,d)}}}return a}]);