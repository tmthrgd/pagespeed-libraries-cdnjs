!function(){"use strict";angular.module("gantt.movable",["gantt"]).directive("ganttMovable",["ganttMouseButton","ganttMouseOffset","ganttSmartEvent","ganttMovableOptions","ganttUtils","$window","$document","$timeout",function(t,e,a,o,s,i,n,r){return{restrict:"E",require:"^gantt",scope:{enabled:"=",allowMoving:"=?",allowResizing:"=?",allowRowSwitching:"=?"},link:function(l,g,k,d){var v=d.gantt.api;if(l.options&&"object"==typeof l.options.movable)for(var w in l.options.movable)l[w]=l.options[w];o.initialize(l),v.registerEvent("tasks","move"),v.registerEvent("tasks","moveBegin"),v.registerEvent("tasks","moveEnd"),v.registerEvent("tasks","resize"),v.registerEvent("tasks","resizeBegin"),v.registerEvent("tasks","resizeEnd"),v.registerEvent("tasks","change");var c="ontouchstart"in i||i.DocumentTouch&&n[0]instanceof i.DocumentTouch,m="touchstart mousedown",u="touchmove mousemove",f="touchend mouseup";v.directives.on.new(l,function(o,g,k){if("ganttTask"===o){var d,v,w,M=5,b=3,p=15,h=5,R=angular.element(i),z=g.row.rowsManager.gantt.body.$element,E=g.row.rowsManager.gantt.scroll.$element,O=!1;k.on(m,function(a){a.preventDefault(),c&&(a=e.getTouch(a));var o=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"enabled",l.enabled);if(o){var i=e.getOffset(a).x,n=P(i);if(""!==n&&1===t.getButton(a)){var r=e.getOffsetForElement(z[0],a).x;B(n,r)}g.$digest()}}),k.on("mousemove",function(t){var a=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"enabled",l.enabled);if(a){var o=e.getOffset(t).x,i=P(o);""===i||!g.task.isMoving&&"M"===i?k.css("cursor",""):k.css("cursor",S(i))}});var $=function(t,e){y(t,e),T(t,e)},y=function(t,a){var o=e.getOffsetForElement(z[0],a),i=o.x;if(g.task.mouseOffsetX=i,"M"===t){var n=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"allowRowSwitching",l.allowRowSwitching);if(n){var r=E[0].getBoundingClientRect(),k=s.scopeFromPoint(r.left,a.clientY),v=k.row,w=g.task.row;void 0!==v&&w!==v&&(v.moveTaskToRow(g.task,!0),w.$element.scope().$digest(),v.$element.scope().$digest())}var c=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"allowMoving",l.allowMoving);c&&(i-=d,"truncate"!==g.taskOutOfRange&&(0>i?i=0:i+g.task.width>=g.gantt.width&&(i=g.gantt.width-g.task.width)),g.task.moveTo(i),g.$digest(),g.row.rowsManager.gantt.api.tasks.raise.move(g.task))}else"E"===t?("truncate"!==g.taskOutOfRange&&(i<g.task.left?i=g.task.left:i>g.gantt.width&&(i=g.gantt.width)),g.task.setTo(i),g.$digest(),g.row.rowsManager.gantt.api.tasks.raise.resize(g.task)):("truncate"!==g.taskOutOfRange&&(i>g.task.left+g.task.width?i=g.task.left+g.task.width:0>i&&(i=0)),g.task.setFrom(i),g.$digest(),g.row.rowsManager.gantt.api.tasks.raise.resize(g.task));O=!0},T=function(t,a){var o=e.getOffsetForElement(z[0],a),s=E[0].scrollLeft,i=E[0].offsetWidth,n=E[0].scrollWidth,l=s+i,k=!1;o.x<v?s>0&&o.x<=s+h&&(o.x-=p,k=!0,g.row.rowsManager.gantt.api.scroll.left(p)):n>l&&o.x>=l-h&&(o.x+=p,k=!0,g.row.rowsManager.gantt.api.scroll.right(p)),k&&(w=r(function(){$(t,a)},100,!0))},x=function(){void 0!==w&&(r.cancel(w),w=void 0)},P=function(t){var e=0,a=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"allowResizing",l.allowResizing),o=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"allowRowSwitching",l.allowRowSwitching),i=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"allowMoving",l.allowMoving);return a&&(e=k[0].offsetWidth<10?b:M),a&&t>k[0].offsetWidth-e?"E":a&&e>t?"W":(i||o)&&t>=e&&t<=k[0].offsetWidth-e?"M":""},S=function(t){switch(t){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},B=function(t,o){void 0===g.task.originalModel&&(g.task.originalRow=g.task.row,g.task.originalModel=g.task.model,g.task.model=angular.copy(g.task.originalModel)),"M"===t?(k.addClass("gantt-task-moving"),g.task.isMoving||g.row.rowsManager.gantt.api.tasks.raise.moveBegin(g.task)):(k.addClass("gantt-task-resizing"),g.task.isMoving||g.row.rowsManager.gantt.api.tasks.raise.resizeBegin(g.task)),O=!1,g.task.moveMode=t,g.task.isMoving=!0,g.task.active=!0,v=o,d=o-g.task.modelLeft;var s=function(a){a.stopImmediatePropagation(),c&&(a=e.getTouch(a)),g.task.isMoving&&(x(),$(t,a))},i=a(g,R,u,s);i.bind(),a(g,R,f,function(t){c&&(t=e.getTouch(t)),i.unbind(),W(t),g.$digest()}).bindOnce(),k.css("cursor",S(t)),angular.element(n[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:S(t)})},W=function(){if(k.removeClass("gantt-task-moving"),k.removeClass("gantt-task-resizing"),void 0!==g.task.originalModel){if(angular.extend(g.task.originalModel,g.task.model),g.task.model=g.task.originalModel,g.task.row.model.id!==g.task.originalRow.model.id){var t=g.task.row;t.removeTask(g.task.model.id),g.task.row=g.task.originalRow,t.moveTaskToRow(g.task,!1)}delete g.task.originalModel,delete g.task.originalRow,g.$apply()}g.task.isMoving=!1,g.task.active=!1,x(),k.css("cursor",""),angular.element(n[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""}),"M"===g.task.moveMode?g.row.rowsManager.gantt.api.tasks.raise.moveEnd(g.task):g.row.rowsManager.gantt.api.tasks.raise.resizeEnd(g.task),g.task.moveMode=void 0,O===!0&&(O=!1,g.task.row.sortTasks(),g.row.rowsManager.gantt.api.tasks.raise.change(g.task))};g.task.isResizing?(delete g.task.isResizing,B("E",g.task.mouseOffsetX)):g.task.isMoving&&B("M",g.task.mouseOffsetX)}})}}}])}(),function(){"use strict";angular.module("gantt.movable").factory("ganttMovableOptions",[function(){return{initialize:function(t){return t.enabled=void 0!==t.enabled?!!t.enabled:!0,t.allowMoving=void 0!==t.allowMoving?!!t.allowMoving:!0,t.allowResizing=void 0!==t.allowResizing?!!t.allowResizing:!0,t.allowRowSwitching=void 0!==t.allowRowSwitching?!!t.allowRowSwitching:!0,t}}}])}();