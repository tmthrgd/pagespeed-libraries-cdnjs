/*! angular-gantt 10-11-2013 */
var gantt=angular.module("gantt",[]);gantt.directive("gantt",["Gantt","dateFunctions",function(a,b){return{restrict:"EA",replace:!0,templateUrl:function(a,b){return void 0===b.templateUrl?"template/gantt.tmpl.html":b.templateUrl},scope:{viewScale:"=?",viewScaleFactor:"=?",sortMode:"=?",taskPrecision:"=?",autoExpand:"=?",fromDate:"=?",toDate:"=?",firstDayOfWeek:"=?",weekendDays:"=?",showWeekends:"=?",workHours:"=?",showNonWorkHours:"=?",maxHeight:"=?",data:"=?",loadData:"&",removeData:"&",clearData:"&",onGanttReady:"&",onRowAdded:"&",onRowClicked:"&",onRowUpdated:"&",onScroll:"&",onTaskClicked:"&"},controller:["$scope","$element","$timeout",function(c,d,e){void 0===c.autoExpand&&(c.autoExpand=!1),void 0===c.sortMode&&(c.sortMode="name"),void 0===c.viewScale&&(c.viewScale="day"),void 0===c.viewScaleFactor&&(c.viewScaleFactor=.1),void 0===c.taskPrecision&&(c.taskPrecision=4),void 0===c.firstDayOfWeek&&(c.firstDayOfWeek=1),void 0===c.maxHeight&&(c.maxHeight=0),void 0===c.weekendDays&&(c.weekendDays=[0,6]),void 0===c.showWeekends&&(c.showWeekends=!0),void 0===c.workHours&&(c.workHours=[8,9,10,11,12,13,14,15,16]),void 0===c.showNonWorkHours&&(c.showNonWorkHours=!0),c.ganttInnerWidth=0,c.gantt=new a(c.weekendDays,c.showWeekends,c.workHours,c.showNonWorkHours),c.getBodyColumns=function(){return"hour"===c.viewScale?c.gantt.columns.hours:c.gantt.columns.days},c.swapRows=function(a,b){c.gantt.swapRows(a,b),c.raiseRowUpdated(a),c.raiseRowUpdated(b),"custom"!==c.sortMode?c.sortMode="custom":c.sortRows()},c.sortRows=function(){c.gantt.sortRows(c.sortMode)},c.$watch("sortMode",function(a,b){angular.equals(a,b)||c.sortRows()}),c.$watch("data",function(a,b){angular.equals(a,b)||(c.removeAllData(),c.setData(a))}),c.$watch("viewScale+viewScaleFactor+firstDayOfWeek",function(a,b){angular.equals(a,b)||c.updateBounds()}),c.$watch("weekendDays+showWeekends+workHours+showNonWorkHours",function(a,b){angular.equals(a,b)||(c.gantt.weekendDays=c.weekendDays,c.gantt.showWeekends=c.showWeekends,c.gantt.workHours=c.workHours,c.gantt.showNonWorkHours=c.showNonWorkHours,c.gantt.reGenerateColumns(),c.updateBounds())}),c.updateBounds=function(){var a,b;for(c.updateColumnBounds(),a=0,b=c.gantt.rows.length;b>a;a++)for(var d=c.gantt.rows[a],e=0,f=d.tasks.length;f>e;e++)c.updateTaskBounds(d.tasks[e]);var g=c.gantt.columns.getLast();c.ganttInnerWidth=null!==g?g.left+g.width:0},c.updateTaskBounds=function(a){var b=function(a){return a.date},d=c.calcClosestColumns(a.from,b),e=c.calcClosestColumns(a.to,b);a.left=f(d[0],a),a.width=Math.round(10*(f(e[0],a)-a.left))/10,0===a.width&&(a.width=d[0].width/c.taskPrecision)};var f=function(a,b){return Math.round(10*(a.left+a.width*g(b.from,c.taskPrecision)))/10},g=function(a,b){return"hour"===c.viewScale?Math.round(a.getMinutes()/60*b)/b:Math.round(a.getHours()/24*b)/b};c.updateColumnBounds=function(){var a,d,e=0,f=-1,g=-1,i=-1;for(a=0,d=c.gantt.columns.hours.length;d>a;a++){var j=c.gantt.columns.hours[a];j.width=c.viewScaleFactor,j.left=e,e=Math.round(10*(e+j.width))/10,f=h(c.gantt.columns.days,f,j.width,f>-1?c.gantt.columns.days[f].date.getDate()!==j.date.getDate():!0),g=h(c.gantt.columns.weeks,g,j.width,g>-1?c.gantt.columns.weeks[g].week!==b.getWeek(j.date):!0),i=h(c.gantt.columns.months,i,j.width,i>-1?c.gantt.columns.months[i].date.getMonth()!==j.date.getMonth():!0)}};var h=function(a,b,c,d){var e=a[b];return void 0===e||d?(b+=1,e=a[b],e.left=Math.round(10*(b>0?a[b-1].left+a[b-1].width:0))/10,e.width=c):e.width=Math.round(10*(e.width+c))/10,b};c.autoExpandColumns=function(a,d,e){if(c.autoExpand===!0){var f,g,h=1,i=30;"left"===e?(f="hour"===c.viewScale?b.addDays(d,-h,!0):b.addDays(d,-i,!0),g=d):(f=d,g="hour"===c.viewScale?b.addDays(d,h,!0):b.addDays(d,i,!0));var j=0===a.scrollLeft?(g-f)*a.scrollWidth/(c.gantt.columns.getLast().date-c.gantt.columns.getFirst().date):a.scrollLeft;c.gantt.expandColumns(f,g),c.updateBounds(),a.scrollLeft=j}},c.raiseRowAdded=function(a){c.onRowAdded({event:{row:a.clone()}})},c.calcClosestColumns=function(a,b){for(var d=c.getBodyColumns(),e=-1,f=d.length;f-e>1;){var g=Math.floor((e+f)/2);b(d[g])<=a?e=g:f=g}return void 0!==d[e]&&b(d[e])===a&&(f=e),[d[e],d[f]]},c.getOffset=function(a){if(a.layerX&&a.layerY)return{x:a.layerX,y:a.layerY};var b,c,d=a.target;for(b=c=0;d&&!isNaN(d.offsetLeft)&&!isNaN(d.offsetTop);)b+=d.offsetLeft-d.scrollLeft,c+=d.offsetTop-d.scrollTop,d=d.offsetParent;return b=a.clientX-b,c=a.clientY-c,{x:b,y:c}},c.raiseRowClicked=function(a,d){var e=c.ganttScroll.children()[0].offsetWidth/c.ganttInnerWidth,f=c.calcClosestColumns(c.getOffset(a).x/e,function(a){return a.left})[0];c.onRowClicked({event:{row:d.clone(),column:f.clone(),date:b.clone(f.date)}}),a.stopPropagation(),a.preventDefault()},c.raiseRowUpdated=function(a){c.onRowUpdated({event:{row:a.clone()}})},c.raiseScrollEvent=function(){var a,d=c.ganttScroll[0],f=null;0===d.scrollLeft?(f="left",a=b.clone(c.gantt.columns.getFirst().date)):d.offsetWidth+d.scrollLeft>=d.scrollWidth&&(f="right",a=b.clone(c.gantt.columns.getLast().date)),null!==f&&e(function(){c.autoExpandColumns(d,a,f),c.onScroll({event:{date:a,direction:f}})},500,!0)},c.raiseTaskClicked=function(a,b,d){var e=b.clone();c.onTaskClicked({event:{row:e,task:e.tasksMap[d.id]}}),a.stopPropagation(),a.preventDefault()},c.removeAllData=function(){c.gantt.removeRows(),c.updateBounds()},c.ganttScroll=angular.element(d.children()[2]),c.ganttScroll.bind("scroll",c.raiseScrollEvent),c.setData=function(a){for(var b=c.ganttScroll[0],d=c.gantt.columns.hours.length>0?c.gantt.columns.getLast().date-c.gantt.columns.getFirst().date:1,e=b.scrollWidth,f=0,g=a.length;g>f;f++){var h=a[f],i=c.gantt.addRow(h),j=c.gantt.rowsMap[h.id];i===!0?c.raiseRowUpdated(j):c.raiseRowAdded(j)}if(c.fromDate||c.toDate){var k=c.fromDate?c.fromDate:c.gantt.columns.getFirst().date,l=c.toDate?c.toDate:c.gantt.columns.getLast().date;void 0!==k&&void 0!==l&&c.gantt.expandColumns(k,l)}c.updateBounds(),c.sortRows(),b.scrollLeft=0===b.scrollLeft&&c.gantt.columns.hours.length>0?(c.gantt.columns.getLast().date-c.gantt.columns.getFirst().date)*e/d-e:b.scrollLeft},c.loadData({fn:c.setData}),c.removeData({fn:function(a){for(var b=0,d=a.length;d>b;b++){var e=a[b];if(void 0!==e.tasks&&e.tasks.length>0){if(e.id in c.gantt.rowsMap){for(var f=c.gantt.rowsMap[e.id],g=0,h=e.tasks.length;h>g;g++)f.removeTask(e.tasks[g].id);c.raiseRowUpdated(f)}}else c.gantt.removeRow(e.id)}c.updateBounds(),c.sortRows()}}),c.clearData({fn:c.removeAllData}),c.onGanttReady()}]}}]),gantt.factory("Column",[function(){var a=function(b){var c=this;c.date=b,c.left=0,c.width=0,c.copy=function(){var b=new a(c.date);return b.left=c.left,b.width=c.width,b}},b=function(b){var c=new a(b);return c.clone=function(){return c.copy()},c},c=function(b,c){var d=new a(b);return d.week=c,d.clone=function(){var a=d.copy();return a.week=d.week,a},d},d=function(b,c){var d=new a(b);return d.isWeekend=c,d.clone=function(){var a=d.copy();return a.isWeekend=d.isWeekend,a},d},e=function(b,c,d){var e=new a(b);return e.isWeekend=c,e.isWorkHour=d,e.clone=function(){var a=e.copy();return a.isWeekend=e.isWeekend,a.isWorkHour=e.isWorkHour,a},e};return{Hour:e,Day:d,Week:c,Month:b}}]),gantt.service("dateFunctions",[function(){return{firstDayOfWeek:1,isNumber:function(a){return!isNaN(parseFloat(a))&&isFinite(a)},isString:function(a){return"string"==typeof a||"object"==typeof a&&a.constructor===String},clone:function(a){return this.isString(a)?new Date(Date.parse(a)):this.isNumber(a)?new Date(a):new Date(a.getTime())},setTimeZero:function(a,b){var c=b===!0?this.clone(a):a;return c.setHours(0),c.setMinutes(0),c.setMilliseconds(0),c},setToFirstDayOfMonth:function(a,b){var c=b===!0?this.clone(a):a;return c.setDate(1),c},setToDayOfWeek:function(a,b,c){var d=c===!0?this.clone(a):a;if(d.getDay()===b)return d;var e=-1,f=(b-d.getDay()+7*(e||1))%7;return this.addDays(d,0===f?f+=7*(e||1):f)},addMonths:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(1),d.setMonth(d.getMonth()+b),d},addWeeks:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+7*b),d},addDays:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setDate(d.getDate()+b),d},addHours:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setHours(d.getHours()+b),d},addMinutes:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMinutes(d.getMinutes()+b),d},addMilliseconds:function(a,b,c){var d=c===!0?this.clone(a):a;return d.setMilliseconds(d.getMilliseconds()+b),d},getWeek:function(a){var b,c,d,e,f,g,h,i,j,k,l,m,n;return b=a.getFullYear(),c=a.getMonth()+1,d=a.getDate(),2>=c?(e=b-1,f=(0|e/4)-(0|e/100)+(0|e/400),g=(0|(e-1)/4)-(0|(e-1)/100)+(0|(e-1)/400),m=f-g,i=0,j=d-1+31*(c-1)):(e=b,f=(0|e/4)-(0|e/100)+(0|e/400),g=(0|(e-1)/4)-(0|(e-1)/100)+(0|(e-1)/400),m=f-g,i=m+1,j=d+(153*(c-3)+2)/5+58+m),k=(e+f)%7,h=(j+k-i)%7,l=0|j+3-h,n=0>l?53-(0|(k-m)/5):l>364+m?1:(0|l/7)+1,b=c=d=null,n}}}]),gantt.factory("Gantt",["Row","Column","dateFunctions",function(a,b,c){var d=function(d,e,f,g){var h=this;h.rowsMap={},h.rows=[],h.highestRowOrder=0,h.weekendDays=d,h.showWeekends=e,h.workHours=f,h.showNonWorkHours=g;var i=function(){var a=this;a.months=[],a.weeks=[],a.days=[],a.hours=[],a.getLast=function(){return a.hours.length>0?a.hours[a.hours.length-1]:null},a.getFirst=function(){return a.hours.length>0?a.hours[0]:null},a.prepend=function(b){b.weeks.length>0&&a.weeks[0].week===b.weeks[b.weeks.length-1].week&&b.weeks.splice(b.weeks.length-1,1),b.months.length>0&&a.months[0].date.getMonth()===b.months[b.months.length-1].date.getMonth()&&b.months.splice(b.months.length-1,1),a.hours.unshift.apply(a.hours,b.hours),a.days.unshift.apply(a.days,b.days),a.weeks.unshift.apply(a.weeks,b.weeks),a.months.unshift.apply(a.months,b.months)}};h.columns=new i,h.expandColumns=function(a,b){var d=h.columns.getFirst(),e=h.columns.getLast();a=c.setTimeZero(a,!0),b=c.setTimeZero(b,!0),0===h.columns.hours.length?j(a,b):a<d.date?j(a,c.addDays(c.setTimeZero(d.date,!0),-1)):b>e.date&&j(c.addDays(c.setTimeZero(e.date,!0),1),b)};var j=function(a,d){var e,f=c.clone(a);for(e=0===h.columns.hours.length||a>h.columns.getFirst().date?h.columns:new i;d-f>=0;){for(var g=h.isWeekend(f.getDay()),j=!1,k=0;24>k;k++){var l=new Date(f.getFullYear(),f.getMonth(),f.getDate(),k,0,0),m=h.isWorkHour(k);(g&&h.showWeekends||!g)&&(!m&&h.showNonWorkHours||m)&&(e.hours.push(new b.Hour(l,g,m)),j=!0)}if(j){var n=e.days;(0===n.length||n[n.length-1].date.getDate()!==f.getDate())&&n.push(new b.Day(new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0),g));var o=e.weeks,p=c.getWeek(f);(0===o.length||o[o.length-1].week!==p)&&o.push(new b.Week(new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0),p));var q=e.months;(0===q.length||q[q.length-1].date.getMonth()!==f.getMonth())&&q.push(new b.Month(new Date(f.getFullYear(),f.getMonth(),f.getDate(),0,0,0)))}f=c.addDays(f,1)}h.columns!=e&&h.columns.prepend(e)};h.reGenerateColumns=function(){var a=h.columns.getFirst().date,b=h.columns.getLast().date;h.columns=new i,void 0!==a&&void 0!==b&&h.expandColumns(a,b)},h.addRow=function(b){var c,d=!1;if(b.id in h.rowsMap)c=h.rowsMap[b.id],c.copy(b),d=!0;else{var e=b.order;void 0===e&&(e=h.highestRowOrder),e>=h.highestRowOrder&&(h.highestRowOrder=e+1),c=new a(b.id,b.description,e,b.data),h.rowsMap[b.id]=c,h.rows.push(c)}if(void 0!==b.tasks)for(var f=0,g=b.tasks.length;g>f;f++){var i=c.addTask(b.tasks[f]);h.expandColumns(i.from,i.to)}return d},h.removeRow=function(a){if(a in h.rowsMap){delete h.rowsMap[a];for(var b=0,c=h.rows.length;c>b;b++){var d=h.rows[b];if(d.id===a)return h.rows.splice(b,1),d}}},h.removeRows=function(){h.rowsMap={},h.rows=[],h.highestRowOrder=0,h.columns=new i},h.swapRows=function(a,b){var c=a.order;a.order=b.order,b.order=c};var k=function(a,b){return void 0===a.minFromDate&&void 0===b.minFromDate?l(a,b):void 0===a.minFromDate?1:void 0===b.minFromDate?-1:a.minFromDate-b.minFromDate},l=function(a,b){return a.description===b.description?0:a.description<b.description?-1:1},m=function(a,b){return void 0===a.order&&void 0===b.order?l(a,b):void 0===a.order?1:void 0===b.order?-1:a.order-b.order};h.sortRows=function(a){switch(a){case"name":h.rows.sort(l);break;case"custom":h.rows.sort(m);break;default:h.rows.sort(k)}},h.isWeekend=function(a){for(var b=0,c=h.weekendDays.length;c>b;b++)if(h.weekendDays[b]===a)return!0;return!1},h.isWorkHour=function(a){for(var b=0,c=h.workHours.length;c>b;b++)if(h.workHours[b]===a)return!0;return!1}};return d}]),gantt.factory("Row",["Task","dateFunctions",function(a,b){var c=function(d,e,f,g){var h=this;h.id=d,h.description=e,h.order=f,h.tasksMap={},h.tasks=[],h.data=g,h.addTask=function(b){var c;return b.id in h.tasksMap?(c=h.tasksMap[b.id],c.copy(b)):(c=new a(b.id,b.subject,b.color,b.from,b.to,b.data),h.tasksMap[b.id]=c,h.tasks.push(c)),h.findEarliestFromDate(c),c},h.removeTask=function(a){if(a in h.tasksMap){delete h.tasksMap[a];for(var b=0,c=h.tasks.length;c>b;b++){var d=h.tasks[b];if(d.id===a){if(h.tasks.splice(b,1),0===h.minFromDate-d.from){h.minFromDate=void 0;for(var e=0,f=h.tasks.length;f>e;e++)h.findEarliestFromDate(h.tasks[e])}return d}}}},h.findEarliestFromDate=function(a){void 0===h.minFromDate?h.minFromDate=b.clone(a.from):a.from<h.minFromDate&&(h.minFromDate=b.clone(a.from))},h.copy=function(a){h.description=a.description,h.data=a.data,void 0!==a.order&&(h.order=a.order)},h.clone=function(){for(var a=new c(h.id,h.description,h.order,h.data),b=0,d=h.tasks.length;d>b;b++)a.addTask(h.tasks[b].clone());return a}};return c}]),gantt.factory("Task",["dateFunctions",function(a){var b=function(c,d,e,f,g,h){var i=this;i.id=c,i.subject=d,i.color=e,i.from=a.clone(f),i.to=a.clone(g),i.data=h,i.copy=function(b){i.subject=b.subject,i.color=b.color,i.from=a.clone(b.from),i.to=a.clone(b.to),i.data=b.data},i.clone=function(){return new b(i.id,i.subject,i.color,i.from,i.to,i.data)}};return b}]),gantt.filter("ganttColumnLimit",[function(){var a=function(a,b){for(var c=-1,d=a.length;d-c>1;){var e=Math.floor((c+d)/2);a[e].left<=b?c=e:d=e}return void 0!==a[c]&&a[c].left===b&&(d=c),[c,d]};return function(b,c,d,e){if(e===!0)return[];var f=a(b,c)[0],g=a(b,c+d)[1];return b.slice(f,g)}}]),gantt.filter("ganttDateWeek",["dateFunctions",function(a){return function(b){return a.getWeek(b)}}]),gantt.directive("ganttHorizontalScrollReceiver",["scroller",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){a.horizontal.push(c[0])}]}}]),gantt.directive("ganttLimitUpdater",["$timeout",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){var d=c[0],e=function(){var a=b.ganttScroll.children()[0].offsetWidth/b.ganttInnerWidth;b.scroll_start=d.scrollLeft/a,b.scroll_width=d.offsetWidth/a};c.bind("scroll",function(){b.$apply(function(){e()})}),b.$watch("ganttInnerWidth",function(){a(function(){e()},20,!0)})}]}}]),gantt.directive("ganttScrollSender",["scroller","$timeout",function(a,b){return{restrict:"A",controller:["$scope","$element",function(c,d){var e=d[0],f=function(){var b,c;for(b=0,c=a.vertical.length;c>b;b++){var d=a.vertical[b];d.style.top!==-e.scrollTop&&(d.style.top=-e.scrollTop+"px")}for(b=0,c=a.horizontal.length;c>b;b++){var f=a.horizontal[b];f.style.left!==-e.scrollLeft&&(f.style.left=-e.scrollLeft+"px")}};d.bind("scroll",f),c.$watch("ganttInnerWidth",function(a){0===a&&b(function(){f()},20,!0)})}]}}]),gantt.service("scroller",[function(){return{vertical:[],horizontal:[]}}]),gantt.directive("ganttSortable",["$document","sortableState",function(a,b){return{restrict:"E",template:"<div ng-transclude></div>",replace:!0,transclude:!0,scope:{row:"=ngModel",swap:"&"},controller:["$scope","$element",function(c,d){d.bind("mousedown",function(){f();var b=function(){angular.element(a[0].body).unbind("mouseup",b),g()};angular.element(a[0].body).bind("mouseup",b)}),d.bind("mousemove",function(d){if(e()){var f=angular.element(a[0].elementFromPoint(d.clientX,d.clientY)),g=f.controller("ngModel").$modelValue;c.$apply(function(){c.swap({a:g,b:b.startRow})})}});var e=function(){return void 0!==b.startRow&&!angular.equals(c.row,b.startRow)},f=function(){b.startRow=c.row,d.css("cursor","move"),angular.element(a[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:"no-drop"})},g=function(){b.startRow=void 0,d.css("cursor","pointer"),angular.element(a[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:"auto"})}}]}}]),gantt.service("sortableState",[function(){return{startRow:void 0}}]),gantt.filter("ganttTaskLimit",[function(){return function(a,b,c){for(var d=[],e=0,f=a.length;f>e;e++){var g=a[e];(g.left>=b&&g.left<=b+c||g.left+g.width>=b&&g.left+g.width<=b+c||g.left<b&&g.left+g.width>b+c)&&d.push(g)}return d}}]),gantt.directive("ganttTooltip",["dateFilter","$timeout","$document",function(a,b,c){return{restrict:"E",template:"<div ng-mouseenter='mouseEnter($event)' ng-mouseleave='mouseLeave($event)'><div ng-show='visible' class='gantt-task-info' ng-style='css'><div class='gantt-task-info-content'>{{ task.subject }}</br><small>{{ task.to - task.from === 0 && (task.from | date:'MMM d, HH:mm') || (task.from | date:'MMM d, HH:mm') + ' - ' + (task.to | date:'MMM d, HH:mm') }}</small></div></div><div ng-transclude></div></div>",replace:!0,transclude:!0,scope:{task:"=ngModel"},controller:["$scope","$element",function(a,d){a.visible=!1,a.css={},a.mouseEnter=function(c){a.visible=!0,b(function(){var b=angular.element(d.children()[0]);b.removeClass("gantt-task-infoArrow"),b.removeClass("gantt-task-infoArrowR"),c.clientX+b[0].offsetWidth>a.getViewPortWidth()?(a.css.left=c.clientX+20-b[0].offsetWidth+"px",b.addClass("gantt-task-infoArrowR")):(a.css.left=c.clientX-20+"px",b.addClass("gantt-task-infoArrow")),a.css.top=d[0].getBoundingClientRect().top+"px",a.css.marginTop=-b[0].offsetHeight-8+"px",a.css.opacity=1},1,!0)},a.mouseLeave=function(){a.css.opacity=0,a.visible=!1},a.getViewPortWidth=function(){var a=c[0];return a.documentElement.clientWidth||a.documentElement.getElementById("body")[0].clientWidth}}]}}]),gantt.directive("ganttVerticalScrollReceiver",["scroller",function(a){return{restrict:"A",controller:["$scope","$element",function(b,c){a.vertical.push(c[0])}]}}]);