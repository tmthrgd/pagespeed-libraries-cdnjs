!function(){"use strict";angular.module("gantt.movable",["gantt"]).directive("ganttMovable",["ganttMouseButton","ganttMouseOffset","ganttSmartEvent","ganttMovableOptions","ganttUtils","$window","$document","$timeout",function(t,e,a,o,s,n,i,r){return{restrict:"E",require:"^gantt",scope:{enabled:"=?",allowMoving:"=?",allowResizing:"=?",allowRowSwitching:"=?"},link:function(l,g,k,d){var v=d.gantt.api;if(l.options&&"object"==typeof l.options.movable)for(var w in l.options.movable)l[w]=l.options[w];o.initialize(l),v.registerEvent("tasks","move"),v.registerEvent("tasks","moveBegin"),v.registerEvent("tasks","moveEnd"),v.registerEvent("tasks","resize"),v.registerEvent("tasks","resizeBegin"),v.registerEvent("tasks","resizeEnd"),v.registerEvent("tasks","change");var m,c,u="ontouchstart"in n||n.DocumentTouch&&i[0]instanceof n.DocumentTouch,f="touchstart mousedown",M="touchmove mousemove",b="touchend mouseup",h=5,p=3,R=15,z=5;v.directives.on.new(l,function(o,g,k){if("ganttTask"===o){var v,w=angular.element(n),E=g.row.rowsManager.gantt.body.$element,O=g.row.rowsManager.gantt.scroll.$element,$=!1;k.on(f,function(a){a.preventDefault(),u&&(a=e.getTouch(a));var o=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"enabled",l.enabled);if(o){var n=e.getOffset(a).x,i=S(n);if(""!==i&&1===t.getButton(a)){var r=e.getOffsetForElement(E[0],a).x;W(i,r)}g.$digest()}}),k.on("mousemove",function(t){var a=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"enabled",l.enabled);if(a){var o=e.getOffset(t).x,n=S(o);""===n||!g.task.isMoving&&"M"===n?k.css("cursor",""):k.css("cursor",B(n))}});var y=function(t,e){T(t,e),x(t,e)},T=function(t,a){var o=e.getOffsetForElement(E[0],a),n=o.x;if(g.task.mouseOffsetX=n,"M"===t){var i=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"allowRowSwitching",l.allowRowSwitching);if(i){for(var r,k=O[0].getBoundingClientRect(),v=s.findElementFromPoint(k.left,a.clientY,function(t){return angular.element(t).hasClass("gantt-row")}),w=d.gantt.rowsManager.rows,c=0,u=w.length;u>c;c++)if(v===w[c].$element[0]){r=w[c];break}var f=g.task.row;void 0!==r&&f!==r&&(r.moveTaskToRow(g.task,!0),f.$scope.$digest(),r.$scope.$digest())}var M=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"allowMoving",l.allowMoving);M&&(n-=m,"truncate"!==g.taskOutOfRange&&(0>n?n=0:n+g.task.width>=g.gantt.width&&(n=g.gantt.width-g.task.width)),g.task.moveTo(n),g.$digest(),g.row.rowsManager.gantt.api.tasks.raise.move(g.task))}else"E"===t?("truncate"!==g.taskOutOfRange&&(n<g.task.left?n=g.task.left:n>g.gantt.width&&(n=g.gantt.width)),g.task.setTo(n),g.$digest(),g.row.rowsManager.gantt.api.tasks.raise.resize(g.task)):("truncate"!==g.taskOutOfRange&&(n>g.task.left+g.task.width?n=g.task.left+g.task.width:0>n&&(n=0)),g.task.setFrom(n),g.$digest(),g.row.rowsManager.gantt.api.tasks.raise.resize(g.task));$=!0},x=function(t,a){var o=e.getOffsetForElement(E[0],a),s=O[0].scrollLeft,n=O[0].offsetWidth,i=O[0].scrollWidth,l=s+n,k=!1;o.x<c?s>0&&o.x<=s+z&&(o.x-=R,k=!0,g.row.rowsManager.gantt.api.scroll.left(R)):i>l&&o.x>=l-z&&(o.x+=R,k=!0,g.row.rowsManager.gantt.api.scroll.right(R)),k&&(v=r(function(){y(t,a)},100,!0))},P=function(){void 0!==v&&(r.cancel(v),v=void 0)},S=function(t){var e=0,a=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"allowResizing",l.allowResizing),o=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"allowRowSwitching",l.allowRowSwitching),n=s.firstProperty([g.task.model.movable,g.task.row.model.movable],"allowMoving",l.allowMoving);return a&&(e=k[0].offsetWidth<10?p:h),a&&t>k[0].offsetWidth-e?"E":a&&e>t?"W":(n||o)&&t>=e&&t<=k[0].offsetWidth-e?"M":""},B=function(t){switch(t){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},W=function(t,o){void 0===g.task.originalModel&&(g.task.originalRow=g.task.row,g.task.originalModel=g.task.model,g.task.model=angular.copy(g.task.originalModel)),"M"===t?(k.addClass("gantt-task-moving"),g.task.isMoving||g.row.rowsManager.gantt.api.tasks.raise.moveBegin(g.task)):(k.addClass("gantt-task-resizing"),g.task.isMoving||g.row.rowsManager.gantt.api.tasks.raise.resizeBegin(g.task)),g.task.isMoving||(c=o,m=o-g.task.modelLeft),$=!1,g.task.moveMode=t,g.task.isMoving=!0,g.task.active=!0;var s=function(a){a.stopImmediatePropagation(),u&&(a=e.getTouch(a)),g.task.isMoving&&(P(),y(t,a))},n=a(g,w,M,s);n.bind(),a(g,w,b,function(t){u&&(t=e.getTouch(t)),n.unbind(),C(t),g.$digest()}).bindOnce(),k.css("cursor",B(t)),angular.element(i[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:B(t)})},C=function(){if(k.removeClass("gantt-task-moving"),k.removeClass("gantt-task-resizing"),void 0!==g.task.originalModel){if(angular.extend(g.task.originalModel,g.task.model),g.task.model=g.task.originalModel,g.task.row.model.id!==g.task.originalRow.model.id){var t=g.task.row;t.removeTask(g.task.model.id,!1,!0),g.task.row=g.task.originalRow,t.moveTaskToRow(g.task,!1)}delete g.task.originalModel,delete g.task.originalRow,g.$apply()}g.task.isMoving=!1,g.task.active=!1,P(),k.css("cursor",""),angular.element(i[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""}),"M"===g.task.moveMode?g.row.rowsManager.gantt.api.tasks.raise.moveEnd(g.task):g.row.rowsManager.gantt.api.tasks.raise.resizeEnd(g.task),g.task.moveMode=void 0,$===!0&&($=!1,g.task.row.sortTasks(),g.row.rowsManager.gantt.api.tasks.raise.change(g.task))};g.task.isResizing?(delete g.task.isResizing,W("E",g.task.mouseOffsetX)):g.task.isMoving&&W("M",g.task.mouseOffsetX)}})}}}])}(),function(){"use strict";angular.module("gantt.movable").factory("ganttMovableOptions",[function(){return{initialize:function(t){return t.enabled=void 0!==t.enabled?!!t.enabled:!0,t.allowMoving=void 0!==t.allowMoving?!!t.allowMoving:!0,t.allowResizing=void 0!==t.allowResizing?!!t.allowResizing:!0,t.allowRowSwitching=void 0!==t.allowRowSwitching?!!t.allowRowSwitching:!0,t}}}])}();