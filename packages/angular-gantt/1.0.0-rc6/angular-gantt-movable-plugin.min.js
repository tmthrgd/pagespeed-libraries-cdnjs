/*
Project: angular-gantt v1.0.0-rc6 - Gantt chart component for AngularJS
Authors: Marco Schweighauser, RÃ©mi Alvergnat
License: MIT
Homepage: http://www.angular-gantt.com
Github: https://github.com/angular-gantt/angular-gantt.git
*/

!function(){"use strict";angular.module("gantt.movable",["gantt"]).directive("ganttMovable",["ganttMouseButton","ganttMouseOffset","ganttSmartEvent","ganttMovableOptions","ganttUtils","$window","$document","$timeout",function(a,b,c,d,e,f,g,h){return{restrict:"E",require:"^gantt",scope:{enabled:"=?",allowMoving:"=?",allowResizing:"=?",allowRowSwitching:"=?"},link:function(i,j,k,l){var m=l.gantt.api;if(i.options&&"object"==typeof i.options.movable)for(var n in i.options.movable)i[n]=i.options[n];d.initialize(i),m.registerEvent("tasks","move"),m.registerEvent("tasks","moveBegin"),m.registerEvent("tasks","moveEnd"),m.registerEvent("tasks","resize"),m.registerEvent("tasks","resizeBegin"),m.registerEvent("tasks","resizeEnd"),m.registerEvent("tasks","change");var o,p,q="ontouchstart"in f||f.DocumentTouch&&g[0]instanceof f.DocumentTouch,r="touchstart mousedown",s="touchmove mousemove",t="touchend mouseup",u=5,v=3,w=15,x=5;m.directives.on.new(i,function(d,j,k){if("ganttTask"===d){var m,n=angular.element(f),y=j.row.rowsManager.gantt.body.$element,z=j.row.rowsManager.gantt.scroll.$element,A=!1;k.on(r,function(c){c.preventDefault(),q&&(c=b.getTouch(c));var d=e.firstProperty([j.task.model.movable,j.task.row.model.movable],"enabled",i.enabled);if(d){var f=b.getOffset(c).x,g=F(f);if(""!==g&&1===a.getButton(c)){var h=b.getOffsetForElement(y[0],c).x;H(g,h)}j.$digest()}}),k.on("mousemove",function(a){var c=e.firstProperty([j.task.model.movable,j.task.row.model.movable],"enabled",i.enabled);if(c){var d=b.getOffset(a).x,f=F(d);""===f||!j.task.isMoving&&"M"===f?k.css("cursor",""):k.css("cursor",G(f))}});var B=function(a,b){C(a,b),D(a,b)},C=function(a,c){var d=b.getOffsetForElement(y[0],c),f=d.x;if(j.task.mouseOffsetX=f,"M"===a){var g=e.firstProperty([j.task.model.movable,j.task.row.model.movable],"allowRowSwitching",i.allowRowSwitching);if(g){for(var h,k=z[0].getBoundingClientRect(),m=e.findElementFromPoint(k.left,c.clientY,function(a){return angular.element(a).hasClass("gantt-row")}),n=l.gantt.rowsManager.rows,p=0,q=n.length;q>p;p++)if(m===n[p].$element[0]){h=n[p];break}var r=j.task.row;void 0!==h&&r!==h&&(h.moveTaskToRow(j.task,!0),r.$scope.$digest(),h.$scope.$digest())}var s=e.firstProperty([j.task.model.movable,j.task.row.model.movable],"allowMoving",i.allowMoving);s&&(f-=o,"truncate"!==j.taskOutOfRange&&(0>f?f=0:f+j.task.width>=j.gantt.width&&(f=j.gantt.width-j.task.width)),j.task.moveTo(f,!0),j.$digest(),j.row.rowsManager.gantt.api.tasks.raise.move(j.task))}else"E"===a?("truncate"!==j.taskOutOfRange&&(f<j.task.left?f=j.task.left:f>j.gantt.width&&(f=j.gantt.width)),j.task.setTo(f,!0),j.$digest(),j.row.rowsManager.gantt.api.tasks.raise.resize(j.task)):("truncate"!==j.taskOutOfRange&&(f>j.task.left+j.task.width?f=j.task.left+j.task.width:0>f&&(f=0)),j.task.setFrom(f,!0),j.$digest(),j.row.rowsManager.gantt.api.tasks.raise.resize(j.task));A=!0},D=function(a,c){var d=b.getOffsetForElement(y[0],c),e=z[0].scrollLeft,f=z[0].offsetWidth,g=z[0].scrollWidth,i=e+f,k=!1;d.x<p?e>0&&d.x<=e+x&&(d.x-=w,k=!0,j.row.rowsManager.gantt.api.scroll.left(w)):g>i&&d.x>=i-x&&(d.x+=w,k=!0,j.row.rowsManager.gantt.api.scroll.right(w)),k&&(m=h(function(){B(a,c)},100,!0))},E=function(){void 0!==m&&(h.cancel(m),m=void 0)},F=function(a){var b=0,c=e.firstProperty([j.task.model.movable,j.task.row.model.movable],"allowResizing",i.allowResizing),d=e.firstProperty([j.task.model.movable,j.task.row.model.movable],"allowRowSwitching",i.allowRowSwitching),f=e.firstProperty([j.task.model.movable,j.task.row.model.movable],"allowMoving",i.allowMoving);return c&&(b=k[0].offsetWidth<10?v:u),c&&a>k[0].offsetWidth-b?"E":c&&b>a?"W":(f||d)&&a>=b&&a<=k[0].offsetWidth-b?"M":""},G=function(a){switch(a){case"E":return"e-resize";case"W":return"w-resize";case"M":return"move"}},H=function(a,d){void 0===j.task.originalModel&&(j.task.originalRow=j.task.row,j.task.originalModel=j.task.model,j.task.model=angular.copy(j.task.originalModel)),"M"===a?(k.addClass("gantt-task-moving"),j.task.isMoving||j.row.rowsManager.gantt.api.tasks.raise.moveBegin(j.task)):(k.addClass("gantt-task-resizing"),j.task.isMoving||j.row.rowsManager.gantt.api.tasks.raise.resizeBegin(j.task)),j.task.isMoving||(p=d,o=d-j.task.modelLeft),A=!1,j.task.moveMode=a,j.task.isMoving=!0,j.task.active=!0;var e=function(c){c.stopImmediatePropagation(),q&&(c=b.getTouch(c)),j.task.isMoving&&(E(),B(a,c))},f=c(j,n,s,e);f.bind(),c(j,n,t,function(a){q&&(a=b.getTouch(a)),f.unbind(),I(a),j.$digest()}).bindOnce(),k.css("cursor",G(a)),angular.element(g[0].body).css({"-moz-user-select":"-moz-none","-webkit-user-select":"none","-ms-user-select":"none","user-select":"none",cursor:G(a)})},I=function(){if(k.removeClass("gantt-task-moving"),k.removeClass("gantt-task-resizing"),void 0!==j.task.originalModel){if(angular.extend(j.task.originalModel,j.task.model),j.task.model=j.task.originalModel,j.task.row.model.id!==j.task.originalRow.model.id){var a=j.task.row;a.removeTask(j.task.model.id,!1,!0),j.task.row=j.task.originalRow,a.moveTaskToRow(j.task,!1)}delete j.task.originalModel,delete j.task.originalRow,j.$apply()}j.task.isMoving=!1,j.task.active=!1,E(),k.css("cursor",""),angular.element(g[0].body).css({"-moz-user-select":"","-webkit-user-select":"","-ms-user-select":"","user-select":"",cursor:""}),"M"===j.task.moveMode?j.row.rowsManager.gantt.api.tasks.raise.moveEnd(j.task):j.row.rowsManager.gantt.api.tasks.raise.resizeEnd(j.task),j.task.moveMode=void 0,A===!0&&(A=!1,j.task.row.sortTasks(),j.row.rowsManager.gantt.api.tasks.raise.change(j.task))};j.task.isResizing?(delete j.task.isResizing,H("E",j.task.mouseOffsetX)):j.task.isMoving&&H("M",j.task.mouseOffsetX)}})}}}])}(),function(){"use strict";angular.module("gantt.movable").factory("ganttMovableOptions",[function(){return{initialize:function(a){return a.enabled=void 0!==a.enabled?!!a.enabled:!0,a.allowMoving=void 0!==a.allowMoving?!!a.allowMoving:!0,a.allowResizing=void 0!==a.allowResizing?!!a.allowResizing:!0,a.allowRowSwitching=void 0!==a.allowRowSwitching?!!a.allowRowSwitching:!0,a}}}])}();
//# sourceMappingURL=angular-gantt-movable-plugin.min.js.map