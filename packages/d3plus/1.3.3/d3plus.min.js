!function(){var i=window.d3plus||{};window.d3plus=i,i.version="1.3.3 - Sky",i.array={},i.color={},i.data={},i.draw={},i.edges={},i.font={},i.input={},i.locale={},i.method={},i.number={},i.object={},i.shape={},i.string={},i.style={},i.tooltip={},i.ui={},i.util={},i.variable={},i.visualization={},i.zoom={},i.array.sort=function(e,t,a,l,n){function r(e,r){for(var o=0,s=0;s<t.length;s++){var u=t[s];if(n){var d=e.d3plus?n.id.nesting[e.d3plus.depth]:void 0,c=e.d3plus?e.d3plus.depth:void 0;e=u===n.color.value?i.variable.color(n,e,d):u===n.text.value?i.variable.text(n,e,c):i.variable.value(n,e,u,d);var d=r.d3plus?n.id.nesting[r.d3plus.depth]:void 0,c=r.d3plus?r.d3plus.depth:void 0;r=u===n.color.value?i.variable.color(n,r,d):u===n.text.value?i.variable.text(n,r,c):i.variable.value(n,r,u,d)}else e=e[u],r=r[u];if(e=e instanceof Array?e=e[0]:"string"==typeof e?e=e.toLowerCase():e,r=r instanceof Array?r=r[0]:"string"==typeof r?r=r.toLowerCase():r,o=l.indexOf(u)>=0?i.color.sort(e,r):r>e?-1:1,0!==o||s===t.length-1)break}return"asc"===a?o:-o}if(!e||e.length<=1||!t)return e||[];if(!a)var a="asc";if(t instanceof Array||(t=[t]),l)l instanceof Array||(l=[l]);else var l=["color"];return 2===e.length?r(e[0],e[1]):e.sort(r)},i.array.update=function(e,t){if(!(e instanceof Array))var e=[];return t instanceof Array?e=t:e.indexOf(t)>=0?e.splice(e.indexOf(t),1):e.push(t),e},i.color.legible=function(e){var t=d3.hsl(e);return t.l>.45&&(t.s>.8&&(t.s=.8),t.l=.45),t.toString()},i.color.lighter=function(e,t){if(void 0===t)var t=.5;var a=d3.hsl(e);return a.l+=(1-a.l)*t,a.toString()},i.color.mix=function(e,t,a,i){if(!a)var a=1;if(!i)var i=1;e=d3.rgb(e),t=d3.rgb(t);var l=(a*e.r+i*t.r-a*i*t.r)/(a+i-a*i),n=(a*e.g+i*t.g-a*i*t.g)/(a+i-a*i),r=(a*e.b+i*t.b-a*i*t.b)/(a+i-a*i);return d3.rgb(l,n,r).toString()},i.color.random=function(e){var t=e||Math.floor(20*Math.random());return i.color.scale.default(t)},i.color.scale={},i.color.scale.default=d3.scale.ordinal().range(["#B35C1E","#C9853A","#E4BA79","#F5DD9E","#F3D261","#C4B346","#94B153","#254322","#4F6456","#759E80","#9ED3E3","#27366C","#7B91D3","#C6CBF7","#D59DC2","#E5B3BB","#E06363","#AF3500","#D74B03","#843012","#9A4400"]),i.color.sort=function(e,t){var a=d3.hsl(e),i=d3.hsl(t);return e=0===a.s?361:a.h,t=0===i.s?361:i.h,e===t?a.l-i.l:e-t},i.color.text=function(e){var t=d3.rgb(e),a=t.r,i=t.g,l=t.b,n=(299*a+587*i+114*l)/1e3;return n>=128?"#444444":"#f7f7f7"},i.color.validate=function(e){e+="",e=e.replace(/ /g,""),0===e.indexOf("rgb")&&(e=e.split("(")[1].split(")")[0].split(",").slice(0,3).join(",")),0===e.indexOf("hsl")&&(e=e.split(",")[2].split(")")[0]);var t=d3.rgb(e).toString(),a=["black","#000","#000000","0%","0,0,0"],i=a.indexOf(e)>=0;return"#000000"!==t||i},i.data.color=function(e){e.dev.value&&i.console.time("getting color data range");var t=[];if(e.data.pool.forEach(function(a){var l=parseFloat(i.variable.value(e,a,e.color.value));"number"==typeof l&&!isNaN(l)&&t.indexOf(l)<0&&t.push(l)}),e.dev.value&&i.console.timeEnd("getting color data range"),t.length>1){if(e.dev.value&&i.console.time("calculating color scale"),t=d3.extent(t),t[0]<0&&t[1]>0){var a=e.color.range;3==a.length&&(t.push(t[1]),t[1]=0)}else if(t[1]>0&&t[0]>=0){var a=e.color.heatmap;t=i.util.buckets(t,a.length)}else{var a=e.color.range.slice(0);t[0]<0?a.pop():a.shift()}e.color.scale=d3.scale.sqrt().domain(t).range(a).interpolate(d3.interpolateRgb),e.dev.value&&i.console.timeEnd("calculating color scale")}else e.color.scale=null},i.data.edges=function(e){if(e.dev.value){var t="analyzing edges list";i.console.time(t)}var a=i.visualization[e.type.value].requirements,l=a.indexOf("nodes")>=0&&!e.nodes.value;if(l){e.nodes.value=[];var n=[];e.nodes.changed=!0}e.edges.value.forEach(function(t){if("object"!=typeof t[e.edges.source]){var a={};a[e.id.value]=t[e.edges.source],t[e.edges.source]=a}if("object"!=typeof t[e.edges.target]){var a={};a[e.id.value]=t[e.edges.target],t[e.edges.target]=a}"keys"in e.data||(e.data.keys={}),e.id.value in e.data.keys||(e.data.keys[e.id.value]=typeof t[e.edges.source][e.id.value]),l&&(n.indexOf(t[e.edges.source][e.id.value])<0&&(n.push(t[e.edges.source][e.id.value]),e.nodes.value.push(t[e.edges.source])),n.indexOf(t[e.edges.target][e.id.value])<0&&(n.push(t[e.edges.target][e.id.value]),e.nodes.value.push(t[e.edges.target])))}),e.edges.value=e.edges.value.filter(function(t){var a=t[e.edges.source][e.id.value],l=t[e.edges.target][e.id.value];if(a===l){var n=e.format.locale.value.dev.sameEdge;return i.console.warning(i.string.format(n,'"'+a+'"'),"edges"),!1}return!0}),e.edges.linked=!0,e.dev.value&&i.console.timeEnd(t)},i.data.element=function(e){function t(e,t){[].forEach.call(t.attributes,function(t){if(/^data-/.test(t.name)){var a=t.name.substr(5).replace(/-(.)/g,function(e,t){return t.toUpperCase()});e[a]=t.value}}),i.forEach(function(a){null!==t.getAttribute(a)&&(e[a]=t.getAttribute(a))})}function a(e){e.style("position","absolute","important").style("clip","rect(1px 1px 1px 1px)","important").style("clip","rect(1px, 1px, 1px, 1px)","important").style("width","1px","important").style("height","1px","important").style("margin","-1px","important").style("padding","0","important").style("border","0","important").style("overflow","hidden","important").html("")}var i=[e.color.value,e.icon.value,e.keywords.value,e.alt.value,"style"];e.text.value||e.self.text("text"),i=i.concat(e.id.nesting),e.data.element=e.data.value;var l=e.data.element.node().tagName.toLowerCase(),n=e.data.element.attr("type"),r=[];if("select"===l){var o=e.data.element.node().id;o&&e.self.container({id:o}),e.data.element.selectAll("option").each(function(a,i){var l={};if(l.text=this.innerHTML,t(l,this),r.push(l),this.selected)for(var i=e.id.nesting.length-1;i>=0;i--){var n=e.id.nesting[i];if(n in l){e.self.focus(l[n]);break}}})}else if("input"===l&&"radio"===n){var s=e.data.element.node().getAttribute("name");s&&e.self.container({id:s}),e.data.element.each(function(){var i={};t(i,this);var l=i[e.id.value]||this.id||!1;if(l&&isNaN(parseFloat(l))){var n=d3.select("label[for="+l+"]");n.empty()||(i.text=n.html(),n.call(a))}r.push(i),this.checked&&(e.focus.value=i[e.id.value])})}!e.focus.value&&r.length&&(e.data.element.node().selectedIndex=0,e.self.focus(r[0][e.id.value]));var u=d3.select("legend[for="+e.container.id+"]");u.empty()||(e.self.title(u.html()),u.call(a)),e.data.element.call(a);var d=e.container.value?e.container.value.node().tagName.toLowerCase():!1;return(e.container.value===!1||"body"===d)&&(e.container.value=d3.select(e.data.element.node().parentNode)),r},i.data.fetch=function(e,t){if(!t&&"time"in e){var a=e.time.solo.value.length?"solo":"mute",t=[];if(e.time[a].value.length){var t=[];e.time[a].value.forEach(function(a){"function"==typeof a?e.data.time.forEach(function(e){a(e)&&t.push(e)}):t.push(a)}),"mute"===a&&(t=e.data.time.filter(function(e){return t.indexOf(e)<0}))}else t.push("all")}else t=["all"];var l=[e.type.value,e.id.value,e.depth.value].concat(e.data.filters).concat(t),n=e.data.solo.length?"solo":"mute",r=d3.keys(e.data.cache),o="viz"===e.shell?i.visualization[e.type.value].filter:null;e.data[n].length&&e.data[n].forEach(function(t){var a=e[t][n].value.slice(0);a.unshift(t),l=l.concat(a)}),l=l.join("_");for(var s=0;s<r.length;s++){var u=r[s].split("_").slice(1).join("_");if(u===l){l=(new Date).getTime()+"_"+l,e.data.cache[l]=e.data.cache[r[s]],delete e.data.cache[r[s]];break}}if(e.data.cache[l]){e.dev.value&&i.console.comment("data already cached");var d=e.data.cache[l];return"function"==typeof o&&(d=o(e,d)),d}if(e.data.value)if(1===t.length)var d=e.data.nested[t[0]][e.id.value];else{var c=[],d=[];if(t.forEach(function(t){e.data.nested[t]?d=d.concat(e.data.nested[t][e.id.value]):c.push(t)}),0===d.length&&c.length&&!e.internal_error){var v=e.format.locale.value.error.dataYear,p=e.format.locale.value.ui.and;c=i.string.list(c,p),e.internal_error=i.string.format(v,c)}else{var f=!1;if(e.axes.values.forEach(function(t){e[t].value===e.time.value&&"continuous"===e[t].scale.value&&(f=!0)}),!f){var h=e.id.nesting.slice(0,e.depth.value+1);d=i.data.nest(e,d,h)}}}else var d=[];d=d?i.data.filter(e,d):[];var r=d3.keys(e.data.cache);return 20===r.length&&(r.sort(),delete e.data.cache(r[0])),l=(new Date).getTime()+"_"+l,e.data.cache[l]=d,"function"==typeof o&&(d=o(e,d)),e.dev.value&&i.console.comment("storing data in cache"),d},i.data.filter=function(e,t){e.dev.value&&i.console.time("filtering data");var a=d3.keys(e.data.keys||{});"attrs"in e&&(a=a.concat(d3.keys(e.attrs.keys||{}))),t=t.filter(function(t){return e.id.value in t}),e.data.filters.forEach(function(l){a.indexOf(e[l].value)>=0&&(t=t.filter(function(t){var a=i.variable.value(e,t,e[l].value);return"size"===l?"number"==typeof a&&a>0:null!==a}))});var l=e.data.solo.length?"solo":"mute";return e.data[l].forEach(function(a){function n(t){var i=e[a][l].value,n=!1;return i.forEach(function(e){"function"==typeof e?n=e(t):e===t&&(n=!0)}),n}function r(t){var r=!1;return e[a].nesting?e[a].nesting.forEach(function(a){r||(r=n(i.variable.value(e,t,a)))}):r=n(i.variable.value(e,t,e[a].value)),"solo"===l?r:!r}t=t.filter(r),"id"===a&&("nodes"in e&&e.nodes.value&&(e.dev.value&&i.console.log("Filtering Nodes"),e.nodes.restricted=e.nodes.value.filter(r)),"edges"in e&&e.edges.value&&(e.dev.value&&i.console.log("Filtering Connections"),e.edges.restricted=e.edges.value.filter(function(t){var a=r(t[e.edges.source]),i=r(t[e.edges.target]);return a&&i})))}),e.dev.value&&i.console.timeEnd("filtering data"),t},i.data.format=function(e){if(e.dev.value){var t="disaggregating data by time and nesting";i.console.time(t)}if(e.time&&e.time.value){e.data.time=i.util.uniques(e.data.value,e.time.value);for(var a=0;a<e.data.time.length;a++)e.data.time[a]=parseInt(e.data.time[a]);e.data.time=e.data.time.filter(function(e){return e}),e.data.time.sort()}else e.data.time=[];e.data.nested={all:{}},e.id.nesting.forEach(function(t,a){var l=e.id.nesting.slice(0,a+1);e.data.nested.all[t]=i.data.nest(e,e.data.value,l)}),e.data.time.forEach(function(t){e.data.nested[t]={};var a=e.data.value.filter(function(a){return parseInt(i.variable.value(e,a,e.time.value))===t});e.id.nesting.forEach(function(l,n){var r=e.id.nesting.slice(0,n+1);e.data.nested[t][l]=i.data.nest(e,a,r)})}),e.dev.value&&i.console.timeEnd(t)},i.data.keys=function(e,t){function a(l){if(l instanceof Array)l.forEach(function(e){a(e)});else if(i.object.validate(l))for(var n in l)i.object.validate(l[n])?a(l[n]):n in e[t].keys||!l[n]||(e[t].keys[n]=typeof l[n])}if(e.dev.value){var l=t+" key analysis";console.time(l)}if(e[t].keys={},i.object.validate(e[t].value))for(var n in e[t].value)a(e[t].value[n]);else a(e[t].value);e.dev.value&&console.time(l)},i.data.nest=function(e,t,a,l){var n=d3.nest(),r=[],o="viz"===e.shell?["active","temp","total"]:[],l=l instanceof Array?l:"viz"===e.shell?i.visualization[e.type.value].requirements:[],s="viz"===e.shell?[e.time.value,e.icon.value]:[],u=function(){l&&l.length&&e.axes.values.forEach(function(t){var a=e[t].value;l.indexOf(t)>=0&&a&&"continuous"===e[t].scale.value&&(s.push(a),n.key(function(t){return i.variable.value(e,t,a)}))})};a.forEach(function(t){n.key(function(a){return"function"==typeof t?t(a):i.variable.value(e,a,t)}),u()}),a.length||(n.key(function(){return!0}),u());var d=a.length?a.length-1:0;n.rollup(function(t){if(1===t.length&&"d3plus"in t[0]){var a=t[0];return a.d3plus.depth=d,r.push(a),a}"size"in e&&e.size.value&&i.util.uniques(t,e.size.value).length&&i.array.sort(t,e.size.value,"desc",[],e);var a={d3plus:{depth:d}};o.forEach(function(l){var n=e[l].value||l;a.d3plus[n]=d3.sum(t,function(t){if(e[l].value){var a=i.variable.value(e,t,e[l].value);"number"!=typeof a&&(a=a?1:0)}else if("total"===l)var a=1;else var a=0;return a})});for(var l in e.data.keys){var n=e.aggs.value[l]||"sum",s=typeof n,u=e.data.keys[l],c=e.id.nesting.indexOf(l)>=0,v="time"in e&&l===e.time.value;if(l in a.d3plus)a[l]=a.d3plus[l];else if("function"===s)a[l]=e.aggs.value[l](t);else if("number"!==u||"string"!==s||c||v){var p=1===t.length?t[0][l]:i.util.uniques(t,l);if(p instanceof Array&&1===p.length&&"string"==typeof p[0]&&0===p[0].indexOf("[object Object]")){var f=[];t.forEach(function(e){f=f.concat(e[l])});var p=i.util.uniques(f,l)}if(p)p instanceof Array||(p=[p]),p.length&&(a[l]=p.length<=t.length&&c&&e.id.nesting.indexOf(l)>d&&p.length>1?t:1===p.length?p[0]:p);else if(c){var h=e.id.nesting.indexOf(l)-1;h>=d&&(!("endPoint"in a.d3plus)||a.d3plus.endPoint>d)&&(a.d3plus.endPoint=d)}}else a[l]=d3[n](t,function(e){return l in e?e[l]:!1})}return r.push(a),a});var c=function(e){return e.values&&e.values.length?(e.children=e.values.map(function(e){return c(e)}),delete e.values,e):e.values?e.values:e},v=function(t,i,l){if(t.children){"number"==e.data.keys[a[i]]&&(t.key=parseFloat(t.key)),l[a[i]]=t.key,delete t.key;for(var n in l)t[n]=l[n];i++,t.children.forEach(function(e){v(e,i,l)})}};return n=n.entries(t).map(c).map(function(e){return v(e,0,{}),e}),r},i.data.nodes=function(e){if(e.dev.value){var t="analyzing node positions";i.console.time(t)}var a=e.nodes.value.filter(function(e){return"number"==typeof e.x&&"number"==typeof e.y}).length;if(a==e.nodes.value.length)e.nodes.positions=!0;else{var l=d3.layout.force().size([e.width.viz,e.height.viz]).nodes(e.nodes.value).links(e.edges.value),n=50,r=.01;l.start();for(var o=n;o>0&&(l.tick(),!(l.alpha()<r));--o);l.stop(),e.nodes.positions=!0}e.dev.value&&i.console.timeEnd(t)},i.data.reset=function(e,t){e.changed&&(e.changed=!1),"draw"===t&&(e.frozen=!1,e.update=!0,e.first=!1);for(var a in e)i.object.validate(e[a])&&i.data.reset(e[a],a)},i.data.threshold=function(e,t,a){if(e.size.threshold===!1)var l=0;else if("number"==typeof e.size.threshold)var l=e.size.threshold;else if("number"==typeof i.visualization[e.type.value].threshold)var l=i.visualization[e.type.value].threshold;else if("function"==typeof i.visualization[e.type.value].threshold)var l=i.visualization[e.type.value].threshold(e);else var l=.02;if("number"==typeof l&&l>0){var n=[],r=0==e.depth.value?0:{},o=[],s={},u=d3.nest();a&&u.key(function(t){return i.variable.value(e,t,a)}),u.rollup(function(t){var l=t.length;e.aggs[e.size.value]?"function"==typeof e.aggs[e.size.value]?l=e.aggs[e.size.value](t):"string"==typeof e.aggs[e.size.value]&&(l=d3[e.aggs[e.size.value]](t,function(t){return i.variable.value(e,t,e.size.value)})):l=d3.sum(t,function(t){return i.variable.value(e,t,e.size.value)});var n=a?i.variable.value(e,t[0],a):"all";return s[n]=l,l}).entries(t);var d=t.filter(function(t){var u=i.variable.value(e,t,e.id.value),d=i.variable.value(e,t,e.size.value),c=a?i.variable.value(e,t,a):"all";if(n.indexOf(u)<0&&d/s[c]>=l&&n.push(u),n.indexOf(u)<0){if(0==e.depth.value)d>r&&(r=d);else{var v=t[e.id.nesting[e.depth.value-1]];v in r||(r[v]=0),d>r[v]&&(r[v]=d)}return o.push(t),!1}return!0});if(o.length>1){o=i.array.sort(o,e.size.value,"desc",[],e);var c=e.id.nesting.slice(0,e.depth.value),v=i.data.nest(e,o,c).filter(function(t){return i.variable.value(e,t,e.size.value)>0});v.forEach(function(t){var a=e.id.nesting[e.depth.value-1];if(e.id.nesting.forEach(function(a,i){if(e.depth.value==i){var l=t[e.id.nesting[i-1]];t[a]="string"==typeof l?"d3plus_other_"+l:"d3plus_other"}else i>e.depth.value&&delete t[a]}),e.color.value&&"string"===e.color.type&&(t[e.color.value]=0==e.depth.value?e.color.missing:i.variable.color(e,t[a],a)),e.icon.value&&0!=e.depth.value&&(t[e.icon.value]=i.variable.value(e,t[a],e.icon.value,a),t.d3plus.depth=e.depth.value+1),e.text.value){if(0==e.depth.value)t[e.text.value]=e.format.value(e.format.locale.value.ui.values),t[e.text.value]+=" < "+e.format.value(r);else{var n=i.variable.value(e,t,e.text.value,a);t[e.text.value]=n,t[e.text.value]+=" < "+e.format.value(r[t[a]],e.size.value)}t[e.text.value]+=" ("+e.format.value(100*l)+"%)",t.d3plus.threshold=r,a?(t.d3plus.merged=[],o.forEach(function(e){t[a]==e[a]&&t.d3plus.merged.push(e)})):t.d3plus.merged=o}})}else v=o;return d.concat(v)}return t},i.data.url=function(e,t,a){e.dev.value&&i.console.time("loading "+t);var l=e[t].url;if(e[t].type.value)var n=e[t].type.value;else{var n=l.slice(l.length-5).split(".");n=n.length>1?n[1]:!1,n?("txt"===n&&(n="text"),e[t].type.accepted.indexOf(n)<0&&(n="json")):n="json"}if("dsv"===n)var r=d3.dsv(e[t].delimiter.value,"text/plain");else var r=d3[n];r(l,function(r,o){if(!r&&o){if("function"==typeof e[t].callback){var s=e[t].callback(o);if(s)if(i.object.validate(s)&&t in s)for(var u in s)u in e&&(e[u].value=s[u]);else e[t].value=s}else e[t].value=o;"json"!==n&&e[t].value.forEach(function(e){for(var t in e)"false"===e[t].toLowerCase()?e[t]=!1:"true"===e[t].toLowerCase()?e[t]=!0:"null"===e[t].toLowerCase()?e[t]=null:"undefined"===e[t].toLowerCase()&&(e[t]=void 0)}),e[t].changed=!0,e[t].loaded=!0}else e.internal_error='Could not load data from: "'+l+'"';e.dev.value&&i.console.time("loading "+t),a()})},i.edges.connections=function(){},i.font.awesome=!1;for(var l=0;l<document.styleSheets.length;l++){var n=document.styleSheets[l];if(n.href&&n.href.indexOf("font-awesome")>=0){i.font.awesome=!0;break}}i.font.sizes=function(e,t,a){var t=(a||i.font.tester("svg").append("text"),t||{}),l=[],n=a.selectAll("tspan.d3plus_testFontSize").data(e);return n.enter().append("tspan").attr("class","d3plus_testFontSize").text(String).style(t).attr("x",0).attr("y",0).each(function(e){l.push({height:this.offsetHeight,text:e,width:this.getComputedTextLength()})}),n.remove(),a||a.remove(),l},i.font.tester=function(e){if(["div","svg"].indexOf(e)<0)var e="div";var t=d3.select("body").selectAll(e+".d3plus_tester").data(["d3plus_tester"]);return t.enter().append(e).attr("class","d3plus_tester").style("position","absolute").style("left","-9999px").style("top","-9999px").style("visibility","hidden").style("display","block"),t},i.font.validate=function(e){function t(e){return r.append("span").style("font-family",e).style("font-size","32px").style("padding","0px").style("margin","0px").text("abcdefghiABCDEFGHI_!@#$%^&*()_+1234567890")}function a(e,t){var a=e.node().offsetWidth,i=t.node().offsetWidth;return a!==i}e instanceof Array||(e=e.split(","));var l=e.join(", "),n=i.font.validate.complete;if(l in n)return n[l];var r=i.font.tester("div"),o=t("monospace"),s=t("sans-serif");for(var u in e){var d=e[u].trim(),c=t(d+",monospace"),v=a(c,o);if(c.remove(),!v){var c=t(d+",sans-serif");v=a(c,s),c.remove()}if(v){v=d;break}}return v||(v="sans-serif"),o.remove(),s.remove(),n[l]=v,v},i.font.validate.complete={},i.form=function(){var e={shell:"form"};e.self=function(){function t(a,i){var i="number"!=typeof i?1===e.id.nesting.length?0:e.id.nesting.length-1:i,l=e.id.nesting[i];return i>0&&(!(l in a)||a[l]instanceof Array)?t(a,i-1):l}var a=e.data.value instanceof Array&&e.data.value.length>e.data.large;if(e.draw.timing=e.draw.first||a||i.ie?0:e.timing.ui,e.data.value instanceof Array){if(e.dev.value&&i.console.groupCollapsed('drawing "'+e.type.value+'"'),e.data.changed&&(e.data.cache={},i.data.keys(e,"data"),i.data.format(e)),e.data.app=i.data.fetch(e),(e.data.changed||e.order.changed||e.order.sort.changed)&&i.array.sort(e.data.app,e.order.value||e.text.value,e.order.sort.value,e.color.value,e),!e.focus.value&&e.data.app.length&&(e.focus.value=e.data.app[0][e.id.value],e.dev.value&&i.console.log('"value" set to "'+e.focus+'"')),e.data.changed){"auto"===e.search.value?e.data.app.length>10?(e.search.enabled=!0,e.dev.value&&i.console.log("Search enabled.")):(e.search.enabled=!1,e.dev.value&&i.console.log("Search disabled.")):e.search.enabled=e.search.value;var l=e.data.element?e.data.element.node().tagName.toLowerCase():"";if(e.data.element&&"select"===l){var n=[];for(var r in e.data.nested.all)n=n.concat(e.data.nested.all[r]);options=e.data.element.selectAll("option").data(n,function(e){var a=t(e);return e&&a in e?e[a]:!1}),options.exit().remove(),options.enter().append("option"),options.each(function(a){var i=t(a),l=i===e.id.value?e.text.value||e.id.value:e.text.nesting!==!0&&i in e.text.nesting?e.text.nesting[i]:i;for(var n in a)"object"!=typeof a[n]&&(n===l&&d3.select(this).html(a[n]),["alt","value"].indexOf(n)>=0?d3.select(this).attr(n,a[n]):d3.select(this).attr("data-"+n,a[n]));this.selected=a[i]===e.focus.value?!0:!1})}}else if(e.focus.changed&&e.data.element){var l=e.data.element.node().tagName.toLowerCase();"select"===l&&e.data.element.selectAll("option").each(function(a){var i=t(a);this.selected=a[i]===e.focus.value?!0:!1})}if("auto"!==e.type.value){if(!e.container.ui){e.container.ui=e.container.value.selectAll("div#d3plus_"+e.type.value+"_"+e.container.id).data(["container"]);var o=e.data.element?e.data.element[0][0]:null;if(o)if(o.id)o="#"+o.id;else{var s=o.getAttribute(e.id.value)?e.id.value:"data-"+e.id.value;o=o.getAttribute(s)?"["+s+"="+o.getAttribute(s)+"]":null}e.container.ui.enter().insert("div",o).attr("id","d3plus_"+e.type.value+"_"+e.container.id).style("position","relative").style("overflow","visible").style("vertical-align","top")}e.container.ui.transition().duration(e.draw.timing).style("display",e.ui.display.value).style("margin",e.ui.margin+"px");var u=e.container.ui.selectAll("div.d3plus_title").data(e.title.value?[e.title.value]:[]);u.enter().insert("div","#d3plus_"+e.type.value+"_"+e.container.id).attr("class","d3plus_title"),u.style("display",e.ui.display.value).style("color",e.font.color).style("font-family",e.font.family.value).style("font-size",e.font.size+"px").style("font-weight",e.font.weight).style("padding",e.ui.padding+"px").style("border-color","transparent").style("border-style","solid").style("border-width",e.ui.border+"px").text(String).each(function(){e.margin.left=this.offsetWidth})}if(e.data.value.length){var d=e.format.locale.value.visualization[e.type.value];e.dev.value&&i.console.time("drawing "+d),i.input[e.type.value](e),e.dev.value&&i.console.timeEnd("drawing "+d)}else!e.data.url||e.data.loaded&&!e.data.stream||i.data.url(e,"data",e.self.draw);i.data.reset(e),e.methodGroup=!1,e.dev.value&&i.console.groupEnd()}};var t=["active","aggs","alt","color","container","depth","dev","data","draw","focus","format","height","history","hover","icon","id","keywords","margin","open","order","remove","search","select","selectAll","text","title","type","width"],a=["data","font","icon","timing","title","ui"];return i.method(e,t,a),e.self},i.console=function(e,t,a){var a=a||"";i.ie?console.log("[ D3plus ] "+t):"groupCollapsed"===e?window.chrome&&navigator.onLine?console[e]("%c%c "+t,"padding:3px 10px;line-height:25px;background-size:20px;background-position:top left;background-image:url('http://d3plus.org/assets/img/favicon.ico');","font-weight:200;"+a):console[e]("%cD3plus%c "+t,"line-height:25px;font-weight:800;color:#b35c1e;margin-left:0px;","font-weight:200;"+a):console[e]("%c"+t,a+"font-weight:200;")},i.console.comment=function(e){this("log",e,"color:#aaa;")},i.console.error=function(e,t){this("groupCollapsed","ERROR: "+e,"font-weight:800;color:#D74B03;"),this.stack(),this.wiki(t),this.groupEnd()},i.console.group=function(e){this("group",e,"color:#888;")},i.console.groupCollapsed=function(e){this("groupCollapsed",e,"color:#888;")},i.console.groupEnd=function(){i.ie||console.groupEnd()},i.console.log=function(e){this("log",e,"color:#444444;")},i.console.stack=function(){if(!i.ie){var e=new Error;if(e.stack){var t=e.stack.split("\n");if(t=t.filter(function(e){return 0!==e.indexOf("Error")&&e.indexOf("d3plus.js:")<0&&e.indexOf("d3plus.min.js:")<0}),t.length){var a=window.chrome?"at ":"@",l=t[0].split(a)[1];t=l.split(":"),3===t.length&&t.pop();var n=t.pop(),r=t.join(":").split("/");r=r[r.length-1];var o="line "+n+" of "+r+": "+l;this("log",o,"color:#D74B03;")}}}},i.console.time=function(e){i.ie||console.time(e)},i.console.timeEnd=function(e){i.ie||console.timeEnd(e)},i.console.warning=function(e,t){this("groupCollapsed",e,"color:#888;"),this.stack(),this.wiki(t),this.groupEnd()},i.console.wiki=function(e){if(e&&e in i.wiki){var t=i.repo+"wiki/"+i.wiki[e];this("log","documentation: "+t,"color:#aaa;")}},i.evt={},i.touch="ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?!0:!1,i.touch?(i.evt.click="click",i.evt.down="touchstart",i.evt.up="touchend",i.evt.over="touchstart",i.evt.out="touchend",i.evt.move="touchmove"):(i.evt.click="click",i.evt.down="mousedown",i.evt.up="mouseup",i.ie?(i.evt.over="mouseenter",i.evt.out="mouseleave"):(i.evt.over="mouseover",i.evt.out="mouseout"),i.evt.move="mousemove"),i.repo="https://github.com/alexandersimoes/d3plus/",i.wiki={active:"Segmenting-Data#active",aggs:"Custom-Aggregations",alt:"Alt-Text-Parameters",attrs:"Attribute-Data#axes",axes:"Axis-Parameters",background:"Background",color:"Color-Parameters",container:"Container-Element",coords:"Geography-Data",csv:"CSV-Export",data:"Data-Points",depth:"Visible-Depth",descs:"Value-Definitions",dev:"Verbose-Mode",draw:"Draw",edges:"Edges-List",error:"Custom-Error-Message",focus:"Focus-Element",font:"Font-Styles",footer:"Custom-Footer",format:"Value-Formatting",height:"Height",history:"User-History",hover:"Hover-Element",icon:"Icon-Parameters",id:"Unique-ID",keywords:"Keyword-Parameters",labels:"Data-Labels",legend:"Legend",links:"Link-Styles",margin:"Outer-Margins",messages:"Status-Messages",method:"Methods",nodes:"Node-Positions",open:"Open",order:"Data-Ordering",remove:"Remove",search:"Search-Box",select:"Selecting-Elements#select",selectAll:"Selecting-Elements#selectall",shape:"Data-Shapes",size:"Size-Parameters",temp:"Segmenting-Data#temp",text:"Text-Parameters",time:"Time-Parameters",timeline:"Timeline",timing:"Animation-Timing",title:"Custom-Titles",tooltip:"Tooltip-Parameters",total:"Segmenting-Data#total",type:"Output-Type",ui:"Custom-Interface",width:"Width",x:"Axis-Parameters",y:"Axis-Parameters",zoom:"Zooming"},i.ie=!1,i.prefix=function(){if("-webkit-transform"in document.body.style)var e="-webkit-";else if("-moz-transform"in document.body.style)var e="-moz-";else if("-ms-transform"in document.body.style)var e="-ms-";else if("-o-transform"in document.body.style)var e="-o-";else var e="";return i.prefix=function(){return e},e},i.rtl="rtl"==d3.select("html").attr("dir"),i.scrollbar=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var a=e.offsetWidth;t.style.overflow="scroll";var l=e.offsetWidth;a==l&&(l=t.clientWidth),document.body.removeChild(t);var n=a-l;return i.scrollbar=function(){return n},n},i.locale.en={dev:{accepted:"{0} is not an accepted value for {1}, please use one of the following: {2}.",deprecated:"the {0} method has been removed, please update your code to use {1}.",noChange:"{0} was not updated because it did not change.",noContainer:"cannot find a container on the page matching {0}.",of:"of",oldStyle:"style properties for {0} have now been embedded directly into .{1}().",sameEdge:"edges cannot link to themselves. automatically removing self-referencing edge {0}.",set:"{0} has been set.",setLong:"{0} has been set to {1}.",setContainer:"please define a container div using .container()"},error:{accepted:"{0} is not an accepted {1} for {2} visualizations, please use one of the following: {3}.",connections:"no connections available for {0}.",data:"no data available",dataYear:"no data available for {0}.",lib:"{0} visualizations require loading the {1} library.",libs:"{0} visualizations require loading the following libraries: {1}.",method:"{0} visualizations require setting the {1} method.",methods:"{0} visualizations require setting the following methods: {1}."},lowercase:["a","and","at","but","in","of","or","the","to","with"],message:{data:"analyzing data",draw:"drawing visualization",initializing:"initializing {0}",loading:"loading data",tooltipReset:"resetting tooltips",ui:"updating ui"},method:{active:"active segments",color:"color",depth:"depth",dev:"verbose",focus:"focus",icon:"icon",id:"id",height:"height",labels:"labels",legend:"legend",margin:"margin",messages:"status messages",mode:"mode",order:"order",search:"search",shape:"shape",size:"size",style:"style",temp:"temporary segments",text:"text",time:"time",timeline:"timeline",total:"total segments",type:"type",width:"width",x:"x axis",y:"y axis",zoom:"zoom"},time:["date","day","month","time","year"],ui:{and:"and",back:"back",collapse:"click to collapse",error:"error",expand:"click to expand",including:"including",loading:"loading...",more:"{0} more",moreInfo:"click for more info",noResults:"no results matching {0}.",primary:"primary connections",share:"share",total:"total",values:"values"},uppercase:["tv","ui"],visualization:{bubbles:"Bubbles",chart:"Chart",geo_map:"Geo Map",line:"Line Plot",network:"Network",rings:"Rings",scatter:"Scatter Plot",stacked:"Stacked Area",tree_map:"Tree Map"}},i.locale.mk={dev:{accepted:"{0} не е прифатенa вредноста за {1}, ве молиме користете еднa од следниве вредности: {2}.",deprecated:"{0} метод е отстранета, ве молиме обновете го вашиот код за да се користи {1}.",noChange:"{0} не е ажурирана, бидејќи немаше промени.",noContainer:"не можe да се најде контејнер на страницата кој се совпаѓа со {0}.",of:"на",oldStyle:"својствата за стилот за {0} сега се вградени директно во. {1} ().",sameEdge:"рабовите не може да имаат алка самите кон себе. автоматски ги отстранувам рабовите кои се само-референцираат {0}.",set:"{0} е наместен.",setLong:"{0} е поставен на {1}.",setContainer:"Ве молиме дефинирајте контејнер div користејќи .container()"},error:{accepted:"{0} не е прифатлива за {1} {2} визуелизација, ве молиме користете една од следниве: {3}.",connections:"нема конекции на располагање за {0}.",data:"нема податоци",dataYear:"Нема достапни податоци за {0}.",lib:"{0} визуализации бараат вчитување на библиотеката {1} .",libs:"{0} визуализации бараат вчитување на следниве библиотеки: {1}.",method:"{0} визуализации бара поставување на {1} методот.",methods:"{0} визуализации бараат поставување на следниве методи: {1}."},lowercase:["a","и","во","но","на","или","да","се","со"],method:{active:"активни сегменти",color:"боја",depth:"длабочина",dev:"опширно",focus:"фокус",icon:"икона",id:"ID",height:"висина",labels:"етикети",legend:"легенда",margin:"маргина",messages:"пораки за статусот",order:"цел",search:"барај",shape:"форма",size:"големина",style:"стил",temp:"привремени сегменти",text:"текст",time:"време",timeline:"времеплов",total:"Вкупно сегменти",type:"тип",width:"ширина",x:"x оската",y:"y оската",zoom:"зум",mode:"режим"},time:["датум","ден","месец","време","година"],visualization:{bubbles:"Меурчиња",chart:"Табела",geo_map:"Гео мапа",line:"Линиски график",network:"Мрежа",rings:"Прстени",scatter:"Распрскан график",stacked:"Наредена површина",tree_map:"Мапа во вид на дрво"},ui:{and:"и",back:"назад",collapse:"кликни за да се собере",error:"грешка",expand:"кликни за да се прошири",loading:"Се вчитува ...",more:"{0} повеќе",moreInfo:"кликнете за повеќе информации",noResults:"Нема резултати за појавување на {0}.",primary:"основно врски",share:"удел",total:"Вкупно",values:"вредности",including:"вклучувајќи"},message:{data:"анализирање на податоците",draw:"цртање на визуелизација",initializing:"иницијализација {0}",loading:"вчитување на податоци",tooltipReset:"ресетирање на објаснувањата",ui:"ажурирање на кориничкиот интерфејс"},uppercase:["TV","UI"]},i.locale.pt={dev:{accepted:"{0} não é um valor aceito para {1}, por favor, use um dos seguintes procedimentos: {2}.",deprecated:"{0} método foi removido, por favor atualize seu código para utilizar {1}.",noChange:"{0} não foi atualizado porque ele não mudou.",noContainer:"Não foi possível encontrar um local na página correspondente a {0}.",of:"de",oldStyle:"propriedades de estilo para {0} já foram incorporados diretamente no. {1} ().",sameEdge:"bordas não podem vincular a si mesmos. removendo automaticamente borda de auto-referência {0}.",set:"{0} foi definida.",setLong:"{0} foi definida para {1}.",setContainer:"por favor, defina um div utilizando .container()"},error:{accepted:"{0} não é um reconhecido {1} para {2} visualizações, por favor, use um dos seguintes procedimentos: {3}.",connections:"Não há conexões disponíveis para {0}.",data:"Não há dados disponíveis",dataYear:"Não há dados disponíveis para {0}.",lib:"A visualização {0} necessita que seja carregado a biblioteca {1}.",libs:"A visualização {0} necessita que seja carregado as bibliotecas {1}.",method:"A visualização {0} exige a definição do método {1}.",methods:"A visualização {0} exige a definição dos métodos {1}."},lowercase:["a","com","de","e","em","mas","ou","para","um"],method:{active:"segmentos ativos",color:"cor",depth:"profundidade",dev:"verboso",focus:"foco",icon:"ícone",id:"id",height:"altura",labels:"rótulos",legend:"legenda",margin:"margem",messages:"mensagens de status",order:"ordenar",search:"pesquisar",shape:"forma",size:"tamanho",style:"estilo",temp:"segmentos temporários",text:"texto",time:"tempo",timeline:"cronograma",total:"segmentos totais",type:"tipo",width:"largura",x:"eixo x",y:"eixo y",zoom:"zoom",mode:"modo"},time:["ano","data","dia","hora","mês"],visualization:{bubbles:"Bolhas",chart:"Gráfico",geo_map:"Mapa",line:"Gráfico de Linha",network:"Rede",rings:"Anéis",scatter:"Dispersão",stacked:"Evolução",tree_map:"Tree Map"},ui:{and:"e",back:"de volta",collapse:"Clique para fechar",error:"erro",expand:"clique para expandir",loading:"carregando ...",more:"mais {0}",moreInfo:"clique para mais informações",noResults:"nenhum resultado para {0}.",primary:"conexões primárias",share:"participação",total:"total",values:"valores",including:"incluindo"},message:{data:"analisando dados",draw:"desenhando visualização",initializing:"inicializando {0}",loading:"carregando dados",tooltipReset:"redefinindo as dicas",ui:"atualizando interface"},uppercase:["TV"]},i.locale.zh={dev:{accepted:"{0}不是{1}的可接受值, 请用下列之一的值:{2}",deprecated:"{0}的方法已被移除, 请更新您的代码去使用{1}",noChange:"{0}没有更新, 因为它并没有改变。",noContainer:"无法在该页找到容器去匹配{0}",of:"的",oldStyle:"样式属性{0}现在已经直接嵌入到。{1}（）。",sameEdge:"边缘不能链接到自己。自动去除自我参照边缘{0}。",set:"{0}已经被设置。",setLong:"{0}被设置为{1}。",setContainer:"请使用()容器来定义div容器"},error:{accepted:"{0}对于{2}的可视化效果并不是一个可接受的{1}, 请使用如下的一个：{3}.",connections:"没有对{0}可用的连接。",data:"无可用数据",dataYear:"没有数据对{0}可用。",lib:"{0}的可视化要求装载{1}库。",libs:"{0}的可视化需要加载以下库：{1}。",method:"{0}的可视化要求设置{1}方法。",methods:"{0}的可视化要求设置以下方法：{1}。"},lowercase:["一个","和","在","但是","在...里","的","或者","这","向","与...一起"],method:{active:"活跃段",color:"颜色",depth:"深度",dev:"详细",focus:"焦点",icon:"图标",id:"身份认证",height:"高度",labels:"标签",legend:"图例注释",margin:"外边距",messages:"状态消息",order:"规则",search:"搜索",shape:"形状",size:"大小",style:"样式",temp:"暂时性区段",text:"文本",time:"时间",timeline:"时间轴",total:"总段",type:"类型",width:"宽度",x:"X轴",y:"Y轴",zoom:"缩放",mode:"模式"},time:["日","星期","月","时间","年"],visualization:{bubbles:"气泡",chart:"图表",geo_map:"地理地图",line:"线图",network:"网络",rings:"特性",scatter:"散点图",stacked:"堆积面积图",tree_map:"树图"},ui:{and:"和",back:"后面",collapse:"点击合并",error:"错误",expand:"单击以展开",loading:"载入中...",more:"{0}更多",moreInfo:"点击了解更多信息",noResults:"没有结果匹配{0}。",primary:"主要连接",share:"共享",total:"总",values:"值",including:"包括"},message:{data:"分析数据",draw:"绘制可视化",initializing:"初始化{0}",loading:"加载数据",tooltipReset:"重置工具提示",ui:"更新UI"},uppercase:["电视","用户界面","研发"]},i.method=function(e,t,a){var t=t||[],a=a||[],l=i.style[i.method.style.value];
t.forEach(function(t){t in e||(e[t]={}),e[t]=i.object.merge(i.method[t],e[t]),a.indexOf(t)>=0&&(e[t]=i.object.merge(l[t],e[t]),a.splice(a.indexOf(t),1)),i.method.init(e,e[t],t),e.self[t]=i.method.function(t,e)}),a.forEach(function(t){e[t]=i.object.merge(e[t]||{},l[t]),i.method.init(e,e[t],t),e.self[t]=i.method.function(t,e)})},i.object.merge=function(e,t){function a(e,t){for(var l in e)"undefined"!=typeof e[l]&&(i.object.validate(e[l])?("object"!=typeof t[l]&&(t[l]={}),a(e[l],t[l])):t[l]=!i.util.d3selection(e[l])&&e[l]instanceof Array?e[l].slice(0):e[l])}var l={};return e&&a(e,l),t&&a(t,l),l},i.object.validate=function(e){return null!==e&&"object"==typeof e&&!(e instanceof Array)},i.number.format=function(e,t,a){if(!a&&"getVars"in this)var a=this.getVars();if(a&&t&&(t===a.x.value&&"log"===a.x.scale.value||t===a.y.value&&"log"===a.y.scale.value)){var l="⁰¹²³⁴⁵⁶⁷⁸⁹",n=function(e){return(e+"").split("").map(function(e){return l[e]}).join("")};return"10 "+n(Math.round(Math.log(e)/Math.LN10))}if("locale"in this)var r=this.locale.value,o=r.time;else var r=i.locale.en,o=r.time;if(a&&"string"==typeof a.time.value&&o.push(a.time.value),t&&o.indexOf(t.toLowerCase())>=0)return e;if(10>e&&e>-10)return d3.round(e,2);if(e.toString().split(".")[0].length>4){var s=d3.formatPrefix(e).symbol;return s=s.replace("G","B"),e=d3.formatPrefix(e).scale(e),e=parseFloat(d3.format(".3g")(e)),e+s}return"share"==t?d3.format(".2f")(e):d3.format(",f")(e)},i.string.format=function(){var e=Array.prototype.slice.call(arguments),t=e.shift();return t.unkeyed_index=0,t.replace(/\{(\w*)\}/g,function(a,i){if(""===i&&(i=t.unkeyed_index,t.unkeyed_index++),i==+i)return"undefined"!==e[i]?e[i]:a;for(var l=0;l<e.length;l++)if("object"==typeof e[l]&&"undefined"!=typeof e[l][i])return e[l][i];return a}.bind(t))},i.string.list=function(e,t,a,l){if(!(e instanceof Array))return e;if(e=e.slice(0),!t)var t=i.locale.en.ui.and;if(!l)var l=i.locale.en.ui.more;if(2===e.length)return e.join(" "+t+" ");if(a&&e.length>a){var n=e.length-a+1;e=e.slice(0,a-1),e[a-1]=i.string.format(l,n)}return e.length>1&&(e[e.length-1]=t+" "+e[e.length-1]),e.join(", ")},i.string.strip=function(e){var t=["!","@","#","$","%","^","&","*","(",")","[","]","{","}",".",",","/","\\","|","'",'"',";",":","<",">","?","=","+"];return e+="",""+e.replace(/[^A-Za-z0-9\-_]/g,function(e){if(" "==e)return"_";if(t.indexOf(e)>=0)return"";var a=[[/[\300-\306]/g,"A"],[/[\340-\346]/g,"a"],[/[\310-\313]/g,"E"],[/[\350-\353]/g,"e"],[/[\314-\317]/g,"I"],[/[\354-\357]/g,"i"],[/[\322-\330]/g,"O"],[/[\362-\370]/g,"o"],[/[\331-\334]/g,"U"],[/[\371-\374]/g,"u"],[/[\321]/g,"N"],[/[\361]/g,"n"],[/[\307]/g,"C"],[/[\347]/g,"c"]],i="";for(var l in a)if(a[l][0].test(e)){i=a[l][1];break}return i})},i.string.title=function(e){if(!e)return"";if("locale"in this){var t=this.locale.value;"string"==typeof t&&(t=t in i.locale?i.locale[t]:i.locale.en)}else var t=i.locale.en;if("."===e.charAt(e.length-1))return e.charAt(0).toUpperCase()+e.substr(1);var a=t.lowercase,l=t.uppercase;return e.replace(/\w\S*/g,function(t,i){return l.indexOf(t.toLowerCase())>=0?t.toUpperCase():a.indexOf(t.toLowerCase())>=0&&0!==i&&i!==e.length-1?t.toLowerCase():t.charAt(0).toUpperCase()+t.substr(1).toLowerCase()})},i.textwrap=function(){var e={shell:"textwrap"};e.self=function(t){return t.each(function(){i.textwrap.getDimensions(e),i.textwrap.getSize(e),e.size.value[0]<e.height.value&&(i.textwrap.getText(e),i.textwrap.wrap(e))}),e.self};var t=["container","dev","draw","format","height","resize","text","shape","size","width"];return i.method(e,t),e.self},i.tooltip.app=function(e){function t(t){var s={},p={},f="merged"in l.d3plus?n:n+1,h=a.id.nesting[f],b="merged"in l.d3plus?l.d3plus.merged:l[h],w=i.variable.value(a,l,a.size.value);if(a.tooltip.children.value)if(b instanceof Array){if(b=b.slice(0),i.object.validate(b[0])){var _=[];b.forEach(function(e){_=_.concat(e[h])}),b=i.util.uniques(_,h)}for(var z="short"===v?3:a.data.large,k=d3.min([b.length,z]),A=0;k>A;A++){var E=b[A],O=i.variable.text(a,E,f)[0],j=i.variable.value(a,E,a.size.value,h),F=i.variable.color(a,E,h);p[O]=j?a.format.value(j,a.size.value):"",F&&(p.d3plus_colors||(p.d3plus_colors={}),p.d3plus_colors[O]=F)}b.length>k&&(p.d3plusMore=b.length-k)}else if(b){var O=i.variable.text(a,b,f)[0];p[O]=w?a.format.value(w,a.size.value):""}a.tooltip.size.value&&w&&(!b||b instanceof Array)&&(s[a.size.value]=w);var S=a.active.value?i.variable.value(a,l,a.active.value):l.d3plus.active,B=a.temp.value?i.variable.value(a,l,a.temp.value):l.d3plus.temp,C=a.total.value?i.variable.value(a,l,a.total.value):l.d3plus.total;if("number"==typeof S&&S>0&&C){var M=a.active.value||"active";s[M]=S+"/"+C+" ("+a.format.value(S/C*100,"share")+"%)"}if("number"==typeof B&&B>0&&C){var M=a.temp.value||"temp";s[M]=B+"/"+C+" ("+a.format.value(B/C*100,"share")+"%)"}a.tooltip.share.value&&l.d3plus.share&&(s.share=a.format.value(100*l.d3plus.share,"share")+"%");var f="depth"in e?e.depth:n,q=i.variable.text(a,l,f)[0],T=i.variable.value(a,l,a.icon.value,a.id.nesting[f]),N=i.tooltip.data(a,l,v,s,p,f);if(N.length>0||g||!l.d3plus_label&&"short"==v&&q||l.d3plus_label&&"visible"in l.d3plus_label&&!l.d3plus_label.visible){q||(q=E);var f=l.d3plus&&"depth"in l.d3plus?a.id.nesting[l.d3plus.depth]:a.id.value;if("string"==typeof a.icon.style.value)var P=a.icon.style.value;else if("object"==typeof a.icon.style.value&&a.icon.style.value[f])var P=a.icon.style.value[f];else var P="default";if(e.width)var L=e.width;else if(d||0!=N.length)var L=a.tooltip.small;else var L="auto";i.tooltip.create({align:c,arrow:o,locale:a.format.locale.value,background:a.tooltip.background,curtain:a.tooltip.curtain.color,curtainopacity:a.tooltip.curtain.opacity,fontcolor:a.tooltip.font.color,fontfamily:a.tooltip.font.family.value,fontsize:a.tooltip.font.size,fontweight:a.tooltip.font.weight,data:N,color:i.variable.color(a,l),allColors:!0,footer:e.footer===!1?e.footer:g,fullscreen:d,html:t,icon:T,id:u,max_height:e.maxheight,max_width:a.tooltip.small,mouseevents:r,offset:x,parent:a.container.value,style:P,title:q,width:L,x:m,y:y})}else i.tooltip.remove(u)}"d3plus"in e.data||(e.data.d3plus={});var a=e.vars,l=e.data,n="d3plus"in l&&"depth"in l.d3plus?l.d3plus.depth:a.depth.value,r=(e.ex,e.mouseevents?e.mouseevents:!1),o="arrow"in e?e.arrow:!0,s=i.variable.value(a,l,a.id.value),u=e.id||a.type.value;if(!d3.event||"click"!=d3.event.type||!a.tooltip.html.value&&!a.tooltip.value.long||"fullscreen"in e){var d=!1,c=e.anchor||a.tooltip.anchor,v=e.length||"short",p=a.zoom.direction(l);if(-1===p){var f=a.id.nesting[n-1];i.variable.value(a,s,f)}if(1===p&&a.zoom.value)var h=a.format.value(a.format.locale.value.ui.expand);else if(-1===p&&a.zoom.value&&a.history.states.length)var h=a.format.value(a.format.locale.value.ui.collapse);else if("short"==v&&(a.tooltip.html.value||a.tooltip.value.long)&&a.focus.value!=s)var h=a.format.locale.value.ui.moreInfo;else if("long"==v)var h=a.footer.value||"";else var h="";var g=h.length?a.format.value(h,"footer"):!1}else{var d=!0,o=!1,r=!0,v="long",g=a.footer.value;a.covered=!0}if("x"in e)var m=e.x;else if("follow"==i.visualization[a.type.value].tooltip)var m=d3.mouse(a.container.value.node())[0];else{var m=l.d3plus.x;a.zoom.translate&&a.zoom.scale&&(m=a.zoom.translate[0]+m*a.zoom.scale),m+=a.margin.left}if("y"in e)var y=e.y;else if("follow"==i.visualization[a.type.value].tooltip)var y=d3.mouse(a.container.value.node())[1];else{var y=l.d3plus.y;a.zoom.translate&&a.zoom.scale&&(y=a.zoom.translate[1]+y*a.zoom.scale),y+=a.margin.top}if("offset"in e)var x=e.offset;else if("follow"==i.visualization[a.type.value].tooltip)var x=3;else{var x=l.d3plus.r?l.d3plus.r:l.d3plus.height/2;a.zoom.scale&&(x*=a.zoom.scale)}d?"string"==typeof a.tooltip.html.value?t(a.tooltip.html.value):"function"==typeof a.tooltip.html.value?t(a.tooltip.html.value(s)):a.tooltip.html.value&&"object"==typeof a.tooltip.html.value&&a.tooltip.html.value.url?d3.json(a.tooltip.html.value.url,function(e){var i=a.tooltip.html.value.callback?a.tooltip.html.value.callback(e):e;t(i)}):t(""):t("")},i.tooltip.arrow=function(e){e.style("bottom",function(e){return"center"==e.anchor.y||e.flip?"auto":"-5px"}).style("top",function(e){return"center"!=e.anchor.y&&e.flip?"-5px":"center"==e.anchor.y?"50%":"auto"}).style("left",function(e){return"center"==e.anchor.y&&e.flip?"-5px":"center"!=e.anchor.y?"50%":"auto"}).style("right",function(e){return"center"!=e.anchor.y||e.flip?"auto":"-5px"}).style("margin-left",function(e){if("center"==e.anchor.y)return"auto";if("right"==e.anchor.x)var t=-e.width/2+e.arrow_offset/2;else if("left"==e.anchor.x)var t=e.width/2-2*e.arrow_offset-5;else var t=-5;if(e.cx-e.width/2-5<t)t=e.cx-e.width/2-5,t<2-e.width/2&&(t=2-e.width/2);else if(-(e.limit[0]-e.cx-e.width/2+5)>t){var t=-(e.limit[0]-e.cx-e.width/2+5);t>e.width/2-11&&(t=e.width/2-11)}return t+"px"}).style("margin-top",function(e){if("center"!=e.anchor.y)return"auto";if("bottom"==e.anchor.y)var t=-e.height/2+e.arrow_offset/2-1;else if("top"==e.anchor.y)var t=e.height/2-2*e.arrow_offset-2;else var t=-9;if(e.cy-e.height/2-e.arrow_offset<t)t=e.cy-e.height/2-e.arrow_offset,t<4-e.height/2&&(t=4-e.height/2);else if(-(e.limit[1]-e.cy-e.height/2+e.arrow_offset)>t){var t=-(e.limit[1]-e.cy-e.height/2+e.arrow_offset);t>e.height/2-22&&(t=e.height/2-22)}return t+"px"})},i.tooltip.create=function(e){var t=e.fullscreen?250:200;if(e.width=e.width||t,e.max_width=e.max_width||386,e.id=e.id||"default",e.size=e.fullscreen||e.html?"large":"small",e.offset=e.offset||0,e.arrow_offset=e.arrow?8:0,e.x=e.x||0,e.y=e.y||0,e.parent=e.parent||d3.select("body"),e.curtain=e.curtain||"#fff",e.curtainopacity=e.curtainopacity||.8,e.background=e.background||"#fff",e.fontcolor=e.fontcolor||"#444",e.fontfamily=e.fontfamily||"sans-serif",e.fontweight=e.fontweight||"normal",e.fontsize=e.fontsize||"12px",e.style=e.style||"default",e.zindex="small"==e.size?2e3:500,e.locale=e.locale||i.locale.en,e.iconsize||(e.iconsize="small"==e.size?22:50),e.limit=[parseFloat(e.parent.style("width"),10),parseFloat(e.parent.style("height"),10)],e.title instanceof Array){var a=e.locale.ui.and,l=e.locale.ui.more;e.title=i.string.list(e.title,a,3,l)}var n=function(){d3.selectAll("div.d3plus_tooltip_data_desc").style("height","0px"),d3.selectAll("div.d3plus_tooltip_data_help").style("background-color","#ccc")};if(i.tooltip.remove(e.id),e.anchor={},e.fullscreen)e.anchor.x="center",e.anchor.y="center",e.x=e.parent?e.parent.node().offsetWidth/2:window.innerWidth/2,e.y=e.parent?e.parent.node().offsetHeight/2:window.innerHeight/2;else if(e.align){var r=e.align.split(" ");e.anchor.y=r[0],e.anchor.x=r[1]?r[1]:"center"}else e.anchor.x="center",e.anchor.y="top";var o=e.width-30;if(e.fullscreen){e.parent.append("div").attr("id","d3plus_tooltip_curtain_"+e.id).attr("class","d3plus_tooltip_curtain").style("background-color",e.curtain).style("opacity",e.curtainopacity).style("position","absolute").style("z-index",499).style("top","0px").style("right","0px").style("bottom","0px").style("left","0px").on(i.evt.click,function(){i.tooltip.remove(e.id)})}var s=e.parent.append("div").datum(e).attr("id","d3plus_tooltip_id_"+e.id).attr("class","d3plus_tooltip d3plus_tooltip_"+e.size).style("color",e.fontcolor).style("font-family",e.fontfamily).style("font-weight",e.fontweight).style("font-size",e.fontsize+"px").style("position","absolute").style("z-index",e.zindex).on(i.evt.out,function(){n()});e.max_height&&s.style("max-height",e.max_height+"px"),e.fixed?(s.style("z-index",500),e.mouseevents=!0):s.style("z-index",2e3);var u=s.append("div").datum(e).attr("class","d3plus_tooltip_container").style("background-color",e.background);if(e.fullscreen&&e.html){c=e.parent?.75*e.parent.node().offsetWidth:.75*window.innerWidth,k=e.parent?.75*e.parent.node().offsetHeight:.75*window.innerHeight,u.style("width",c+"px").style("height",k+"px");var d=u.append("div").attr("class","d3plus_tooltip_body").style("display","inline-block").style("z-index",1).style("width",e.width+"px")}else{if("auto"==e.width){var c="auto";u.style("max-width",e.max_width+"px")}else var c=e.width-14+"px";var d=u.style("width",c)}if(e.title||e.icon)var v=d.append("div").attr("class","d3plus_tooltip_header").style("position","relative").style("z-index",1);if(e.fullscreen){s.append("div").attr("class","d3plus_tooltip_close").style("background-color",e.color).style("color",i.color.text(e.color)).style("position","absolute").html("&times;").on(i.evt.click,function(){i.tooltip.remove(e.id)})}if(e.mouseevents){if(e.mouseevents!==!0){var p=d3.select(e.mouseevents).on(i.evt.out),f=function(){var t=d3.event.toElement||d3.event.relatedTarget;if(t)var a="string"==typeof t.className?t.className:t.className.baseVal,l=0==a.indexOf("d3plus_tooltip");else var l=!1;t&&(h(s.node(),t)||h(e.mouseevents,t)||l)||(p(d3.select(e.mouseevents).datum()),n(),d3.select(e.mouseevents).on(i.evt.out,p))},h=function(e,t){for(var a=t.parentNode;null!==a;){if(a==e)return!0;a=a.parentNode}return!1};d3.select(e.mouseevents).on(i.evt.out,f),s.on(i.evt.out,f);var g=d3.select(e.mouseevents).on(i.evt.move);g&&s.on(i.evt.move,g)}}else s.style("pointer-events","none");if(e.arrow){s.append("div").attr("class","d3plus_tooltip_arrow").style("background-color",e.background).style("position","absolute")}if(e.icon){var m=v.append("div").attr("class","d3plus_tooltip_icon").style("width",e.iconsize+"px").style("height",e.iconsize+"px").style("z-index",1).style("background-position","50%").style("background-size","100%").style("background-image","url("+e.icon+")").style("display","inline-block");"knockout"==e.style&&m.style("background-color",e.color),o-=m.node().offsetWidth}if(e.title){var y=e.max_width-6;e.icon&&(y-=e.iconsize+6),y+="px";{v.append("div").attr("class","d3plus_tooltip_title").style("max-width",y).style("color",e.icon?e.fontcolor:i.color.legible(e.color)).style("vertical-align","top").style("width",o+"px").style("display","inline-block").style("overflow","hidden").style("text-overflow","ellipsis").style("word-wrap","break-word").style("z-index",1).text(e.title)}}if(e.description){d.append("div").attr("class","d3plus_tooltip_description").text(e.description)}if(e.data||e.html&&!e.fullscreen)var x=d.append("div").attr("class","d3plus_tooltip_data_container");if(e.data){var b=0,w={},_=null;e.data.forEach(function(t,a){t.group&&_!=t.group&&(_=t.group,x.append("div").attr("class","d3plus_tooltip_data_title").text(t.group));var l=x.append("div").attr("class","d3plus_tooltip_data_block").datum(t);t.highlight===!0?l.style("color",i.color.legible(e.color)):(t.allColors||t.highlight!==e.color)&&l.style("color",i.color.legible(t.highlight));var r=l.append("div").attr("class","d3plus_tooltip_data_name").html(t.name).on(i.evt.out,function(){d3.event.stopPropagation()});if(t.value instanceof Array){var o=e.locale.ui.and,s=e.locale.ui.more;t.value=i.string.list(t.value,o,3,s)}var u=l.append("div").attr("class","d3plus_tooltip_data_value").text(t.value).on(i.evt.out,function(){d3.event.stopPropagation()});if(i.rtl?u.style("left","6px"):u.style("right","6px"),e.mouseevents&&t.desc){var d=l.append("div").attr("class","d3plus_tooltip_data_desc").text(t.desc).on(i.evt.out,function(){d3.event.stopPropagation()}),c=d.node().offsetHeight;d.style("height","0px");var v=r.append("div").attr("class","d3plus_tooltip_data_help").text("?").on(i.evt.over,function(){var e=d3.select(this.parentNode.parentNode).style("color");d3.select(this).style("background-color",e),d.style("height",c+"px")}).on(i.evt.out,function(){d3.event.stopPropagation()});r.style("cursor","pointer").on(i.evt.over,function(){n();var e=d3.select(this.parentNode).style("color");v.style("background-color",e),d.style("height",c+"px")}),l.on(i.evt.out,function(){d3.event.stopPropagation(),n()})}var p=parseFloat(u.style("width"),10);p>e.width/2&&(p=e.width/2),p>b&&(b=p),a!=e.data.length-1&&(t.group&&t.group==e.data[a+1].group||!t.group&&!e.data[a+1].group)&&x.append("div").attr("class","d3plus_tooltip_data_seperator")}),x.selectAll(".d3plus_tooltip_data_name").style("width",function(){var e=parseFloat(d3.select(this.parentNode).style("width"),10);return e-b-30+"px"}),x.selectAll(".d3plus_tooltip_data_value").style("width",b+"px").each(function(e){var t=parseFloat(d3.select(this).style("height"),10);w[e.name]=t}),x.selectAll(".d3plus_tooltip_data_name").style("min-height",function(e){return w[e.name]+"px"})}e.html&&!e.fullscreen&&x.append("div").html(e.html);var z=d.append("div").attr("class","d3plus_tooltip_footer");if(e.footer&&z.html(e.footer),e.height=s.node().offsetHeight,e.html&&e.fullscreen){var k=e.height-12,c=s.node().offsetWidth-e.width-44;u.append("div").attr("class","d3plus_tooltip_html").style("width",c+"px").style("height",k+"px").html(e.html)}if(e.width=s.node().offsetWidth,"center"!=e.anchor.y?e.height+=e.arrow_offset:e.width+=e.arrow_offset,e.data||!e.fullscreen&&e.html){if(e.fullscreen)var k=e.height;else var A=e.parent.node().offsetHeight,E=e.fixed?A-e.y-10:A-10,k=e.height<E?e.height:E;k-=parseFloat(u.style("padding-top"),10),k-=parseFloat(u.style("padding-bottom"),10),v&&(k-=v.node().offsetHeight,k-=parseFloat(v.style("padding-top"),10),k-=parseFloat(v.style("padding-bottom"),10)),z&&(k-=z.node().offsetHeight,k-=parseFloat(z.style("padding-top"),10),k-=parseFloat(z.style("padding-bottom"),10)),x.style("max-height",k+"px")}e.height=s.node().offsetHeight,i.tooltip.move(e.x,e.y,e.id)},i.tooltip.data=function(e,t,a,l,n,r){function o(a,l){if(e.attrs.value[l])var n=l;else var n=null;l&&(l=e.format.value(l));var r=u[a]||i.variable.value(e,t,a,n);if(r!==!1&&null!==r){var o=e.format.value(e.format.locale.value.ui[a]?e.format.locale.value.ui[a]:a),s=c.indexOf(a)>=0;r instanceof Array?r.forEach(function(t){t=e.format.value(t)}):r=e.format.value(r);var d={name:o,value:r,highlight:s,group:l};if(e.descs.value)if("function"==typeof e.descs.value){var v=e.descs.value(a);"string"==typeof v&&(d.desc=v)}else a in e.descs.value&&(d.desc=e.descs.value[a]);r&&p.push(d)}}if(e.small)return[];if(!a)var a="long";if("long"==a)var s="short";else var s="long";var u={};if(l&&"string"==typeof l)l=[l];else if(l&&"object"==typeof l){u=i.object.merge(u,l);var l=[];for(var d in u)l.push(d)}else if(!l)var l=[];var c=[];if(e.tooltip.value instanceof Array)var v=e.tooltip.value;else if("string"==typeof e.tooltip.value)var v=[e.tooltip.value];else{if(e.tooltip.value[e.id.nesting[r]])var v=e.tooltip.value[e.id.nesting[r]];else var v=e.tooltip.value;v instanceof Array||(v=v[a]?v[a]:v[s]?[]:i.object.merge({"":[]},v)),"string"==typeof v?v=[v]:v instanceof Array||(v=i.object.merge({"":[]},v))}var p=[];if(v instanceof Array)l.forEach(function(e){v.indexOf(e)<0&&v.push(e)}),v.forEach(function(e){o(e)});else{if(e.id.nesting.length&&r<e.id.nesting.length-1){var v=i.util.copy(v);e.id.nesting.forEach(function(e,t){t>r&&v[e]&&delete v[e]})}if(e.tooltip.value.long&&"object"==typeof e.tooltip.value.long){var f=[];for(var h in e.tooltip.value.long)l.forEach(function(t){e.tooltip.value.long[h].indexOf(t)>=0&&(v[h]&&v[h].indexOf(t)<0||!v[h])?(v[h]||(v[h]=[]),v[h].push(t),f.push(t)):v[h]&&v[h].indexOf(t)>=0&&f.push(t)});l.forEach(function(e){f.indexOf(e)<0&&(v[""]||(v[""]=[]),v[""].push(e))})}else{var g=[];for(var h in v)l.forEach(function(e){v[h]instanceof Array&&v[h].indexOf(e)>=0?g.push(e):"string"==typeof v[h]&&v[h]==e&&g.push(e)});g.length!=l.length&&(v[""]||(v[""]=[]),l.forEach(function(e){g.indexOf(e)<0&&v[""].push(e)}))}v[""]&&(v[""].forEach(function(e){o(e,"")}),delete v[""]);for(var h in v)v[h]instanceof Array?v[h].forEach(function(e){o(e,h)}):"string"==typeof v[h]&&o(v[h],h)}if(n){var m=e.format.locale.value.ui.including,y=n.d3plus_colors;for(var x in n)if("d3plus_colors"!==x){if("d3plusMore"===x){var b=e.format.locale.value.ui.more,w=i.string.format(b,n[x]),_=!0;n[x]=""}else var w=x,_=y&&y[w]?y[w]:!1;p.push({group:e.format.value(m),highlight:_,name:w,value:n[x]})}}if(e.tooltip.connections.value&&"long"===a){var z=e.edges.connections(t[e.id.value],e.id.value,!0);z.length&&z.forEach(function(t){var a=i.variable.text(e,t)[0],l=i.variable.color(e,t),n=e.tooltip.font.size,r="square"==e.shape.value?0:n;styles=["background-color: "+l,"border-color: "+i.color.legible(l),"border-style: solid","border-width: "+e.data.stroke.width+"px","display: inline-block","height: "+n+"px","left: 0px","position: absolute","width: "+n+"px","top: 0px",i.prefix()+"border-radius: "+r+"px"],node="<div style='"+styles.join("; ")+";'></div>",p.push({group:e.format.value(e.format.locale.value.ui.primary),highlight:!1,name:"<div style='position:relative;padding-left:"+1.5*n+"px;'>"+node+a+"</div>",value:""})})}return p},i.tooltip.move=function(e,t,a){if(a)var l=d3.select("div#d3plus_tooltip_id_"+a);else var l=d3.select("div#d3plus_tooltip_id_default");if(l.node()){var n=l.datum();n.cx=e,n.cy=t,n.fixed||("center"!=n.anchor.y?("right"==n.anchor.x?n.x=n.cx-n.arrow_offset-4:"center"==n.anchor.x?n.x=n.cx-n.width/2:"left"==n.anchor.x&&(n.x=n.cx-n.width+n.arrow_offset+2),"bottom"==n.anchor.y?n.flip=n.cy+n.height+n.offset<=n.limit[1]:"top"==n.anchor.y&&(n.flip=n.cy-n.height-n.offset<0),n.y=n.flip?n.cy+n.offset+n.arrow_offset:n.cy-n.height-n.offset-n.arrow_offset):(n.y=n.cy-n.height/2,"right"==n.anchor.x?n.flip=n.cx+n.width+n.offset<=n.limit[0]:"left"==n.anchor.x&&(n.flip=n.cx-n.width-n.offset<0),"center"==n.anchor.x?(n.flip=!1,n.x=n.cx-n.width/2):n.x=n.flip?n.cx+n.offset+n.arrow_offset:n.cx-n.width-n.offset),n.x<0?n.x=0:n.x+n.width>n.limit[0]&&(n.x=n.limit[0]-n.width),n.y<0?n.y=0:n.y+n.height>n.limit[1]&&(n.y=n.limit[1]-n.height)),l.style("top",n.y+"px").style("left",n.x+"px"),n.arrow&&l.selectAll(".d3plus_tooltip_arrow").call(i.tooltip.arrow)}},i.tooltip.remove=function(e){e?(d3.selectAll("div#d3plus_tooltip_curtain_"+e).remove(),d3.selectAll("div#d3plus_tooltip_id_"+e).remove()):(d3.selectAll("div#d3plus_tooltip_curtain").remove(),d3.selectAll("div.d3plus_tooltip").remove())},i.util.buckets=function(e,t){for(var a=[],i=1/(t-1)*(e[1]-e[0]),l=i,l=e[0];l<=e[1];l+=i)a.push(l);return a.length<t&&(a[t-1]=e[1]),a[a.length-1]<e[1]&&(a[a.length-1]=e[1]),a},i.util.child=function(e,t){if(!e||!t)return!1;i.util.d3selection(e)&&(e=e.node()),i.util.d3selection(e)&&(t=t.node());for(var a=t.parentNode;null!==a;){if(a==e)return!0;a=a.parentNode}return!1},i.util.closest=function(e,t){var a=e[0];return e.forEach(function(e){Math.abs(t-e)<Math.abs(t-a)&&(a=e)}),a},i.util.copy=function(e){if(i.object.validate(e))return i.object.merge(e);if(e instanceof Array){var t=[];return e.forEach(function(e){t.push(i.util.copy(e))}),t}return e},i.util.d3selection=function(e){return i.ie?"object"==typeof e&&e instanceof Array:e instanceof d3.selection},i.util.dataurl=function(e,t){var a=new Image;a.src=e,a.crossOrigin="Anonymous",a.onload=function(){var e=document.createElement("canvas");e.width=this.width,e.height=this.height;var a=e.getContext("2d");a.drawImage(this,0,0),t.call(this,e.toDataURL("image/png")),e=null}},i.util.distances=function(e,t){var a=[],i=[];return e.forEach(function(l){var n=t?t(l):[l.x,l.y];i.push(l),e.forEach(function(e){if(i.indexOf(e)<0){var l=t?t(e):[e.x,e.y],r=Math.abs(n[0]-l[0]),o=Math.abs(n[1]-l[1]);a.push(Math.sqrt(r*r+o*o))}})}),a.sort(function(e,t){return e-t}),a},i.util.offset=function(e,t,a){var i={x:0,y:0};if(0>e&&(e=2*Math.PI+e),"square"==a){var l=45*(Math.PI/180);if(e<=Math.PI)if(e<Math.PI/2)if(l>e){i.x+=t;var n=Math.tan(e)*t;i.y+=n}else{i.y+=t;var r=t/Math.tan(e);i.x+=r}else if(e<Math.PI-l){i.y+=t;var r=t/Math.tan(Math.PI-e);i.x-=r}else{i.x-=t;var n=Math.tan(Math.PI-e)*t;i.y+=n}else if(e<3*Math.PI/2)if(e<l+Math.PI){i.x-=t;var n=Math.tan(e-Math.PI)*t;i.y-=n}else{i.y-=t;var r=t/Math.tan(e-Math.PI);i.x-=r}else if(e<2*Math.PI-l){i.y-=t;var r=t/Math.tan(2*Math.PI-e);i.x+=r}else{i.x+=t;var n=Math.tan(2*Math.PI-e)*t;i.y-=n}}else i.x+=t*Math.cos(e),i.y+=t*Math.sin(e);return i},i.util.uniques=function(e,t){if(void 0===e||void 0===t)return[];var a=!1,i=d3.nest().key(function(e){return"string"==typeof t?(a||"undefined"==typeof e[t]||(a=typeof e[t]),e[t]):"function"==typeof t?(a||"undefined"==typeof t(e)||(a=typeof t(e)),t(e)):e}).entries(e).reduce(function(e,t){return a&&"undefined"!==t.key?e.concat("number"===a?parseFloat(t.key):t.key):e},[]);return"number"===a&&i.sort(function(e,t){return t>e?-1:1}),i},i.variable.color=function(e,t,a){function l(e){return i.object.validate(e)&&(e=e[a]),i.color.random(e)}if(!a)var a=e.id.value;if(e.color.value){for(var n=e.id.nesting.indexOf(a);n>=0;n--){var r=e.id.nesting[n],o=i.variable.value(e,t,e.color.value,r);if(o)break}return o?e.color.scale?e.color.scale(o):i.color.validate(o)?o:l(o):e.color.value||"function"==typeof e.color.scale?e.color.missing:l(t)}return l(t)},i.variable.text=function(e,t,a){if("number"!=typeof a)var a=e.depth.value;var l=e.id.nesting[a];if(e.text.nesting&&i.object.validate(e.text.nesting))if(e.text.nesting[l])var n=e.text.nesting[l];else var n=e.text.nesting[d3.keys(e.text.nesting)[0]];else{var n=[];e.text.value&&n.push(e.text.value),n.push(l)}n instanceof Array||(n=[n]);var r=[];return n.forEach(function(a){var n=i.variable.value(e,t,a,l);n&&(n instanceof Array?n.forEach(function(t){t=e.format.value(t.toString())}):n=e.format.value(n.toString()),r.push(n))}),r},i.variable.value=function(e,t,a,l,n){function r(e){if(t instanceof Array){var a=i.util.uniques(t,l);return e.filter(function(e){return a.indexOf(e[l])>=0})}return e.filter(function(e){return e[l]===t})}function o(e){e.children?e.children.forEach(function(e){o(e)}):e[a]&&u.push(e[a])}function s(e){var t=i.util.uniques(e,a);return 1===t.length?t[0]:void 0}if(a&&"function"==typeof a)return a(t);if(!l)if(i.object.validate(a)){if(a[e.id.value])var l=e.id.value;else var l=d3.keys(a)[0];a=a[l]}else var l=e.id.value;if(a===l){if(i.object.validate(t)&&a in t)return t[a];if(!(t instanceof Array))return t}var u=[];if(i.object.validate(t)&&a in t)return t[a];if(i.object.validate(t)&&t.children){if(!n){var n="sum";"string"==typeof e.aggs.value?n=e.aggs.value:e.aggs.value[a]&&(n=e.aggs.value[a])}if(o(t),u.length){if("string"==typeof n)return d3[n](u);if("function"==typeof n)return n(u)}var d=t;t=d[l]}else{if(i.object.validate(t)&&l in t){var c=s(t);if(c)return c;t=t[l]}if(t instanceof Array){var c=s(t);if(c)return c}if(e.data.app instanceof Array){var c=s(r(e.data.app));if(c)return c}}if("attrs"in e&&e.attrs.value)if(e.attrs.value instanceof Array)var v=r(e.attrs.value);else if(l in e.attrs.value)if(e.attrs.value[l]instanceof Array)var v=r(e.attrs.value[l]);else var v=e.attrs.value[l];else var v=e.attrs.value;if(i.object.validate(v)){var p=[];t instanceof Array?t.forEach(function(e){p.push(v[e])}):p.push(v[t]),v=p}if(v&&v.length){var f=i.util.uniques(v,a);if(1===f.length)return f[0]}return null},i.viz=function(){var e={g:{apps:{}},shell:"viz"};e.self=function(t){return t.each(function(){function t(){u=s.shift();var t=e.g.message&&n===u.message,a="check"in u?u.check:!0;if("function"==typeof a&&(a=a(e)),a)if(!t&&e.draw.update){e.dev.value&&(n!==!1&&i.console.groupEnd(),i.console.groupCollapsed(u.message)),n="string"==typeof e.messages.value?e.messages.value:u.message;var l="string"==typeof e.messages.value?e.messages.value:e.format.value(u.message);i.ui.message(e,l),setTimeout(c,10)}else c();else"otherwise"in u?setTimeout(function(){c("otherwise")},10):d()}e.draw.frozen=!0,e.internal_error=null,i.draw.container(e),"timing"in e.draw||(e.draw.timing=e.timing.transitions);var a=e.width.value<=e.width.small,l=e.height.value<=e.height.small;e.small=a||l;var n=!1;if(e.error.value){var r=e.draw.timing;e.group.transition().duration(r).attr("opacity",0),e.g.data.transition().duration(r).attr("opacity",0),e.g.edges.transition().duration(r).attr("opacity",0),e.messages.style="large";var o=e.error.value===!0?e.format.value(e.format.locale.value.ui.error):e.error.value;n=o,i.ui.message(e,o)}else{var s=i.draw.steps(e),u=!1;e.container.value.style("cursor","wait"),e.messages.style=e.group&&"1"===e.group.attr("opacity")?"small":"large";var d=function(){s.length?t():(e.methodGroup=!1,e.dev.value&&(i.console.timeEnd("total draw time"),i.console.groupEnd(),i.console.log("\n")),e.container.value.style("cursor","auto"))},c=function(t){var t=t||"function";u[t]instanceof Array?u[t].forEach(function(t){t(e,d)}):"function"==typeof u[t]&&u[t](e,d),u.wait||d()};t()}}),e.self};var t=["active","aggs","attrs","axes","color","container","coords","csv","data","depth","descs","dev","draw","edges","error","focus","footer","format","height","history","icon","id","labels","legend","margin","messages","nodes","order","shape","size","style","temp","text","time","timeline","title","tooltip","total","type","ui","width","x","y","zoom"],a=["axes","background","color","coords","data","edges","font","footer","height","labels","legend","links","messages","nodes","shape","timeline","timing","title","tooltip","ui","width "];return i.method(e,t,a),e.self},i.zoom.bounds=function(e,t,a){if(!t)var t=e.zoom.bounds;if("number"!=typeof a)var a=e.timing.transitions;e.zoom.size={height:t[1][1]-t[0][1],width:t[1][0]-t[0][0]};var l=e.coords.fit.value;if("auto"==l||i.visualization[e.type.value].requirements.indexOf("coords")<0)var n=d3.max([e.zoom.size.width/e.width.viz,e.zoom.size.height/e.height.viz]);else var n=e.zoom.size[l]/e["app_"+l];var r=d3.min([e.width.viz,e.height.viz]),o=(r-2*e.coords.padding)/r/n,s=e.zoom.behavior.scaleExtent();(s[0]==s[1]||t==e.zoom.bounds)&&e.zoom.behavior.scaleExtent([o,16*o]);var u=e.zoom.behavior.scaleExtent()[1];o>u&&(o=u),e.zoom.scale=o;var d=[];d[0]=e.width.viz/2-e.zoom.size.width*o/2-t[0][0]*o,d[1]=e.height.viz/2-e.zoom.size.height*o/2-t[0][1]*o,e.zoom.translate=d,e.zoom.behavior.translate(d).scale(o),e.zoom.size={height:e.zoom.bounds[1][1]-e.zoom.bounds[0][1],width:e.zoom.bounds[1][0]-e.zoom.bounds[0][0]},i.zoom.transform(e,a)},i.zoom.controls=function(){if(d3.select("#d3plus.utilsts.zoom_controls").remove(),!vars.small){var e=vars.container.value.append("div").attr("id","d3plus.utilsts.zoom_controls").style("top",vars.margin.top+5+"px");e.append("div").attr("id","zoom_in").attr("unselectable","on").on(i.evt.click,function(){vars.zoom("in")}).text("+"),e.append("div").attr("id","zoom_out").attr("unselectable","on").on(i.evt.click,function(){vars.zoom("out")}).text("-"),e.append("div").attr("id","zoom_reset").attr("unselectable","on").on(i.evt.click,function(){vars.zoom("reset"),vars.draw.update()}).html("&#8634;")}},i.zoom.labels=function(e){var t=e.zoom.behavior.scaleExtent()[1];e.dev.value&&i.console.time("determining label visibility"),e.draw.timing?e.g.viz.selectAll("text.d3plus_label").transition().duration(e.draw.timing).attr("opacity",function(a){if(!a)var a={scale:t};var i=parseFloat(d3.select(this).attr("font-size"),10);return a.visible=i/a.scale*e.zoom.scale>=7,a.visible?1:0}):e.g.viz.selectAll("text.d3plus_label").attr("opacity",function(a){if(!a)var a={scale:t};var i=parseFloat(d3.select(this).attr("font-size"),10);return a.visible=i/a.scale*e.zoom.scale>=7,a.visible?1:0}),e.dev.value&&i.console.timeEnd("determining label visibility")},i.zoom.mouse=function(e){var t=d3.event.translate,a=d3.event.scale,l=e.zoom.bounds,n=(e.width.viz-e.zoom.size.width*a)/2,r=n>0?n:0,o=n>0?e.width.viz-n:e.width.viz,s=(e.height.viz-e.zoom.size.height*a)/2,u=s>0?s:0,d=s>0?e.height.viz-s:e.height.viz;if(t[0]+l[0][0]*a>r?t[0]=-l[0][0]*a+r:t[0]+l[1][0]*a<o&&(t[0]=o-l[1][0]*a),t[1]+l[0][1]*a>u?t[1]=-l[0][1]*a+u:t[1]+l[1][1]*a<d&&(t[1]=d-l[1][1]*a),e.zoom.behavior.translate(t).scale(a),e.zoom.translate=t,e.zoom.scale=a,"wheel"==d3.event.sourceEvent.type){var c=e.draw.timing?100:250;clearTimeout(e.zoom.wheel),e.zoom.wheel=setTimeout(function(){i.zoom.labels(e)},c)}else i.zoom.labels(e);"dblclick"===d3.event.sourceEvent.type?i.zoom.transform(e,e.timing.transitions):i.zoom.transform(e,0)},i.zoom.transform=function(e,t){if("number"!=typeof t)var t=e.timing.transitions;var a=e.zoom.translate,i=e.zoom.scale;t?e.g.viz.transition().duration(t).attr("transform","translate("+a+")scale("+i+")"):e.g.viz.attr("transform","translate("+a+")scale("+i+")")
},i.input.auto=function(e){var t=e.data.value.length;1===t?e.self.type("button").draw():5>t?e.self.type("toggle").draw():e.self.type("drop").draw()},i.input.toggle=function(e){"buttons"in e.container||(e.container.buttons=i.form().container(e.container.ui).type("button"));var t=e.data.app.length,a=e.width.value?e.width.value/t:!1,l=e.container.ui.selectAll("div.d3plus_toggle").data(e.data.app,function(t){return t[e.id.value]});l.enter().append("div").attr("class","d3plus_toggle").style("display","inline-block").style("vertical-align","top"),l.order().each(function(t){"form"in t.d3plus||(t.d3plus.form=i.form().container(d3.select(this)));var l=e.id.nesting.length>e.depth.value?e.id.nesting[e.depth.value+1]:e.id.value;t[l]instanceof Array?t.d3plus.form.container({id:e.container.id+"_"+t[e.id.value]}).data(t[l]).id(e.id.nesting.slice(1)).type("drop"):t.d3plus.form.data([t]).id(e.id.value).type("button"),t.d3plus.form.color(e.color).focus(e.focus.value,function(t){t!==e.focus.value&&e.self.focus(t).draw()}).icon({select:!1,value:e.icon.value}).font(e.font).format(e.format).order(e.order).text(e.text.value).ui({border:e.ui.border,color:e.ui.color,display:"inline-block",margin:0,padding:e.ui.padding}).width(a).draw()})},i.method.axis=function(e){var e=e||"x";return{accepted:[Array,Boolean,Function,Object,String],dataFilter:!0,deprecates:[e+"axis",e+"axis_val",e+"axis_var"],domain:!1,lines:[],mute:i.method.filter(!0),range:!1,reset:["range"],scale:{accepted:["linear","log","continuous","share"],value:"linear",deprecates:["layout","unique_axis","yaxis_scale"]},solo:i.method.filter(!0),stacked:{accepted:[Boolean],value:!1},value:!1,zerofill:{accepted:[Boolean],value:!1}}},i.method.filter=function(e){var e=e||!1;return{accepted:[Array,Boolean,Function,Number,Object,String],global:e,process:Array,value:[]}},i.method.function=function(e,t){return function(a,l){function n(e){if(i.object.validate(e))if("family"in e)e.family.value=e.family.process(a.family);else for(var t in e)n(e[t])}var r=e in t&&i.object.validate(t[e])&&"accepted"in t[e]?t[e].accepted:e in t?typeof t[e]:null;if("function"==typeof r&&(r=r(t)),null===r||r instanceof Array||(r=[r]),a===Object)return t[e];if(!arguments.length&&(null===r&&!("value"in t)||void 0!==r&&r.indexOf(void 0)<0))return"value"in t[e]?t[e].value:t[e];if("style"===e&&"object"==typeof a){var o=t.format.locale.value.dev.oldStyle;(t.dev.value||"dev"===e&&a)&&!t.methodGroup&&"wait"!==t.methodGroup&&(t.methodGroup=!0,i.console.groupCollapsed("method behavior"));for(var s in a)i.console.warning(i.string.format(o,'"'+s+'"',s),s),t.self[s](a[s]);return t.self}return"font"===e&&i.object.validate(a)&&"family"in a&&"string"==typeof a.family&&n(t),i.method.object(t,e,t,e,a),"function"==typeof l&&(t[e].callback=l),t[e].chainable===!1?t[e].value:t.self}},i.method.init=function(e,t,a){t.previous=!1,t.changed=!1,t.initialized=!1,t.getVars=function(){return e},"init"in t&&!("value"in t)&&(t.value=t.init(e),delete t.init),"process"in t&&(t.value=i.method.process(t,t.value));for(var l in t)if("deprecates"===l){var n=t[l]instanceof Array?t[l]:[t[l]];n.forEach(function(t){e.self[t]=function(t,a){return function(){e.dev.value&&e.methodGroup&&(i.console.groupEnd(),e.methodGroup=!1);var l=e.format.locale.value.dev.deprecated;return t="."+t+"()",i.console.error(i.string.format(l,t,"."+a+"()"),a),e.self}}(t,a)})}else"global"===l?a in e||(e[a]=[]):i.object.validate(t[l])&&i.method.init(e,t[l],l);t.initialized=!0},i.method.object=function(e,t,a,l,n){if(["accepted","getVars"].indexOf(l)<0){var r=i.object.validate(n),o=!(!r||"value"in n||d3.keys(n)[0]in a[l]);if(null===n||!r||o)o?i.method.set(e,t,a[l],"value",n):i.method.set(e,t,a,l,n);else if(r)for(d in n)i.method.object(e,t,a[l],d,n[d])}},i.method.process=function(e,t){return e.process===Array?i.array.update(i.util.copy(e.value),t):"object"==typeof e.process&&"string"==typeof t?e.process[t]:"function"==typeof e.process?e.process(t):t},i.method.processData=function(e,t){if("string"==typeof e||i.util.d3selection(e)){if(void 0===t)var t=this;var a=(t.getVars(),e.indexOf("/")>=0);return!a&&i.util.d3selection(e)?e:a||d3.selectAll(e).empty()?(t.url=e,[]):d3.selectAll(e)}return e},i.method.set=function(e,t,a,l,n){if("value"!==l&&l&&l!==t)var r=e.format.locale.value.dev.of,o='"'+l+'" '+r+" ."+t+"()";else var o="."+t+"()";if("value"===l&&"accepted"in a)var s=a.accepted;else if(i.object.validate(a[l])&&"accepted"in a[l])var s=a[l].accepted;else var s=null;"function"==typeof s&&(s=s(e)),null===s||s instanceof Array||(s=[s]);var u=!0;if(s instanceof Array){var d=void 0===n?n:n.constructor;u=s.indexOf(n)>=0||s.indexOf(d)>=0}if(u===!1){if(void 0!==n){var c=e.format.locale.value.dev.accepted,v=[],p=JSON.stringify(n),f=e.format.locale.value.ui.and;"string"!=typeof n&&(p='"'+p+'"'),s.forEach(function(e){v.push("string"==typeof e?'"'+e+'"':"function"==typeof e?e.toString().split("()")[0].substring(9):e.toString())}),v=i.string.list(v,f),i.console.warning(i.string.format(c,p,o,v),t)}}else{if(i.object.validate(a[l])&&"value"in a[l]){var h=l;a=a[l],l="value"}if("value"===l&&"process"in a&&(n=i.method.process(a,n)),(!(a[l]instanceof Array)&&a[l]===n||a[l]&&a[l]===n)&&void 0!==n){var c=e.format.locale.value.dev.noChange;e.dev.value&&i.console.comment(i.string.format(c,o))}else{if(a.changed=!0,"history"in e&&"draw"!==t){var g=i.util.copy(a);g.method=t,e.history.chain.push(g)}if(a.previous=a[l],"id"in e&&"value"===l&&"nesting"in a)if("id"!==t){if("object"!=typeof a.nesting&&(a.nesting={}),i.object.validate(n)){for(var m in n)"string"==typeof n[m]&&(n[m]=[n[m]]);a.nesting=i.object.merge(a.nesting,n),e.id.value in a.nesting||(a.nesting[e.id.value]=n[d3.keys(n)[0]])}else a.nesting[e.id.value]=n instanceof Array?n:[n];a[l]=a.nesting[e.id.value][0]}else n instanceof Array?(a.nesting=n,"depth"in e&&e.depth.value<n.length?a[l]=n[e.depth.value]:(a[l]=n[0],"depth"in e&&(e.depth.value=0))):(a[l]=n,a.nesting=[n],"depth"in e&&(e.depth.value=0));else if("depth"===t){if(e.depth.value=n>=e.id.nesting.length?e.id.nesting.length-1:0>n?0:n,e.id.value=e.id.nesting[e.depth.value],"object"==typeof e.text.nesting){var y=e.text.nesting[e.id.value];y&&(e.text.nesting[e.id.value]="string"==typeof y?[y]:y,e.text.value=y instanceof Array?y[0]:y)}}else a[l]=i.object.validate(a[l])&&i.object.validate(n)?i.object.merge(a[l],n):n;if("value"===l&&a.global){var x=a[l].length>0,b=h||l;b in e&&(x&&e.data[b].indexOf(t)<0||!x&&e.data[b].indexOf(t)>=0)&&(e.data[b]=i.array.update(e.data[b],t))}if("value"===l&&a.dataFilter&&e.data&&e.data.filters.indexOf(t)<0&&e.data.filters.push(t),"value"===l&&a.reset){var w="string"==typeof a.reset?[a.reset]:a.reset;w.forEach(function(e){a[e]=!1})}if((e.dev.value||"dev"===l)&&a.changed&&void 0!==a[l]){var _=a[l]instanceof Array&&a[l].length>10,z=i.util.d3selection(a[l]),k="function"==typeof a[l],A=_||z||k?null:"string"==typeof a[l]?a[l]:JSON.stringify(a[l]);if((e.dev.value||"dev"===l&&user)&&!e.methodGroup&&"wait"!==e.methodGroup&&(e.methodGroup=!0,i.console.groupCollapsed("method behavior")),null!==A&&A.length<260){var c=e.format.locale.value.dev.setLong;i.console.log(i.string.format(c,o,'"'+A+'"'))}else{var c=e.format.locale.value.dev.set;i.console.log(i.string.format(c,o))}}}"value"===l&&a.callback&&!a.url&&a.callback(n)}},i.method.active={accepted:[!1,Array,Function,Number,Object,String],deprecates:"active_var",mute:i.method.filter(!0),solo:i.method.filter(!0),spotlight:{accepted:[Boolean],deprecates:"spotlight",value:!1},value:!1},i.method.aggs={accepted:[Object],deprecated:"nesting_aggs",value:{}},i.method.alt={accepted:[!1,Array,Function,Object,String],mute:i.method.filter(!0),solo:i.method.filter(!0),value:"alt"},i.method.attrs={accepted:[!1,Array,Object,String],delimiter:{accepted:[String],value:"|"},process:i.method.processData,type:{accepted:[!1,"json","xml","html","csv","dsv","tsv","txt"],value:!1},value:!1},i.method.axes={mirror:{accepted:[Boolean],deprecates:["mirror_axis","mirror_axes"],value:!1},values:["x","y"]},i.method.color={accepted:[!1,Array,Function,Object,String],deprecates:"color_var",init:function(e){return"form"===e.shell?"color":!1},mute:i.method.filter(!0),solo:i.method.filter(!0)},i.method.container={accepted:[Array,Object,String],element:!1,id:"default",process:function(e){if(e===!1){var t=this.getVars().shell;return"form"===t?d3.select("body"):e}return i.util.d3selection(e)?e:d3.select(e instanceof Array?e[0][0]:e)},value:!1},i.method.coords={accepted:[!1,Array,Function,Object,String],mute:i.method.filter(!1),process:i.method.processData,solo:i.method.filter(!1),type:{accepted:["json"],value:"json"},value:!1},i.method.csv={accepted:[void 0,Array,String],chainable:!1,data:[],process:function(e){var t=this.getVars();if(void 0===t.returned)return[];if(e instanceof Array)var a=e;else if("string"==typeof e)var a=[e];var l=[],n=[],r=t.title.value||"My D3plus App Data";if(r=i.string.strip(r),!a){var a=[t.id.value];t.time.value&&a.push(t.time.value),t.size.value&&a.push(t.size.value),t.text.value&&a.push(t.text.value)}a.forEach(function(e){n.push(t.format.value(e))}),l.push(n),t.returned.nodes.forEach(function(e){var n=[];a.forEach(function(a){n.push(i.variable.value(t,e,a))}),l.push(n)});var o="data:text/csv;charset=utf-8,";if(l.forEach(function(e,t){dataString=e.join(","),o+=t<l.length?dataString+"\n":dataString}),i.ie){var s=new Blob([o],{type:"text/csv;charset=utf-8;"});navigator.msSaveBlob(s,r+".csv")}else{var u=encodeURI(o),d=document.createElement("a");d.setAttribute("href",u),d.setAttribute("download",r+".csv"),d.click()}return this.data=l,a},value:void 0},i.method.data={accepted:[!1,Array,Function,String],cache:{},delimiter:{accepted:[String],value:"|"},filters:[],mute:[],process:function(e){var t=this.getVars();return"default"===t.container.id&&e.length&&t.self.container({id:"default"+e.length}),i.method.processData(e,this)},type:{accepted:[!1,"json","xml","html","csv","dsv","tsv","txt"],value:!1},solo:[],value:!1},i.method.depth={accepted:[Function,Number],value:0},i.method.descs={accepted:[!1,Function,Object],value:!1},i.method.dev={accepted:[Boolean],value:!1},i.method.draw={accepted:[void 0,Function],first:!0,frozen:!1,process:function(e){if(this.initialized===!1)return this.initialized=!0,e;var t=this.getVars(),a="history"in t?t.history.chain:[];if("data"in t&&t.data.value&&i.util.d3selection(t.data.value)&&(t.data.value=i.data.element(t)),void 0===e&&"function"==typeof this.value&&(e=this.value),t.container.value===!1){var l=t.format.locale.value.dev.setContainer;i.console.warning(l,"container")}else if(t.container.value.empty()){var l=t.format.locale.value.dev.noContainer;i.console.warning(i.string.format(l,'"'+t.container.value+'"'),"container")}else t.dev.value&&(t.methodGroup&&(t.methodGroup="wait",i.console.groupEnd()),i.console.time("total draw time")),t.container.value.call(t.self);if("function"==typeof e&&a.length){var n={};a.forEach(function(e){var t=e.method;delete e.method,n[t]=e}),e(n),t.history.chain=[]}return e},update:!0,value:void 0},i.method.edges={accepted:[!1,Array,Function,String],connections:function(e,t,a){var i=this;if(!i.value)return[];if(!t)var t="id";var l=i.restricted||i.value,n=[];if(!e)return l;var r=l.filter(function(l){var r=!1;return l[i.source][t]==e?(r=!0,a&&n.push(l[i.target])):l[i.target][t]==e&&(r=!0,a&&n.push(l[i.source])),r});return a?n:r},delimiter:{accepted:[String],value:"|"},label:!1,process:i.method.processData,size:!1,source:"source",target:"target",type:{accepted:[!1,"json","xml","html","csv","dsv","tsv","txt"],value:!1},value:!1},i.method.error={accepted:[Boolean,String],value:!1},i.method.focus={accepted:[!1,Function,Number,String],deprecates:"highlight",process:function(e){var t=this.getVars();if(t.data.element){var a=t.data.element.node().tagName.toLowerCase(),i=t.data.element.attr("type");"select"===a?t.data.element.selectAll("option").each(function(a,i){a&&a[t.id.value]===e&&(t.data.element.node().selectedIndex=i)}):"input"===a&&"radio"===i&&t.data.element.each(function(a){this.checked=a&&a[t.id.value]===e?!0:!1})}return e},tooltip:{accepted:[Boolean],value:!0},value:!1},i.method.footer={accepted:[!1,Number,String],link:!1,value:!1},i.method.format={accepted:[Function,String],deprecates:["number_format","text_format"],locale:{accepted:function(){return d3.keys(i.locale)},process:function(e){var t="en",a=i.locale[t];return e!==t&&(a=i.object.merge(a,i.locale[e])),this.language=e,a},value:"en"},number:i.number.format,process:function(e){if("string"==typeof e){var t=this.getVars();t.self.format({locale:e})}else if("function"==typeof e)return e;return this.value},text:i.string.title,value:function(e,t){return"number"==typeof e?this.number(e,t):"string"==typeof e?this.text(e,t):JSON.stringify(e)}},i.method.height={accepted:[!1,Number],secondary:!1,value:!1},i.method.history={accepted:[Boolean],back:function(){if(this.states.length>0){var e=this.states.pop();e()}},chain:[],states:[],value:!0},i.method.hover={accepted:[!1,Number,String],value:!1},i.method.icon={accepted:[!1,Array,Function,Object,String],deprecates:"icon_var",style:{accepted:[Object,String],deprecates:"icon_style",value:"default"},value:"icon"},i.method.id={accepted:[Array,String],dataFilter:!0,deprecates:["id_var","nesting"],init:function(e){return"form"===e.shell?(this.nesting=["value"],"value"):(this.nesting=["id"],"id")},mute:i.method.filter(!0),solo:i.method.filter(!0)},i.method.keywords={accepted:[!1,Array,Function,Object,String],mute:i.method.filter(!0),solo:i.method.filter(!0),value:"keywords"},i.method.labels={accepted:[Boolean],resize:{accepted:[Boolean],value:!0},value:!0},i.method.legend={accepted:[Boolean],value:!0},i.method.margin={accepted:[Number,Object,String],process:function(e){var t=this,a=["top","right","bottom","left"];if(void 0===e)var e=t.value;var i=e;if("string"==typeof e&&(e=e.split(" "),e.forEach(function(t,a){e[a]=parseFloat(t,10)}),e=1===e.length?e[0]:2===e.length?{top:e[0],right:e[1],bottom:e[0],left:e[1]}:3===e.length?{top:e[0],right:e[1],bottom:e[2],left:e[1]}:4===e.length?{top:e[0],right:e[1],bottom:e[2],left:e[3]}:0),"number"==typeof e)a.forEach(function(a){t[a]=e});else{for(var l in e){var n=a.indexOf(l);n>=0&&(a.splice(n,1),t[l]=e[l])}a.forEach(function(e){t[e]=0})}return i},value:0},i.method.messages={accepted:[Boolean,String],value:!0},i.method.nodes={accepted:[!1,Array,Function,String],delimiter:{accepted:[String],value:"|"},process:i.method.processData,type:{accepted:[!1,"json","xml","html","csv","dsv","tsv","txt"],value:!1},value:!1},i.method.open={accepted:[Boolean],flipped:{accepted:[Boolean],value:!1},value:!1},i.method.order={accepted:[!1,Function,String],sort:{accepted:["asc","desc"],value:"asc",deprecates:["sort"]},value:!1},i.method.remove={accepted:void 0,process:function(e){if(!this.initialized)return e;var t=this.getVars();t.container.value.remove()},value:void 0},i.method.resize={accepted:[Boolean],value:!1},i.method.search={accepted:["auto",Boolean],process:function(e){return"Boolean"==typeof e&&(this.enabled=e),e},value:"auto"},i.method.select={accepted:[String],chainable:!1,process:function(e){var t=this.getVars();return t.container.value&&e?t.container.value.select(e):e},value:void 0},i.method.selectAll={accepted:[String],chainable:!1,process:function(e){var t=this.getVars();return t.container.value&&e?t.container.value.selectAll(e):e},value:void 0},i.method.shape={accepted:function(e){return"textwrap"===e.shell?["circle","square"]:["circle","donut","line","square","area","coordinates"]},value:!1},i.method.size={accepted:function(e){return"textwrap"===e.shell?[Array]:[Array,Boolean,Function,Object,String]},dataFilter:!0,deprecates:["value","value_var"],init:function(e){return"textwrap"===e.shell?[9,40]:!1},mute:i.method.filter(!0),scale:{accepted:[Function],deprecates:"size_scale",value:d3.scale.sqrt()},solo:i.method.filter(!0),threshold:!0},i.method.style={accepted:function(){return d3.keys(i.style).filter(function(e){return"object"==typeof i.style[e]})},value:"default"},i.method.temp={accepted:[!1,Array,Function,Object,String],deprecates:["else_var","else"],mute:i.method.filter(!0),solo:i.method.filter(!0),value:!1},i.method.text={accepted:[Array,Boolean,Function,Object,String],deprecates:["name_array","text_var"],html:{accepted:[Boolean],value:!1},init:function(e){if("textwrap"===e.shell){var t=this.split;this.break=new RegExp("[^\\s\\"+t.join("\\")+"]+\\"+t.join("?\\")+"?","g")}return!1},nesting:!0,mute:i.method.filter(!0),solo:i.method.filter(!0),secondary:{accepted:[Array,Boolean,Function,Object,String],nesting:!0,value:!1},split:["-","/",";",":","&"]},i.method.time={accepted:[Array,Boolean,Function,Object,String],dataFilter:!0,deprecates:["year","year_var"],fixed:{accepted:[Boolean],deprecates:["static_axis","static_axes"],value:!0},mute:i.method.filter(!1),solo:i.method.filter(!1),value:!1},i.method.timeline={accepted:[Boolean],value:!0},i.method.title={accepted:[!1,Function,String],link:!1,sub:{accepted:[!1,String],deprecates:"sub_title",link:!1,value:!1},total:{accepted:[Boolean,Object],deprecates:"total_bar",link:!1,value:!1},process:function(e){var t=this.getVars();if(0===t.container.id.indexOf("default")&&e){var a=i.string.strip(e).toLowerCase();t.self.container({id:a})}return e},value:!1},i.method.tooltip={accepted:[!1,Array,Function,Object,String],deprecates:"tooltip_info",html:{accepted:[!1,Function,String],deprecates:"click_function",value:!1},value:!1},i.method.total={accepted:[!1,Array,Function,Object,String],deprecates:["total_var"],mute:i.method.filter(!0),solo:i.method.filter(!0),value:!1},i.method.type={accepted:function(e){var t=e.shell;return"viz"===t?d3.keys(i.visualization):"form"===t?d3.keys(i.input):null},init:function(e){var t=e.shell;return"viz"===t?"tree_map":"form"===t?"auto":void 0},mode:{accepted:["squarify","slice","dice","slice-dice"],value:"squarify"}},i.method.ui={accepted:[Array,Boolean],value:!1},i.method.width={accepted:[!1,Number],secondary:!1,value:!1},i.method.x=i.method.axis("x"),i.method.y=i.method.axis("y"),i.method.zoom={accepted:[Boolean],behavior:d3.behavior.zoom().scaleExtent([1,1]),click:{accepted:[Boolean],value:!0},direction:function(e){var t=this.getVars(),a=t.id.nesting.length-1,l=t.depth.value,n=i.visualization[t.type.value].nesting===!1;return n?0:e.d3plus.merged||a>l&&(!e||t.id.nesting[t.depth.value+1]in e)?1:l!==a&&(!e||t.id.nesting[t.depth.value+1]in e)||!t.small&&t.tooltip.html.value?0:-1},pan:{accepted:[Boolean],value:!0},scroll:{accepted:[Boolean],deprecates:"scroll_zoom",value:!0},touchEvent:function(){var e=this.getVars(),t=e.zoom.scale>e.zoom.behavior.scaleExtent()[0],a=i.visualization[e.type.value].zoom&&e.zoom.value&&e.zoom.scroll.value,l=d3.event.touches.length>1&&a;l||t||d3.event.stopPropagation()},value:!0},i.style.default={},i.style.default.fontFamily=["Helvetica Neue","HelveticaNeue","Helvetica","Arial","sans-serif"],i.style.fontFamily=function(e){return{process:i.font.validate,value:e}},i.textwrap.flow=function(e){e.text.html.value?this.foreign(e):this.tspan(e)},i.textwrap.foreign=function(e){var t=e.container.value,a=t.attr("font-family")||t.style("font-family"),i=t.attr("text-anchor")||t.style("text-anchor"),l=t.attr("fill")||t.style("fill"),n=t.attr("opacity")||t.style("opacity");i="end"===i?"right":"middle"===i?"center":"left",d3.select(t.node().parentNode).append("foreignObject").attr("width",e.width.value+"px").attr("height",e.height.value+"px").attr("x","0px").attr("y","0px").append("xhtml:div").style("font-family",a).style("font-size",e.size.value[1]).style("color",l).style("text-align",i).style("opacity",n).text(e.text.current)},i.textwrap.getDimensions=function(e){if(!e.width.value||!e.height.value){var t=d3.select(e.container.value.node().parentNode),a=t.select("rect"),i=t.select("circle");if(a.empty())if(i.empty())e.width.value||e.self.width(500),e.height.value||e.self.height(500);else{var l=i.attr("r");e.width.value||e.self.width(parseFloat(2*l,10)),e.height.value||e.self.height(parseFloat(2*l,10))}else{if(!e.width.value){var n=a.attr("width")||a.style("width");e.self.width(parseFloat(n,10))}if(!e.height.value){var r=a.attr("height")||a.style("height");e.self.height(parseFloat(r,10))}}}},i.textwrap.getSize=function(e){var t=e.container.value.attr("font-size")||e.container.value.style("font-size");e.self.size(e.resize.value?[parseFloat(t,10),e.size.value[1]]:[e.size.value[0],parseFloat(t,10)])},i.textwrap.getText=function(e){if(!e.text.value){var t=e.container.value.html();t.indexOf("tspan")>=0&&(t.replace(/\<\/tspan\>\<tspan\>/g," "),t.replace(/\<\/tspan\>/g,""),t.replace(/\<tspan\>/g,"")),e.self.text(t)}e.text.phrases=e.text.value instanceof Array?e.text.value.filter(function(e){return["string","number"].indexOf(typeof e)>=0}):[e.text.value+""],e.container.value.html("")},i.textwrap.resize=function(e){if(e.resize.value){for(var t=[],a=0;a<e.text.words.length;a++){var l=a===e.text.words.length-1?"":" ";t.push(e.text.words[a]+l)}var n=Math.floor(e.size.value[1]),r="circle"===e.shape.value?.785*e.width.value:e.width.value,o=i.font.sizes(t,{"font-size":n+"px"},e.container.value),s=d3.max(o,function(e){return e.width}),u=1.2*d3.sum(o,function(e){return e.width*e.height}),d="circle"===e.shape.value?Math.PI*Math.pow(e.width.value/2,2):r*e.height.value;if(s>r||u>d){var c=Math.sqrt(d/u),v=r/s,p=d3.min([c,v]);n=d3.max([e.size.value[0],Math.floor(n*p)])}s*(n/e.size.value[1])<=r?(n!==e.size.value[1]&&e.self.size([e.size.value[0],n]),e.container.value.attr("font-size",e.size.value[1]+"px"),this.flow(e)):this.wrap(e)}},i.textwrap.tspan=function(e){var t=e.container.value.attr("x")||"0px",a=e.text.words.slice(0),i=!1,l=e.container.value.append("tspan").text(a[0]).attr("dy",e.size.value[1]+"px"),n=l.node().offsetHeight,r=1,o=function(){return e.container.value.append("tspan").attr("x",t).attr("dy",e.size.value[1]+"px")},s=function(){l.empty()||(a=l.text().match(/[^\s-]+-?/g),u())},u=function(){if(a&&a.length){var t=a.pop(),i=t.charAt(t.length-1);if(1===t.length&&e.text.split.indexOf(t)>=0)u();else{e.text.split.indexOf(i)>=0&&(t=t.substr(0,t.length-1)),l.text(a.join(" ")+" "+t+" ...");var o=(r-1)*n,d="circle"===e.shape.value?2*Math.sqrt(o*(2*(e.width.value/2)-o)):e.width.value;l.node().getComputedTextLength()>d&&u()}}else l.remove(),l=d3.select(e.container.value.node().lastChild),l.empty()||(r--,s())};"circle"===e.shape.value&&e.container.value.attr("text-anchor","middle");for(var d=1;d<a.length;d++){if(r*n>e.height.value){l.remove(),1!==d&&(l=d3.select(e.container.value.node().lastChild),l.empty()||s());break}var c=l.text(),v=(c.slice(-1),e.text.current.charAt(e.text.current.indexOf(c)+c.length)),p=" "==v?" ":"";l.text(c+p+a[d]);var f=(r-1)*n,h="circle"===e.shape.value?2*Math.sqrt(f*(2*(e.width.value/2)-f)):e.width.value;l.node().getComputedTextLength()>h&&(i||(l.text(""),l=o()),l.text(c),l=o(),l.text(a[d]),r++)}},i.textwrap.wrap=function(e){e.text.phrases.length&&(e.text.current=e.text.phrases.shift()+"",e.text.words=e.text.current.match(e.text.break),e.resize.value?this.resize(e):this.flow(e))},i.shape.area=function(e,t,a){var l=d3.svg.area().x(function(e){return e.d3plus.x}).y0(function(e){return e.d3plus.y0}).y1(function(e){return e.d3plus.y}).interpolate(e.shape.interpolate.value);a.append("path").attr("class","d3plus_data").attr("d",function(e){return l(e.values)}).call(i.shape.style,e),t.selectAll("path.d3plus_data").data(function(t){function a(t){l.y=d3.max([l.y,t.y]),l.y0=d3.min([l.y0,t.y0]),l.x0=t.x,l.h=l.y0-l.y,l.w=l.x0-l.x;var a=l.h-2*e.labels.padding<10||l.w-2*e.labels.padding<20,r=(n.w/n.h,n.w*n.h),o=(l.w/l.h,l.w*l.h);(!a&&o>r||!n.w)&&(n={w:l.w,h:l.h,x:l.x+l.w/2,y:l.y+l.h/2}),a&&(l=i.util.copy(t))}if(e.labels.value){var l=null,n={w:0,h:0,x:0,y:0};t.values.forEach(function(n,r){if(l){var o=i.util.buckets([0,1],e.labels.segments+1);o.shift(),o.pop(),o.forEach(function(e){var l=i.util.copy(n.d3plus),o=t.values[r-1].d3plus;l.x=o.x+(l.x-o.x)*e,l.y=o.y+(l.y-o.y)*e,l.y0=o.y0+(l.y0-o.y0)*e,a(l)}),a(i.util.copy(n.d3plus))}else l=i.util.copy(n.d3plus)}),n.w>=10&&n.h>=10&&(t.d3plus_label=n)}return[t]}),e.draw.timing?t.selectAll("path.d3plus_data").transition().duration(e.draw.timing).attr("d",function(e){return l(e.values)}).call(i.shape.style,e):t.selectAll("path.d3plus_data").attr("d",function(e){return l(e.values)}).call(i.shape.style,e)},i.shape.color=function(e,t){var a=e.d3plus?e.d3plus.shapeType:t.shape.value;if("line"==t.shape.value)return"circle"==a?i.variable.color(t,e):"none";if("area"==t.shape.value||"active"==a)return i.variable.color(t,e);if("temp"==a)return"url(#d3plus_hatch_"+e.d3plus.id+")";if("active"==a)return i.variable.color(t,e);if(e.d3plus.static)return i.color.lighter(i.variable.color(t,e),.75);var l=t.active.value?i.variable.value(t,e,t.active.value):e.d3plus.active,n=t.temp.value?i.variable.value(t,e,t.temp.value):e.d3plus.temp,r=t.total.value?i.variable.value(t,e,t.total.value):e.d3plus.total;return!t.active.value&&!t.temp.value||l===!0||l&&r&&l==r&&!n||l&&!r?i.variable.color(t,e):t.active.spotlight.value?"#eee":i.color.lighter(i.variable.color(t,e),.75)},i.shape.coordinates=function(e,t,a){var l=d3.geo[e.coords.projection.value]().center(e.coords.center);e.zoom.scale||(e.zoom.scale=1),e.zoom.area=1/e.zoom.scale/e.zoom.scale,e.path=d3.geo.path().projection(l),a.append("path").attr("id",function(e){return e.id}).attr("class","d3plus_data").attr("d",e.path).call(i.shape.style,e),e.draw.timing?t.selectAll("path.d3plus_data").transition().duration(e.draw.timing).call(i.shape.style,e):t.selectAll("path.d3plus_data").call(i.shape.style,e);var n=e.old_height!=e.height.viz||e.height.changed||e.old_width!=e.width.viz||e.width.changed;e.old_height=e.height.viz,e.old_width=e.width.viz,e.coords.changed||n||e.coords.mute.changed||e.coords.solo.changed?(e.zoom.bounds=null,e.zoom.coords={},e.zoom.labels={},t.each(function(t){var a=e.path.bounds(t),l=[];t.geometry.coordinates=t.geometry.coordinates.filter(function(a,n){var r=i.util.copy(t);r.geometry.coordinates=[r.geometry.coordinates[n]];var o=e.path.area(r);return o>=e.coords.threshold?(l.push(o),!0):!1}),l.sort(function(e,t){return e-t});var n=i.util.copy(t),r=i.util.copy(t);n.geometry.coordinates=n.geometry.coordinates.filter(function(a,n){var o=i.util.copy(t);o.geometry.coordinates=[o.geometry.coordinates[n]];var s=e.path.area(o);return s==l[l.length-1]&&(r.geometry.coordinates=o.geometry.coordinates),s>=d3.quantile(l,.9)}),e.zoom.coords[t.d3plus.id]=n;var o=e.path.centroid(r),s=e.path.bounds(r);e.zoom.labels[t.d3plus.id]={anchor:"middle",group:e.g.labels,h:.35*(s[1][1]-s[0][1]),w:.35*(s[1][0]-s[0][0]),valign:"center",x:o[0],y:o[1]},e.zoom.bounds?(e.zoom.bounds[0][0]>a[0][0]&&(e.zoom.bounds[0][0]=a[0][0]),e.zoom.bounds[0][1]>a[0][1]&&(e.zoom.bounds[0][1]=a[0][1]),e.zoom.bounds[1][0]<a[1][0]&&(e.zoom.bounds[1][0]=a[1][0]),e.zoom.bounds[1][1]<a[1][1]&&(e.zoom.bounds[1][1]=a[1][1])):e.zoom.bounds=a})):e.focus.value||(e.zoom.viewport=!1)},i.shape.donut=function(e,t,a,l){function n(t,a,i,l){if(!a)var a=0;if("number"!=typeof i)var i=void 0;if("number"!=typeof l)var l=void 0;t.attrTween("d",function(t){if(void 0==i)var n=t.d3plus.r?t.d3plus.r:d3.max([t.d3plus.width,t.d3plus.height]);else var n=i;if(void 0==l)var o=t.d3plus.a[t.d3plus.shapeType];else var o=l;e.arcs[t.d3plus.shapeType][t.d3plus.id]||(e.arcs[t.d3plus.shapeType][t.d3plus.id]={r:0},e.arcs[t.d3plus.shapeType][t.d3plus.id].a="donut"==t.d3plus.shapeType?2*Math.PI:0);var s=d3.interpolate(e.arcs[t.d3plus.shapeType][t.d3plus.id].r,n+a),u=d3.interpolate(e.arcs[t.d3plus.shapeType][t.d3plus.id].a,o);return function(a){return e.arcs[t.d3plus.shapeType][t.d3plus.id].r=s(a),e.arcs[t.d3plus.shapeType][t.d3plus.id].a=u(a),r(t)}})}e.arcs||(e.arcs={donut:{},active:{},temp:{}});var r=d3.svg.arc().startAngle(0).endAngle(function(t){var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].a;return a>2*Math.PI?2*Math.PI:a}).innerRadius(function(t){if("donut"!=shape||t.d3plus.static)return 0;var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].r;return a*e.data.donut.size}).outerRadius(function(t){var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].r;return"donut"!=t.d3plus.shapeType?2*a:a});l.selectAll("path.d3plus_data").transition().duration(e.draw.timing).call(n,0,0).each("end",function(t){delete e.arcs[t.d3plus.shapeType][t.d3plus.id]}),t.selectAll("path.d3plus_data").data(function(e){return[e]}).transition().duration(e.draw.timing).call(n).call(i.shape.style,e),a.append("path").attr("class","d3plus_data").transition().duration(0).call(n,0,0).call(i.shape.style,e)},i.shape.draw=function(e){function t(t){var a=t.d3plus.depth?t.d3plus.depth:e.depth.value;return t.d3plus.id=i.variable.value(e,t,e.id.nesting[a]),t.d3plus.id+="_"+a+"_"+u,e.axes.values.forEach(function(a){"continuous"==e[a].scale.value&&(t.d3plus.id+="_"+i.variable.value(e,t,e[a].value))}),t.d3plus.id=i.string.strip(t.d3plus.id),t}function a(t,a){var l=i.visualization[e.type.value].scale;if(a&&l&&l[e.shape.value])var n=l[e.shape.value];else if(a&&l&&"number"==typeof l)var n=l;else var n=1;t.attr("transform",function(e){return["line","area","coordinates"].indexOf(u)<0?"translate("+e.d3plus.x+","+e.d3plus.y+")scale("+n+")":"scale("+n+")"})}function l(t){if(t&&e.g.edges.selectAll("g").size()>0){e.g.edges.selectAll("g").each(function(a){var i=t[e.id.value],l=a[e.edges.source][e.id.value],n=a[e.edges.target][e.id.value];if(l==i||n==i){var r=e.g.edge_hover.node().appendChild(this.cloneNode(!0));d3.select(r).datum(a).attr("opacity",1).selectAll("line, path").datum(a)}});var a=e.edges.arrows.value;e.g.edge_hover.attr("opacity",0).selectAll("line, path").style("stroke",e.color.primary).style("stroke-width",function(){return e.edges.size?d3.select(this).style("stroke-width"):2*e.data.stroke.width}).attr("marker-start",function(t){var i=e.edges.arrows.direction.value;if("bucket"in t.d3plus)var l="_"+t.d3plus.bucket;else var l="";return"source"==i&&a?"url(#d3plus_edge_marker_highlight"+l+")":"none"}).attr("marker-end",function(t){var i=e.edges.arrows.direction.value;if("bucket"in t.d3plus)var l="_"+t.d3plus.bucket;else var l="";return"target"==i&&a?"url(#d3plus_edge_marker_highlight"+l+")":"none"}),e.g.edge_hover.selectAll("text").style("fill",e.color.primary),e.draw.timing?(e.g.edge_hover.transition().duration(e.timing.mouseevents).attr("opacity",1),e.g.edges.transition().duration(e.timing.mouseevents).attr("opacity",.5)):e.g.edge_hover.attr("opacity",1)}else e.draw.timing?(e.g.edge_hover.transition().duration(e.timing.mouseevents).attr("opacity",0).transition().selectAll("*").remove(),e.g.edges.transition().duration(e.timing.mouseevents).attr("opacity",1)):e.g.edge_hover.selectAll("*").remove()}var n=e.returned.nodes||[],r=e.returned.edges||[];e.draw.timing=n.length<e.data.large&&r.length<e.edges.large?e.timing.transitions:0;var o={area:"area",circle:"rect",donut:"donut",line:"line",square:"rect",coordinates:"coordinates"},s={};n.forEach(function(t){if(t.d3plus)if(t.d3plus.shape){var a=t.d3plus.shape;t.d3plus.shapeType=a}else{var a=o[e.shape.value];t.d3plus.shapeType=a}else var a=o[e.shape.value];s[a]||(s[a]=[]),s[a].push(t)});for(u in o)o[u]in s&&0!==d3.keys(s).length||(e.draw.timing?e.g.data.selectAll("g.d3plus_"+o[u]).transition().duration(e.draw.timing).attr("opacity",0).remove():e.g.data.selectAll("g.d3plus_"+o[u]).remove());for(var u in s){var d=e.g.data.selectAll("g.d3plus_"+u).data(s[u],function(a){if(a.d3plus||(a.d3plus={}),"coordinates"===u)return a.d3plus.id=a.id,a.id;if(!a.d3plus.id)if(a.values)a.values.forEach(function(e){e=t(e),e.d3plus.shapeType="circle"}),a.d3plus.id=a.key;else if(a=t(a),!a.d3plus.a){a.d3plus.a={donut:2*Math.PI};var i=e.active.value?a.d3plus[e.active.value]:a.d3plus.active,l=e.temp.value?a.d3plus[e.temp.value]:a.d3plus.temp,n=e.total.value?a.d3plus[e.total.value]:a.d3plus.total;n&&(a.d3plus.a.active=i?i/n*2*Math.PI:0,a.d3plus.a.temp=l?l/n*2*Math.PI+a.d3plus.a.active:0)}return a.d3plus?a.d3plus.id:!1});if(e.draw.timing)var c=d.exit().transition().duration(e.draw.timing).attr("opacity",0).remove();else var c=d.exit().remove();
e.draw.timing?d.transition().duration(e.draw.timing).call(a):d.call(a);var v=e.draw.timing?0:1,p=d.enter().append("g").attr("class","d3plus_"+u).attr("opacity",v).call(a);e.draw.timing&&p.transition().duration(e.draw.timing).attr("opacity",1),d.order(),e.dev.value&&i.console.time('drawing "'+u+'" shapes'),i.shape[u](e,d,p,c,a),e.dev.value&&i.console.timeEnd('drawing "'+u+'" shapes'),["rect","donut"].indexOf(u)>=0&&i.visualization[e.type.value].fill&&(e.dev.value&&i.console.time('filling "'+u+'" shapes'),i.shape.fill(e,d,p,c,a),e.dev.value&&i.console.timeEnd('filling "'+u+'" shapes'))}l(),i.touch?e.g.data.selectAll("g").on(i.evt.over,e.zoom.touchEvent).on(i.evt.move,e.zoom.touchEvent).on(i.evt.out,e.zoom.touchEvent):e.g.data.selectAll("g").on(i.evt.over,function(t){if(!(e.draw.frozen||t.d3plus&&t.d3plus.static)){if(d3.select(this).style("cursor","pointer").transition().duration(e.timing.mouseevents).call(a,!0),d3.select(this).selectAll(".d3plus_data").transition().duration(e.timing.mouseevents).attr("opacity",1),e.covered=!1,["area","line"].indexOf(e.shape.value)>=0||e.focus.value!=t[e.id.value]){if(e.continuous_axis){var n="x"===e.continuous_axis?0:1,r=d3.mouse(e.container.value.node())[n],o=i.util.uniques(t.values,function(t){return t.d3plus[e.continuous_axis]}),s=i.util.closest(o,r);t.d3plus_data=t.values[o.indexOf(s)],t.d3plus=t.values[o.indexOf(s)].d3plus}var u=t.d3plus_data?t.d3plus_data:t;i.tooltip.app({vars:e,data:u})}"function"==typeof e.mouse?e.mouse(t):e.mouse[i.evt.over]&&e.mouse[i.evt.over](t),l(t)}}).on(i.evt.move,function(t){if(!(e.draw.frozen||t.d3plus&&t.d3plus.static)){if(e.covered=!1,["area","line"].indexOf(e.shape.value)>=0||"follow"==i.visualization[e.type.value].tooltip&&e.focus.value!=t[e.id.value]){if(e.continuous_axis){var a="x"===e.continuous_axis?0:1,l=d3.mouse(e.container.value.node())[a],n=i.util.uniques(t.values,function(t){return t.d3plus[e.continuous_axis]}),r=i.util.closest(n,l);t.d3plus_data=t.values[n.indexOf(r)],t.d3plus=t.values[n.indexOf(r)].d3plus}var o=t.d3plus_data?t.d3plus_data:t;i.tooltip.app({vars:e,data:o})}"function"==typeof e.mouse?e.mouse(t):e.mouse[i.evt.move]&&e.mouse[i.evt.move](t)}}).on(i.evt.out,function(t){var n=i.util.child(this,d3.event.toElement);n||e.draw.frozen||t.d3plus&&t.d3plus.static||(d3.select(this).transition().duration(e.timing.mouseevents).call(a),d3.select(this).selectAll(".d3plus_data").transition().duration(e.timing.mouseevents).attr("opacity",e.data.opacity),e.covered||i.tooltip.remove(e.type.value),"function"==typeof e.mouse?e.mouse(t):e.mouse[i.evt.out]&&e.mouse[i.evt.out](t),l())}),e.g.data.selectAll("g").on(i.evt.click,function(t){if(!(e.draw.frozen||t.d3plus&&t.d3plus.static)){"function"==typeof e.mouse?e.mouse(t):e.mouse[i.evt.out]?e.mouse[i.evt.out](t):e.mouse[i.evt.click]&&e.mouse[i.evt.click](t);var n=e.zoom.direction(t.d3plus_data||t),r=e.id.solo.value,o=i.variable.text(e,t)[0],s=i.color.legible(i.variable.color(e,t)),u=e.title.sub.value||!1,d=e.title.sub.font.color,c=e.title.total.font.color;if(t.d3plus.threshold&&t.d3plus.merged&&e.zoom.value)e.history.states.push(function(){e.self.id({solo:r}).title({sub:{font:{color:d},value:u},total:{font:{color:c}}}).draw()}),e.self.id({solo:i.util.uniques(t.d3plus.merged,e.id.value)}).title({sub:{font:{color:s},value:o},total:{font:{color:s}}}).draw();else if(1===n&&e.zoom.value){var v=i.variable.value(e,t,e.id.value);e.history.states.push(function(){e.self.depth(e.depth.value-1).id({solo:r}).title({sub:{font:{color:d},value:u},total:{font:{color:c}}}).draw()}),e.self.depth(e.depth.value+1).id({solo:[v]}).title({sub:{font:{color:s},value:o},total:{font:{color:s}}}).draw()}else if(-1===n&&e.zoom.value)e.history.back();else if(i.visualization[e.type.value].zoom&&e.zoom.value)l(),d3.select(this).transition().duration(e.timing.mouseevents).call(a),d3.select(this).selectAll(".d3plus_data").transition().duration(e.timing.mouseevents).attr("opacity",e.data.opacity),i.tooltip.remove(e.type.value),e.draw.update=!1,t&&t[e.id.value]!=e.focus.value?e.self.focus(t[e.id.value]).draw():e.self.focus(!1).draw();else if(t[e.id.value]!=e.focus.value){l();var p=t.d3plus_data?t.d3plus_data:t;i.tooltip.app({vars:e,data:p})}}})},i.shape.edges=function(e){function t(t){var a=1==e.edges.opacity?e.edges.opacity:0;t.attr("opacity",a).style("stroke-width",0).style("stroke",e.background.value).style("fill","none")}function a(t){var a=e.edges.arrows.value;t.style("stroke-width",function(t){return e.edges.scale(t[e.edges.size])}).style("stroke",e.edges.color).attr("opacity",e.edges.opacity).attr("marker-start",function(t){var i=e.edges.arrows.direction.value;if("bucket"in t.d3plus)var l="_"+t.d3plus.bucket;else var l="";return"source"==i&&a?"url(#d3plus_edge_marker_default"+l+")":"none"}).attr("marker-end",function(t){var i=e.edges.arrows.direction.value;if("bucket"in t.d3plus)var l="_"+t.d3plus.bucket;else var l="";return"target"==i&&a?"url(#d3plus_edge_marker_default"+l+")":"none"}).attr("vector-effect","non-scaling-stroke").attr("pointer-events","none")}function l(t){t.attr("x1",function(t){return t[e.edges.source].d3plus.dx}).attr("y1",function(t){return t[e.edges.source].d3plus.dy}).attr("x2",function(t){return t[e.edges.target].d3plus.dx}).attr("y2",function(t){return t[e.edges.target].d3plus.dy})}function n(t){t.attr("d",function(t){if(t[e.edges.source].d3plus.dr){var a=t[e.edges.source].d3plus.a,i=t[e.edges.source].d3plus.dr,l=t[e.edges.target].d3plus.a,n=t[e.edges.target].d3plus.dr,r={};return r[e.edges.source]={x:a,y:i},r[e.edges.target]={x:l,y:n},p(r)}var a=t[e.edges.source].d3plus.dx,i=t[e.edges.source].d3plus.dy,l=t[e.edges.target].d3plus.dx,n=t[e.edges.target].d3plus.dy,r={};return r[e.edges.source]={x:a,y:i},r[e.edges.target]={x:l,y:n},v(r)}).attr("transform",function(e){if(e.d3plus&&e.d3plus.translate){var t=e.d3plus.translate.x||0,a=e.d3plus.translate.y||0;return"translate("+t+","+a+")"}})}function r(t){if(delete t.d3plus_label,e.g.edges.selectAll("line, path").size()<e.edges.large&&e.edges.label&&t[e.edges.label]){if("spline"in t.d3plus)var a=this.getTotalLength(),i=this.getPointAtLength(a/2),l=this.getPointAtLength(a/2-.1*a),n=this.getPointAtLength(a/2+.1*a),r=Math.atan2(n.y-l.y,n.x-l.x),o=r*(180/Math.PI),s=(this.parentNode.getBBox(),.8*a),u=t.d3plus.translate.x+i.x,d=t.d3plus.translate.y+i.y,c={x:t.d3plus.translate.x+i.x,y:t.d3plus.translate.y+i.y};else{{this.getBBox()}start={x:t[e.edges.source].d3plus.dx,y:t[e.edges.source].d3plus.dy},end={x:t[e.edges.target].d3plus.dx,y:t[e.edges.target].d3plus.dy},xdiff=end.x-start.x,ydiff=end.y-start.y,i={x:end.x-xdiff/2,y:end.y-ydiff/2},r=Math.atan2(ydiff,xdiff),o=r*(180/Math.PI),a=Math.sqrt(xdiff*xdiff+ydiff*ydiff),s=a,u=i.x,d=i.y,c={x:i.x,y:i.y}}s+=2*e.labels.padding;var v=0;e.edges.arrows.value&&(v="number"==typeof e.edges.arrows.value?e.edges.arrows.value:8,v/=e.zoom.behavior.scaleExtent()[1],s-=2*v),(-90>o||o>90)&&(o-=180),s*e.zoom.behavior.scaleExtent()[0]>20&&(t.d3plus_label={x:u,y:d,translate:c,w:s,h:15+2*e.labels.padding,angle:o,anchor:"middle",valign:"center",color:e.edges.color,resize:!1,names:[e.format.value(t[e.edges.label])],background:1})}}var o=e.returned.edges||[],s=e.zoom.behavior.scaleExtent()[0];if("string"==typeof e.edges.size){var u=d3.extent(o,function(t){return t[e.edges.size]}),d=.6*d3.min(e.returned.nodes||[],function(e){return e.d3plus.r});e.edges.scale=d3.scale.sqrt().domain(u).range([e.edges.width,d*s])}else{var c="number"==typeof e.edges.size?e.edges.size:e.edges.width;e.edges.scale=function(){return c}}var v=d3.svg.diagonal(),p=d3.svg.diagonal().projection(function(e){var t=e.y,a=e.x;return[t*Math.cos(a),t*Math.sin(a)]}),f=e.edges.arrows.value?"string"==typeof e.edges.size?["default_0","default_1","default_2","highlight_0","highlight_1","highlight_2","focus_0","focus_1","focus_2"]:["default","highlight","focus"]:[];if("string"==typeof e.edges.size)for(var h=i.util.buckets(e.edges.scale.range(),4),g=[],m=0;3>m;m++)g.push(h[m+1]+(h[1]-h[0])*(m+2));else var y="number"==typeof e.edges.arrows.value?e.edges.arrows.value:8,g="number"==typeof e.edges.size?e.edges.size/y:y;var x=e.defs.selectAll(".d3plus_edge_marker").data(f,String),b=function(t){t.attr("d",function(t){var a=t.split("_");if(2==a.length&&e.edges.scale){a=parseInt(a[1]);var i=g[a]}else var i=g;return"target"==e.edges.arrows.direction.value?"M 0,-"+i/2+" L "+.85*i+",0 L 0,"+i/2+" L 0,-"+i/2:"M 0,-"+i/2+" L -"+.85*i+",0 L 0,"+i/2+" L 0,-"+i/2}).attr("fill",function(t){var a=t.split("_")[0];return"default"==a?e.edges.color:"focus"==a?e.color.focus:e.color.primary}).attr("transform","scale("+1/s+")")};e.draw.timing?(x.exit().transition().duration(e.draw.timing).attr("opacity",0).remove(),x.select("path").transition().duration(e.draw.timing).attr("opacity",1).call(b)):(x.exit().remove(),x.select("path").attr("opacity",1).call(b));var w=e.draw.timing?0:1,_=x.enter().append("marker").attr("id",function(e){return"d3plus_edge_marker_"+e}).attr("class","d3plus_edge_marker").attr("orient","auto").attr("markerUnits","userSpaceOnUse").style("overflow","visible").append("path").attr("opacity",w).attr("vector-effect","non-scaling-stroke").call(b);e.draw.timing&&_.transition().duration(e.draw.timing).attr("opacity",1);var z="string"==typeof e.edges.size?i.util.buckets(e.edges.scale.domain(),4):null,k=e.edges.arrows.direction.value,A=o.filter(function(t){if(!t.d3plus||t.d3plus&&t.d3plus.spline!==!0){if(t.d3plus||(t.d3plus={}),z){var a=t[e.edges.size];t.d3plus.bucket=a<z[1]?0:a<z[2]?1:2;var l=.85*g[t.d3plus.bucket]/s}else{delete t.d3plus.bucket;var l=.85*g/s}var n=t[e.edges.source],r=t[e.edges.target],o=Math.atan2(n.d3plus.y-r.d3plus.y,n.d3plus.x-r.d3plus.x),u="source"==k&&e.edges.arrows.value?n.d3plus.r+l:n.d3plus.r,d="target"==k&&e.edges.arrows.value?r.d3plus.r+l:r.d3plus.r,c=i.util.offset(o,u,e.shape.value),v=i.util.offset(o,d,e.shape.value);return n.d3plus.dx=n.d3plus.x-c.x,n.d3plus.dy=n.d3plus.y-c.y,r.d3plus.dx=r.d3plus.x+v.x,r.d3plus.dy=r.d3plus.y+v.y,!0}return!1}),E=e.g.edges.selectAll("g.d3plus_edge_line").data(A,function(t){return t.d3plus||(t.d3plus={}),t.d3plus.id=t[e.edges.source][e.id.value]+"_"+t[e.edges.target][e.id.value],t.d3plus.id}),O=o.filter(function(t){if(t.d3plus&&t.d3plus.spline){if(z){var a=t[e.edges.size];t.d3plus.bucket=a<z[1]?0:a<z[2]?1:2;var i=.85*g[t.d3plus.bucket]/s}else{delete t.d3plus.bucket;var i=.85*g/s}var l=t[e.edges.source],n=t[e.edges.target],r=2==l.d3plus.depth?-i:i,o=2==n.d3plus.depth?-i:i,u="source"==k&&e.edges.arrows.value?l.d3plus.r+r:l.d3plus.r,d="target"==k&&e.edges.arrows.value?n.d3plus.r+o:n.d3plus.r;return l.d3plus.dr=u,n.d3plus.dr=d,!0}return!1}),j=e.g.edges.selectAll("g.d3plus_edge_path").data(O,function(t){return t.d3plus||(t.d3plus={}),t.d3plus.id=t[e.edges.source][e.id.value]+"_"+t[e.edges.target][e.id.value],t.d3plus.id});e.draw.timing?(E.exit().transition().duration(e.draw.timing).attr("opacity",0).remove(),j.exit().transition().duration(e.draw.timing).attr("opacity",0).remove(),E.selectAll("text.d3plus_label, rect.d3plus_label_bg").transition().duration(e.draw.timing/2).attr("opacity",0).remove(),j.selectAll("text.d3plus_label, rect.d3plus_label_bg").transition().duration(e.draw.timing/2).attr("opacity",0).remove(),E.selectAll("line").data(function(e){return[e]}).transition().duration(e.draw.timing).call(l).call(a).each("end",r),j.selectAll("path").data(function(e){return[e]}).transition().duration(e.draw.timing).call(n).call(a).each("end",r),E.enter().append("g").attr("class","d3plus_edge_line").append("line").call(l).call(t).transition().duration(e.draw.timing).call(a).each("end",r),j.enter().append("g").attr("class","d3plus_edge_path").append("path").call(n).call(t).transition().duration(e.draw.timing).call(a).each("end",r)):(E.exit().remove(),j.exit().remove(),E.selectAll("text.d3plus_label, rect.d3plus_label_bg").remove(),j.selectAll("text.d3plus_label, rect.d3plus_label_bg").remove(),E.selectAll("line").data(function(e){return[e]}).call(l).call(a).call(r),j.selectAll("path").data(function(e){return[e]}).call(n).call(a).call(r),E.enter().append("g").attr("class","d3plus_edge_line").append("line").call(l).call(t).call(a).call(r),j.enter().append("g").attr("class","d3plus_edge_path").append("path").call(n).call(t).call(a).call(r))},i.shape.fill=function(e,t){function a(e){e.attr("x",0).attr("y",0).attr("width",0).attr("height",0)}function l(t,a){if(!a)var a=0;t.attr("x",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return-t/2-a/2}).attr("y",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return-t/2-a/2}).attr("width",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return t+a}).attr("height",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return t+a}).attr("rx",function(t){var i=t.d3plus.r?2*t.d3plus.r:t.d3plus.width,l=["circle","donut"].indexOf(e.shape.value)>=0;return l?(i+a)/2:0}).attr("ry",function(t){var i=t.d3plus.r?2*t.d3plus.r:t.d3plus.height,l=["circle","donut"].indexOf(e.shape.value)>=0;return l?(i+a)/2:0}).attr("shape-rendering",function(){return["square"].indexOf(e.shape.value)>=0?e.shape.rendering.value:"auto"})}function n(t,a,i,l){if(!a)var a=0;if("number"!=typeof i)var i=void 0;if("number"!=typeof l)var l=void 0;t.attrTween("d",function(t){if(void 0==i)var n=t.d3plus.r?t.d3plus.r:d3.max([t.d3plus.width,t.d3plus.height]);else var n=i;if(void 0==l)var o=t.d3plus.a[t.d3plus.shapeType];else var o=l;e.arcs[t.d3plus.shapeType][t.d3plus.id]||(e.arcs[t.d3plus.shapeType][t.d3plus.id]={r:0},e.arcs[t.d3plus.shapeType][t.d3plus.id].a="donut"==t.d3plus.shapeType?2*Math.PI:0);var s=d3.interpolate(e.arcs[t.d3plus.shapeType][t.d3plus.id].r,n+a),u=d3.interpolate(e.arcs[t.d3plus.shapeType][t.d3plus.id].a,o);return function(a){return e.arcs[t.d3plus.shapeType][t.d3plus.id].r=s(a),e.arcs[t.d3plus.shapeType][t.d3plus.id].a=u(a),r(t)}})}e.arcs||(e.arcs={donut:{},active:{},temp:{}});var r=d3.svg.arc().startAngle(0).endAngle(function(t){var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].a;return a>2*Math.PI?2*Math.PI:a}).innerRadius(function(t){if("donut"!=shape||t.d3plus.static)return 0;var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].r;return a*e.data.donut.size}).outerRadius(function(t){var a=e.arcs[t.d3plus.shapeType][t.d3plus.id].r;return"donut"!=t.d3plus.shapeType?2*a:a});t.each(function(t){function r(t){t.attr("stroke",c).attr("stroke-width",1).attr("shape-rendering",e.shape.rendering.value)}var o=e.active.value?t.d3plus[e.active.value]:t.d3plus.active,s=e.temp.value?t.d3plus[e.temp.value]:t.d3plus.temp,u=e.total.value?t.d3plus[e.total.value]:t.d3plus.total,d=d3.select(this),c=i.variable.color(e,t),v=[],p=[];if(u&&i.visualization[e.type.value].fill){if(s){var f=i.util.copy(t);f.d3plus.shapeType="temp",v.push(f),p=["temp"]}if(o&&(u>o||s)){var f=i.util.copy(t);f.d3plus.shapeType="active",v.push(f)}}var h=e.defs.selectAll("pattern#d3plus_hatch_"+t.d3plus.id).data(p);e.draw.timing?(h.selectAll("rect").transition().duration(e.draw.timing).style("fill",c),h.selectAll("line").transition().duration(e.draw.timing).style("stroke",c)):(h.selectAll("rect").style("fill",c),h.selectAll("line").style("stroke",c));var g=h.enter().append("pattern").attr("id","d3plus_hatch_"+t.d3plus.id).attr("patternUnits","userSpaceOnUse").attr("x","0").attr("y","0").attr("width","10").attr("height","10").append("g");g.append("rect").attr("x","0").attr("y","0").attr("width","10").attr("height","10").attr("fill",c).attr("fill-opacity",.25),g.append("line").attr("x1","0").attr("x2","10").attr("y1","0").attr("y2","10").call(r),g.append("line").attr("x1","-1").attr("x2","1").attr("y1","9").attr("y2","11").call(r),g.append("line").attr("x1","9").attr("x2","11").attr("y1","-1").attr("y2","1").call(r);var m=v.length?[t]:[],y=d.selectAll("#d3plus_clip_"+t.d3plus.id).data(m);y.enter().insert("clipPath",".d3plus_mouse").attr("id","d3plus_clip_"+t.d3plus.id).append("rect").attr("class","d3plus_clipping").call(a),e.draw.timing?(y.selectAll("rect").transition().duration(e.draw.timing).call(l),y.exit().transition().delay(e.draw.timing).remove()):(y.selectAll("rect").call(l),y.exit().remove());var x=d.selectAll("path.d3plus_fill").data(v);x.transition().duration(e.draw.timing).call(i.shape.style,e).call(n),x.enter().insert("path","rect.d3plus_mouse").attr("class","d3plus_fill").attr("clip-path","url(#d3plus_clip_"+t.d3plus.id+")").transition().duration(0).call(n,0,void 0,0).call(i.shape.style,e).transition().duration(e.draw.timing).call(n),x.exit().transition().duration(e.draw.timing).call(n,0,void 0,0).remove()})},i.shape.labels=function(e,t){var a=e.zoom.behavior.scaleExtent(),l=e.g[t].selectAll("g"),n=function(t){t.attr("opacity",function(t){if(!t)var t={scale:a[1]};var i=parseFloat(d3.select(this).attr("font-size"),10);return t.visible=i/t.scale*e.zoom.scale>=7,t.visible?1:0})};if(remove=function(t){e.draw.timing?t.transition().duration(e.draw.timing).attr("opacity",0).remove():t.remove()},style=function(t,l){function n(t){if("circle"===t.shape)return"0px";var l=t.anchor||e.labels.align,n="tspan"===this.tagName.toLowerCase(),r=n?"d3plus_share"==this.parentNode.className.baseVal:"d3plus_share"==this.className.baseVal,o=d3.select(this).node().getComputedTextLength()/a[1];if("middle"==l||r)var s=t.x-o/2;else if("end"==l&&!i.rtl||"start"==l&&i.rtl)var s=t.x+(t.w-t.padding)/2-o;else var s=t.x-(t.w-t.padding)/2;if(n){var u=this.getComputedTextLength()/a[1];"middle"==l?i.rtl?s-=(o-u)/2:s+=(o-u)/2:"end"==l&&(i.rtl?s-=o-u:s+=o-u)}return i.rtl&&(s+=o),s*a[1]}function r(t){if(d3.select(this).select("tspan").empty())return 0;var i=e.labels.align,l=d3.select(this).node().getBBox().height/a[1],n=parseFloat(d3.select(this).style("font-size"),10)/5/a[1];if("d3plus_share"==this.className.baseVal){var r=d3.select(this.parentNode).datum(),o=r.d3plus.r?2*r.d3plus.r:r.d3plus.height;if(o/=a[1],"end"==i)var s=t.y-o/2+n/2;else var s=t.y+o/2-l-n/2}else if("circle"===t.shape||"middle"===i||"center"===t.valign)var s=t.y-l/2-n/2;else if("end"==i)var s=t.y+(t.h-t.padding)/2-l+n/2;else var s=t.y-(t.h-t.padding)/2-n;return s*a[1]}t.attr("font-weight",e.labels.font.weight).attr("font-family",e.labels.font.family.value).attr("text-anchor",function(e){return"circle"===e.shape?"middle":"start"}).attr("pointer-events",function(e){return e.mouse?"auto":"none"}).attr("fill",function(t){if(t.color)return t.color;var a=i.shape.color(t.parent,e),l=i.color.text(a),n=t.text?.15:1;return i.color.mix(a,l,.2,n)}).attr("x",n).attr("y",r),l&&t.each(function(t){if(t.resize instanceof Array){t.resize[0],t.resize[1]}if(t.text){if(t.resize instanceof Array)var a=t.resize,l=!0;else var a=[8/t.scale,50*t.scale],l=t.resize;i.textwrap().container(d3.select(this)).height(t.h*t.scale-t.padding).resize(l).size(a).text(e.format.value(100*t.text,"share")+"%").width(t.w*t.scale-t.padding).draw()}else{if("middle"!=e.labels.align)var n=t.h-t.share-t.padding;else var n=t.h;if(t.resize instanceof Array)var a=t.resize,l=!0;else var a=[8/t.scale,40*t.scale],l=t.resize;var r=t.shape||"square";i.textwrap().container(d3.select(this)).height(n*t.scale-t.padding).resize(l).size(a).shape(r).text(t.names).width(t.w*t.scale-t.padding).draw()}}).attr("x",n).attr("y",r),t.attr("transform",function(e){var t=e.angle||0,i=e.translate&&e.translate.x||0,l=e.translate&&e.translate.y||0;return"rotate("+t+","+i+","+l+")scale("+1/a[1]+")"}).selectAll("tspan").attr("x",n)},e.labels.value){if(e.dev.value){var r="drawing "+t+" labels";i.console.time(r)}l.each(function(l){function r(t){var i="none"===e.background.value?"#ffffff":e.background.value,l="string"==typeof label.background?label.background:i,n=label.angle||0,r=label.translate?g.x+g.width/2:0,o=label.translate?g.y+g.height/2:0,s="scale("+1/a[1]+")rotate("+n+","+r+","+o+")";t.attr("fill",l).attr(g).attr("transform",s)}var o=l.d3plus&&"label"in l.d3plus&&!l.d3plus.label,s=l.d3plus&&"static"in l.d3plus&&l.d3plus.static;if(label=l.d3plus_label?l.d3plus_label:e.zoom.labels?e.zoom.labels[l.d3plus.id]:null,share=l.d3plus_share,names=label&&label.names?label.names:i.variable.text(e,l),t=label&&"group"in label?label.group:d3.select(this),share_size=0,fill=i.visualization[e.type.value].fill,label)if(["line","area"].indexOf(e.shape.value)>=0)var u=!0;else if(l&&"d3plus"in l)var d=e.active.value?l.d3plus[e.active.value]:l.d3plus.active,c=e.temp.value?l.d3plus[e.temp.value]:l.d3plus.temp,v=e.total.value?l.d3plus[e.total.value]:l.d3plus.total,u=!c&&!d||d==v;if(o||!u&&fill||s)delete l.d3plus_label,t.selectAll("text#d3plus_label_"+l.d3plus.id+", rect#d3plus_label_bg_"+l.d3plus.id).call(remove);else{if(share&&l.d3plus.share&&"middle"!=e.labels.align){share.resize=e.labels.resize.value===!1?!1:share&&"resize"in share?share.resize:!0,share.scale=share.resize?a[1]:a[0],share.padding=e.labels.padding/share.scale*2,share.text=l.d3plus.share,share.parent=l;var p=t.selectAll("text#d3plus_share_"+l.d3plus.id).data([share],function(e){return e.w+""+e.h+e.text});e.draw.timing?(p.transition().duration(e.draw.timing/2).call(style),p.enter().append("text").attr("id","d3plus_share_"+l.d3plus.id).attr("class","d3plus_share").attr("opacity",0).call(style,!0).transition().duration(e.draw.timing/2).delay(e.draw.timing/2).attr("opacity",1)):(p.attr("opacity",1).call(style),p.enter().append("text").attr("id","d3plus_share_"+l.d3plus.id).attr("class","d3plus_share").attr("opacity",1).call(style,!0)),share_size=p.node().getBBox().height,p.exit().call(remove)}else t.selectAll("text.d3plus_share").call(remove);if(label&&(label.resize=e.labels.resize.value===!1?!1:label&&"resize"in label?label.resize:!0,label.scale=label.resize?a[1]:a[0],label.padding=e.labels.padding/label.scale*2),label&&label.w*label.scale-label.padding>=25&&label.h*label.scale-label.padding>=15&&names.length){label.names=names,label.share=share_size,label.parent=l;var p=t.selectAll("text#d3plus_label_"+l.d3plus.id).data([label],function(e){return e?e.w+"_"+e.h+"_"+e.x+"_"+e.y+"_"+e.names.join("_"):!1}),f=label.resize?void 0:e.labels.font.size*label.scale;if(e.draw.timing?(p.transition().duration(e.draw.timing/2).call(style),p.enter().append("text").attr("font-size",f).attr("id","d3plus_label_"+l.d3plus.id).attr("class","d3plus_label").attr("opacity",0).call(style,!0).transition().duration(e.draw.timing/2).delay(e.draw.timing/2).call(n)):(p.attr("opacity",1).call(style),p.enter().append("text").attr("font-size",f).attr("id","d3plus_label_"+l.d3plus.id).attr("class","d3plus_label").call(style,!0).call(n)),p.exit().call(remove),0==p.size()||""==p.html())delete l.d3plus_label,t.selectAll("text#d3plus_label_"+l.d3plus.id+", rect#d3plus_label_bg_"+l.d3plus.id).call(remove);else{if(label.background){var h=["background"],g=p.node().getBBox();g.width+=e.labels.padding*a[0],g.height+=e.labels.padding*a[0],g.x-=e.labels.padding*a[0]/2,g.y-=e.labels.padding*a[0]/2}else var h=[],g={};var m=t.selectAll("rect#d3plus_label_bg_"+l.d3plus.id).data(h),y="number"==typeof label.background?label.background:.6;e.draw.timing?(m.exit().transition().duration(e.draw.timing).attr("opacity",0).remove(),m.transition().duration(e.draw.timing).attr("opacity",y).call(r),m.enter().insert("rect",".d3plus_label").attr("id","d3plus_label_bg_"+l.d3plus.id).attr("class","d3plus_label_bg").attr("opacity",0).call(r).transition().duration(e.draw.timing).attr("opacity",y)):(m.exit().remove(),m.enter().insert("rect",".d3plus_label").attr("id","d3plus_label_bg_"+l.d3plus.id).attr("class","d3plus_label_bg"),m.attr("opacity",y).call(r))}}else delete l.d3plus_label,t.selectAll("text#d3plus_label_"+l.d3plus.id+", rect#d3plus_label_bg_"+l.d3plus.id).call(remove)}}),e.dev.value&&i.console.timeEnd(r)}else{if(e.dev.value){var r="removing "+t+" labels";i.console.time(r)}l.selectAll("text.d3plus_label, rect.d3plus_label_bg").call(remove),e.g.labels.selectAll("text.d3plus_label, rect.d3plus_label_bg").call(remove),e.dev.value&&i.console.timeEnd(r)}},i.shape.line=function(e,t){function a(e){e.attr("x",function(e){return e.d3plus.x}).attr("y",function(e){return e.d3plus.y}).attr("width",0).attr("height",0)}function l(e,t){if(!t)var t=0;e.attr("x",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return e.d3plus.x-(a/2+t/2)}).attr("y",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return e.d3plus.y-(a/2+t/2)}).attr("width",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return a+t}).attr("height",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return a+t}).attr("rx",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return(a+t)/2}).attr("ry",function(e){var a=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return(a+t)/2})}var n=d3.svg.line().x(function(e){return e.d3plus.x}).y(function(e){return e.d3plus.y}).interpolate(e.shape.interpolate.value),r=e.data.stroke.width;30>r&&(r=30),t.each(function(t){var o=!1,s=[],u=[],d=i.util.copy(t),c=d3.select(this);d.values=[],t.values.forEach(function(a,l,n){u.push(a);var r=a[e[e.continuous_axis].value],c=e.tickValues[e.continuous_axis].indexOf(r);o===!1&&(o=c),l+o===c?(d.values.push(a),d.key+="_"+s.length):(l>0&&(s.push(d),d=i.util.copy(t),d.values=[]),d.values.push(a),d.key+="_"+s.length,o++),l===n.length-1&&s.push(d)});var v=c.selectAll("path.d3plus_line").data(s,function(e){return e.key}),p=c.selectAll("rect.d3plus_anchor").data(u,function(e){return e.d3plus.id});e.draw.timing?(v.transition().duration(e.draw.timing).attr("d",function(e){return n(e.values)}).call(i.shape.style,e),v.enter().append("path").attr("class","d3plus_line").attr("d",function(e){return n(e.values)}).call(i.shape.style,e),p.enter().append("rect").attr("class","d3plus_anchor").attr("id",function(e){return e.d3plus.id}).call(a).call(i.shape.style,e),p.transition().duration(e.draw.timing).call(l).call(i.shape.style,e),p.exit().transition().duration(e.draw.timing).call(a).remove()):(v.enter().append("path").attr("class","d3plus_line"),v.attr("d",function(e){return n(e.values)}).call(i.shape.style,e),p.enter().append("rect").attr("class","d3plus_anchor").attr("id",function(e){return e.d3plus.id}),p.call(l).call(i.shape.style,e));var f=c.selectAll("path.d3plus_mouse").data(s,function(e){return e.key});f.enter().append("path").attr("class","d3plus_mouse").attr("d",function(e){return n(e.values)}).style("stroke","black").style("stroke-width",r).style("fill","none").style("stroke-linecap","round").attr("opacity",0),f.on(i.evt.over,function(){e.draw.frozen||(d3.select(this.parentNode).selectAll("path.d3plus_line").transition().duration(e.timing.mouseevents).style("stroke-width",2*e.data.stroke.width),d3.select(this.parentNode).selectAll("rect").transition().duration(e.timing.mouseevents).style("stroke-width",2*e.data.stroke.width).call(l,2))}).on(i.evt.out,function(){e.draw.frozen||(d3.select(this.parentNode).selectAll("path.d3plus_line").transition().duration(e.timing.mouseevents).style("stroke-width",e.data.stroke.width),d3.select(this.parentNode).selectAll("rect").transition().duration(e.timing.mouseevents).style("stroke-width",e.data.stroke.width).call(l))}),e.draw.timing?f.transition().duration(e.draw.timing).attr("d",function(e){return n(e.values)}).style("stroke-width",r):f.attr("d",function(e){return n(e.values)}).style("stroke-width",r),f.exit().remove()})},i.shape.rect=function(e,t,a,l){function n(t){if(e.labels.value&&!t.d3plus.label){t.d3plus_label={w:0,h:0,x:0,y:0};var a=t.d3plus.r?2*t.d3plus.r:t.d3plus.width,i=t.d3plus.r?2*t.d3plus.r:t.d3plus.height;t.d3plus_share={w:a,h:d3.max([25,i/3]),x:0,y:0},t.d3plus_label.w=a,t.d3plus_label.h=i,t.d3plus_label.shape="circle"===e.shape.value?"circle":"square"}else t.d3plus.label&&(t.d3plus_label=t.d3plus.label);return[t]}function r(e){e.attr("x",0).attr("y",0).attr("width",0).attr("height",0)}function o(t){t.attr("x",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return-t/2}).attr("y",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return-t/2}).attr("width",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.width;return t}).attr("height",function(e){var t=e.d3plus.r?2*e.d3plus.r:e.d3plus.height;return t}).attr("rx",function(t){var a="circle"==e.shape.value,i=t.d3plus.r?2*t.d3plus.r:t.d3plus.width;return a?(i+2)/2:0}).attr("ry",function(t){var a="circle"==e.shape.value,i=t.d3plus.r?2*t.d3plus.r:t.d3plus.height;return a?(i+2)/2:0}).attr("transform",function(e){return"rotate"in e.d3plus?"rotate("+e.d3plus.rotate+")":""}).attr("shape-rendering",function(t){return"square"!=e.shape.value||"rotate"in t.d3plus?"auto":e.shape.rendering.value})}e.draw.timing?a.append("rect").attr("class","d3plus_data").call(r).call(i.shape.style,e):a.append("rect").attr("class","d3plus_data"),e.draw.timing?t.selectAll("rect.d3plus_data").data(n).transition().duration(e.draw.timing).call(o).call(i.shape.style,e):t.selectAll("rect.d3plus_data").data(n).call(o).call(i.shape.style,e),e.draw.timing&&l.selectAll("rect.d3plus_data").transition().duration(e.draw.timing).call(r)},i.shape.style=function(e,t){e.attr("fill",function(e){return e.d3plus&&e.d3plus.spline?"none":i.shape.color(e,t)}).style("stroke",function(e){if(e.values)var a=i.shape.color(e.values[0],t);else var a=i.shape.color(e,t);return d3.rgb(a).darker(.5)}).style("stroke-width",t.data.stroke.width).attr("opacity",t.data.opacity).attr("vector-effect","non-scaling-stroke")},i.draw.app=function(e){if(e.group=e.g.apps[e.type.value],e.mouse={},e.internal_error)var t=null;else{var a=e.format.locale.value.visualization[e.type.value];e.dev.value&&i.console.time("running "+a);var t=i.visualization[e.type.value](e);e.dev.value&&i.console.timeEnd("running "+a)}e.returned={nodes:null,edges:null},t instanceof Array?e.returned.nodes=t:t&&(t.nodes&&(e.returned.nodes=t.nodes),t.edges&&(e.returned.edges=t.edges));var l=e.returned.nodes;l&&l instanceof Array&&l.length||(e.returned.nodes=[])},i.draw.container=function(e){if(e.container.changed){e.container.value.style("position",function(){var e=d3.select(this).style("position"),t=["absolute","fixed"].indexOf(e)>=0;return t?e:"relative"}).html("");var t=["width","height"];t.forEach(function(t){function a(i){if(void 0===i.tagName||["BODY","HTML"].indexOf(i.tagName)>=0){var l=window["inner"+t.charAt(0).toUpperCase()+t.slice(1)],n=document!=i?d3.select(i):null;n&&"width"==t?(l-=parseFloat(n.style("margin-left"),10),l-=parseFloat(n.style("margin-right"),10),l-=parseFloat(n.style("padding-left"),10),l-=parseFloat(n.style("padding-right"),10)):n&&"height"==t&&(l-=parseFloat(n.style("margin-top"),10),l-=parseFloat(n.style("margin-bottom"),10),l-=parseFloat(n.style("padding-top"),10),l-=parseFloat(n.style("padding-bottom"),10)),1==d3.selectAll("body > *:not(script)").size()&&d3.select("body").style("overflow","hidden"),20>=l&&(l=e[t].small),e[t].value=l}else{var l=parseFloat(d3.select(i).style(t),10);"number"==typeof l&&l>0?e[t].value=l:"BODY"!=i.tagName&&a(i.parentNode)}}e[t].value||a(e.container.value.node())}),e.container.value.style("width",e.width.value+"px").style("height",e.height.value+"px")}e.width.viz=e.width.value,e.height.viz=e.height.value},i.draw.enter=function(e){e.dev.value&&i.console.time("creating SVG elements"),e.svg=e.container.value.selectAll("svg#d3plus").data([0]),e.svg.enter().insert("svg","#d3plus_message").attr("id","d3plus").attr("width",e.width.value).attr("height",e.height.value).attr("xmlns","http://www.w3.org/2000/svg").attr("xmlns:xmlns:xlink","http://www.w3.org/1999/xlink"),e.g.bg=e.svg.selectAll("rect#bg").data(["bg"]),e.g.bg.enter().append("rect").attr("id","bg").attr("fill",e.background.value).attr("width",e.width.value).attr("height",e.height.value),e.g.timeline=e.svg.selectAll("g#timeline").data(["timeline"]),e.g.timeline.enter().append("g").attr("id","timeline").attr("transform","translate(0,"+e.height.value+")"),e.g.legend=e.svg.selectAll("g#key").data(["key"]),e.g.legend.enter().append("g").attr("id","key").attr("transform","translate(0,"+e.height.value+")"),e.g.footer=e.svg.selectAll("g#footer").data(["footer"]),e.g.footer.enter().append("g").attr("id","footer").attr("transform","translate(0,"+e.height.value+")"),e.g.clipping=e.svg.selectAll("#clipping").data(["clipping"]),e.g.clipping.enter().append("clipPath").attr("id","clipping").append("rect").attr("width",e.width.viz).attr("height",e.height.viz),e.g.container=e.svg.selectAll("g#container").data(["container"]),e.g.container.enter().append("g").attr("id","container").attr("clip-path","url(#clipping)").attr("transform","translate("+e.margin.left+","+e.margin.top+")"),e.g.zoom=e.g.container.selectAll("g#zoom").data(["zoom"]),e.g.zoom.enter().append("g").attr("id","zoom"),e.g.viz=e.g.zoom.selectAll("g#d3plus_viz").data(["d3plus_viz"]),e.g.viz.enter().append("g").attr("id","d3plus_viz"),e.g.overlay=e.g.viz.selectAll("rect#d3plus_overlay").data([{id:"d3plus_overlay"}]),e.g.overlay.enter().append("rect").attr("id","d3plus_overlay").attr("width",e.width.value).attr("height",e.height.value).attr("opacity",0),i.touch?e.g.overlay.on(i.evt.over,e.zoom.touchEvent).on(i.evt.move,e.zoom.touchEvent).on(i.evt.out,e.zoom.touchEvent):e.g.overlay.on(i.evt.move,function(t){t.dragging||(i.visualization[e.type.value].zoom&&e.zoom.pan.value&&e.zoom.behavior.scaleExtent()[0]<e.zoom.scale?d3.select(this).style("cursor",i.prefix()+"grab"):d3.select(this).style("cursor","auto"))
}).on(i.evt.up,function(t){i.visualization[e.type.value].zoom&&e.zoom.pan.value&&e.zoom.behavior.scaleExtent()[0]<e.zoom.scale?(t.dragging=!1,d3.select(this).style("cursor",i.prefix()+"grab")):d3.select(this).style("cursor","auto")}).on(i.evt.down,function(t){i.visualization[e.type.value].zoom&&e.zoom.pan.value&&e.zoom.behavior.scaleExtent()[0]<e.zoom.scale?(t.dragging=!0,d3.select(this).style("cursor",i.prefix()+"grabbing")):d3.select(this).style("cursor","auto")}),e.g.app=e.g.viz.selectAll("g#app").data(["app"]),e.g.app.enter().append("g").attr("id","app"),e.g.edges=e.g.viz.selectAll("g#edges").data(["edges"]),e.g.edges.enter().append("g").attr("id","edges").attr("opacity",0),e.g.edge_focus=e.g.viz.selectAll("g#focus").data(["focus"]),e.g.edge_focus.enter().append("g").attr("id","focus"),e.g.edge_hover=e.g.viz.selectAll("g#edge_hover").data(["edge_hover"]),e.g.edge_hover.enter().append("g").attr("id","edge_hover").attr("opacity",0),e.g.data=e.g.viz.selectAll("g#data").data(["data"]),e.g.data.enter().append("g").attr("id","data").attr("opacity",0),e.g.data_focus=e.g.viz.selectAll("g#data_focus").data(["data_focus"]),e.g.data_focus.enter().append("g").attr("id","data_focus"),e.g.labels=e.g.viz.selectAll("g#d3plus_labels").data(["d3plus_labels"]),e.g.labels.enter().append("g").attr("id","d3plus_labels"),e.defs=e.svg.selectAll("defs").data(["defs"]),e.defs.enter().append("defs"),e.dev.value&&i.console.timeEnd("creating SVG elements")},i.draw.errors=function(e){e.dev.value&&i.console.time("checking for errors");var t=["id"];i.visualization[e.type.value].requirements&&(t=t.concat(i.visualization[e.type.value].requirements));var a=[];if(t.forEach(function(t){e[t].value||a.push('"'+t+'"')}),a.length>1){var l=e.format.locale.value.error.methods,n=e.format.locale.value.visualization[e.type.value],r=e.format.locale.value.ui.and;a=i.string.list(a,r),e.internal_error=i.string.format(l,n,a)}else if(1===a.length){var l=e.format.locale.value.error.method,n=e.format.locale.value.visualization[e.type.value];e.internal_error=i.string.format(l,n,a[0])}if(!e.internal_error&&t.indexOf("edges")>=0&&t.indexOf("focus")>=0){var o=e.edges.connections(e.focus.value,e.id.value);if(0==o.length){var s=i.variable.text(e,e.focus.value,e.depth.value),l=e.format.locale.value.error.connections;e.internal_error=i.string.format(l,'"'+s+'"')}}var t=["d3"];i.visualization[e.type.value].libs&&(t=t.concat(i.visualization[e.type.value].libs));var a=[];if(t.forEach(function(e){window[e]||a.push('"'+e+'"')}),a.length>1){var l=e.format.locale.value.error.libs,n=e.format.locale.value.visualization[e.type.value],r=e.format.locale.value.ui.and;a=i.string.list(a,r),e.internal_error=i.string.format(l,n,a)}else if(1===a.length){var l=e.format.locale.value.error.lib,n=e.format.locale.value.visualization[e.type.value];e.internal_error=i.string.format(l,n,a[0])}if(e.shape.value){if(i.visualization[e.type.value].shapes.indexOf(e.shape.value)<0){var u=i.visualization[e.type.value].shapes.join('", "'),l=e.format.locale.value.error.accepted,d='"'+e.shape.value+'"',c=e.format.locale.value.method.shape,n=e.format.locale.value.visualization[e.type.value];i.console.warning(i.string.format(l,d,c,n,'"'+u+'"'),"shape"),e.shape.previous=e.shape.value,e.shape.value=i.visualization[e.type.value].shapes[0];var l=e.format.locale.value.dev.setLong,d='"'+e.shape.value+'"';e.dev.value&&i.console.log(i.string.format(l,c,d))}}else e.shape.value=i.visualization[e.type.value].shapes[0];if("modes"in i.visualization[e.type.value])if(e.type.mode.value){if(i.visualization[e.type.value].modes.indexOf(e.type.mode.value)<0){var v=i.visualization[e.type.value].modes.join('", "'),l=e.format.locale.value.error.accepted,p='"'+e.type.mode.value+'"',f=e.format.locale.value.method.mode,n=e.format.locale.value.visualization[e.type.value];i.console.warning(i.string.format(l,p,f,n,'"'+v+'"')),e.type.mode.previous=e.type.mode.value,e.type.mode.value=i.visualization[e.type.value].modes[0];var l=e.format.locale.value.dev.setLong,p='"'+e.type.mode.value+'"';e.dev.value&&i.console.log(i.string.format(l,f,p))}}else e.type.mode.value=i.visualization[e.type.value].modes[0];e.dev.value&&i.console.timeEnd("checking for errors")},i.draw.finish=function(e){i.visualization[e.type.value].zoom&&e.zoom.value?(e.dev.value&&i.console.time("calculating zoom"),e.draw.first&&e.zoom.bounds&&i.zoom.bounds(e,e.zoom.bounds,0),(e.focus.changed||e.height.changed||e.width.changed)&&(e.zoom.viewport?i.zoom.bounds(e,e.zoom.viewport):i.zoom.bounds(e,e.zoom.bounds)),e.dev.value&&i.console.timeEnd("calculating zoom")):e.zoom.scale=1;var t=e.zoom.size?e.zoom.size.width:e.width.viz,a=e.zoom.size?e.zoom.size.height:e.height.viz,l=e.zoom.bounds?e.zoom.bounds[0][0]:0,n=e.zoom.bounds?e.zoom.bounds[0][1]:0;if(e.g.overlay.attr("width",t).attr("height",a).attr("x",l).attr("y",n),e.draw.update?(i.shape.edges(e),(e.draw.timing||!i.visualization[e.type.value].zoom&&!e.draw.timing)&&(i.shape.labels(e,"data"),e.edges.label&&setTimeout(function(){i.shape.labels(e,"edges")},e.draw.timing))):i.visualization[e.type.value].zoom&&e.zoom.value&&e.draw.timing&&setTimeout(function(){i.zoom.labels(e)},e.draw.timing),i.visualization[e.type.value].zoom&&e.zoom.value&&e.focus.value&&!e.draw.timing&&(e.dev.value&&i.console.time("focus labels"),i.shape.labels(e,"data_focus"),e.edges.label&&setTimeout(function(){i.shape.labels(e,"edge_focus")},e.draw.timing),e.dev.value&&i.console.timeEnd("focus labels")),!e.internal_error){var r=i.visualization[e.type.value].requirements.indexOf("data")>=0;e.data.app&&e.returned.nodes.length||!r||(e.internal_error=e.format.locale.value.error.data)}var o=e.type.previous;o&&e.type.value!=o&&e.g.apps[o]&&(e.dev.value&&i.console.time('hiding "'+o+'"'),e.draw.timing?e.g.apps[o].transition().duration(e.draw.timing).attr("opacity",0):e.g.apps[o].attr("opacity",0),e.dev.value&&i.console.timeEnd());var r=i.visualization[e.type.value].requirements.indexOf("data")>=0,s=r&&0==e.data.app.length||e.internal_error?0:e.focus.value&&i.visualization[e.type.value].zoom&&e.zoom.value?.4:1,u=e.group.attr("opacity");if(s!=u){var d=e.draw.timing;e.group.transition().duration(d).attr("opacity",s),e.g.data.transition().duration(d).attr("opacity",s),e.g.edges.transition().duration(d).attr("opacity",s)}e.internal_error?(e.internal_error=i.string.title(e.internal_error),i.console.warning(e.internal_error),i.ui.message(e,e.internal_error),e.internal_error=null):i.ui.message(e),setTimeout(function(){i.data.reset(e),i.visualization[e.type.value].zoom&&e.zoom.value?(e.g.zoom.datum(e).call(e.zoom.behavior.on("zoom",i.zoom.mouse)),e.zoom.scroll.value||e.g.zoom.on("wheel.zoom",null),e.zoom.click.value||e.g.zoom.on("dblclick.zoom",null),e.zoom.pan.value||(e.g.zoom.on("mousemove.zoom",null),e.g.zoom.on("mousedown.zoom",null))):e.g.zoom.call(e.zoom.behavior.on("zoom",null))},e.draw.timing)},i.draw.focus=function(t){if(t.g.edge_focus.selectAll("g").remove(),t.g.data_focus.selectAll("g").remove(),t.focus.value&&i.visualization[t.type.value].zoom&&t.zoom.value){t.dev.value&&i.console.time("drawing focus elements");var a=t.g.edges.selectAll("g");if(a.size()>0){a.each(function(e){var a=e[t.edges.source][t.id.value],i=e[t.edges.target][t.id.value];if(a==t.focus.value||i==t.focus.value){var l=t.g.edge_focus.node().appendChild(this.cloneNode(!0));d3.select(l).datum(e).attr("opacity",1).selectAll("line, path").datum(e)}});var l=t.edges.arrows.value;t.g.edge_focus.selectAll("line, path").attr("vector-effect","non-scaling-stroke").style("stroke",t.color.focus).style("stroke-width",function(){return t.edges.size?d3.select(this).style("stroke-width"):2*t.data.stroke.width}).attr("marker-start",function(e){var a=t.edges.arrows.direction.value;if("bucket"in e.d3plus)var i="_"+e.d3plus.bucket;else var i="";return"source"==a&&l?"url(#d3plus_edge_marker_focus"+i+")":"none"}).attr("marker-end",function(e){var a=t.edges.arrows.direction.value;if("bucket"in e.d3plus)var i="_"+e.d3plus.bucket;else var i="";return"target"==a&&l?"url(#d3plus_edge_marker_focus"+i+")":"none"}),t.g.edge_focus.selectAll("text").style("fill",t.color.focus)}var n=i.util.uniques(t.edges.connections(t.focus.value,t.id.value,!0),t.id.value);n.push(t.focus.value);{var r=[],o=[],s=[0],u=[0];t.g.data.selectAll("g").each(function(a){if(n.indexOf(a[t.id.value])>=0){var l=t.g.data_focus.node().appendChild(this.cloneNode(!0)),l=d3.select(l).datum(a).attr("opacity",1);"coordinates"==t.shape.value?t.zoom.viewport=t.path.bounds(t.zoom.coords[a.d3plus.id]):"d3plus"in a&&("x"in a.d3plus&&r.push(a.d3plus.x),"y"in a.d3plus&&o.push(a.d3plus.y),"r"in a.d3plus?(s.push(a.d3plus.r),u.push(a.d3plus.r)):("width"in a.d3plus&&s.push(a.d3plus.width/2),"height"in a.d3plus&&u.push(a.d3plus.height/2)));for(e in i.evt){var d=d3.select(this).on(i.evt[e]);d&&l.on(i.evt[e],d)}}})}if(r.length&&o.length){var d=d3.extent(r),c=d3.extent(o),v=d3.max(s),p=d3.max(u);t.zoom.viewport=[[d[0]-v,c[0]-p],[d[1]+v,c[1]+p]]}t.g.data_focus.selectAll("path").style("stroke-width",2*t.data.stroke.width),t.dev.value&&i.console.timeEnd("drawing focus elements")}else t.zoom.viewport=null},i.draw.steps=function(e){var t=[],a=e.type.value,l=e.format.locale.value,n=l.message.ui,r=l.message.draw,o=["data","attrs","coords","nodes","edges"];if(o.forEach(function(a){!e[a].loaded&&e[a].url&&t.push({"function":function(e,t){i.data.url(e,a,t)},message:l.message.loading,wait:!0})}),e.draw.update){var s=l.visualization[a].toLowerCase(),u=i.visualization[a].setup,d=i.visualization[a].requirements,c=i.string.format(l.message.initializing,s),v=l.message.data;"function"==typeof u&&t.push({"function":function(e){if(e.dev.value){var t="running "+s+" setup";i.console.time(t)}u(e),e.dev.value&&i.console.timeEnd(t)},message:c}),e.container.changed&&t.push({"function":i.draw.enter,message:c}),a in e.g.apps||t.push({"function":function(e){if(e.dev.value){var t="creating "+s+" group";i.console.time(t)}e.g.apps[a]=e.g.app.selectAll("g#"+a).data([a]),e.g.apps[a].enter().append("g").attr("id",a).attr("opacity",0),e.dev.value&&i.console.timeEnd(t)},message:c}),e.data.changed&&t.push({"function":function(e){e.data.cache={},delete e.nodes.restricted,delete e.edges.restricted,i.data.keys(e,"data")},message:v}),e.attrs.changed&&t.push({"function":function(e){i.data.keys(e,"attrs")},message:v}),t.push({"function":function(e){if(e.color.changed&&e.color.value){if(e.dev.value){var t="determining color type";i.console.time(t)}var a=e.color.value;i.object.validate(a)&&(a=a[e.id.value]?a[e.id.value]:a[d3.keys(a)[0]]),e.color.type=e.data.keys&&a in e.data.keys?e.data.keys[a]:e.attrs.keys&&a in e.attrs.keys?e.attrs.keys[a]:void 0,e.dev.value&&i.console.timeEnd(t)}else e.color.value||(e.color.type="keys"in e.data?e.data.keys[e.id.value]:!1)},message:v}),d.indexOf("edges")>=0&&e.edges.value&&(!e.edges.linked||e.edges.changed)&&t.push({"function":i.data.edges,message:v}),d.indexOf("nodes")>=0&&e.edges.value&&(!e.nodes.positions||e.nodes.changed)&&t.push({"function":i.data.nodes,message:v}),(e.data.changed||e.time.changed||e.id.changed)&&t.push({"function":i.data.format,message:v}),t.push({"function":function(e){var t=e.time.fixed.value?null:["all"];if(e.dev.value){var a=t?"fetching pool data":"fetching data";i.console.time(a)}e.data.pool=i.data.fetch(e,t),e.dev.value&&i.console.timeEnd(a),t?(e.dev.value&&i.console.time("fetching data for current year"),e.data.app=i.data.fetch(e),e.dev.value&&i.console.timeEnd("fetching data for current year")):e.data.app=e.data.pool},message:v}),t.push({check:function(e){return e.color.value&&"number"===e.color.type&&e.id.nesting.indexOf(e.color.value)<0&&e.data.value&&e.color.value!=e.id.value&&(e.color.changed||e.data.changed||e.depth.changed||e.time.fixed.value&&(e.time.solo.changed||e.time.mute.changed))},"function":i.data.color,message:v,otherwise:function(e){"number"!==e.color.type&&(e.color.scale=null)}})}return t.push({"function":function(e){if(e.dev.value){var t=e.format.locale.value.message.tooltipReset;i.console.time(t)}e.type.previous&&a!==e.type.previous&&i.tooltip.remove(e.type.previous),i.tooltip.remove(a),e.dev.value&&i.console.timeEnd(t)},message:n}),t.push({"function":function(e){if(e.margin.process(),i.ui.titles(e),e.draw.update)i.ui.drawer(e),i.ui.timeline(e),i.ui.legend(e);else{e.dev.value&&i.console.time("calculating margins");var t=e.container.value.select("div#d3plus_drawer").node().offsetHeight,a=e.g.timeline.node().getBBox();a=e.timeline.value?a.height+a.y:0;var l=e.g.legend.node().getBBox();l=e.legend.value?l.height+l.y:0,e.margin.bottom+=t+a+l,e.dev.value&&i.console.timeEnd("calculating margins")}i.ui.history(e),e.height.viz-=e.margin.top+e.margin.bottom,e.width.viz-=e.margin.left+e.margin.right},message:n}),t.push({"function":i.ui.focus,message:n}),t.push({"function":i.draw.update,message:r}),e.draw.update&&t.push({"function":[i.draw.errors,i.draw.app,i.shape.draw],message:r}),t.push({"function":[i.draw.focus,i.draw.finish],message:r}),t},i.draw.update=function(e){e.dev.value&&i.console.time("updating SVG elements"),e.draw.timing?(e.container.value.transition().duration(e.draw.timing).style("width",e.width.value+"px").style("height",e.height.value+"px"),e.svg.transition().duration(e.draw.timing).attr("width",e.width.value).attr("height",e.height.value),e.g.bg.transition().duration(e.draw.timing).attr("width",e.width.value).attr("height",e.height.value),e.g.clipping.select("rect").transition().duration(e.draw.timing).attr("width",e.width.viz).attr("height",e.height.viz),e.g.container.transition().duration(e.draw.timing).attr("transform","translate("+e.margin.left+","+e.margin.top+")")):(e.container.value.style("width",e.width.value+"px").style("height",e.height.value+"px"),e.svg.attr("width",e.width.value).attr("height",e.height.value),e.g.bg.attr("width",e.width.value).attr("height",e.height.value),e.g.clipping.select("rect").attr("width",e.width.viz).attr("height",e.height.viz),e.g.container.attr("transform","translate("+e.margin.left+","+e.margin.top+")")),e.dev.value&&i.console.timeEnd("updating SVG elements")},i.visualization.bubbles=function(e){function t(t){t.attr("x",function(e){return e.d3plus.x}).attr("y",function(e){return e.d3plus.y-e.r-e.d3plus.label_height-v}).attr("text-anchor","middle").attr("font-weight",e.labels.font.weight).attr("font-family",e.labels.font.family.value).attr("font-size","12px").style("fill",function(t){var a=i.variable.color(e,t);return i.color.legible(a)}).each(function(t){if(t.r>10&&a>10){var l=i.variable.text(e,t,t.depth);i.textwrap().container(d3.select(this)).height(a).text(l).width(s-2*v).draw()}}).attr("y",function(e){return e.d3plus.label_height=d3.select(this).node().getBBox().height,e.d3plus.y-e.r-e.d3plus.label_height-v}).selectAll("tspan").attr("x",function(e){return e.d3plus.x})}var a=e.labels.value&&!e.small?50:0;i.array.sort(e.data.app,e.order.value||e.size.value,e.order.sort.value,e.color.value,e);var l=e.data.app.length;if(4>l)var n=l,r=1;else var o=e.width.viz/e.height.viz,n=Math.ceil(Math.sqrt(l*o)),r=Math.ceil(Math.sqrt(l/o));if(l>0)for(;(r-1)*n>=e.data.app.length;)r--;var s=e.width.viz/n,u=e.height.viz/r,d=d3.min(e.data.app,function(t){return e.size.value?i.variable.value(e,t,e.size.value,null,"min"):0}),c=d3.max(e.data.app,function(t){return e.size.value?i.variable.value(e,t,e.size.value):0}),v=5,p=20,f=d3.min([s,u])/2-2*v;f-=a;var h=e.size.scale.value.domain([d,c]).rangeRound([p,f]),g=d3.layout.pack().size([s-2*v,u-2*v-a]).value(function(t){return e.size.value?i.variable.value(e,t,e.size.value):0}).padding(v).radius(function(e){return h(e)}),m=[],y=0;e.data.app.forEach(function(t,i){var l=g.nodes(t),r=s*i%e.width.viz,o=u*y;l.forEach(function(t){t.xoffset=r,t.yoffset=o+a,t.d3plus.static=t.depth<e.depth.value?!0:!1,t.d3plus.label=1==l.length?!1:!0}),m=m.concat(l),(i+1)%n==0&&y++});var x=f/d3.max(m,function(e){return e.r});m.forEach(function(e){e.x=(e.x-s/2)*x+s/2,e.d3plus.x=e.x+e.xoffset,e.y=(e.y-u/2)*x+u/2,e.d3plus.y=e.y+e.yoffset,e.r=e.r*x,e.d3plus.r=e.r}),m.sort(function(e,t){return e.depth-t.depth});var b=m.filter(function(e){return 0==e.depth}),w=e.group.selectAll("text.d3plus_bubble_label").data(b,function(t){return t.d3plus.label_height||(t.d3plus.label_height=0),t[e.id.nesting[t.depth]]});return w.enter().append("text").attr("class","d3plus_bubble_label").call(t).attr("opacity",0),w.transition().duration(e.draw.timing).call(t).attr("opacity",1),w.exit().attr("opacity",0).remove(),m},i.visualization.bubbles.fill=!0,i.visualization.bubbles.requirements=["data"],i.visualization.bubbles.scale=1.05,i.visualization.bubbles.shapes=["circle","donut"],i.visualization.bubbles.tooltip="static",i.visualization.chart=function(e){function t(t,a){t.attr("stroke",e.axes.ticks.color).attr("stroke-width",e.axes.ticks.width).attr("shape-rendering",e.shape.rendering.value).style("opacity",function(t){var i="log"==e[a].scale.value&&"1"!=t.toString().charAt(0);return i?.25:1})}function a(t,a){t.attr("x1",function(t){return"x"==a?e.x_scale(t):0}).attr("x2",function(t){return"x"==a?e.x_scale(t):s.width}).attr("y1",function(t){return"y"==a?e.y_scale(t):0}).attr("y2",function(t){return"y"==a?e.y_scale(t):s.height})}function l(e){return"number"==typeof e||"string"==typeof e?null:d3.keys(e)[0]}function n(e){if("number"==typeof e)return e;if("string"==typeof e)return parseFloat(e);var t=e[d3.keys(e)[0]];return"string"==typeof t?parseFloat(t):t}function r(t,a){t.attr("x1",function(e){return"y"==a?0:e.d3plus.x-s.margin.left}).attr("x2",function(e){return"y"==a?-5:e.d3plus.x-s.margin.left}).attr("y1",function(e){return"x"==a?s.height:e.d3plus.y-s.margin.top}).attr("y2",function(e){return"x"==a?s.height+5:e.d3plus.y-s.margin.top}).style("stroke",function(t){return i.color.legible(i.variable.color(e,t))}).style("stroke-width",e.data.stroke.width).attr("shape-rendering",e.shape.rendering.value)}function o(t){function a(e){e.attr("x2",function(e){var t="x"==e.axis?e.x:e.x-e.r;return t}).attr("y2",function(e){var t="y"==e.axis?e.y:e.y+e.r;return t}).style("stroke-width",0).attr("opacity",0)}var l=d3.event.type==i.evt.click&&(e.tooltip.value.long||e.tooltip.html.value),n=[i.evt.over,i.evt.move].indexOf(d3.event.type)>=0;if(!l&&n&&"area"!=e.shape.value){if(t.data)var t=t.data;var r=[i.util.copy(t.d3plus),i.util.copy(t.d3plus)];r[0].axis="x",r[1].axis="y"}else var r=[];var o=S.selectAll("line.d3plus_axis_label").data(r,function(e){return e.axis+"_"+e.id});o.enter().append("line").attr("class","d3plus_axis_label").call(a).attr("x1",function(e){return"x"==e.axis?e.x:e.x-e.r}).attr("y1",function(e){return"y"==e.axis?e.y:e.y+e.r}).style("stroke",function(){return i.variable.color(e,t)}).attr("shape-rendering",e.shape.rendering.value),o.transition().duration(e.timing.mouseevents).attr("class","d3plus_axis_label").attr("x2",function(t){return"x"==t.axis?t.x:s.margin.left-e.axes.ticks.size}).attr("y2",function(t){return"y"==t.axis?t.y:s.height+s.margin.top+e.axes.ticks.size}).style("stroke",function(){return i.color.legible(i.variable.color(e,t))}).style("stroke-width",e.data.stroke.width).attr("opacity",1),o.exit().transition().duration(e.timing.mouseevents).call(a).remove();var u=S.selectAll("text.d3plus_axis_label").data(r,function(e){return e.axis+"_"+e.id});u.enter().append("text").attr("class","d3plus_axis_label").attr("id",function(e){return e.axis+"_"+e.id}).text(function(a){var l=i.variable.value(e,t.d3plus_data||t,e[a.axis].value);return e.format.value(l,e[a.axis].value)}).attr("x",function(t){return"x"==t.axis?t.x:s.margin.left-5-e.axes.ticks.size}).attr("y",function(t){return"y"==t.axis?t.y:s.height+s.margin.top+5+e.axes.ticks.size}).attr("dy",function(t){return"y"==t.axis?.35*e.axes.ticks.font.size:e.axes.ticks.font.size}).attr("text-anchor",function(e){return"y"==e.axis?"end":"middle"}).style("fill",function(){return i.color.legible(i.variable.color(e,t))}).style("font-size",e.axes.ticks.font.size).attr("font-family",e.axes.ticks.font.family.value).attr("font-weight",e.axes.ticks.font.weight).attr("opacity",0),u.transition().duration(e.timing.mouseevents).delay(e.timing.mouseevents).attr("opacity",1),u.exit().transition().duration(e.timing.mouseevents).attr("opacity",0).remove();var d=S.selectAll("rect.d3plus_axis_label").data(r,function(e){return e.axis+"_"+e.id});d.enter().insert("rect","text").attr("class","d3plus_axis_label").attr("x",function(t){var a=d3.select("text#"+t.axis+"_"+t.id).node().getBBox().width,i="x"==t.axis?t.x:s.margin.left-e.axes.ticks.size;return"x"==t.axis?i-a/2-5:i-a-10}).attr("y",function(t){var a=d3.select("text#"+t.axis+"_"+t.id).node().getBBox().height,i="y"==t.axis?t.y:s.height+s.margin.top;return"x"==t.axis?i+e.axes.ticks.size:i-a/2-5}).attr("width",function(e){var t=d3.select("text#"+e.axis+"_"+e.id).node().getBBox();return t.width+10}).attr("height",function(e){var t=d3.select("text#"+e.axis+"_"+e.id).node().getBBox();return t.height+10}).style("stroke",function(){return i.color.legible(i.variable.color(e,t))}).style("fill","white").style("stroke-width",e.data.stroke.width).attr("shape-rendering",e.shape.rendering.value).attr("opacity",0),d.transition().duration(e.timing.mouseevents).delay(e.timing.mouseevents).attr("opacity",1),d.exit().transition().duration(e.timing.mouseevents).attr("opacity",0).remove()}if(e.small)var s={margin:{top:0,right:0,bottom:0,left:0}};else var s={margin:{top:10,right:10,bottom:40,left:40}};if(s.width=e.width.viz-s.margin.left-s.margin.right,s.height=e.height.viz-s.margin.top-s.margin.bottom,e.data.app.length){if(e.tickValues||(e.tickValues={}),e.continuous_axis=null,e.opp_axis=null,e.stacked_axis=null,e.axes.values.forEach(function(t){if(e[t].stacked.value&&(e.stacked_axis=t),e.continuous_axis||"continuous"!=e[t].scale.value||(e.continuous_axis=t,e.opp_axis="x"==t?"y":"x"),e.data.changed||e.depth.changed||!e[t+"_range"]||e.time.fixed.value){if(e.dev.value&&i.console.time("determining "+t+"-axis"),"share"==e[t].scale.value)e[t+"_range"]=[0,1],e.tickValues[t]=i.util.buckets([0,1],11),e.stacked_axis=t;else if(e[t].stacked.value){if(e.time.fixed.value)var a=e.data.app;else var a=e.data.value;var l=d3.nest().key(function(t){return t[e.x.value]}).rollup(function(a){return d3.sum(a,function(a){return parseFloat(i.variable.value(e,a,e[t].value))})}).entries(a);e[t+"_range"]=[0,d3.max(l,function(e){return e.values})]}else if(e[t].domain instanceof Array)e[t+"_range"]=e[t].domain,e.tickValues[t]=i.util.uniques(e.data.app,e[t].value),e.tickValues[t]=e.tickValues[t].filter(function(a){return a>=e[t+"_range"][0]&&a<=e[t+"_range"][1]});else if(e.time.fixed.value)e[t+"_range"]=d3.extent(e.data.app,function(a){return parseFloat(i.variable.value(e,a,e[t].value))}),e.tickValues[t]=i.util.uniques(e.data.app,e[t].value);else{var n=[];for(id in e.id.nesting)n=n.concat(e.data.grouped[e.id.nesting[id]].all);e[t+"_range"]=d3.extent(n,function(a){return parseFloat(i.variable.value(e,a,e[t].value))}),e.tickValues[t]=i.util.uniques(e.data.value,e[t].value)}e[t+"_range"][0]==e[t+"_range"][1]&&(e[t+"_range"][0]-=1,e[t+"_range"][1]+=1),"y"==t&&(e.y_range=e.y_range.reverse()),e.dev.value&&i.console.timeEnd("determining "+t+"-axis")}else e[t+"_range"]||(e[t+"_range"]=[-1,1])}),e.axes.mirror.value){var u=e.y_range.concat(e.x_range);e.x_range=d3.extent(u),e.y_range=d3.extent(u).reverse()}e.dev.value&&i.console.time("removing data outside of axes");var c=e.data.app.length;if("share"==e.y.scale.value)var v=e.data.app;else var v=e.data.app.filter(function(t){var a=parseFloat(i.variable.value(e,t,e.y.value)),l=null!==a&&a<=e.y_range[0]&&a>=e.y_range[1];if(l){var a=parseFloat(i.variable.value(e,t,e.x.value));return null!==a&&a>=e.x_range[0]&&a<=e.x_range[1]}return!1});e.dev.value&&i.console.timeEnd("removing data outside of axes");var p=c-v.length;if(p&&e.dev.value&&i.console.log("removed "+p+" nodes"),v){if(e.dev.value&&i.console.time("determining size scale"),e.size.value){if(e.time.fixed.value)var f=d3.extent(e.data.app,function(t){var a=i.variable.value(e,t,e.size.value);return 0==a?null:a});else{var h=[];for(id in e.id.nesting)h=h.concat(e.data.grouped[e.id.nesting[id]].all);var f=d3.extent(h,function(t){var a=i.variable.value(e,t,e.size.value);return 0==a?null:a})}f[0]&&f[1]||(f=[0,0])}else var f=[0,0];var g=Math.floor(d3.max([d3.min([s.width,s.height])/15,10])),m=10;if(f[0]==f[1])var m=g;var y=[m,g],x=e.size.scale.value.domain(f).rangeRound(y);e.dev.value&&i.console.timeEnd("determining size scale")}e.axes.values.forEach(function(t){var a="x"==t?s.width:s.height;if(["continuous","share"].indexOf(e[t].scale.value)>=0)var i="linear";else var i=e[t].scale.value;if(e[t+"_scale"]=d3.scale[i]().domain(e[t+"_range"]).rangeRound([0,a]),["square","circle","donut"].indexOf(e.shape.value)>=0&&["share"].indexOf(e[t].scale.value)<0){var l=e[t+"_scale"],n=2*x.range()[1],r=l.invert(-n),o=l.invert(a+n);e[t+"_scale"].domain([r,o])}var u="x"==t?"bottom":"left";e[t+"_axis"]=d3.svg.axis().tickSize(e.axes.ticks.size).tickPadding(5).orient(u).scale(e[t+"_scale"]).tickFormat(function(a){var i=!0;if(e[t].value==e.time.value&&a%1!=0&&(i=!1),("log"==e[t].scale.value&&"1"==a.toString().charAt(0)||"log"!=e[t].scale.value)&&i){if("share"==e[t].scale.value)var l=100*a+"%";else var l=e.format.value(a,e[t].value);if(d3.select(this).style("font-size",e.axes.ticks.font.size).style("fill",e.axes.ticks.font.color).attr("font-family",e.axes.ticks.font.family.value).attr("font-weight",e.axes.ticks.font.weight).text(l),"x"==t){var n=this.getBBox().width,r=this.getBBox().height;d3.select(this).attr("transform","translate(18,8)rotate(70)");var o=Math.ceil(Math.cos(25)*n+5);o>s.yoffset&&!e.small&&(s.yoffset=o);var u=Math.ceil(Math.cos(25)*r+5);u>s.rightoffset&&!e.small&&(s.rightoffset=u)}else{var u=this.getBBox().width;u>s.offset&&!e.small&&(s.offset=u)}}else var l=null;return l}),"continuous"==e[t].scale.value&&e.tickValues[t]&&e[t+"_axis"].tickValues(e.tickValues[t])})}if(!v)var v=[];var b=e.group.selectAll("g#plane").data(["plane"]);b.enter().append("g").attr("id","plane").attr("transform","translate("+s.margin.left+","+s.margin.top+")");var w=b.selectAll("rect#background").data(["background"]);w.enter().append("rect").attr("id","background").attr("x",0).attr("y",0).attr("width",s.width).attr("height",s.height).attr("stroke-width",1).attr("stroke","#ccc").attr("shape-rendering",e.shape.rendering.value).style("fill","#fafafa");var _=b.selectAll("path#mirror").data(["mirror"]);_.enter().append("path").attr("id","mirror").attr("fill","#000").attr("fill-opacity",.03).attr("stroke-width",1).attr("stroke","#ccc").attr("stroke-dasharray","10,10").attr("opacity",0);var z=e.group.selectAll("g#axes").data(["axes"]);z.enter().append("g").attr("id","axes");var k=b.selectAll("g#xgrid").data(["xgrid"]);k.enter().append("g").attr("id","xgrid");var A=b.selectAll("g#ygrid").data(["ygrid"]);A.enter().append("g").attr("id","ygrid");var E=b.selectAll("g#xaxis").data(["xaxis"]);E.enter().append("g").attr("id","xaxis").attr("transform","translate(0,"+s.height+")");var O=b.selectAll("g#yaxis").data(["yaxis"]);O.enter().append("g").attr("id","yaxis");var j=z.selectAll("text#xlabel").data(e.small?[]:["xlabel"]);j.enter().append("text").attr("id","xlabel").attr("x",e.width.viz/2).attr("y",e.height.viz-10).text(e.format.value(e.x.value)).attr("font-family",e.labels.font.family.value).attr("font-weight",e.labels.font.weight).attr("font-size",e.labels.font.size).attr("fill",e.labels.font.color).attr("text-anchor",e.labels.font.align),j.exit().remove();var F=z.selectAll("text#ylabel").data(e.small?[]:["ylabel"]);F.enter().append("text").attr("id","ylabel").attr("y",15).attr("x",-(s.height/2+s.margin.top)).text(e.format.value(e.y.value)).attr("transform","rotate(-90)").attr("font-family",e.labels.font.family.value).attr("font-weight",e.labels.font.weight).attr("font-size",e.labels.font.size).attr("fill",e.labels.font.color).attr("text-anchor",e.labels.font.align),F.exit().remove();var S=e.group.selectAll("g#mouseevents").data(["mouseevents"]);S.enter().append("g").attr("id","mouseevents"),s.offset=0,O.call(e.y_axis).selectAll("line").call(t,"y"),s.margin.left+=s.offset,s.width-=s.offset,e.x_scale.rangeRound([0,s.width]),s.yoffset=0,s.rightoffset=0,E.call(e.x_axis).selectAll("line").call(t,"x"),s.height-=s.yoffset,s.width-=s.rightoffset,e.x_scale.rangeRound([0,s.width]),e.y_scale.rangeRound([0,s.height]),O.call(e.y_axis),E.call(e.x_axis),b.transition().duration(e.draw.timing).attr("transform","translate("+s.margin.left+","+s.margin.top+")"),w.attr("width",s.width).attr("height",s.height),_.transition().duration(e.draw.timing).attr("opacity",function(){return e.axes.mirror.value?1:0}).attr("d",function(){var e=s.width,t=s.height;return"M "+e+" "+t+" L 0 "+t+" L "+e+" 0 Z"}),O.transition().duration(e.draw.timing).call(e.y_axis.scale(e.y_scale)),O.selectAll("line").transition().duration(e.draw.timing).call(t,"y"),O.selectAll("path").style("fill","none"),E.transition().duration(e.draw.timing).attr("transform","translate(0,"+s.height+")").call(e.x_axis.scale(e.x_scale)).selectAll("g.tick").select("text").style("text-anchor","start"),E.selectAll("line").transition().duration(e.draw.timing).call(t,"x"),E.selectAll("path").style("fill","none");var B="continuous"==e.y.scale.value?e.y_scale.ticks(e.tickValues.y.length):e.y_scale.ticks(),C=A.selectAll("line").data(B);C.enter().append("line").style("opacity",0).call(a,"y").call(t,"y"),C.transition().duration(e.draw.timing).style("opacity",1).call(a,"y").call(t,"y"),C.exit().transition().duration(e.draw.timing).style("opacity",0).remove();var M="continuous"==e.x.scale.value?e.x_scale.ticks(e.tickValues.x.length):e.x_scale.ticks(),q=k.selectAll("line").data(M);q.enter().append("line").style("opacity",0).call(a,"x").call(t,"x"),q.transition().duration(e.draw.timing).style("opacity",1).call(a,"x").call(t,"x"),q.exit().transition().duration(e.draw.timing).style("opacity",0).remove(),j.text(e.format.value(e.x.value)).attr("x",e.width.viz/2).attr("y",e.height.viz-10).attr("opacity",function(){return 0==e.data.app.length?0:1}),F.text(e.format.value(e.y.value)).attr("y",15).attr("x",-(s.height/2+s.margin.top)).attr("opacity",function(){return 0==e.data.app.length?0:1}),e.axes.values.forEach(function(t){var a=b.selectAll("g.d3plus_"+t+"line").data(e[t].lines,function(e){return"number"==typeof e||"string"==typeof e?e:d3.keys(e)[0]}),i=a.enter().append("g").attr("class","d3plus_"+t+"line"),r="x"==t?"height":"width",o="x"==t?s.height-8+"px":"10px",u="x"==t?10:20;i.append("line").attr(t+"1",0).attr(t+"2",s[r]).attr("stroke","#ccc").attr("stroke-width",3).attr("stroke-dasharray","10,10"),i.append("text").style("font-size",e.axes.ticks.font.size).style("fill",e.axes.ticks.font.color).attr("text-align","start").attr(t,o),a.selectAll("line").transition().duration(e.draw.timing).attr(t+"1",function(a){return n(a)?e[t+"_scale"](n(a)):0}).attr(t+"2",function(a){return n(a)?e[t+"_scale"](n(a)):0}).attr("opacity",function(a){var i=n(a)>e[t+"_scale"].domain()[1]&&n(a)<e[t+"_scale"].domain()[0];return null!==n(a)&&i?1:0}),a.selectAll("text").transition().duration(e.draw.timing).text(function(){if(null!==n(d)){var t=e.format.value(n(d),y_name);return l(d)?e.format.value(l(d))+": "+t:t}return null}).attr(t,function(a){return e[t+"_scale"](n(a))+u+"px"})}),["line","area"].indexOf(e.shape.value)>=0&&x.rangeRound([2,2]),e.axis_offset={x:s.margin.left,y:s.margin.top},v.forEach(function(t){t.d3plus.x=e.x_scale(i.variable.value(e,t,e.x.value)),t.d3plus.x+=e.axis_offset.x,t.d3plus.r=x(i.variable.value(e,t,e.size.value)),e.stacked_axis||(t.d3plus.y=e.y_scale(i.variable.value(e,t,e.y.value)),t.d3plus.y+=e.axis_offset.y,"area"==e.shape.value&&(t.d3plus[e.opp_axis+"0"]=e[e.opp_axis+"_scale"].range()[1],t.d3plus[e.opp_axis+"0"]+=e.axis_offset[e.opp_axis]))});var T=e.order.value?e.order.value:e.continuous_axis?e[e.opp_axis].value:e.size.value||e.id.value;if(["line","area"].indexOf(e.shape.value)>=0&&(v=d3.nest().key(function(t){var a=i.variable.value(e,t,e.id.value),l=t.d3plus.depth?t.d3plus.depth:0;return i.string.strip(a)+"_"+l+"_"+e.shape.value
}).rollup(function(t){var a=i.util.uniques(t,e[e.continuous_axis].value),l=!1;return e.tickValues[e.continuous_axis].forEach(function(n,r,o){if(a.indexOf(n)<0){var s={};if(s[e[e.continuous_axis].value]=n,s[e.id.value]=t[0][e.id.value],s[e[e.opp_axis].value]=e[e.opp_axis+"_scale"].domain()[1],s.d3plus={},s.d3plus.r=x(x.domain()[0]),s.d3plus[e.continuous_axis]+=e.axis_offset[e.continuous_axis],e.stacked_axis||(s.d3plus[e.opp_axis]=e[e.opp_axis+"_scale"].range()[1],s.d3plus[e.opp_axis]+=e.axis_offset[e.opp_axis],s.d3plus[e.opp_axis+"0"]=s.d3plus[e.opp_axis]),e[e.continuous_axis].zerofill.value||e[e.opp_axis].stacked.value){var u=e[e.continuous_axis+"_scale"](n);u+=e.axis_offset[e.continuous_axis],s.d3plus[e.continuous_axis]=u,t.push(s)}else if("line"!=e.shape.value){if(!l&&r>0){var u=e[e.continuous_axis+"_scale"](o[r-1]);u+=e.axis_offset[e.continuous_axis],s.d3plus[e.continuous_axis]=u,t.push(s)}if(r<o.length-1){var u=e[e.continuous_axis+"_scale"](o[r+1]);u+=e.axis_offset[e.continuous_axis];var d=i.util.copy(s);d.d3plus[e.continuous_axis]=u,t.push(d)}}l=!0}else l=!1}),t.sort(function(t,a){var i=t.d3plus[e.continuous_axis]-a.d3plus[e.continuous_axis];if(i)return i;var l=t[e[e.continuous_axis].value]-a[e[e.continuous_axis].value];return l}),t}).entries(v),v.forEach(function(t){e.id.nesting.forEach(function(a,l){l<=e.depth.value&&!t[a]&&(t[a]=i.util.uniques(t.values,a).filter(function(e){return e&&"undefined"!=e})[0])}),T in t||(t[T]=0,t.values.forEach(function(a){var l=i.variable.value(e,a,T);l&&("number"==typeof l?t[T]+=l:t[T]=l)}))})),T&&i.array.sort(v,T,"desc"===e.order.sort.value?"asc":"desc",e.color.value||[],e),e.stacked_axis)var N=d3.layout.stack().values(function(e){return e.values}).x(function(e){return e.d3plus.x}).x(function(e){return e.d3plus.y}).y(function(t){var a=s.height,l=i.variable.value(e,t,e.y.value);return a-e.y_scale(l)}).out(function(t,a,i){var l=s.height;"share"==e[e.stacked_axis].scale.value?(t.d3plus.y0=(1-a)*l,t.d3plus.y=t.d3plus.y0-i*l):(t.d3plus.y0=l-a,t.d3plus.y=t.d3plus.y0-i),t.d3plus.y+=s.margin.top,t.d3plus.y0+=s.margin.top}),P="share"==e[e.stacked_axis].scale.value?"expand":"zero",v=N.offset(P)(v);else if(["area","line"].indexOf(e.shape.value)<0){var L=b.selectAll("g.d3plus_data_ticks").data(v,function(t){return t[e.id.value]+"_"+t.d3plus.depth}),I=L.enter().append("g").attr("class","d3plus_data_ticks").attr("opacity",0);I.append("line").attr("class","d3plus_data_y").call(r,"y"),L.selectAll("line.d3plus_data_y").call(r,"y"),I.append("line").attr("class","d3plus_data_x").call(r,"x"),L.selectAll("line.d3plus_data_x").call(r,"x"),L.transition().duration(e.draw.timing).attr("opacity",1),L.exit().transition().duration(e.draw.timing).attr("opacity",0).remove()}return e.mouse=o,v},i.visualization.chart.fill=!0,i.visualization.chart.requirements=["data","x","y"],i.visualization.chart.scale={circle:1.1,donut:1.1,square:1.1},i.visualization.chart.shapes=["circle","donut","line","square","area"],i.visualization.chart.tooltip="static",i.visualization.geo_map=function(e){topojson.presimplify(e.coords.value);var t=e.coords.value,a=d3.keys(t.objects)[0],i=topojson.feature(t,t.objects[a]),l=i.features,l=l.filter(function(t){return t[e.id.value]=t.id,e.coords.solo.value.length?e.coords.solo.value.indexOf(t.id)>=0:e.coords.mute.value.length?e.coords.mute.value.indexOf(t.id)<0:!0});return l},i.visualization.geo_map.libs=["topojson"],i.visualization.geo_map.nesting=!1,i.visualization.geo_map.requirements=["color","coords"],i.visualization.geo_map.scale=1,i.visualization.geo_map.shapes=["coordinates"],i.visualization.geo_map.tooltip="follow",i.visualization.geo_map.zoom=!0,i.visualization.line=function(e){return i.visualization.chart(e)},i.visualization.line.requirements=["data","x","y"],i.visualization.line.setup=function(e){e.self.x({scale:"continuous"})},i.visualization.line.shapes=["line"],i.visualization.line.tooltip="static",i.visualization.network=function(e){var t=e.nodes.restricted||e.nodes.value,a=e.edges.restricted||e.edges.value,l=d3.extent(t,function(e){return e.x}),n=d3.extent(t,function(e){return e.y}),r=e.size.value?d3.extent(t,function(t){var a=i.variable.value(e,t,e.size.value);return 0===a?null:a}):[1,1];"undefined"==typeof r[0]&&(r=[1,1]);var o=d3.min(i.util.distances(t));if(o*=e.nodes.overlap,e.edges.arrows.value&&(o=.5*o),r[0]===r[1])var s=o;else{var u=l[1]+1.1*o-(l[0]-1.1*o),d=n[1]+1.1*o-(n[0]-1.1*o);if(aspect=u/d,app=e.width.viz/e.height.viz,app>aspect)var c=e.height.viz/d;else var c=e.width.viz/u;var s=.25*o;2>s*c&&(s=2/c)}var v=e.size.scale.value.domain(r).range([s,o]);e.zoom.bounds=[[l[0]-1.1*o,n[0]-1.1*o],[l[1]+1.1*o,n[1]+1.1*o]];var p=[],f={};return t.forEach(function(t){var a=e.data.app.filter(function(a){return a[e.id.value]==t[e.id.value]})[0];if(a)var l=i.object.merge(t,a);else var l=i.util.copy(t);l.d3plus={},l.d3plus.x=t.x,l.d3plus.y=t.y;var n=i.variable.value(e,l,e.size.value);l.d3plus.r=n?v(n):v.range()[0],f[l[e.id.value]]={x:l.d3plus.x,y:l.d3plus.y,r:l.d3plus.r},p.push(l)}),p.sort(function(e,t){return t.d3plus.r-e.d3plus.r}),a.forEach(function(t){t[e.edges.source]=i.util.copy(t[e.edges.source]),t[e.edges.source].d3plus={};var a=f[t[e.edges.source][e.id.value]];t[e.edges.source].d3plus.r=a.r,t[e.edges.source].d3plus.x=a.x,t[e.edges.source].d3plus.y=a.y,t[e.edges.target]=i.util.copy(t[e.edges.target]),t[e.edges.target].d3plus={};var l=f[t[e.edges.target][e.id.value]];t[e.edges.target].d3plus.r=l.r,t[e.edges.target].d3plus.x=l.x,t[e.edges.target].d3plus.y=l.y}),{nodes:p,edges:a}},i.visualization.network.nesting=!1,i.visualization.network.requirements=["nodes","edges"],i.visualization.network.scale=1.05,i.visualization.network.shapes=["circle","square","donut"],i.visualization.network.tooltip="static",i.visualization.network.zoom=!0,i.visualization.rings=function(e){var t=d3.min([e.height.viz,e.width.viz])/2,l=e.small||!e.labels.value?(t-2*e.labels.padding)/2:t/3,n=e.small||!e.labels.value?1.4*l:l,r=2*l,o=[],s=[],u=e.data.app.filter(function(t){return t[e.id.value]===e.focus.value})[0];u||(u={d3plus:{}},u[e.id.value]=e.focus.value),u.d3plus.x=e.width.viz/2,u.d3plus.y=e.height.viz/2,u.d3plus.r=.65*n;var d=[],c=[e.focus.value];e.edges.connections(e.focus.value,e.id.value).forEach(function(t){var a=t[e.edges.source][e.id.value]==e.focus.value?t[e.edges.target]:t[e.edges.source],i=e.data.app.filter(function(t){return t[e.id.value]===a[e.id.value]})[0];i||(i={d3plus:{}},i[e.id.value]=a[e.id.value]),i.d3plus.edges=e.edges.connections(i[e.id.value],e.id.value).filter(function(t){return t[e.edges.source][e.id.value]!=e.focus.value&&t[e.edges.target][e.id.value]!=e.focus.value}),i.d3plus.edge=t,c.push(i[e.id.value]),d.push(i)});var v=e.order.value||e.color.value||e.size.value||e.id.value;d.sort(function(t,a){var l=t.d3plus.edges.length-a.d3plus.edges.length;return l?l:i.array.sort([t,a],v,e.order.sort.value,e.color.value||[],e)}),"number"==typeof e.edges.limit?d=d.slice(0,e.edges.limit):"function"==typeof e.edges.limit&&(d=e.edges.limit(d));var p=[],f=0;d.forEach(function(t){var a=t[e.id.value];t.d3plus.edges=t.d3plus.edges.filter(function(t){var i=t[e.edges.source][e.id.value],l=t[e.edges.target][e.id.value];return c.indexOf(i)<0&&l==a||c.indexOf(l)<0&&i==a}),f+=t.d3plus.edges.length||1,t.d3plus.edges.forEach(function(t){var i=t[e.edges.source],l=t[e.edges.target],n=l[e.id.value]==a?i:l;c.push(n[e.id.value])})}),i.array.sort(d,v,e.order.sort.value,e.color.value||[],e);var h=0,g=2*Math.PI,m=0;d.forEach(function(t,l){var o=t.d3plus.edges.length||1,s=g/f*o;0==l&&(m=u,h-=s/2);var u=h+s/2;u-=g/4,t.d3plus.radians=u,t.d3plus.x=e.width.viz/2+n*Math.cos(u),t.d3plus.y=e.height.viz/2+n*Math.sin(u),h+=s,t.d3plus.edges.sort(function(a,l){var a=a[e.edges.source][e.id.value]==t[e.id.value]?a[e.edges.target]:a[e.edges.source],l=l[e.edges.source][e.id.value]==t[e.id.value]?l[e.edges.target]:l[e.edges.source];return i.array.sort([a,l],v,e.order.sort.value,e.color.value||[],e)}),t.d3plus.edges.forEach(function(i,l){var n=i[e.edges.source][e.id.value]==t[e.id.value]?i[e.edges.target]:i[e.edges.source],s=g/f,d=e.data.app.filter(function(t){return t[e.id.value]===n[e.id.value]})[0];d||(d={d3plus:{}},d[e.id.value]=n[e.id.value]),a=u-s*o/2+s/2+s*l,d.d3plus.radians=a,d.d3plus.x=e.width.viz/2+r*Math.cos(a),d.d3plus.y=e.height.viz/2+r*Math.sin(a),p.push(d)})});var y=d3.min(i.util.distances(d,function(e){return[e.d3plus.x,e.d3plus.y]})),x=d3.min(i.util.distances(p,function(e){return[e.d3plus.x,e.d3plus.y]}));if(y||(y=l/2),x||(x=l/4),8>y/2-4)var b=d3.min([y/2,8]);else var b=y/2-4;if(4>x/2-4)var w=d3.min([x/2,4]);else var w=x/2-4;w>l/10&&(w=l/10),w>b?w=.75*b:b>1.5*w&&(b=1.5*w),b=Math.floor(b),w=Math.floor(w);var _=i.util.uniques(d,e.id.value);_=_.concat(i.util.uniques(p,e.id.value)),_.push(e.focus.value);var z=e.data.app.filter(function(t){return _.indexOf(t[e.id.value])>=0});if(e.size.value){var k=d3.extent(z,function(t){return i.variable.value(e,t,e.size.value)});k[0]==k[1]&&(k[0]=0);var t=d3.scale.linear().domain(k).rangeRound([3,d3.min([b,w])]),A=i.variable.value(e,u,e.size.value);u.d3plus.r=t(A)}else{var t=d3.scale.linear().domain([1,2]).rangeRound([b,w]);e.edges.label&&(u.d3plus.r=1.5*t(1))}return p.forEach(function(a){a.d3plus.ring=2;var l=e.size.value?i.variable.value(e,a,e.size.value):2;a.d3plus.r=t(l)}),d.forEach(function(a){a.d3plus.ring=1;var l=e.size.value?i.variable.value(e,a,e.size.value):1;a.d3plus.r=t(l)}),d.forEach(function(t){var a=[e.edges.source,e.edges.target],l=i.util.copy(t.d3plus.edge);a.forEach(function(a){l[a].d3plus=l[a][e.id.value]==u[e.id.value]?{x:u.d3plus.x,y:u.d3plus.y,r:u.d3plus.r}:{x:t.d3plus.x,y:t.d3plus.y,r:t.d3plus.r}}),delete l.d3plus,o.push(l),e.edges.connections(t[e.id.value],e.id.value).forEach(function(a){var l=i.util.copy(a),s=l[e.edges.source][e.id.value]==t[e.id.value]?l[e.edges.target]:l[e.edges.source];if(s[e.id.value]!=u[e.id.value]){var c=p.filter(function(t){return t[e.id.value]==s[e.id.value]})[0];if(c)var v=r;else{var v=n;c=d.filter(function(t){return t[e.id.value]==s[e.id.value]})[0]}if(c){l.d3plus={spline:!0,translate:{x:e.width.viz/2,y:e.height.viz/2}};var f=[e.edges.source,e.edges.target];f.forEach(function(a){l[a].d3plus=l[a][e.id.value]==t[e.id.value]?{a:t.d3plus.radians,r:n+t.d3plus.r,depth:1}:{a:c.d3plus.radians,r:v-c.d3plus.r,depth:2}}),o.push(l)}}})}),s=[u].concat(d).concat(p),s.forEach(function(t){if(!e.small&&e.labels.value)if(t[e.id.value]!=e.focus.value){t.d3plus.rotate=t.d3plus.radians*(180/Math.PI);var a=t.d3plus.rotate,r=l-3*e.labels.padding-t.d3plus.r;if(-90>a||a>90){a-=180;var o=-(t.d3plus.r+r/2+e.labels.padding),s="end"}else var o=t.d3plus.r+r/2+e.labels.padding,s="start";var u=d.indexOf(t)>=0?!0:!1,c=1==t.d3plus.ring?y:x;c+=2*e.labels.padding,t.d3plus.label={x:o,y:0,w:r,h:c,angle:a,anchor:s,valign:"center",color:i.color.legible(i.variable.color(e,t[e.id.value])),resize:[8,e.labels.font.size],background:u,mouse:!0}}else if(e.size.value||e.edges.label){var c=n-2*t.d3plus.r-2*e.labels.padding;t.d3plus.label={x:0,y:t.d3plus.r+c/2,w:n,h:c,color:i.color.legible(i.variable.color(e,t[e.id.value])),resize:[10,40],background:!0,mouse:!0}}else delete t.d3plus.rotate,delete t.d3plus.label;else delete t.d3plus.rotate,delete t.d3plus.label}),e.mouse[i.evt.click]=function(t){t[e.id.value]!=e.focus.value&&(i.tooltip.remove(e.type.value),e.self.focus(t[e.id.value]).draw())},{edges:o,nodes:s,data:z}},i.visualization.rings.filter=function(e,t){var a=e.edges.connections(e.focus.value,e.id.value,!0),l=[];a.forEach(function(t){l=l.concat(e.edges.connections(t[e.id.value],e.id.value,!0))});var n=a.concat(l),r=i.util.uniques(n,e.id.value),o=[];return r.forEach(function(a){var i=t.filter(function(t){return t[e.id.value]===a})[0];if(i)o.push(i);else{var l={d3plus:{}};l[e.id.value]=a,o.push(l)}}),o},i.visualization.rings.nesting=!1,i.visualization.rings.scale=1,i.visualization.rings.shapes=["circle","square","donut"],i.visualization.rings.requirements=["edges","focus"],i.visualization.rings.tooltip="static",i.visualization.scatter=function(e){return i.visualization.chart(e)},i.visualization.scatter.fill=!0,i.visualization.scatter.requirements=["data","x","y"],i.visualization.scatter.scale=i.visualization.chart.scale,i.visualization.scatter.shapes=["circle","square","donut"],i.visualization.scatter.tooltip="static",i.visualization.stacked=function(e){return i.visualization.chart(e)},i.visualization.stacked.filter=function(e,t){return i.data.threshold(e,t,e.x.value)},i.visualization.stacked.requirements=["data","x","y"],i.visualization.stacked.setup=function(e){e.self.x({scale:"continuous",zerofill:!0}).y({stacked:!0});var t=e.y,a=e.size;!t.value&&a.value||a.changed&&a.previous===t.value?e.self.y(a.value):(!a.value&&t.value||t.changed&&t.previous===a.value)&&e.self.size(t.value)},i.visualization.stacked.shapes=["area"],i.visualization.stacked.threshold=function(e){return 20/e.height.viz},i.visualization.stacked.tooltip="static",i.visualization.tree_map=function(e){var t=d3.nest();e.id.nesting.forEach(function(a,l){l<e.depth.value&&t.key(function(t){return i.variable.value(e,t.d3plus,a)})});var a=[];e.data.app.forEach(function(t){a.push({d3plus:t,id:t[e.id.value],value:i.variable.value(e,t,e.size.value)})}),t=t.entries(a);var l=d3.layout.treemap().mode(e.type.mode.value).round(!0).size([e.width.viz,e.height.viz]).children(function(e){return e.values}).padding(1).sort(function(e,t){var a=e.value-t.value;return 0===a?e.id<t.id:a}).nodes({name:"root",values:t}).filter(function(e){return!e.values&&e.area});if(l.length){for(var n=l[0];n.parent;)n=n.parent;var r=[];l.forEach(function(e){e.d3plus.d3plus=i.object.merge(e.d3plus.d3plus,{x:e.x+e.dx/2,y:e.y+e.dy/2,width:e.dx,height:e.dy,share:e.value/n.value}),r.push(e.d3plus)})}return r},i.visualization.tree_map.filter=function(e,t){return i.data.threshold(e,t)},i.visualization.tree_map.modes=["squarify","slice","dice","slice-dice"],i.visualization.tree_map.requirements=["data","size"],i.visualization.tree_map.shapes=["square"],i.visualization.tree_map.threshold=function(e){return 1600/(e.width.viz*e.height.viz)},i.visualization.tree_map.tooltip="follow",i.ui.drawer=function(e){var t=e.ui.value&&e.ui.value.length,a=e.ui.position.value,l=0;e.dev.value&&t&&i.console.time("drawing custom UI elements");var n=e.container.value.selectAll("div#d3plus_drawer").data(["d3plus_drawer"]);n.enter().append("div").attr("id","d3plus_drawer").each(function(){l+=2*e.ui.margin});var r={};e.ui.position.accepted.forEach(function(t){r[t]=t==a?e.margin.bottom+"px":"auto"}),n.style("text-align",e.ui.align.value).style("position","absolute").style("width",e.width.value-2*e.ui.padding+"px").style("height","auto").style(r);var o=n.selectAll("div.d3plus_drawer_ui").data(t?e.ui.value:[],function(e){return e.method||!1});o.enter().append("div").attr("class","d3plus_drawer_ui").style("padding",e.ui.padding+"px").style("display","inline-block").each(function(t){var a=d3.select(this);t.form=i.form().container(a).focus(e[t.method].value,function(a){a!==e[t.method].value&&e.self[t.method](a).draw()}).font(e.ui.font).id("id").text("text").type("auto").width(t.width||!1)}),o.each(function(t){var a=[],i=e.format.locale.value.method[t.method]||t.method;t.value.forEach(function(t){var i={id:t,text:e.format.value(t)};a.push(i)}),t.form.data(a).format(e.format.locale.language).title(e.format.value(i)).ui({align:e.ui.align.value,padding:e.ui.padding,margin:e.ui.margin}).draw()}),o.exit().remove();var s=n.node().offsetHeight;s&&(e.margin[a]+=s+l),e.dev.value&&t&&i.console.timeEnd("drawing custom UI elements")},i.ui.focus=function(e){if(!e.internal_error&&e.focus.value&&!e.small&&e.focus.tooltip.value){e.dev.value&&i.console.time("drawing focus tooltip");var t=e.data.pool.filter(function(t){return i.variable.value(e,t,e.id.value)==e.focus.value});t.length>=1?t=t[0]:(t={},t[e.id.value]=e.focus.value);var a=e.labels.padding;i.tooltip.app({anchor:"top left",arrow:!1,data:t,length:"long",fullscreen:!1,id:e.type.value+"_focus",maxheight:e.height.viz-2*a,mouseevents:!0,offset:0,vars:e,x:e.width.value-e.margin.right-a,y:e.margin.top+a,width:e.tooltip.large}),d3.select("div#d3plus_tooltip_id_"+e.type.value+"_focus").empty()||(e.width.viz-=e.tooltip.large+2*a),e.dev.value&&i.console.timeEnd("drawing focus tooltip")}else i.tooltip.remove(e.type.value+"_focus")},i.ui.history=function(e){function t(t){t.style("position","absolute").style("left",e.ui.padding+"px").style("top",e.margin.top/2-l/2+"px").style("color",n).style("font-family",r).style("font-weight",o).style("font-size",l+"px").style("z-index",2e3)}if(!e.small&&e.history.states.length>0){e.dev.value&&i.console.time("drawing back button");var a=e.container.value.selectAll("div#d3plus_back_button").data(["d3plus_back_button"]),l=e.title.value?e.title.font.size:e.title.sub.font.size,n=e.title.sub.value?e.title.sub.font.color:e.title.font.color,r=e.title.sub.value?e.title.sub.font.family.value:e.title.font.family.value,o=e.title.sub.value?e.title.sub.font.weight:e.title.font.weight,s=e.title.sub.value?e.title.sub.padding:e.title.padding,u=l+2*s;e.margin.top<u&&(e.margin.top=u);{a.enter().append("div").attr("id","d3plus_back_button").style("opacity",0).call(t).html(function(){if(i.font.awesome)var t="<span style='font-family:FontAwesome;margin-right:5px;'>&#xf104</span>";else var t="&laquo; ";return t+e.format.value(e.format.locale.value.ui.back)})}a.on(i.evt.over,function(){!e.small&&e.history.states.length>0&&d3.select(this).style("cursor","pointer").transition().duration(e.timing.mouseevents).style("color",i.color.lighter(n,.25))}).on(i.evt.out,function(){!e.small&&e.history.states.length>0&&d3.select(this).style("cursor","auto").transition().duration(e.timing.mouseevents).style("color",n)}).on(i.evt.click,function(){e.history.back()}).transition().duration(e.draw.timing).style("opacity",1).call(t),e.dev.value&&i.console.timeEnd("drawing back button")}else e.container.value.selectAll("div#d3plus_back_button").transition().duration(e.draw.timing).style("opacity",0).remove()},i.ui.legend=function(e){function t(t){t.attr("transform",function(t,a){var i=y+a*(e.ui.padding+n);return"translate("+i+","+e.ui.padding+")"})}function a(t){t.attr("width",n).attr("height",n).attr("fill",function(t){d3.select(this.parentNode).selectAll("text").remove();var a=i.variable.value(e,t,e.icon.value,e.id.nesting[t.d3plus.depth]),l=i.variable.color(e,t,e.id.nesting[t.d3plus.depth]);if(a){var r=i.string.strip(a+"_"+l),o=e.defs.selectAll("pattern#"+r).data([r]);if("string"==typeof e.icon.style.value)var s=e.icon.style.value;else if("object"==typeof e.icon.style.value&&e.icon.style.value[icon_depth])var s=e.icon.style.value[icon_depth];else var s="default";var l="knockout"==s?l:"none";o.select("rect").transition().duration(e.draw.timing).attr("fill",l).attr("width",n).attr("height",n),o.select("image").transition().duration(e.draw.timing).attr("width",n).attr("height",n);var u=o.enter().append("pattern").attr("id",r).attr("width",n).attr("height",n);return u.append("rect").attr("fill",l).attr("width",n).attr("height",n),u.append("image").attr("xlink:href",a).attr("width",n).attr("height",n).each(function(){0==a.indexOf("/")||a.indexOf(window.location.hostname)>=0?i.util.dataurl(a,function(e){o.select("image").attr("xlink:href",e)}):o.select("image").attr("xlink:href",a)}),"url(#"+r+")"}var d=d3.select(this.parentNode).append("text");return d.attr("font-size",e.legend.font.size).attr("font-weight",e.legend.font.weight).attr("font-family",e.legend.font.family.value).attr("text-anchor","start").attr("fill",i.color.text(l)).attr("x",0).attr("y",0).each(function(){var a=i.variable.text(e,t,t.d3plus.depth);1===a.length&&a[0].length&&i.textwrap().container(d3.select(this)).height(n-2*e.ui.padding).resize(e.labels.resize.value).text(a[0]).width(n-2*e.ui.padding).draw()}).attr("y",function(){var e=this.getBBox().height,t=parseFloat(d3.select(this).style("font-size"),10)/5;return n/2-e/2-t/2}).selectAll("tspan").attr("x",function(){var e=this.getComputedTextLength();return n/2-e/2}),d.select("tspan").empty()&&d.remove(),l})}var l=!0,n=0,r=e.color.value||e.id.value,o=e.color.value||"d3plus_color";if(!e.small&&e.legend.value&&r)if(e.color.scale)if(e.color.scale){e.dev.value&&i.console.time("drawing color scale"),e.g.legend.selectAll("g.d3plus_color").transition().duration(e.draw.timing).attr("opacity",0).remove();var s=e.color.scale.domain(),u=e.color.scale.range();s.length<=2&&(s=i.util.buckets(s,6));var c=e.g.legend.selectAll("g.d3plus_scale").data(["scale"]);c.enter().append("g").attr("class","d3plus_scale").attr("opacity",0);var v=c.selectAll("#d3plus_legend_heatmap").data(["heatmap"]);v.enter().append("linearGradient").attr("id","d3plus_legend_heatmap").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","0%").attr("spreadMethod","pad");var p=v.selectAll("stop").data(d3.range(0,u.length));p.enter().append("stop").attr("stop-opacity",1),p.attr("offset",function(e){return Math.round(e/(u.length-1)*100)+"%"}).attr("stop-color",function(e){return u[e]}),p.exit().remove();var f=c.selectAll("rect#gradient").data(["gradient"]);f.enter().append("rect").attr("id","gradient").attr("x",function(){return"middle"==e.legend.align?e.width.value/2:"end"==e.legend.align?e.width.value:0}).attr("y",e.ui.padding).attr("width",0).attr("height",e.legend.gradient.height).attr("stroke",e.legend.font.color).attr("stroke-width",1).style("fill","url(#d3plus_legend_heatmap)");var h=c.selectAll("text.d3plus_tick").data(d3.range(0,s.length));h.enter().append("text").attr("class","d3plus_tick").attr("x",function(){return"middle"==e.legend.align?e.width.value/2:"end"==e.legend.align?e.width.value:0}).attr("y",function(){return this.getBBox().height+e.legend.gradient.height+2*e.ui.padding});var g=0;h.order().attr("font-weight",e.legend.font.weight).attr("font-family",e.legend.font.family.value).attr("font-size",e.legend.font.size).attr("text-anchor",e.legend.font.align).attr("fill",e.legend.font.color).text(function(t){return e.format.value(s[t],r)}).attr("y",function(){return this.getBBox().height+e.legend.gradient.height+2*e.ui.padding}).each(function(){var e=this.offsetWidth;e>g&&(g=e)}),g+=2*e.labels.padding;var m=g*(s.length-1);if(m+g<e.width.value){if(m+g<e.width.value/2&&(m=e.width.value/2,g=m/s.length,m-=g),"start"==e.legend.align)var y=e.ui.padding;else if("end"==e.legend.align)var y=e.width.value-e.ui.padding-m;else var y=e.width.value/2-m/2;h.transition().duration(e.draw.timing).attr("x",function(e){return y+g*e}),h.exit().transition().duration(e.draw.timing).attr("opacity",0).remove();var x=c.selectAll("rect.d3plus_tick").data(d3.range(0,s.length));x.enter().append("rect").attr("class","d3plus_tick").attr("x",function(){return"middle"==e.legend.align?e.width.value/2:"end"==e.legend.align?e.width.value:0}).attr("y",e.ui.padding).attr("width",0).attr("height",e.ui.padding+e.legend.gradient.height).attr("fill",e.legend.font.color),x.transition().duration(e.draw.timing).attr("x",function(e){var t=0==e?1:0;return y+g*e-t}).attr("y",e.ui.padding).attr("width",1).attr("height",e.ui.padding+e.legend.gradient.height).attr("fill",e.legend.font.color),x.exit().transition().duration(e.draw.timing).attr("width",0).remove(),f.transition().duration(e.draw.timing).attr("x",function(){return"middle"==e.legend.align?e.width.value/2-m/2:"end"==e.legend.align?e.width.value-m-e.ui.padding:e.ui.padding}).attr("y",e.ui.padding).attr("width",m).attr("height",e.legend.gradient.height),c.transition().duration(e.draw.timing).attr("opacity",1),e.dev.value&&i.console.timeEnd("drawing color scale")}else l=!1}else l=!1;else{if(e.dev.value&&i.console.time("grouping data by colors"),e.nodes.value&&i.visualization[e.type.value].requirements.indexOf("nodes")>=0){var b=e.nodes.restriced||e.nodes.value;if(e.data.app.length)for(var w=0;w<b.length;w++){var _=e.data.app.filter(function(t){return t[e.id.value]===b[w][e.id.value]});_.length&&(b[w]=i.object.merge(b[w],_[0]))}}else var b=e.data.app;for(var z=0;z<b.length;z++){d=b[z];for(var w=0;w<e.id.nesting.length;w++){var k=e.id.nesting[w];if(!(k in d)){var A=e.id.nesting[w+1];d[k]=i.variable.value(e,d[A],k,A)}}}for(var E=function(t){return i.variable.color(e,t,e.id.nesting[O])},w=0;w<e.id.nesting.length;w++){var O=w,k=e.id.nesting[w],j=i.util.uniques(b,k),F=i.util.uniques(b,E);if(j.length===F.length&&F.length>1)break}for(var u=i.data.nest(e,b,[E],[]),z=0;z<u.length;z++){d=u[z];var A=e.id.nesting[O+1];d[k]=d[k]||i.variable.value(e,d[A],k,A),d[o]=d[o]||i.variable.color(e,d,k),d.d3plus={depth:O}}e.dev.value&&i.console.timeEnd("grouping data by color");var S=e.width.value;n=e.legend.size;var m=n*u.length+e.ui.padding*(u.length+1);if(n instanceof Array){e.dev.value&&i.console.time("calculating legend size");for(var w=n[1];w>=n[0];w--)if(m=w*u.length+e.ui.padding*(u.length+1),S>=m){n=w;break}e.dev.value&&i.console.timeEnd("calculating legend size")}else"number"!=typeof n&&n!==!1&&(n=30);if(m>S||1==u.length)l=!1;else{m-=2*e.ui.padding,e.dev.value&&i.console.time("sorting legend");var B=e[e.legend.order.value].value;if(i.array.sort(u,B,e.legend.order.sort.value,o,e),e.dev.value&&i.console.timeEnd("sorting legend"),e.dev.value&&i.console.time("drawing legend"),"start"==e.legend.align)var y=e.ui.padding;else if("end"==e.legend.align)var y=S-e.ui.padding-m;else var y=S/2-m/2;e.g.legend.selectAll("g.d3plus_scale").transition().duration(e.draw.timing).attr("opacity",0).remove();var C=e.g.legend.selectAll("g.d3plus_color").data(u,function(t){return t[e.id.nesting[t.d3plus.depth]]}),M=C.enter().append("g").attr("class","d3plus_color").attr("opacity",0).call(t);M.append("rect").attr("class","d3plus_color").call(a),i.touch||C.on(i.evt.over,function(t,a){d3.select(this).style("cursor","pointer");var l=y+a*(e.ui.padding+n),r=d3.transform(d3.select(this.parentNode).attr("transform")).translate[1];l+=n/2,r+=e.ui.padding+n/2,i.tooltip.app({data:t,footer:!1,vars:e,x:l,y:r})}).on(i.evt.out,function(){i.tooltip.remove(e.type.value)}),C.order().transition().duration(e.draw.timing).attr("opacity",1).call(t),C.selectAll("rect.d3plus_color").transition().duration(e.draw.timing).call(a),C.exit().transition().duration(e.draw.timing).attr("opacity",0).remove(),e.dev.value&&i.console.timeEnd("drawing legend")}}else l=!1;if(e.legend.value&&r&&l){if(e.dev.value&&i.console.time("positioning legend"),n)var q=n+e.ui.padding;else var T=e.g.legend.node().getBBox(),q=T.height+T.y-e.ui.padding;0===e.margin.bottom&&(e.margin.bottom+=e.ui.padding),e.margin.bottom+=q,e.g.legend.transition().duration(e.draw.timing).attr("transform","translate(0,"+(e.height.value-e.margin.bottom)+")"),e.dev.value&&i.console.timeEnd("positioning legend")}else e.dev.value&&i.console.time("hiding legend"),e.g.legend.transition().duration(e.draw.timing).attr("transform","translate(0,"+e.height.value+")"),e.dev.value&&i.console.timeEnd("hiding legend")},i.ui.message=function(e,t){function a(t){t.style(l).style("position","absolute").style("background",r).style("text-align","center").style("left",function(){return"center"==n?"50%":"0px"}).style("width",function(){return"center"==n?"auto":e.width.value+"px"}).style("margin-left",function(){var t=e.width.value-e.width.viz;return"center"==n?-(this.offsetWidth/2+t/2)+"px":"0px"}).style("top",function(){return"center"==n?"50%":"top"==n?"0px":"auto"}).style("bottom",function(){return"bottom"==n?"0px":"auto"}).style("margin-top",function(){if("large"==i){var e=this.offsetHeight;return-e/2+"px"}return"0px"})}var t=e.messages.value?t:null,i=t==e.internal_error?"large":e.messages.style;if("large"==i)var l=e.messages,n="center";else{if(e.footer.value)var l=e.footer;else if(e.title.value)var l=e.title;else if(e.title.sub.value)var l=e.title.sub;else if(e.title.total.value)var l=e.title.total;else var l=e.title.sub;var n=l.position}var l={color:l.font.color,"font-family":l.font.family.value,"font-weight":l.font.weight,"font-size":l.font.size+"px",padding:l.padding+"px"},r="none"!=e.background.value?e.background.value:"white";e.g.message=e.container.value.selectAll("div#d3plus_message").data(["message"]),e.g.message.enter().append("div").attr("id","d3plus_message").attr("opacity",0);var o=t?1:0,s=t?t:e.g.message.text(),u=t?"inline-block":"none";e.g.message.text(s).style("opacity",o).style("display",u).call(a)},i.ui.timeline=function(e){var t=e.data.time;if(!e.small&&t&&t.length>1&&e.timeline.value){if(e.dev.value&&i.console.time("drawing timeline"),e.time.value==e.x.value&&"continuous"==e.x.scale.value||e.time.value==e.y.value&&"continuous"==e.y.scale.value)var a=2;else var a=1;if(e.time.solo.value.length)var l=d3.extent(e.time.solo.value);else var l=d3.extent(t);var n=t[0],r=t[t.length-1],o=l[0],s=l[1],u=[],d=[];t.forEach(function(e,a){0!=a&&d.push(e-t[a-1])});{var c=d3.min(d);c*t.length}t=[];for(var v=n;r>=v;v+=c)t.push(v),u.push(d3.time.year(new Date(parseInt(v),0,1)));u.push(d3.time.year(new Date(parseInt(r+c),0,1)));var p=function(){if(null!==d3.event.sourceEvent){var l=E.extent(),n=i.util.closest(u,d3.time.year.round(l[0])),r=i.util.closest(u,d3.time.year.round(l[1]));n==r&&(n=i.util.closest(u,d3.time.year.floor(l[0])));var o=u.indexOf(n),s=u.indexOf(r);if(s-o>=a)var d=[n,r];else if(o+a<=t.length)var d=[n,u[o+a]];else{for(var d=[n],c=1;a>=c;c++)o+c<=t.length?d.push(u[o+c]):d.unshift(u[o-(o+c-t.length)]);d=[d[0],d[d.length-1]]}d3.select(this).transition().call(E.extent(d)).each("end",function(){var a=d3.range(d[0].getFullYear(),d[1].getFullYear());a=a.filter(function(e){return t.indexOf(e)>=0}),e.self.time({solo:a}).draw()})}},f=e.g.timeline.selectAll("rect.d3plus_timeline_background").data(["background"]);f.enter().append("rect").attr("class","d3plus_timeline_background").attr("opacity",0).attr("fill",e.timeline.background);var h=e.g.timeline.selectAll("g#ticks").data(["ticks"]);h.enter().append("g").attr("id","ticks").attr("transform","translate("+e.width.value/2+","+e.ui.padding+")");var g=e.g.timeline.selectAll("g#brush").data(["brush"]);g.enter().append("g").attr("id","brush");var m=e.g.timeline.selectAll("g#labels").data(["labels"]);m.enter().append("g").attr("id","labels");var y=m.selectAll("text").data(t,function(e,t){return t});y.enter().append("text").attr("y",0).attr("dy",0).attr("x",function(){return"middle"==e.timeline.align?e.width.value/2:"end"==e.timeline.align?e.width.value:0}).attr("y",function(){var t=t=parseFloat(d3.select(this).style("font-size"),10)/5,a=e.ui.padding+e.timeline.height/2+this.getBBox().height/2-t;return a});var x=0,b=0;y.order().attr("font-weight",e.timeline.tick.weight).attr("font-family",e.timeline.tick.family.value).attr("font-size",e.timeline.tick.size).attr("text-anchor",e.timeline.tick.align).attr("opacity",0).text(function(e){return e}).each(function(){var e=this.getBBox().width,t=this.getBBox().height;e>x&&(x=e),t>b&&(b=t)});var w=x+2*e.ui.padding,_=w*t.length,z=e.width.value-2*e.ui.padding,c=1;if(_>z)for(_=z,c=Math.ceil(w/(_/t.length)),w=_/t.length,c;c<t.length-1&&(t.length-1)%c!=0;c++);if("start"==e.timeline.align)var k=e.ui.padding;else if("end"==e.timeline.align)var k=e.width.value-e.ui.padding-_;else var k=e.width.value/2-_/2;y.text(function(e,t){return t%c==0?e:""}).attr("opacity",1),y.transition().duration(e.draw.timing).attr("fill",function(t){if(t>=l[0]&&t<=l[1]){var a=e.timeline.background,n=e.timeline.brush.color,r=e.timeline.brush.opacity;return mixed=i.color.mix(n,a,r),i.color.text(mixed)}return i.color.text(e.timeline.background)}).attr("x",function(e,t){return k+w*t+w/2}).attr("y",function(){var t=t=parseFloat(d3.select(this).style("font-size"),10)/5,a=e.ui.padding+e.timeline.height/2-1+this.getBBox().height/2-t;return c>1&&(a+=b+e.ui.padding),a}),y.exit().transition().duration(e.draw.timing).attr("opacity",0).remove(),f.transition().duration(e.draw.timing).attr("opacity",1).attr("width",_).attr("height",e.timeline.height-2).attr("x",k).attr("y",e.ui.padding).attr("fill",e.timeline.background);var A=d3.time.scale().domain(d3.extent(u)).rangeRound([0,_]),E=d3.svg.brush().x(A).extent([u[t.indexOf(o)],u[t.indexOf(s)+1]]).on("brushend",p);
h.attr("transform","translate("+k+","+e.ui.padding+")").transition().duration(e.draw.timing).call(d3.svg.axis().scale(A).orient("top").ticks(function(){return u}).tickFormat("").tickSize(-(e.timeline.height-2)).tickPadding(0)).selectAll("path").attr("fill","none"),h.selectAll("line").attr("stroke",e.timeline.tick.color).attr("shape-rendering",e.shape.rendering.value),g.attr("transform","translate("+k+","+e.ui.padding+")").attr("opacity",1).call(E),y.attr("pointer-events","none"),g.selectAll("rect.background, rect.extent").attr("height",e.timeline.height-2),g.selectAll("rect.background").attr("fill","none").attr("stroke-width",1).attr("stroke",e.timeline.tick.color).style("visibility","visible").attr("shape-rendering",e.shape.rendering.value),g.selectAll("rect.extent").attr("stroke-width",1).attr("fill",e.timeline.brush.color).attr("fill-opacity",e.timeline.brush.opacity).attr("stroke",e.timeline.tick.color).attr("shape-rendering",e.shape.rendering.value),e.timeline.handles.value?g.selectAll("g.resize").select("rect").attr("fill",e.timeline.handles.color).attr("stroke",e.timeline.handles.stroke).attr("stroke-width",1).attr("x",-e.timeline.handles.size/2).attr("width",e.timeline.handles.size).attr("height",e.timeline.height-2).style("visibility","visible").attr("shape-rendering",e.shape.rendering.value).attr("opacity",e.timeline.handles.opacity):g.selectAll("g.resize").remove(),e.timeline.handles.opacity&&g.selectAll("g.resize").on(i.evt.over,function(){d3.select(this).select("rect").transition().duration(e.timing.mouseevents).attr("fill",e.timeline.handles.hover)}).on(i.evt.out,function(){d3.select(this).select("rect").transition().duration(e.timing.mouseevents).attr("fill",e.timeline.handles.color)}),0===e.margin.bottom&&(e.margin.bottom+=e.ui.padding);var O=e.g.timeline.node().getBBox();e.margin.bottom+=O.height+O.y,e.g.timeline.transition().duration(e.draw.timing).attr("transform","translate(0,"+(e.height.value-e.margin.bottom-e.ui.padding/2)+")"),e.margin.bottom+=e.ui.padding,e.dev.value&&i.console.time("drawing timeline")}else e.g.timeline.transition().duration(e.draw.timing).attr("transform","translate(0,"+e.height.value+")")},i.ui.titles=function(e){function t(t){t.attr("text-anchor",function(e){var t=e.style.font.align;return"center"==t?"middle":"left"==t&&!i.rtl||"right"==t&&i.rtl?"start":"left"==t&&i.rtl||"right"==t&&!i.rtl?"end":void 0}).attr("x",function(t){var a=t.style.font.align;return"center"==a?e.width.value/2:"left"==a&&!i.rtl||"right"==a&&i.rtl?e.padding:"left"==a&&i.rtl||"right"==a&&!i.rtl?e.width.value-e.padding:void 0}).attr("y",0)}function a(t){t.attr("font-size",function(e){return e.style.font.size}).attr("fill",function(t){return t.link?e.links.font.color:t.style.font.color}).attr("font-family",function(t){return t.link?e.links.font.family.value:t.style.font.family.value}).attr("font-weight",function(t){return t.link?e.links.font.weight:t.style.font.weight}).style("text-decoration",function(t){return t.link?e.links.font.decoration.value:t.style.font.decoration.value}).style("text-transform",function(t){return t.link?e.links.font.transform.value:t.style.font.transform.value})}var l=e.size.value?e.size.value:"number"===e.color.type?e.color.value:!1;if(e.data.app&&e.title.total.value&&!e.small)if(l){if(e.dev.value&&i.console.time("calculating total value"),e.focus.value){var n=e.data.app.filter(function(t){return t[e.id.value]==e.focus.value});n=d3.sum(n,function(t){return i.variable.value(e,t,l)})}else var n=d3.sum(e.data.pool,function(t){return i.variable.value(e,t,l)});if(0===n&&(n=!1),"number"==typeof n){var r="";if(e.data.mute.length||e.data.solo.length||e.focus.value){var o=d3.sum(e.data.value,function(t){if(e.time.solo.value.length>0)var a=e.time.solo.value.indexOf(i.variable.value(e,t,e.time.value))>=0;else if(e.time.mute.value.length>0)var a=e.time.solo.value.indexOf(i.variable.value(e,t,e.time.value))<0;else var a=!0;return a?i.variable.value(e,t,l):void 0});if(o>n)var r=n/o*100,s=e.format.value(o,e.size.value),r=" ("+e.format.value(r,"share")+"% of "+s+")"}n=e.format.value(n,e.size.value);var u=e.title.total.value,d=u.prefix||e.format.value(e.format.locale.value.ui.total)+": ";n=d+n,u.suffix?n+=u.suffix:null,n+=r}e.dev.value&&i.console.timeEnd("calculating total value")}else var n=!1;else var n=!1;var c=[];e.footer.value&&c.push({link:e.footer.link,style:e.footer,type:"footer",value:e.footer.value}),e.small||(e.title.value&&c.push({link:e.title.link,style:e.title,type:"title",value:e.title.value}),e.title.sub.value&&c.push({link:e.title.sub.link,style:e.title.sub,type:"sub",value:e.title.sub.value}),e.title.total.value&&n&&c.push({link:e.title.total.link,style:e.title.total,type:"total",value:n})),e.dev.value&&i.console.time("drawing titles");var v=e.svg.selectAll("g.d3plus_title").data(c,function(e){return e.type}),p=e.title.width||e.width.value;v.enter().append("g").attr("class","d3plus_title").attr("opacity",0).attr("transform",function(t){var a="top"==t.style.position?0:e.height.value;return"translate(0,"+a+")"}).append("text").call(t).call(a),v.each(function(t){i.textwrap().container(d3.select(this).select("text")).height(e.height.value/8).text(t.value).width(p).draw(),t.y=e.margin[t.style.position],e.margin[t.style.position]+=this.getBBox().height+2*t.style.padding}).on(i.evt.over,function(t){t.link&&d3.select(this).transition().duration(e.timing.mouseevents).style("cursor","pointer").select("text").attr("fill",e.links.hover.color).attr("font-family",e.links.hover.family.value).attr("font-weight",e.links.hover.weight).style("text-decoration",e.links.hover.decoration.value).style("text-transform",e.links.hover.transform.value)}).on(i.evt.out,function(t){t.link&&d3.select(this).transition().duration(e.timing.mouseevents).style("cursor","auto").select("text").call(a)}).on(i.evt.click,function(e){if(e.link){var t="/"!=e.link.charAt(0)?"_blank":"_self";window.open(e.link,t)}}).transition().duration(e.draw.timing).attr("opacity",1).attr("transform",function(t){var a=t.style.position,i="top"==a?0+t.y:e.height.value-t.y;return"bottom"==a?i-=this.getBBox().height+t.style.padding:i+=t.style.padding,"translate(0,"+i+")"}).select("text").call(t).call(a),v.exit().transition().duration(e.draw.timing).attr("opacity",0).remove(),e.margin.top>0&&(e.margin.top+=e.title.padding),e.margin.bottom>0&&(e.margin.bottom+=e.title.padding);var f=e.title.height;f&&e.margin[e.title.position]<f&&(e.margin[e.title.position]=f),e.dev.value&&i.console.timeEnd("drawing titles")},i.input.button=function(e){var t=this.button,a=e.container.ui.selectAll("div.d3plus_node").data(e.data.app,function(t){return t[e.id.value]});if(e.dev.value&&i.console.time("enter"),a.enter().append("div").attr("class","d3plus_node").call(t.color,e).call(t.style,e).call(t.icons,e).call(t.mouseevents,e,t.color),e.dev.value&&i.console.timeEnd("enter"),e.draw.update||e.draw.timing){e.dev.value&&i.console.time("ordering"),a.order(),e.dev.value&&i.console.timeEnd("ordering");var l=a}else var n=[e.focus.previous,e.focus.value,e.hover.previous,e.hover.value].filter(function(e){return e}),l=a.filter(function(t){return n.indexOf(t[e.id.value])>=0});e.dev.value&&i.console.time("update"),e.draw.timing?l.transition().duration(e.draw.timing).call(t.color,e).call(t.style,e):l.call(t.color,e).call(t.style,e),l.call(t.icons,e).call(t.mouseevents,e,t.color),e.dev.value&&i.console.timeEnd("update"),a.exit().remove()},i.input.drop=function(e){var t=this.drop;e.margin.top=0,e.margin.title=0,t.element(e),t.keyboard(e),t.window(e),t.width(e),t.button(e),t.selector(e),t.title(e),t.search(e),t.list(e),t.data(e),t.update(e)},i.style.default.axes={ticks:{color:"#ccc",font:{color:"#888",decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),size:12,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},size:10,width:1}},i.style.default.background={accepted:[String],value:"#ffffff"},i.style.default.color={heatmap:["#27366c","#7b91d3","#9ed3e3","#f3d261","#c9853a","#d74b03"],focus:"#444444",missing:"#eeeeee",primary:"#d74b03",range:["#d74b03","#eeeeee","#94b153"],secondary:"#e5b3bb"},i.style.default.coords={center:[0,0],fit:{accepted:["auto","height","width"],value:"auto"},padding:20,projection:{accepted:["mercator","equirectangular"],value:"mercator"},threshold:.1},i.style.default.data={donut:{size:.35},large:400,opacity:.9,stroke:{width:1}},i.style.default.edges={arrows:{accepted:[Boolean,Number],direction:{accepted:["source","target"],value:"target"},value:!1},color:"#d0d0d0",large:100,limit:!1,opacity:1,width:1},i.style.default.font={align:{accepted:["left","center","right"],process:function(e){return i.rtl?"left"===e?"right":"right"===e?"left":e:e},value:"left"},color:"#444444",decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),secondary:{align:{accepted:["left","center","right"],process:function(e){return i.rtl?"left"===e?"right":"right"===e?"left":e:e},value:"left"},color:"#444444",decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),size:12,spacing:0,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},size:12,spacing:0,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},i.style.default.footer={font:{align:"center",color:"#444",decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),size:11,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},padding:0,position:"bottom"},i.style.default.height={small:300,max:600},i.style.default.icon={back:{accepted:[!1,String],fallback:"&#x276e;",opacity:1,process:function(e){var t=this.fallback;return i.style.default.icon.fontCheck(e,t)},rotate:0,value:"fa-angle-left"},button:{accepted:[!1,String],fallback:!1,opacity:1,process:function(e){var t=this.fallback;return i.style.default.icon.fontCheck(e,t)},rotate:0,value:!1},drop:{accepted:[!1,String],fallback:"&#x276f;",opacity:1,process:function(e){var t=this.fallback;return i.style.default.icon.fontCheck(e,t)},rotate:0,value:"fa-angle-down"},fontCheck:function(e,t){return e===!1||0===e.indexOf("fa-")&&i.font.awesome||e.indexOf("fa-")<0?e:t},next:{accepted:[!1,String],fallback:"&#x276f;",opacity:1,process:function(e){var t=this.fallback;return i.style.default.icon.fontCheck(e,t)},rotate:0,value:"fa-angle-right"},select:{accepted:[!1,String],fallback:"&#x2713;",opacity:1,process:function(e){var t=this.fallback;return i.style.default.icon.fontCheck(e,t)},rotate:0,value:"fa-check"}},i.style.default.labels={align:"middle",font:{decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),size:11,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},padding:7,segments:2},i.style.default.legend={align:"middle",font:{align:"middle",color:"#444444",family:i.style.fontFamily(i.style.default.fontFamily),size:10,weight:200},gradient:{height:10},order:{accepted:["color","id","size","text"],sort:{accepted:["asc","desc"],value:"asc"},value:"color"},size:[8,30]},i.style.default.links={font:{color:"#444444",decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},hover:{color:"#444444",decoration:{accepted:["line-through","none","overline","underline"],value:"underline"},family:i.style.fontFamily(i.style.default.fontFamily),transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200}},i.style.default.messages={font:{color:"#444",decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),size:16,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},padding:5},i.style.default.nodes={overlap:.6},i.style.default.shape={interpolate:{accepted:["basis","basis-open","cardinal","cardinal-open","linear","monotone","step","step-before","step-after"],deprecates:"stack_type",value:"linear"},rendering:{accepted:["auto","optimizeSpeed","crispEdges","geometricPrecision"],value:"auto"}},i.style.default.timeline={align:"middle",background:"#eeeeee",brush:{color:"#ffffff",opacity:1},handles:{accepted:[Boolean],color:"#e5e5e5",hover:"#ffffff",opacity:1,size:3,stroke:"#cccccc",value:!0},height:20,tick:{align:"middle",color:"#e5e5e5",family:i.style.fontFamily(i.style.default.fontFamily),size:10,weight:200}},i.style.default.timing={mouseevents:60,transitions:600,ui:200},i.style.default.title={font:{align:"center",color:"#444444",decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),size:16,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:400},height:!1,padding:2,position:"top",sub:{font:{align:"center",color:"#444444",decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),size:12,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},padding:1,position:"top"},total:{font:{align:"center",color:"#444444",decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),size:12,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},padding:1,position:"top"},width:!1},i.style.default.tooltip={anchor:"top center",background:"#ffffff",children:{accepted:[Boolean],value:!0},connections:{accepted:[Boolean],value:!0},curtain:{color:"#ffffff",opacity:.8},font:{color:"#444",family:i.style.fontFamily(i.style.default.fontFamily),size:12,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},large:250,share:{accepted:[Boolean],value:!0},size:{accepted:[Boolean],value:!0},small:225},i.style.default.ui={align:{accepted:["left","center","right"],process:function(e){return i.rtl?"left"===e?"right":"right"===e?"left":e:e},value:"center"},border:1,color:{primary:{process:function(e){var t=this.getVars(),a=this.value,i=t.ui.color.secondary.value;return i&&i!==d3.rgb(a).darker(2).toString()||(t.ui.color.secondary.value=d3.rgb(e).darker(2).toString()),e},value:"#ffffff"},secondary:{value:!1}},display:{acceped:["block","inline-block"],value:"inline-block"},font:{align:"center",color:"#444",decoration:{accepted:["line-through","none","overline","underline"],value:"none"},family:i.style.fontFamily(i.style.default.fontFamily),size:11,transform:{accepted:["capitalize","lowercase","none","uppercase"],value:"none"},weight:200},margin:5,padding:5,position:{accepted:["top","right","bottom","left"],value:"bottom"}},i.style.default.width={small:400},i.input.button.color=function(e,t){e.style("background-color",function(e){return t.focus.value!==e[t.id.value]?t.hover.value===e[t.id.value]?i.color.lighter(t.ui.color.secondary.value,.25):t.ui.color.secondary.value:t.hover.value===e[t.id.value]?d3.rgb(t.ui.color.primary.value).darker(.15).toString():t.ui.color.primary.value}).style("color",function(e){var a=e[t.icon.value]&&t.data.app.length<t.data.large;if(t.focus.value===e[t.id.value])var l=1;else var l=.75;if(t.focus.value===e[t.id.value]&&e[t.color.value]&&!a)var n=i.color.legible(e[t.color.value]);else if(t.focus.value===e[t.id.value])var n=i.color.text(t.ui.color.primary.value);else var n=i.color.text(t.ui.color.secondary.value);var n=d3.rgb(n);return"rgba("+n.r+","+n.g+","+n.b+","+l+")"}).style("border-color",t.ui.color.secondary.value)},i.input.button.icons=function(e,t){var a="right"===t.font.align.value&&!i.rtl||i.rtl&&"right"===t.font.align.value;e.each(function(e){var l=["label"];e[t.icon.value]&&t.data.app.length<=t.data.large&&l.push("icon");var n=t.icon.button.value;e[t.id.value]===t.focus.value&&t.icon.select.value?(n=t.icon.select.value,l.push("selected")):n&&e.d3plus.icon!==!1&&l.push("selected");var r=0,o=d3.select(this).selectAll("div.d3plus_button_element").data(l,function(e){return e});o.enter().append("div").style("display",function(e){return"label"===e?"block":"absolute"}),o.order().attr("class",function(e){var t="";return"selected"===e&&0===n.indexOf("fa-")&&(t=" fa "+n),"d3plus_button_element d3plus_button_"+e+t}).html(function(a){if("label"===a){var i=t.text.value&&t.text.value in e&&!(e[t.text.value]instanceof Array)?t.text.value:t.id.value;return t.format.value(e[i])}return"selected"===a&&n.indexOf("fa-")<0?n:""}).style("background-image",function(a){return"icon"===a?"url('"+e[t.icon.value]+"')":"none"}).style("background-color",function(a){return"icon"===a&&"knockout"===e.style?e[t.color.value]||t.ui.color.primary.value:"transparent"}).style("background-size","100%").style("text-align",function(e){return"label"===e?t.font.align.value:"center"}).style("position",function(e){return"label"==e?"static":"absolute"}).style("width",function(e){return"label"===e?"auto":(r=t.height.value?t.height.value-2*t.ui.padding-2*t.ui.border:t.font.size+t.ui.padding+t.ui.border,r+"px")}).style("height",function(e){return"icon"===e?r+"px":"auto"}).style("margin-top",function(e){if("label"===e)return"0px";if(this.offsetHeight)var a=this.offsetHeight;else if("selected"===e)var a=t.font.size;else var a=r;return-a/2+"px"}).style("top",function(e){return"label"===e?"auto":"50%"}).style("left",function(e){return"icon"===e&&!a||"selected"===e&&a?t.ui.padding+"px":"auto"}).style("right",function(e){return"icon"===e&&a||"selected"===e&&!a?t.ui.padding+"px":"auto"}).style(i.prefix()+"transition",function(e){return"selected"===e?t.draw.timing/1e3+"s":"none"}).style(i.prefix()+"transform",function(e){var a="selected"===e?t.icon.select.rotate:"none";return"rotate("+a+"deg)"}).style("opacity",function(e){return"selected"===e?t.icon.select.opacity:1}),o.exit().remove();var s=d3.select(this).selectAll(".d3plus_button_label");if(r>0){r+=2*t.ui.padding;var u=t.ui.padding;if(3===l.length)var d=u+"px "+r+"px";else if(l.indexOf("icon")>=0&&!i.rtl||l.indexOf("selected")>=0&&i.rtl)var d=u+"px "+u+"px "+u+"px "+r+"px";else var d=u+"px "+r+"px "+u+"px "+u+"px";s.style("padding",d)}else s.style("padding",t.ui.padding+"px");if("number"==typeof t.width.value){var c=t.width.value;c-=parseFloat(s.style("padding-left"),10),c-=parseFloat(s.style("padding-right"),10),c-=2*t.ui.border,c+="px"}else var c="auto";s.style("width",c)})},i.input.button.mouseevents=function(e,t,a){e.on(i.evt.over,function(e){t.self.hover(e[t.id.value]),i.ie||!t.draw.timing?d3.select(this).style("cursor","pointer").call(a,t):d3.select(this).style("cursor","pointer").transition().duration(t.timing.mouseevents).call(a,t)}).on(i.evt.out,function(){t.self.hover(!1),i.ie||!t.draw.timing?d3.select(this).style("cursor","auto").call(a,t):d3.select(this).style("cursor","auto").transition().duration(t.timing.mouseevents).call(a,t)}).on(i.evt.click,function(e){e[t.id.value]&&t.self.focus(e[t.id.value]).draw()})},i.input.button.style=function(e,t){e.style("position","relative").style("margin",t.ui.margin+"px").style("display",t.ui.display.value).style("border-style","solid").style("border-width",t.ui.border+"px").style("font-family",t.font.family.value).style("font-size",t.font.size+"px").style("font-weight",t.font.weight).style("letter-spacing",t.font.spacing+"px")},i.input.drop.active=function(e,t,a){var i=[],a=a||e.active.value;if(a instanceof Array)for(var l=0;l<a.length;l++)i.push(this(e,t,a[l]));else{var n=typeof a;i.push("number"===n?e.depth.value===a:"function"===n?a(t):t===a)}return i.indexOf(!0)>=0},i.input.drop.arrow=function(e){e.dev.value&&i.console.time("rotating arrow");var t="&#x276f;"===e.icon.drop.value?90:0;if(e.open.value!=e.open.flipped.value)var a=180+t;else var a=t;e.container.button.icon({select:{opacity:e.open.value?.5:1,rotate:a}}).draw(),e.dev.value&&i.console.timeEnd("rotating arrow")},i.input.drop.button=function(e){if("button"in e.container||(e.dev.value&&i.console.time("creating main button"),e.container.button=i.form().container(e.container.ui).type("button").ui({margin:0}),e.dev.value&&i.console.timeEnd("creating main button")),e.focus.changed||e.data.changed||e.depth.changed){var t=e.depth.value,a=i.util.copy(e.data.value.filter(function(a){for(var i=!1,l=0;l<e.id.nesting.length;l++){var n=e.id.nesting[l];if(i=n in a&&a[n]===e.focus.value){t=l;break}}return i})[0]);a||(a=e.container.button.data()[0]||e.data.app[0]),e.container.button.data([a]).id(e.id.nesting).depth(t)}e.container.button.draw({update:e.draw.update}).focus(e.focus.value).font(e.font).icon({button:e.icon.drop.value,select:e.icon.drop.value,value:e.icon.value}).text(e.text.value).timing({ui:e.draw.timing}).ui({color:e.ui.color,padding:e.ui.padding}).width(e.width.value).draw(),e.margin.top+=e.container.button.container(Object).ui.node().offsetHeight,e.container.button.container(Object).ui.on(i.evt.click,function(){e.self.open(!e.open.value).draw()})},i.input.drop.data=function(e){if(e.data.url&&!e.data.loaded){var a={};a[e.text.value||e.id.value]=e.format.value(e.format.locale.value.ui.loading),e.data.filtered=[a]}else if(e.open.value){var n=e.text.solo.value.length?e.text.solo.value[0].toLowerCase():"",r=i.string.strip(n).split("_"),o=[e.id.value,e.text.value,e.alt.value,e.keywords.value];if(o=o.filter(function(e){return e}),r=r.filter(function(e){return""!=e}),e.text.solo.value.length&&""!==e.text.solo.value[0]){var s=[],u=[],d=[],c=[];e.id.nesting.forEach(function(t){c=c.concat(e.data.nested.all[t])}),c.forEach(function(a){var c=!1;o.forEach(function(o){if(!c&&o in a&&"string"==typeof a[o]){var v=a[o].toLowerCase();if([e.text.value,e.id.value].indexOf(o)>=0&&0==v.indexOf(n))s.push(a),c=!0;else if(v.indexOf(n)>=0)u.push(a),c=!0;else{var p=i.string.strip(v).split("_");for(t in p){if(c)break;for(l in r)if(0===p[t].indexOf(r[l])){d.push(a),c=!0;break}}}}})}),e.data.filtered=d3.merge([s,u,d]),e.data.filtered.forEach(function(e,t){e.d3plus_order=t})}else e.data.filtered=e.data.app,e.id.nesting.length>1&&e.depth.value<e.id.nesting.length-1&&(e.data.filtered=e.data.filtered.filter(function(t){return"endPoint"in t.d3plus&&t.d3plus.endPoint===e.depth.value&&(t.d3plus.icon=!1),!0}));if(0===e.data.filtered.length){var v={},p=e.format.value(e.format.locale.value.ui.noResults);v[e.text.value||e.id.value]=i.string.format(p,'"'+n+'"'),e.data.filtered=[v]}}else e.data.filtered=[]},i.input.drop.element=function(e){e.data.element&&(e.data.element.on("focus."+e.container.id,function(){e.self.draw({update:!1}).hover(!0).draw()}),e.data.element.on("blur."+e.container.id,function(){var t=e.search.enabled?d3.event.relatedTarget!=e.container.select("input").node():!0;t&&e.self.draw({update:!1}).hover(!1).draw()}),e.data.element.on("change."+e.container.id,function(){e.self.focus(this.value).draw()}),e.data.element.on("keydown.cancel_"+e.container.id,function(){var e=d3.event.keyCode;9!=e&&d3.event.preventDefault()}))},i.input.drop.height=function(e){var t=e.container.button.container().node().getBoundingClientRect();e.height.secondary=window.innerHeight-t.bottom-e.ui.margin-2*e.ui.padding-2*e.ui.border,e.height.secondary<3*t.height?(e.height.secondary=t.top-10,e.self.open({flipped:!0})):e.self.open({flipped:!1});e.height.secondary>e.height.max&&(e.height.secondary=e.height.max)},i.input.drop.items=function(e){var t=this;if(e.open.value){e.dev.value&&i.console.time("updating list items"),"items"in e.container||(e.container.items=i.form().container(e.container.list).type("button").ui({border:0,display:"block",margin:0}).width(!1));var a=e.draw.timing?e.data.large:1,l=i.util.copy(e.order),n=e.depth.value===e.id.nesting.length-1;l.value=e.text.solo.value.length&&""!==e.text.solo.value[0]?"d3plus_order":e.order.value,(e.focus.changed||!e.container.items.focus())&&e.container.items.focus(e.focus.value,function(a){var i=a!==e.focus.value;i&&e.active.value&&(i=t.active(e,a)),i&&e.self.focus(a);var l=e.data.filtered.filter(function(t){return t[e.id.value]===a})[0];if(e.depth.value<e.id.nesting.length-1&&e.id.nesting[e.depth.value+1]in l){var n=e.depth.value,r=e.id.solo.value;e.history.states.push(function(){e.self.depth(n).id({solo:r}).draw()}),e.self.depth(e.depth.value+1).id({solo:[a]}).draw()}else e.depth.changed?i&&e.self.draw():e.self.open(!1).draw()}),e.container.items.active(e.active.value).data({large:a,value:e.data.filtered}).draw({update:e.draw.update}).font(e.font.secondary).id(e.id.value).icon({button:n?!1:e.icon.next,select:n?e.icon.select:!1}).order(l).text(e.text.secondary.value||e.text.value).timing({ui:e.draw.timing}).ui({color:{primary:1===e.id.nesting.length?e.ui.color.primary.value:e.ui.color.secondary.value,secondary:e.ui.color.secondary.value},padding:e.ui.padding}).draw(),e.dev.value&&i.console.timeEnd("updating list items")}},i.input.drop.keyboard=function(e){d3.select(document).on("keydown."+e.container.id,function(){if(e.open.value||e.hover===!0){var t=d3.event.keyCode,a=e.container.list.select("div").selectAll("div.d3plus_node"),i=0;if(a.each("boolean"==typeof e.hover?function(t,a){t.value==e.focus&&(i=a)}:function(t,a){t.value==e.hover&&(i=a)}),[9].indexOf(t)>=0&&(!e.search.enabled||e.search.enabled&&!d3.event.shiftKey))e.self.draw({update:!1}).disable();else if([40].indexOf(t)>=0){if(e.open.value&&(i>=a.size()-1?i=0:i+=1),"boolean"!=typeof e.hover)var l=a.data()[i].value;else var l=e.focus;e.open.value?e.self.draw({update:!1}).hover(l).draw(60):e.self.draw({update:!1}).hover(l).enable()}else if([38].indexOf(t)>=0){if(e.open.value&&(0>=i?i=a.size()-1:i-=1),"boolean"!=typeof e.hover)var l=a.data()[i].value;else var l=e.focus;e.open.value?e.self.draw({update:!1}).hover(l).draw(60):e.self.draw({update:!1}).hover(l).enable()}else[13].indexOf(t)>=0?"boolean"!=typeof e.hover?e.self.value(e.hover).hover(!0).draw():e.self.hover(e.focus).toggle():[27].indexOf(t)>=0&&(e.open.value?e.self.hover(!0).disable():e.hover===!0&&e.self.hover(!1).draw())}})},i.input.drop.list=function(e){e.dev.value&&i.console.time("populating list"),e.container.list=e.container.selector.selectAll("div.d3plus_drop_list").data(["list"]),e.container.list.enter().append("div").attr("class","d3plus_drop_list").attr("id","d3plus_drop_list_"+e.container.id).style("overflow-y","auto").style("overflow-x","hidden"),e.dev.value&&i.console.timeEnd("populating list")},i.input.drop.scroll=function(e){if(e.open.value){e.dev.value&&i.console.time("calculating height");var t=!1;if("none"==e.container.selector.style("display"))var t=!0;t&&e.container.selector.style("display","block");var a=e.search.enabled?e.container.search.node().offsetHeight:0,l=e.container.selector.style("height"),n=e.container.selector.property("scrollTop"),r=e.container.list.style("max-height"),o=e.container.list.property("scrollTop");e.container.selector.style("height","auto"),e.container.list.style("max-height","200000px"),e.container.listHeight=parseFloat(e.container.selector.style("height"),10),e.container.list.style("max-height",r).property("scrollTop",o),e.container.selector.style("height",l).property("scrollTop",n);var s=!1;if(e.container.listHeight>e.height.secondary&&(e.container.listHeight=e.height.secondary,s=!0),t&&e.container.selector.style("display","none"),e.dev.value&&i.console.timeEnd("calculating height"),s){e.dev.value&&i.console.time("calculating scroll position");var u=e.container.list.select("div").selectAll("div.d3plus_node"),d=u[0][0];u.each(function(t){t[e.id.value]==e.focus.value&&(d=this)});var t=!1;"none"===e.container.selector.style("display")&&(t=!0,e.container.selector.style("display","block"));var c=d.offsetTop,v=d.offsetHeight,p=e.container.list.property("scrollTop");t&&e.container.selector.style("display","none"),t||e.data.changed||e.depth.changed?e.container.listScroll=c:(e.container.listScroll=p,p>c?e.container.listScroll=c:c+v>p+e.height.secondary-a&&(e.container.listScroll=c-(e.height.secondary-v-a))),e.dev.value&&i.console.timeEnd("calculating scroll position")}else e.container.listScroll=0}else e.container.listScroll=e.container.list.property("scrollTop"),e.container.listHeight=0},i.input.drop.search=function(e){function t(t){t.style("padding",e.ui.padding+"px").style("display","block").style("background-color",e.ui.color.secondary.value)}function a(t){var a=e.width.secondary-4*e.ui.padding-2*e.ui.border;t.style("padding",e.ui.padding+"px").style("width",a+"px").style("border-style","solid").style("border-width","0px").style("font-family",e.font.secondary.family.value).style("font-size",e.font.secondary.size+"px").style("font-weight",e.font.secondary.weight).style("text-align",e.font.secondary.align).style("outline","none").style(i.prefix()+"border-radius","0").attr("placeholder",e.format.value(e.format.locale.value.method.search))}e.dev.value&&i.console.time("creating search");var l=this;e.container.search=e.container.selector.selectAll("div.d3plus_drop_search").data(e.search.enabled?["search"]:[]),e.draw.timing?(e.container.search.transition().duration(e.draw.timing).call(t),e.container.search.select("input").transition().duration(e.draw.timing).call(a)):(e.container.search.call(t),e.container.search.select("input").call(a)),e.container.search.enter().insert("div","#d3plus_drop_list_"+e.container.id).attr("class","d3plus_drop_search").attr("id","d3plus_drop_search_"+e.container.id).call(t).append("input").attr("id","d3plus_drop_input_"+e.container.id).style("-webkit-appearance","none").call(a),e.container.search.select("input").on("keyup."+e.container.id,function(){e.text.solo[0]!==this.value&&(e.self.text({solo:[this.value]}),l.data(e),l.items(e),l.update(e))}),e.container.search.exit().remove(),e.search.enabled&&(e.margin.title+=e.container.search.node().offsetHeight),e.dev.value&&i.console.timeEnd("creating search")},i.input.drop.selector=function(e){e.container.selector=e.container.ui.selectAll("div.d3plus_drop_selector").data(["selector"]),e.container.selector.enter().append("div").attr("class","d3plus_drop_selector").style("position","absolute").style("top","0px").style("z-index","-1").style("overflow","hidden"),e.container.selector.style("padding",e.ui.border+"px")},i.input.drop.title=function(e){function t(t){t.style("padding",e.ui.padding+"px").style("display","block").style("background-color",e.ui.color.secondary.value).style("font-family",e.font.secondary.family.value).style("font-size",e.font.secondary.size+"px").style("font-weight",e.font.secondary.weight).style("text-align",e.font.secondary.align).style("color",i.color.text(e.ui.color.secondary.value))}function a(t){if(!t.empty()){var a=0===e.icon.back.value.indexOf("fa-")?" fa "+e.icon.back.value:"";a="d3plus_drop_back"+a;var i=0===e.icon.back.value.indexOf("fa-")?"":e.icon.back.value;t.style("position","absolute").attr("class",a).style("top",e.ui.padding+e.font.secondary.size/2/2.5+"px").html(i)}}function l(t){var a=r?e.focus.value:e.format.locale.value.ui.back;t.text(e.format.value(a)).style("padding","0px "+2*e.ui.padding+"px")}if(e.open.value){e.dev.value&&i.console.time("creating title and back button");var n=1===e.id.solo.value.length&&e.depth.value>0,r=n,o=e.container.button.data(Object).app[0];r=!0;for(var s=0;s<e.id.nesting.length;s++){var u=e.id.nesting[s];if(u in o&&o[u]===e.focus.value){r=!1;break}}e.container.title=e.container.selector.selectAll("div.d3plus_drop_title").data(n?["title"]:[]),e.draw.timing?(e.container.title.transition().duration(e.draw.timing).call(t),e.container.title.select("div.d3plus_drop_title_text").transition().duration(e.draw.timing).call(l)):(e.container.title.call(t),e.container.title.select("div.d3plus_drop_title_text").call(l)),e.container.title.select("span.d3plus_drop_back").call(a);
var d=e.container.title.enter().insert("div","#d3plus_drop_list_"+e.container.id).attr("class","d3plus_drop_title").attr("id","d3plus_drop_title_"+e.container.id).call(t);d.append("span").attr("id","d3plus_drop_back_"+e.container.id).attr("class","d3plus_drop_back").call(a),d.append("div").attr("id","d3plus_drop_title_text_"+e.container.id).attr("class","d3plus_drop_title_text").call(l),e.container.title.on(i.evt.over,function(){var t=i.color.lighter(e.ui.color.secondary.value);d3.select(this).style("cursor","pointer").transition().duration(e.timing.mouseevents).style("background-color",t).style("color",i.color.text(t))}).on(i.evt.out,function(){var t=e.ui.color.secondary.value;d3.select(this).style("cursor","auto").transition().duration(e.timing.mouseevents).style("background-color",t).style("color",i.color.text(t))}).on(i.evt.click,function(){e.history.back()}),e.container.title.exit().remove(),n&&(e.margin.title+=e.container.title.node().offsetHeight),e.dev.value&&i.console.timeEnd("creating title and back button")}},i.input.drop.update=function(e){function t(t){t.style("left",function(){return"left"===e.font.align.value?e.margin.left+"px":"center"===e.font.align.value?-((e.width.secondary-e.width.value)/2)+"px":"auto"}).style("right",function(){return"right"===e.font.align.value?"0px":"auto"}).style("height",e.container.listHeight+"px").style("padding",e.ui.border+"px").style("background-color",e.ui.color.secondary.value).style("z-index",function(){return e.open.value?"9999":"-1"}).style("width",e.width.secondary-2*e.ui.border+"px").style("top",function(){return e.open.flipped.value?"auto":e.margin.top+"px"}).style("bottom",function(){return e.open.flipped.value?e.margin.top+"px":"auto"}).style("opacity",e.open.value?1:0)}function a(t){t.style("top",function(){return e.open.flipped.value?"auto":e.margin.top+"px"}).style("bottom",function(){return e.open.flipped.value?e.margin.top+"px":"auto"}).style("display",e.open.value?null:"none"),e.search.enabled&&e.open.value&&e.container.selector.select("div.d3plus_drop_search input").node().focus()}function l(e){return function(){var t=d3.interpolateNumber(this.scrollTop,e);return function(e){this.scrollTop=t(e)}}}var n=this;e.draw.timing?e.container.ui.transition().duration(e.draw.timing).each("start",function(){e.open.value&&d3.select(this).style("z-index",9999)}).style("margin",e.ui.margin+"px").each("end",function(){e.open.value||d3.select(this).style("z-index","auto")}):e.container.ui.style("margin",e.ui.margin+"px").style("z-index",function(){return e.open.value?9999:"auto"}),n.items(e),n.height(e),n.scroll(e),n.arrow(e),e.dev.value&&i.console.time("drawing list");var r=e.open.value?e.height.secondary-e.margin.title:0;e.draw.timing?(e.container.selector.transition().duration(e.draw.timing).each("start",function(){d3.select(this).style("display",e.open.value?"block":null)}).call(t).each("end",function(){d3.select(this).transition().duration(e.draw.timing).call(a)}),e.container.list.transition().duration(e.draw.timing).style("width",e.width.secondary-2*e.ui.border+"px").style("max-height",r+"px").tween("scroll",l(e.container.listScroll))):(e.container.selector.call(t).call(a),e.container.list.style("width",e.width.secondary-2*e.ui.border+"px").style("max-height",r+"px").property("scrollTop",e.container.listScroll)),e.dev.value&&i.console.timeEnd("drawing list")},i.input.drop.width=function(e){function t(t){var l="primary"===t?"value":t,n="value"===l?e.icon.drop.value:e.icon.select.value||e.icon.drop.value,r="value"===l?e.text.value:e.text.secondary.value||e.text.value,o="value"===l?e.font:e.font.secondary;e.dev.value&&i.console.time("calculating "+t+" width");var s=i.form().container(i.font.tester()).data({large:9999,value:a}).draw({update:!1}).font(o).icon({button:n,value:e.icon.value}).id(e.id.value).timing({ui:0}).text(r||e.id.value).type("button").ui({border:0,display:"inline-block",margin:0,padding:e.ui.padding}).width(!1).draw(),u=[];s.selectAll("div.d3plus_node").each(function(){u.push(this.offsetWidth)}).remove();var d={};d[l]=d3.max(u)+2*e.ui.border,e.self.width(d),e.dev.value&&i.console.timeEnd("calculating "+t+" width")}var a=[];for(var l in e.data.nested.all){var n=e.data.nested.all[l],r=i.object.validate(e.text.nesting)&&l in e.text.nesting?e.text.nesting[l][0]:l;[e.id.value,e.text.value].indexOf(r)<0&&(n=i.util.copy(n),n.forEach(function(t){t[e.text.value||e.id.value]=t[r]})),a=a.concat(n)}"number"!=typeof e.width.secondary&&("number"==typeof e.width.value?e.self.width({secondary:e.width.value}):t("secondary")),"number"!=typeof e.width.value&&(e.text.value===e.text.secondary?e.self.width(e.width.secondary):t("primary"))},i.input.drop.window=function(e,t){var a=this;if(void 0===t)var t=window;d3.select(t).on("click."+e.container.id,function(){var t=d3.event.target||d3.event.toElement,a=t.parentNode;a&&["d3plus_node","d3plus_drop_title"].indexOf(a.className)>=0&&(t=a.parentNode),t&&a&&!i.util.child(e.container.ui,t)&&e.open.value&&e.self.open(!e.open.value).draw()});try{var l=window.parent.location.host===window.location.host}catch(n){var l=!1}l&&t.self!==window.top&&a.window(e,t.parent)}}();