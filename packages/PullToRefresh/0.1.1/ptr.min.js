/* * * * * * * * *
 * PullToRefresh *
 * Version 0.1.1 *
 * License:  MIT *
 * SimonWaldherr *
 * * * * * * * * */

var ptr=[],ptr_settings={mlang:"en",mode:"mail"},ptr_messages={en:{pulltorefresh:"Pull to refresh",loading:"Loading ..."},de:{pulltorefresh:"ziehen zum aktualisieren",loading:"laden ..."}},ptr_init=function(a){"use strict";var b=0;for(void 0!==a&&(ptr_settings.mlang=a),ptr.scrollable_parent=!1,ptr.scrollables=document.getElementsByClassName("ptr_scrollable"),document.getElementsByTagName("body")[0].className+=window.hasOwnProperty("ontouchstart")||window.navigator.msPointerEnabled?" touch":" notouch",b=0;b<ptr.scrollables.length;b+=1)ptr.scrollables[b].hasAttribute("data-url")!==!1&&(ptr.box=document.createElement("div"),ptr.container=document.createElement("div"),ptr.image=document.createElement("div"),ptr.text=document.createElement("div"),ptr.box.appendChild(ptr.container),ptr.container.appendChild(ptr.image),ptr.container.appendChild(ptr.text),ptr.text.innerHTML=ptr_messages[ptr_settings.mlang].pulltorefresh,ptr.box.className="ptr_box",ptr.box.style.right="99%",ptr.container.className="ptr_container",ptr.image.className="ptr_image",ptr.text.className="ptr_text",ptr.scrollables[b].firstElementChild.insertBefore(ptr.box,ptr.scrollables[b].firstElementChild.firstChild));document.addEventListener("touchstart",function(a){var c=a.target;if(void 0===c.className)return!1;for(b=0;10>b;b+=1){if(void 0!==c.className&&c.className.match("ptr_scrollable")&&(ptr.scrollable_parent=b,b=10,c.hasAttribute("data-url")!==!1?void 0===c.getElementsByClassName("ptr_box")[0]?(ptr.box=document.createElement("div"),ptr.container=document.createElement("div"),ptr.image=document.createElement("div"),ptr.text=document.createElement("div"),ptr.box.appendChild(ptr.container),ptr.container.appendChild(ptr.image),ptr.container.appendChild(ptr.text),ptr.text.innerHTML=ptr_messages[ptr_settings.mlang].pulltorefresh,ptr.box.className="ptr_box",ptr.box.style.right="99%",ptr.container.className="ptr_container",ptr.image.className="ptr_image",ptr.text.className="ptr_text",c.firstElementChild.insertBefore(ptr.box,c.firstElementChild.firstChild)):(c.getElementsByClassName("ptr_box")[0].style.opacity=1,c.getElementsByClassName("ptr_text")[0].innerHTML!==ptr_messages[ptr_settings.mlang].loading&&(c.getElementsByClassName("ptr_text")[0].innerHTML=ptr_messages[ptr_settings.mlang].pulltorefresh)):void 0!==c.getElementsByClassName("ptr_box")[0]&&c.removeChild(c.getElementsByClassName("ptr_box")[0]),0===c.scrollTop?(c.scrollTop=1,c.getElementsByClassName("ptr_wrap")[0].style.top="1px"):c.scrollTop+c.offsetHeight===c.scrollHeight&&(c.scrollTop=c.scrollTop-1)),void 0===c.parentNode.tagName)return b=10,!1;if("BODY"===c.parentNode.tagName||"HTML"===c.parentNode.tagName)return b=10,!1;c=c.parentNode}}),document.addEventListener("touchmove",function(a){var c,d,e,f,g,h,i,j=a.target,k=!1,l=90;if(ptr.scrollable_parent===!1)return a.preventDefault(),!1;for(b=0;b<ptr.scrollable_parent;b+=1)j=j.parentNode;if(ptr.scrollable_parent!==!1&&j.hasAttribute("data-url")!==!1){if(k=!0,ptr.element=j,ptr.wrapelement=ptr.element.getElementsByClassName("ptr_wrap")[0],c=ptr.element.scrollTop,ptr.box=ptr.element.getElementsByClassName("ptr_box")[0],-1===ptr.wrapelement.className.indexOf(" active")&&!ptr.wrapelement.getElementsByClassName("ptr_image")[0].className.match("ptr_loading")&&ptr.element.scrollTop<1)if(ptr.element.scrollTop<-25&&(l=-40>c?-90:130+parseInt(12*c+270,10)),ptr.element.scrollTop<0&&(ptr.box.style.right="0px",ptr.wrapelement.getElementsByClassName("ptr_image")[0].style["-webkit-transform"]="scale(1) rotate("+l+"deg)"),ptr.element.scrollTop<-51){if(-1===ptr.wrapelement.className.indexOf(" ptr_active")){if(ptr.box.style.right="0px",ptr.wrapelement.className+=" ptr_active",ptr.wrapelement.getElementsByClassName("ptr_text")[0].innerHTML=ptr_messages[ptr_settings.mlang].loading,ptr.wrapelement.getElementsByClassName("ptr_image")[0].className+=" ptr_loading","reload"===j.getAttribute("data-url"))return window.location.reload(!0),!1;ptr.element=j,ptr.wrapelement=ptr.element.getElementsByClassName("ptr_wrap")[0],ptr.eleId=j.id,d=new Date,g=window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):XMLHttpRequest&&new XMLHttpRequest||null,h=window.setTimeout(function(){g.abort(),ptr.wrapelement.getElementsByClassName("ptr_text")[0].innerHTML="",ptr.wrapelement.className=ptr.wrapelement.className.replace(" ptr_active",""),ptr.wrapelement.style.top="0px",ptr.box=document.getElementById(ptr.eleId).getElementsByClassName("ptr_box")[0],ptr.box.getElementsByClassName("ptr_image")[0].className=ptr.box.getElementsByClassName("ptr_image")[0].className.replace(" ptr_loading","")},6e3),g.onreadystatechange=function(){4===g.readyState&&200===g.status&&(clearTimeout(h),200!==g.status?(ptr.wrapelement.style.top="0px",ptr.box.getElementsByClassName("ptr_image")[0].className=ptr.getElementsByClassName("ptr_image")[0].className.replace(" loading",""),ptr.wrapelement.className=ptr.wrapelement.className.replace(" ptr_active","")):(ptr.box=document.getElementById(ptr.eleId).getElementsByClassName("ptr_box")[0],e=document.createElement("div"),e.innerHTML=g.responseText,e.className="ptr_inserted",ptr.wrapelement.insertBefore(e,ptr.box.nextSibling),ptr.wrapelement.style.top="0px",ptr.box.getElementsByClassName("ptr_image")[0].className=ptr.box.getElementsByClassName("ptr_image")[0].className.replace(" ptr_loading",""),ptr.wrapelement.className=ptr.wrapelement.className.replace(" ptr_active",""),f=document.getElementsByClassName("ptr_inserted")[0],ptr.element.scrollTop=f.clientHeight-51,ptr.wrapelement.getElementsByClassName("ptr_text")[0].innerHTML="",ptr.box.style.right="99%",ptr.wrapelement.getElementsByClassName("ptr_image")[0].className=ptr.wrapelement.getElementsByClassName("ptr_image")[0].className.replace(" ptr_loading",""),ptr.scrollable_parent=!1))},i=j.getAttribute("data-url")+"?rt="+d.getTime(),g.open("POST",i,!0),g.setRequestHeader("Content-type","application/x-www-form-urlencoded"),g.send()}}else 0!==ptr.element.scrollTop&&-1!==ptr.wrapelement.className.indexOf(" active")&&(ptr.wrapelement.className=ptr.wrapelement.className.replace(" ptr_active",""),ptr.wrapelement.getElementsByClassName("ptr_text")[0].innerHTML=ptr_messages[ptr_settings.mlang].pulltorefresh)}else ptr.scrollable_parent!==!1&&(k=!0);k===!1&&a.preventDefault()}),document.addEventListener("touchend",function(a){var c=a.target;for(b=0;b<ptr.scrollable_parent;b+=1)c=c.parentNode;c.hasAttribute("data-url")!==!1&&ptr.scrollable_parent!==!1&&c.hasAttribute("data-url")!==!1&&(ptr.element=c,ptr.wrapelement=ptr.element.getElementsByClassName("ptr_wrap")[0],ptr.eleId=c.id,ptr.box=ptr.element.getElementsByClassName("ptr_box")[0],ptr.wrapelement.getElementsByClassName("ptr_image")[0].className.match("ptr_loading")?(ptr.wrapelement.className=ptr.wrapelement.className.replace(" ptr_active",""),ptr.wrapelement.style.top="51px"):ptr.box.style.right="99%"),ptr.scrollable_parent=!1})};