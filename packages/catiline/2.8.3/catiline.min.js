/*! catiline 2.8.3 2013-09-19*/
/*!(c)2013 Calvin Metcalf @license MIT https://github.com/calvinmetcalf/catiline */
/*!Includes Promiscuous (c)2013 Ruben Verborgh @license MIT https://github.com/RubenVerborgh/promiscuous*/
/*!Includes Material from setImmediate Copyright (c) 2012 Barnesandnoble.com, llc, Donavon West, and Domenic Denicola @license MIT https://github.com/NobleJS/setImmediate */
"undefined"==typeof document?(self._noTransferable=!0,self.onmessage=function(e){eval(e.data)}):function(e){"use strict";function n(){var e,n=0,s=p;for(p=[];e=s[n++];)e()}function Deferred(){function Promise(){this.then=function(n,s){return e(n,s)}}var e=function(_,r,o){if(_!==e){var a=s();return e.queue.push({deferred:a,resolve:_,reject:r}),a.promise}for(var f=r?"resolve":"reject",d=0,l=e.queue.length;l>d;d++){var u=e.queue[d],c=u.deferred,g=u[f];typeof g!==v?c[f](o):t(g,o,c)}e=i(n,o,r)},n=new Promise;this.promise=n,e.queue=[],this.resolve=function(n){e.queue&&e(e,!0,n)},this.fulfill=this.resolve,this.reject=function(n){e.queue&&e(e,!1,n)}}function s(){return new Deferred}function i(e,n,i){return function(_,r){var o=i?_:r;if(typeof o!==v)return e;var a=s();return t(o,n,a),a.promise}}function t(e,n,s){c.nextTick(function(){try{var i=e(n);i&&typeof i.then===v?i.then(s.resolve,s.reject):s.resolve(i)}catch(t){s.reject(t)}})}function _(e){for(var n=e,s=!0,i={},t=function(e,n){n&&"importScripts("+n.split(",").forEach(function(e){i[c.makeUrl(e.match(/\s*[\'\"](\S*)[\'\"]\s*/)[1])]=!0})+");\n"};s;)s=n.match(/(importScripts\(.*?\);?)/),n=n.replace(/(importScripts\(\s*(?:[\'\"].*?[\'\"])?\s*\);?)/,"\n"),s&&s[0].replace(/importScripts\(\s*([\'\"].*?[\'\"])?\s*\);?/g,t);return i=Object.keys(i),[i,n]}function r(e){var n=_(e),s=n[0],i=n[1];return s.length>0?"importScripts('"+s.join("','")+"');\n"+i:i}function o(e){var n=_(e),s=n[0],i=n[1];return s.length>0?"importScripts('"+s.join("','")+"');eval(__scripts__);\n"+i:i}function a(){if("undefined"!=typeof SHIM_WORKER_PATH)return SHIM_WORKER_PATH;if("SHIM_WORKER_PATH"in c)return c.SHIM_WORKER_PATH;for(var e=document.getElementsByTagName("script"),n=e.length,s=0;n>s;){if(/catiline(\.min)?\.js/.test(e[s].src))return e[s].src;s++}}function f(e,n){var s=e.createElement("script");"undefined"!=typeof s.text?s.text=n:s.innerHTML=n,"complete"===e.readyState?e.documentElement.appendChild(s):e.onreadystatechange=function(){"complete"===e.readyState&&e.documentElement.appendChild(s)}}function d(e,n){var s=document.createElement("iframe");s.style.display="none",document.body.appendChild(s);var i=s.contentWindow,t=i.document,_=["try{ ","var __scripts__='';function importScripts(scripts){","	if(Array.isArray(scripts)&&scripts.length>0){","		scripts.forEach(function(url){","			var ajax = new XMLHttpRequest();","			ajax.open('GET',url,false);","			ajax.send();__scripts__+=ajax.responseText;","			__scripts__+='\\n;';","		});","	}","};",e,"}catch(e){","	window.parent.postMessage(['"+n+"','error'],'*')","}"].join("\n");return f(t,_),s}function l(e,n){var s=c.deferred();return"complete"===document.readyState?s.resolve(d(e,n)):window.addEventListener("load",function(){s.resolve(d(e,n))},!1),s.promise}function u(e){c._noTransferable=!0;var n=new Worker(a());return n.postMessage(e),n}function c(e,n,s){return 1===arguments.length||!n||1>=n?new c.Worker(e):new c.Queue(e,n,s)}function g(n){var s=e.cw;n.noConflict=function(i){e.cw=s,i&&(e[i]=n)},e.catiline=n,e.cw=n,"communist"in e||(e.communist=n)}var b;if("function"==typeof setImmediate)b=setImmediate.bind(e,n);else{var m="com.catiline.setImmediate"+Math.random();addEventListener("message",function(e){e.source===window&&e.data===m&&n()},!1),b=function(){postMessage(m,"*")}}var p=[];c.nextTick=function(e){1===p.push(e)&&b()};var v="function";c.deferred=s,c.resolve=function(e){var n={};return n.then=i(n,e,!0),n},c.reject=function(e){var n={};return n.then=i(n,e,!1),n},c.all=function(e){var n=s(),i=e.length,t=0,_=[],r=function(e){return function(s){_[e]=s,t++,t===i&&n.resolve(_)}};return e.forEach(function(e,s){e.then(r(s),function(e){n.reject(e)})}),n.promise},c._hasWorker="undefined"!=typeof Worker&&"undefined"==typeof fakeLegacy,c.URL=window.URL||window.webkitURL,c._noTransferable=!c.URL,c.makeIWorker=function(e,n){var s=o(e.join("")),i={onmessage:function(){}},t=l(s,n);return window.addEventListener("message",function(e){e.data.slice&&e.data.slice(0,n.length)===n&&i.onmessage({data:JSON.parse(e.data.slice(n.length))})}),i.postMessage=function(e){t.then(function(n){n.contentWindow.postMessage(JSON.stringify(e),"*")})},i.terminate=function(){t.then(function(e){document.body.removeChild(e)})},i},c.makeWorker=function(e,n){if(!c._hasWorker)return c.makeIWorker(e,n);var s,i=r(e.join(""));if(c._noTransferable)return u(i);try{s=new Worker(c.URL.createObjectURL(new Blob([i],{type:"text/javascript"})))}catch(t){try{s=u(i)}catch(_){s=c.makeIWorker(e,n)}}finally{return s}},c.makeUrl=function(e){var n=document.createElement("link");return n.href=e,n.href},c.Worker=function(e){function n(e,s){return e.indexOf(" ")>0?(e.split(" ").forEach(function(e){n(e,s)}),t):e in i?(i[e].forEach(function(e){e(s)}),t):t}"function"==typeof e&&(e={data:e});var s="com.catilinejs."+(c._hasWorker?"iframe":"worker")+Math.random(),i={},t=this;t.on=function(e,n,s){return s=s||t,e.indexOf(" ")>0?(e.split(" ").map(function(e){return t.on(e,n,s)},this),t):(e in i||(i[e]=[]),i[e].push(function(e){n.call(s,e)}),t)},t.fire=function(e,n,s){return c._noTransferable?l.postMessage([[e],n]):l.postMessage([[e],n],s),t},t.off=function(e,n){return e.indexOf(" ")>0?(e.split(" ").map(function(e){return t.off(e,n)}),t):e in i?(n?i[e].indexOf(n)>-1&&(i[e].length>1?delete i[e]:i[e].splice(i[e].indexOf(n),1)):delete i[e],t):t};var _=[],r=function(e){"string"!=typeof e&&"preventDefault"in e&&(e.preventDefault(),e=e.message),_.forEach(function(n){n&&n.reject(e)})};e.__codeWord__='"'+s+'"',"initialize"in e||(e.initialize="init"in e?e.init:function(){});var o="{\n	",a=function(e){var n=function(n,i){var t=_.length;return _[t]=c.deferred(),c._noTransferable?l.postMessage([[s,t],e,n]):l.postMessage([[s,t],e,n],i),_[t].promise};return n},f=0;for(var d in e)0!==f?o+=",\n	":f++,o=o+d+":"+e[d].toString(),t[d]=a(d);o+="}";var l=c.makeWorker(['"use strict";function _fire(e,n){return e.indexOf(" ")>0?(e.split(" ").forEach(function(e){_fire(e,n)}),void 0):(e in listeners&&listeners[e].forEach(function(e){e(n)}),void 0)}function makeConsole(e){return function(){for(var n=arguments.length,s=[],i=0;n>i;)s.push(arguments[i]),i++;_db.fire("console",[e,s])}}var _db=',o,',listeners={},__iFrame__="undefined"!=typeof document,__self__={onmessage:function(e){return _fire("messege",e.data[1]),e.data[0][0]===_db.__codeWord__?regMsg(e):(_fire(e.data[0][0],e.data[1]),void 0)}};__iFrame__?window.onmessage=function(e){"string"==typeof e.data&&(e={data:JSON.parse(e.data)}),__self__.onmessage(e)}:self.onmessage=__self__.onmessage,__self__.postMessage=function(e,n){if(self._noTransferable||__iFrame__)if(__iFrame__){var s=_db.__codeWord__+JSON.stringify(e);window.parent.postMessage(s,"*")}else self._noTransferable&&self.postMessage(e);else self.postMessage(e,n)},_db.on=function(e,n,s){return e.indexOf(" ")>0?e.split(" ").map(function(e){return _db.on(e,n,s)},_db):(s=s||_db,e in listeners||(listeners[e]=[]),listeners[e].push(function(e){n.call(s,e,_db)}),void 0)},_db.fire=function(e,n,s){__self__.postMessage([[e],n],s)},_db.off=function(e,n){return e.indexOf(" ")>0?e.split(" ").map(function(e){return _db.off(e,n)}):(e in listeners&&(n?listeners[e].indexOf(n)>-1&&(listeners[e].length>1?delete listeners[e]:listeners[e].splice(listeners[e].indexOf(n),1)):delete listeners[e]),void 0)};var console={};["log","debug","error","info","warn","time","timeEnd"].forEach(function(e){console[e]=makeConsole(e)});var regMsg=function(e){var n,s=function(n,s){__self__.postMessage([e.data[0],n],s)};if(__iFrame__)try{n=_db[e.data[1]](e.data[2],s,_db)}catch(e){_db.fire("error",JSON.stringify(e))}else n=_db[e.data[1]](e.data[2],s,_db);"undefined"!=typeof n&&s(n)};_db.initialize(_db);'],s);l.onmessage=function(e){n("message",e.data[1]),e.data[0][0]===s?(_[e.data[0][1]].resolve(e.data[1]),_[e.data[0][1]]=0):n(e.data[0][0],e.data[1])},t.on("error",r),l.onerror=function(e){n("error",e)},t.on("console",function(e){console[e[0]].apply(console,e[1])}),t._close=function(){return l.terminate(),r("closed"),c.resolve()},"close"in t||(t.close=t._close)},c.worker=function(e){return new c.Worker(e)},c.Queue=function(e,n,s){function i(e){e=e||"canceled",p=0;var n=m;return m=[],n.forEach(function(n){n[3].reject(e)}),l}function t(e){return function(n,s){return d(e,n,s)}}function _(e){return function(n){return c.all(n.map(function(n){return d(e,n)}))}}function r(e){return function(n){var s=this;return c.all(n.map(function(n){return d(e,n).then(s.__cb__)}))}}function o(e){return function(n){return c.all(n.map(function(n){return d(e,n[0],n[1])}))}}function a(e){return function(n){var s=this;return c.all(n.map(function(n){return d(e,n[0],n[1]).then(s.__cb__)}))}}function f(e){if(p){var n=m.shift();p--,u[e][n[0]](n[1],n[2]).then(function(s){f(e),n[3].resolve(s)},function(s){f(e),n[3].reject(s)})}else g++,b.push(e)}function d(e,i,t){var _=c.deferred();if(s)return _.promise.cancel=function(e){return _.reject(e)},u[~~(Math.random()*n)][e](i,t).then(function(e){return _.resolve(e)},function(e){return _.reject(e)}),_.promise;if(!p&&g){var r=b.pop();g--,_.promise.cancel=function(e){return _.reject(e)},u[r][e](i,t).then(function(e){f(r),_.resolve(e)},function(e){f(r),_.reject(e)})}else if(p||!g){var o=[e,i,t,_];_.promise.cancel=function(e){var n=m.indexOf(o);return n>-1&&(m.splice(n,1),p--),_.reject(e)},p=m.push(o)}return _.promise}var l=this;l.__batchcb__={},l.__batchtcb__={},l.batch=function(e){return"function"==typeof e?(l.__batchcb__.__cb__=e,l.__batchcb__):i(e)},l.batchTransfer=function(e){return"function"==typeof e?(l.__batchtcb__.__cb__=e,l.__batchtcb__):i(e)};for(var u=[],g=0,b=[],m=[],p=0;n>g;)u[g]=new c.Worker(e),b.push(g),g++;l.on=function(e,n,s){return u.forEach(function(i){i.on(e,n,s)}),l},l.off=function(e,n,s){return u.forEach(function(i){i.off(e,n,s)}),l};var v=function(e,n){return u.forEach(function(s){s.fire(e,n)}),l};l.fire=function(e,s){return u[~~(Math.random()*n)].fire(e,s),l},l.batch.fire=v,l.batchTransfer.fire=v;for(var O in e)l[O]=t(O),l.batch[O]=_(O),l.__batchcb__[O]=r(O),l.batchTransfer[O]=o(O),l.__batchtcb__[O]=a(O);l._close=function(){return c.all(u.map(function(e){return e._close()}))},"close"in l||(l.close=l._close)},c.queue=function(e,n,s){return new c.Queue(e,n,s)},c.setImmediate=c.nextTick,"function"==typeof define?define(function(e){return c.SHIM_WORKER_PATH=e.toUrl("./catiline.js"),c}):"undefined"!=typeof module&&"exports"in module?module.exports=c:g(c),c.version="2.8.3"}(this);