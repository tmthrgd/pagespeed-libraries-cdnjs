!function(a){"use strict";function d(a){return function(b){return b&&this===b.target?a.apply(this,arguments):void 0}}var b=function(a,b){this.init(a,b)};b.prototype={constructor:b,init:function(b,c){if(this.$element=a(b),this.options=a.extend({},a.fn.modalmanager.defaults,this.$element.data(),"object"==typeof c&&c),this.stack=[],this.backdropCount=0,this.options.resize){var d,e=this;a(window).on("resize.modal",function(){d&&clearTimeout(d),d=setTimeout(function(){for(var a=0;a<e.stack.length;a++)e.stack[a].isShown&&e.stack[a].layout()},10)})}},createModal:function(b,c){a(b).modal(a.extend({manager:this},c))},appendModal:function(b){this.stack.push(b);var c=this;b.$element.on("show.modalmanager",d(function(){var e=function(){b.isShown=!0;var d=a.support.transition&&b.$element.hasClass("fade");c.$element.toggleClass("modal-open",c.hasOpenModal()).toggleClass("page-overflow",a(window).height()<c.$element.height()),b.$parent=b.$element.parent(),b.$container=c.createContainer(b),b.$element.appendTo(b.$container),c.backdrop(b,function(){b.$element.show(),d&&b.$element[0].offsetWidth,b.layout(),b.$element.addClass("in").attr("aria-hidden",!1);var e=function(){c.setFocus(),b.$element.trigger("shown")};d?b.$element.one(a.support.transition.end,e):e()})};b.options.replace?c.replace(e):e()})),b.$element.on("hidden.modalmanager",d(function(){if(c.backdrop(b),b.$element.parent().length)if(b.$backdrop){var e=a.support.transition&&b.$element.hasClass("fade");e&&b.$element[0].offsetWidth,a.support.transition&&b.$element.hasClass("fade")?b.$backdrop.one(a.support.transition.end,function(){b.destroy()}):b.destroy()}else b.destroy();else c.destroyModal(b)})),b.$element.on("destroyed.modalmanager",d(function(){c.destroyModal(b)}))},getOpenModals:function(){for(var a=[],b=0;b<this.stack.length;b++)this.stack[b].isShown&&a.push(this.stack[b]);return a},hasOpenModal:function(){return this.getOpenModals().length>0},setFocus:function(){for(var a,b=0;b<this.stack.length;b++)this.stack[b].isShown&&(a=this.stack[b]);a&&a.focus()},destroyModal:function(a){a.$element.off(".modalmanager"),a.$backdrop&&this.removeBackdrop(a),this.stack.splice(this.getIndexOfModal(a),1);var b=this.hasOpenModal();this.$element.toggleClass("modal-open",b),b||this.$element.removeClass("page-overflow"),this.removeContainer(a),this.setFocus()},getModalAt:function(a){return this.stack[a]},getIndexOfModal:function(a){for(var b=0;b<this.stack.length;b++)if(a===this.stack[b])return b},replace:function(b){for(var c,e=0;e<this.stack.length;e++)this.stack[e].isShown&&(c=this.stack[e]);c?(this.$backdropHandle=c.$backdrop,c.$backdrop=null,b&&c.$element.one("hidden",d(a.proxy(b,this))),c.hide()):b&&b()},removeBackdrop:function(a){a.$backdrop.remove(),a.$backdrop=null},createBackdrop:function(b,c){var d;return this.$backdropHandle?(d=this.$backdropHandle,d.off(".modalmanager"),this.$backdropHandle=null,this.isLoading&&this.removeSpinner()):d=a(c).addClass(b).appendTo(this.$element),d},removeContainer:function(a){a.$container.remove(),a.$container=null},createContainer:function(b){var e;return e=a('<div class="modal-scrollable">').css("z-index",c("modal",this.getOpenModals().length)).appendTo(this.$element),b&&"static"!=b.options.backdrop?e.on("click.modal",d(function(){b.hide()})):b&&e.on("click.modal",d(function(){b.attention()})),e},backdrop:function(b,d){var e=b.$element.hasClass("fade")?"fade":"",f=b.options.backdrop&&this.backdropCount<this.options.backdropLimit;if(b.isShown&&f){var g=a.support.transition&&e&&!this.$backdropHandle;b.$backdrop=this.createBackdrop(e,b.options.backdropTemplate),b.$backdrop.css("z-index",c("backdrop",this.getOpenModals().length)),g&&b.$backdrop[0].offsetWidth,b.$backdrop.addClass("in"),this.backdropCount+=1,g?b.$backdrop.one(a.support.transition.end,d):d()}else if(!b.isShown&&b.$backdrop){b.$backdrop.removeClass("in"),this.backdropCount-=1;var h=this;a.support.transition&&b.$element.hasClass("fade")?b.$backdrop.one(a.support.transition.end,function(){h.removeBackdrop(b)}):h.removeBackdrop(b)}else d&&d()},removeSpinner:function(){this.$spinner&&this.$spinner.remove(),this.$spinner=null,this.isLoading=!1},removeLoading:function(){this.$backdropHandle&&this.$backdropHandle.remove(),this.$backdropHandle=null,this.removeSpinner()},loading:function(b){if(b=b||function(){},this.$element.toggleClass("modal-open",!this.isLoading||this.hasOpenModal()).toggleClass("page-overflow",a(window).height()<this.$element.height()),this.isLoading)if(this.isLoading&&this.$backdropHandle){this.$backdropHandle.removeClass("in");var f=this;a.support.transition?this.$backdropHandle.one(a.support.transition.end,function(){f.removeLoading()}):f.removeLoading()}else b&&b(this.isLoading);else{this.$backdropHandle=this.createBackdrop("fade",this.options.backdropTemplate),this.$backdropHandle[0].offsetWidth;var d=this.getOpenModals();this.$backdropHandle.css("z-index",c("backdrop",d.length+1)).addClass("in");var e=a(this.options.spinner).css("z-index",c("modal",d.length+1)).appendTo(this.$element).addClass("in");this.$spinner=a(this.createContainer()).append(e).on("click.modalmanager",a.proxy(this.loading,this)),this.isLoading=!0,a.support.transition?this.$backdropHandle.one(a.support.transition.end,b):b()}}};var c=function(){var b,c={};return function(d,e){if("undefined"==typeof b){var f=a('<div class="modal hide" />').appendTo("body"),g=a('<div class="modal-backdrop hide" />').appendTo("body");c.modal=+f.css("z-index"),c.backdrop=+g.css("z-index"),b=c.modal-c.backdrop,f.remove(),g.remove(),g=f=null}return c[d]+b*e}}();a.fn.modalmanager=function(c,d){return this.each(function(){var e=a(this),f=e.data("modalmanager");f||e.data("modalmanager",f=new b(this,c)),"string"==typeof c&&f[c].apply(f,[].concat(d))})},a.fn.modalmanager.defaults={backdropLimit:999,resize:!0,spinner:'<div class="loading-spinner fade" style="width: 200px; margin-left: -100px;"><div class="progress progress-striped active"><div class="bar" style="width: 100%;"></div></div></div>',backdropTemplate:'<div class="modal-backdrop" />'},a.fn.modalmanager.Constructor=b,a(function(){a(document).off("show.bs.modal").off("hidden.bs.modal")})}(jQuery);