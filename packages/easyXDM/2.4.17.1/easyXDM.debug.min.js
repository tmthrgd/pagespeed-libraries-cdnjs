!function(e,n,t,r,o,a){function i(e,n){var t=typeof e[n];return"function"==t||!("object"!=t||!e[n])||"unknown"==t}function s(e,n){return!("object"!=typeof e[n]||!e[n])}function c(e){return"[object Array]"===Object.prototype.toString.call(e)}function l(){var e="Shockwave Flash",n="application/x-shockwave-flash";if(!w(navigator.plugins)&&"object"==typeof navigator.plugins[e]){var t=navigator.plugins[e].description;t&&!w(navigator.mimeTypes)&&navigator.mimeTypes[n]&&navigator.mimeTypes[n].enabledPlugin&&(D=t.match(/\d+/g))}if(!D){var r;try{r=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),D=Array.prototype.slice.call(r.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),r=null}catch(o){}}if(!D)return!1;var a=parseInt(D[0],10),i=parseInt(D[1],10);return S=a>9&&i>0,!0}function u(){if(!z){z=!0,q("firing dom_onReady");for(var e=0;e<Q.length;e++)Q[e]();Q.length=0}}function d(e,n){return z?(e.call(n),void 0):(Q.push(function(){e.call(n)}),void 0)}function f(){var e=parent;if(""!==j)for(var n=0,t=j.split(".");n<t.length;n++){if(!e)throw new Error(t.slice(0,n+1).join(".")+" is not an object");e=e[t[n]]}if(!e||!e.easyXDM)throw new Error("Could not find easyXDM in parent."+j);return e.easyXDM}function p(n){if("string"!=typeof n||!n)throw new Error("namespace must be a non-empty string");return q("Settings namespace to '"+n+"'"),e.easyXDM=A,j=n,j&&(I="easyXDM_"+j.replace(".","_")+"_"),L}function g(e){if(!e)throw new Error("url is undefined or empty");return e.match(C)[3]}function h(e){if(!e)throw new Error("url is undefined or empty");return e.match(C)[4]||""}function m(e){if(!e)throw new Error("url is undefined or empty");if(/^file/.test(e))throw new Error("The file:// protocol is not supported");var n=e.toLowerCase().match(C),t=n[2],r=n[3],o=n[4]||"";return("http:"==t&&":80"==o||"https:"==t&&":443"==o)&&(o=""),t+"//"+r+o}function v(e){if(!e)throw new Error("url is undefined or empty");if(e=e.replace(B,"$1/"),!e.match(/^(http||https):\/\//)){var n="/"===e.substring(0,1)?"":t.pathname;"/"!==n.substring(n.length-1)&&(n=n.substring(0,n.lastIndexOf("/")+1)),e=t.protocol+"//"+t.host+n+e}for(;X.test(e);)e=e.replace(X,"");return q("resolved url '"+e+"'"),e}function y(e,n){if(!n)throw new Error("parameters is undefined or null");var t="",r=e.indexOf("#");-1!==r&&(t=e.substring(r),e=e.substring(0,r));var o=[];for(var i in n)n.hasOwnProperty(i)&&o.push(i+"="+a(n[i]));return e+(J?"#":-1==e.indexOf("?")?"?":"&")+o.join("&")+t}function w(e){return"undefined"==typeof e}function b(e,n,t){var r;for(var o in n)n.hasOwnProperty(o)&&(o in e?(r=n[o],"object"==typeof r?b(e[o],r,t):t||(e[o]=n[o])):e[o]=n[o]);return e}function k(){var e=n.body.appendChild(n.createElement("form")),t=e.appendChild(n.createElement("input"));t.name=I+"TEST"+H,E=t!==e.elements[t.name],n.body.removeChild(e),q("HAS_NAME_PROPERTY_BUG: "+E)}function _(e){q("creating frame: "+e.props.src),w(E)&&k();var t;E?t=n.createElement('<iframe name="'+e.props.name+'"/>'):(t=n.createElement("IFRAME"),t.name=e.props.name),t.id=t.name=e.props.name,delete e.props.name,"string"==typeof e.container&&(e.container=n.getElementById(e.container)),e.container||(b(t.style,{position:"absolute",top:"-2000px",left:"0px"}),e.container=n.body);var r=e.props.src;if(e.props.src="javascript:false",b(t,e.props),t.border=t.frameBorder=0,t.allowTransparency=!0,e.container.appendChild(t),e.onLoad&&R(t,"load",e.onLoad),e.usePost){var o,a=e.container.appendChild(n.createElement("form"));if(a.target=t.name,a.action=r,a.method="POST","object"==typeof e.usePost)for(var i in e.usePost)e.usePost.hasOwnProperty(i)&&(E?o=n.createElement('<input name="'+i+'"/>'):(o=n.createElement("INPUT"),o.name=i),o.value=e.usePost[i],a.appendChild(o));a.submit(),a.parentNode.removeChild(a)}else t.src=r;return e.props.src=r,t}function x(e,n){"string"==typeof e&&(e=[e]);for(var t,r=e.length;r--;)if(t=e[r],t=new RegExp("^"==t.substr(0,1)?t:"^"+t.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),t.test(n))return!0;return!1}function T(r){var o,a=r.protocol;if(r.isHost=r.isHost||w(V.xdm_p),J=r.hash||!1,q("preparing transport stack"),r.props||(r.props={}),r.isHost)r.remote=v(r.remote),r.channel=r.channel||"default"+H++,r.secret=Math.random().toString(16).substring(2),w(a)?(a=m(t.href)==m(r.remote)?"4":i(e,"postMessage")||i(n,"postMessage")?"1":r.swf&&i(e,"ActiveXObject")&&l()?"6":"Gecko"===navigator.product&&"frameElement"in e&&-1==navigator.userAgent.indexOf("WebKit")?"5":r.remoteHelper?"2":"0",q("selecting protocol: "+a)):q("using protocol: "+a);else if(q("using parameters from query"),r.channel=V.xdm_c.replace(/["'<>\\]/g,""),r.secret=V.xdm_s,r.remote=V.xdm_e.replace(/["'<>\\]/g,""),a=V.xdm_p,r.acl&&!x(r.acl,r.remote))throw new Error("Access denied for "+r.remote);switch(r.protocol=a,a){case"0":if(b(r,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),r.isHost){if(!r.local){q("looking for image to use as local");for(var s,c=t.protocol+"//"+t.host,u=n.body.getElementsByTagName("img"),d=u.length;d--;)if(s=u[d],s.src.substring(0,c.length)===c){r.local=s.src;break}r.local||(q("no image found, defaulting to using the window"),r.local=e)}var f={xdm_c:r.channel,xdm_p:0};r.local===e?(r.usePolling=!0,r.useParent=!0,r.local=t.protocol+"//"+t.host+t.pathname+t.search,f.xdm_e=r.local,f.xdm_pa=1):f.xdm_e=v(r.local),r.container&&(r.useResize=!1,f.xdm_po=1),r.remote=y(r.remote,f)}else b(r,{channel:V.xdm_c,remote:V.xdm_e,useParent:!w(V.xdm_pa),usePolling:!w(V.xdm_po),useResize:r.useParent?!1:r.useResize});o=[new L.stack.HashTransport(r),new L.stack.ReliableBehavior({}),new L.stack.QueueBehavior({encode:!0,maxLength:4e3-r.remote.length}),new L.stack.VerifyBehavior({initiate:r.isHost})];break;case"1":o=[new L.stack.PostMessageTransport(r)];break;case"2":r.isHost&&(r.remoteHelper=v(r.remoteHelper)),o=[new L.stack.NameTransport(r),new L.stack.QueueBehavior,new L.stack.VerifyBehavior({initiate:r.isHost})];break;case"3":o=[new L.stack.NixTransport(r)];break;case"4":o=[new L.stack.SameOriginTransport(r)];break;case"5":o=[new L.stack.FrameElementTransport(r)];break;case"6":D||l(),o=[new L.stack.FlashTransport(r)]}return o.push(new L.stack.QueueBehavior({lazy:r.lazy,remove:!0})),o}function M(e){for(var n,t={incoming:function(e,n){this.up.incoming(e,n)},outgoing:function(e,n){this.down.outgoing(e,n)},callback:function(e){this.up.callback(e)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},r=0,o=e.length;o>r;r++)n=e[r],b(n,t,!0),0!==r&&(n.down=e[r-1]),r!==o-1&&(n.up=e[r+1]);return n}function O(e){e.up.down=e.down,e.down.up=e.up,e.up=e.down=null}var E,D,S,R,N,F=this,H=Math.floor(1e4*Math.random()),P=Function.prototype,C=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,X=/[\-\w]+\/\.\.\//,B=/([^:])\/\//g,j="",L={},A=e.easyXDM,I="easyXDM_",J=!1,q=P;if(i(e,"addEventListener"))R=function(e,n,t){q("adding listener "+n),e.addEventListener(n,t,!1)},N=function(e,n,t){q("removing listener "+n),e.removeEventListener(n,t,!1)};else{if(!i(e,"attachEvent"))throw new Error("Browser not supported");R=function(e,n,t){q("adding listener "+n),e.attachEvent("on"+n,t)},N=function(e,n,t){q("removing listener "+n),e.detachEvent("on"+n,t)}}var W,z=!1,Q=[];if("readyState"in n?(W=n.readyState,z="complete"==W||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==W||"interactive"==W)):z=!!n.body,!z){if(i(e,"addEventListener"))R(n,"DOMContentLoaded",u);else if(R(n,"readystatechange",function(){"complete"==n.readyState&&u()}),n.documentElement.doScroll&&e===top){var U=function(){if(!z){try{n.documentElement.doScroll("left")}catch(e){return r(U,1),void 0}u()}};U()}R(e,"load",u)}var V=function(e){e=e.substring(1).split("&");for(var n,t={},r=e.length;r--;)n=e[r].split("="),t[n[0]]=o(n[1]);return t}(/xdm_e=/.test(t.search)?t.search:t.hash),$=function(){var e={},n={a:[1,2,3]},t='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(n).replace(/\s/g,"")===t?JSON:(Object.toJSON&&Object.toJSON(n).replace(/\s/g,"")===t&&(e.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(n=t.evalJSON(),n.a&&3===n.a.length&&3===n.a[2]&&(e.parse=function(e){return e.evalJSON()})),e.stringify&&e.parse?($=function(){return e},e):null)};b(L,{version:"2.4.18.25",query:V,stack:{},apply:b,getJSONObject:$,whenReady:d,noConflict:p}),b(L,{checkAcl:x,getDomainName:g,getLocation:m,appendQueryParameters:y});var G={_deferred:[],flush:function(){this.trace("... deferred messages ...");for(var e=0,n=this._deferred.length;n>e;e++)this.trace(this._deferred[e]);this._deferred.length=0,this.trace("... end of deferred messages ...")},getTime:function(){var e=new Date,n=e.getHours()+"",t=e.getMinutes()+"",r=e.getSeconds()+"",o=e.getMilliseconds()+"",a="000";return 1==n.length&&(n="0"+n),1==t.length&&(t="0"+t),1==r.length&&(r="0"+r),o=a.substring(o.length)+o,n+":"+t+":"+r+"."+o},log:function(n){this.log=!s(e,"console")||w(console.log)?P:function(e){console.log(t.host+(j?":"+j:"")+" - "+this.getTime()+": "+e)},this.log(n)},trace:function(r){if(z){var o=n.getElementById("log");if(o)this.trace=function(e){try{o.appendChild(n.createElement("div")).appendChild(n.createTextNode(t.host+(j?":"+j:"")+" - "+this.getTime()+":"+e)),o.scrollTop=o.scrollHeight}catch(r){}};else if(s(e,"console")&&!w(console.info))this.trace=function(e){console.info(t.host+(j?":"+j:"")+" - "+this.getTime()+":"+e)};else{var a,i=t.host,c=i.replace(/[\-.:]/g,"")+"easyxdm_log";try{a=e.open("",c,"width=800,height=200,status=0,navigation=0,scrollbars=1")}catch(l){}if(a){var u=a.document;o=u.getElementById("log"),o||(u.write("<html><head><title>easyXDM log "+i+"</title></head>"),u.write('<body><div id="log"></div></body></html>'),u.close(),o=u.getElementById("log")),this.trace=function(e){try{o.appendChild(u.createElement("div")).appendChild(u.createTextNode(t.host+(j?":"+j:"")+" - "+this.getTime()+":"+e)),o.scrollTop=o.scrollHeight}catch(n){}},this.trace("---- new logger at "+t.href)}o||(this.trace=P)}this.trace(r)}else 0===this._deferred.length&&L.whenReady(G.flush,G),this._deferred.push(r),this.log(r)},getTracer:function(e){return function(n){G.trace(e+": "+n)}}};G.log("easyXDM present on '"+t.href),L.Debug=G,q=G.getTracer("{Private}"),L.DomHelper={on:R,un:N,requiresJSON:function(t){s(e,"JSON")?G.log("native JSON found"):(G.log("loading external JSON"),n.write('<script type="text/javascript" src="'+t+'"><'+"/script>"))}},function(){var e={};L.Fn={set:function(n,t){this._trace("storing function "+n),e[n]=t},get:function(n,t){this._trace("retrieving function "+n);var r=e[n];return r||this._trace(n+" not found"),t&&delete e[n],r}},L.Fn._trace=G.getTracer("easyXDM.Fn")}(),L.Socket=function(e){var n=G.getTracer("easyXDM.Socket");n("constructor");var t=M(T(e).concat([{incoming:function(n,t){e.onMessage(n,t)},callback:function(n){e.onReady&&e.onReady(n)}}])),r=m(e.remote);this.origin=m(e.remote),this.destroy=function(){t.destroy()},this.postMessage=function(e){t.outgoing(e,r)},t.init()},L.Rpc=function(e,n){var t=G.getTracer("easyXDM.Rpc");if(t("constructor"),n.local)for(var r in n.local)if(n.local.hasOwnProperty(r)){var o=n.local[r];"function"==typeof o&&(n.local[r]={method:o})}var a=M(T(e).concat([new L.stack.RpcBehavior(this,n),{callback:function(n){e.onReady&&e.onReady(n)}}]));this.origin=m(e.remote),this.destroy=function(){a.destroy()},a.init()},L.stack.SameOriginTransport=function(e){var n=G.getTracer("easyXDM.stack.SameOriginTransport");n("constructor");var o,a,i,s;return o={outgoing:function(e,n,t){i(e),t&&t()},destroy:function(){n("destroy"),a&&(a.parentNode.removeChild(a),a=null)},onDOMReady:function(){n("init"),s=m(e.remote),e.isHost?(b(e.props,{src:y(e.remote,{xdm_e:t.protocol+"//"+t.host+t.pathname,xdm_c:e.channel,xdm_p:4}),name:I+e.channel+"_provider"}),a=_(e),L.Fn.set(e.channel,function(e){return i=e,r(function(){o.up.callback(!0)},0),function(e){o.up.incoming(e,s)}})):(i=f().Fn.get(e.channel,!0)(function(e){o.up.incoming(e,s)}),r(function(){o.up.callback(!0)},0))},init:function(){d(o.onDOMReady,o)}}},L.stack.FlashTransport=function(e){function o(e){r(function(){s("received message"),c.up.incoming(e,u)},0)}function i(t){s("creating factory with SWF from "+t);var r=e.swf+"?host="+e.isHost,o="easyXDM_swf_"+Math.floor(1e4*Math.random());L.Fn.set("flash_loaded"+t.replace(/[\-.]/g,"_"),function(){L.stack.FlashTransport[t].swf=f=p.firstChild;for(var e=L.stack.FlashTransport[t].queue,n=0;n<e.length;n++)e[n]();e.length=0}),e.swfContainer?p="string"==typeof e.swfContainer?n.getElementById(e.swfContainer):e.swfContainer:(p=n.createElement("div"),b(p.style,S&&e.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),n.body.appendChild(p));var i="callback=flash_loaded"+a(t.replace(/[\-.]/g,"_"))+"&proto="+F.location.protocol+"&domain="+a(g(F.location.href))+"&port="+a(h(F.location.href))+"&ns="+a(j);i+="&log=true",p.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+o+"' data='"+r+"'>"+"<param name='allowScriptAccess' value='always'></param>"+"<param name='wmode' value='transparent'>"+"<param name='movie' value='"+r+"'></param>"+"<param name='flashvars' value='"+i+"'></param>"+"<embed type='application/x-shockwave-flash' FlashVars='"+i+"' allowScriptAccess='always' wmode='transparent' src='"+r+"' height='1' width='1'></embed>"+"</object>"}var s=G.getTracer("easyXDM.stack.FlashTransport");if(s("constructor"),!e.swf)throw new Error("Path to easyxdm.swf is missing");var c,l,u,f,p;return c={outgoing:function(n,t,r){f.postMessage(e.channel,n.toString()),r&&r()},destroy:function(){s("destroy");try{f.destroyChannel(e.channel)}catch(n){}f=null,l&&(l.parentNode.removeChild(l),l=null)},onDOMReady:function(){s("init"),u=e.remote,L.Fn.set("flash_"+e.channel+"_init",function(){r(function(){s("firing onReady"),c.up.callback(!0)})}),L.Fn.set("flash_"+e.channel+"_onMessage",o),e.swf=v(e.swf);var n=g(e.swf),a=function(){L.stack.FlashTransport[n].init=!0,f=L.stack.FlashTransport[n].swf,f.createChannel(e.channel,e.secret,m(e.remote),e.isHost),e.isHost&&(S&&e.swfNoThrottle&&b(e.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),b(e.props,{src:y(e.remote,{xdm_e:m(t.href),xdm_c:e.channel,xdm_p:6,xdm_s:e.secret}),name:I+e.channel+"_provider"}),l=_(e))};L.stack.FlashTransport[n]&&L.stack.FlashTransport[n].init?a():L.stack.FlashTransport[n]?L.stack.FlashTransport[n].queue.push(a):(L.stack.FlashTransport[n]={queue:[a]},i(n))},init:function(){d(c.onDOMReady,c)}}},L.stack.PostMessageTransport=function(n){function o(e){if(e.origin)return m(e.origin);if(e.uri)return m(e.uri);if(e.domain)return t.protocol+"//"+e.domain;throw"Unable to retrieve the origin of the event"}function a(e){var t=o(e);i("received message '"+e.data+"' from "+t),t==u&&e.data.substring(0,n.channel.length+1)==n.channel+" "&&s.up.incoming(e.data.substring(n.channel.length+1),t)}var i=G.getTracer("easyXDM.stack.PostMessageTransport");i("constructor");var s,c,l,u;return s={outgoing:function(e,t,r){l.postMessage(n.channel+" "+e,t||u),r&&r()},destroy:function(){i("destroy"),N(e,"message",a),c&&(l=null,c.parentNode.removeChild(c),c=null)},onDOMReady:function(){if(i("init"),u=m(n.remote),n.isHost){var o=function(t){t.data==n.channel+"-ready"&&(i("firing onReady"),l="postMessage"in c.contentWindow?c.contentWindow:c.contentWindow.document,N(e,"message",o),R(e,"message",a),r(function(){s.up.callback(!0)},0))};R(e,"message",o),b(n.props,{src:y(n.remote,{xdm_e:m(t.href),xdm_c:n.channel,xdm_p:1}),name:I+n.channel+"_provider"}),c=_(n)}else R(e,"message",a),l="postMessage"in e.parent?e.parent:e.parent.document,l.postMessage(n.channel+"-ready",u),r(function(){s.up.callback(!0)},0)},init:function(){d(s.onDOMReady,s)}}},L.stack.FrameElementTransport=function(o){var a=G.getTracer("easyXDM.stack.FrameElementTransport");a("constructor");var i,s,c,l;return i={outgoing:function(e,n,t){c.call(this,e),t&&t()},destroy:function(){a("destroy"),s&&(s.parentNode.removeChild(s),s=null)},onDOMReady:function(){a("init"),l=m(o.remote),o.isHost?(b(o.props,{src:y(o.remote,{xdm_e:m(t.href),xdm_c:o.channel,xdm_p:5}),name:I+o.channel+"_provider"}),s=_(o),s.fn=function(e){return delete s.fn,c=e,r(function(){i.up.callback(!0)},0),function(e){i.up.incoming(e,l)}}):(n.referrer&&m(n.referrer)!=V.xdm_e&&(e.top.location=V.xdm_e),c=e.frameElement.fn(function(e){i.up.incoming(e,l)}),i.up.callback(!0))},init:function(){d(i.onDOMReady,i)}}},L.stack.NameTransport=function(e){function n(n){var t=e.remoteHelper+(c?"#_3":"#_2")+e.channel;i("sending message "+n),i("navigating to  '"+t+"'"),l.contentWindow.sendMessage(n,t)}function t(){c?2!==++f&&c||s.up.callback(!0):(n("ready"),i("calling onReady"),s.up.callback(!0))}function o(e){i("received message "+e),s.up.incoming(e,g)}function a(){p&&r(function(){p(!0)},0)}var i=G.getTracer("easyXDM.stack.NameTransport");if(i("constructor"),e.isHost&&w(e.remoteHelper))throw i("missing remoteHelper"),new Error("missing remoteHelper");var s,c,l,u,f,p,g,h;return s={outgoing:function(e,t,r){p=r,n(e)},destroy:function(){i("destroy"),l.parentNode.removeChild(l),l=null,c&&(u.parentNode.removeChild(u),u=null)},onDOMReady:function(){i("init"),c=e.isHost,f=0,g=m(e.remote),e.local=v(e.local),c?(L.Fn.set(e.channel,function(n){i("received initial message "+n),c&&"ready"===n&&(L.Fn.set(e.channel,o),t())}),h=y(e.remote,{xdm_e:e.local,xdm_c:e.channel,xdm_p:2}),b(e.props,{src:h+"#"+e.channel,name:I+e.channel+"_provider"}),u=_(e)):(e.remoteHelper=e.remote,L.Fn.set(e.channel,o));var n=function(){var o=l||this;N(o,"load",n),L.Fn.set(e.channel+"_load",a),function i(){"function"==typeof o.contentWindow.sendMessage?t():r(i,50)}()};l=_({props:{src:e.local+"#_4"+e.channel},onLoad:n})},init:function(){d(s.onDOMReady,s)}}},L.stack.HashTransport=function(n){function t(e){if(s("sending message '"+(g+1)+" "+e+"' to "+w),!v)return s("no caller window"),void 0;var t=n.remote+"#"+g++ +"_"+e;(l||!y?v.contentWindow:v).location=t}function o(e){p=e,s("received message '"+p+"' from "+w),c.up.incoming(p.substring(p.indexOf("_")+1),w)}function a(){if(h){var e=h.location.href,n="",t=e.indexOf("#");-1!=t&&(n=e.substring(t)),n&&n!=p&&(s("poll: new message"),o(n))}}function i(){s("starting polling"),u=setInterval(a,f)}var s=G.getTracer("easyXDM.stack.HashTransport");s("constructor");var c,l,u,f,p,g,h,v,y,w;return c={outgoing:function(e){t(e)},destroy:function(){e.clearInterval(u),(l||!y)&&v.parentNode.removeChild(v),v=null},onDOMReady:function(){if(l=n.isHost,f=n.interval,p="#"+n.channel,g=0,y=n.useParent,w=m(n.remote),l){if(b(n.props,{src:n.remote,name:I+n.channel+"_provider"}),y)n.onLoad=function(){h=e,i(),c.up.callback(!0)};else{var t=0,o=n.delay/50;!function a(){if(++t>o)throw s("unable to get reference to _listenerWindow, giving up"),new Error("Unable to reference listenerwindow");try{h=v.contentWindow.frames[I+n.channel+"_consumer"]}catch(e){}h?(i(),s("got a reference to _listenerWindow"),c.up.callback(!0)):r(a,50)}()}v=_(n)}else h=e,i(),y?(v=parent,c.up.callback(!0)):(b(n,{props:{src:n.remote+"#"+n.channel+new Date,name:I+n.channel+"_consumer"},onLoad:function(){c.up.callback(!0)}}),v=_(n))},init:function(){d(c.onDOMReady,c)}}},L.stack.ReliableBehavior=function(){var e=G.getTracer("easyXDM.stack.ReliableBehavior");e("constructor");var n,t,r=0,o=0,a="";return n={incoming:function(i,s){e("incoming: "+i);var c=i.indexOf("_"),l=i.substring(0,c).split(",");i=i.substring(c+1),l[0]==r&&(e("message delivered"),a="",t&&t(!0)),i.length>0&&(e("sending ack, and passing on "+i),n.down.outgoing(l[1]+","+r+"_"+a,s),o!=l[1]&&(o=l[1],n.up.incoming(i,s)))},outgoing:function(e,i,s){a=e,t=s,n.down.outgoing(o+","+ ++r+"_"+e,i)}}},L.stack.QueueBehavior=function(e){function n(){if(e.remove&&0===c.length)return t("removing myself from the stack"),O(i),void 0;if(!l&&0!==c.length&&!s){t("dispatching from queue"),l=!0;var o=c.shift();i.down.outgoing(o.data,o.origin,function(e){l=!1,o.callback&&r(function(){o.callback(e)},0),n()})}}var t=G.getTracer("easyXDM.stack.QueueBehavior");t("constructor");var i,s,c=[],l=!0,u="",d=0,f=!1,p=!1;return i={init:function(){w(e)&&(e={}),e.maxLength&&(d=e.maxLength,p=!0),e.lazy?f=!0:i.down.init()},callback:function(e){l=!1;var t=i.up;n(),t.callback(e)},incoming:function(n,r){if(p){var a=n.indexOf("_"),s=parseInt(n.substring(0,a),10);u+=n.substring(a+1),0===s?(t("received the last fragment"),e.encode&&(u=o(u)),i.up.incoming(u,r),u=""):t("waiting for more fragments, seq="+n)}else i.up.incoming(n,r)},outgoing:function(r,o,s){e.encode&&(r=a(r));var l,u=[];if(p){for(;0!==r.length;)l=r.substring(0,d),r=r.substring(l.length),u.push(l);for(;l=u.shift();)t("enqueuing"),c.push({data:u.length+"_"+l,origin:o,callback:0===u.length?s:null})}else c.push({data:r,origin:o,callback:s});f?i.down.init():n()},destroy:function(){t("destroy"),s=!0,i.down.destroy()}}},L.stack.VerifyBehavior=function(e){function n(){t("requesting verification"),o=Math.random().toString(16).substring(2),r.down.outgoing(o)}var t=G.getTracer("easyXDM.stack.VerifyBehavior");if(t("constructor"),w(e.initiate))throw new Error("settings.initiate is not set");var r,o,a;return r={incoming:function(i,s){var c=i.indexOf("_");-1===c?i===o?(t("verified, calling callback"),r.up.callback(!0)):a||(t("returning secret"),a=i,e.initiate||n(),r.down.outgoing(i)):i.substring(0,c)===a&&r.up.incoming(i.substring(c+1),s)},outgoing:function(e,n,t){r.down.outgoing(o+"_"+e,n,t)},callback:function(){e.initiate&&n()}}},L.stack.RpcBehavior=function(e,n){function t(e){e.jsonrpc="2.0",a.down.outgoing(s.stringify(e))}function r(e,n){var r=Array.prototype.slice;return i("creating method "+n),function(){i("executing method "+n);var o,a=arguments.length,s={method:n};a>0&&"function"==typeof arguments[a-1]?(a>1&&"function"==typeof arguments[a-2]?(o={success:arguments[a-2],error:arguments[a-1]},s.params=r.call(arguments,0,a-2)):(o={success:arguments[a-1]},s.params=r.call(arguments,0,a-1)),u[""+ ++l]=o,s.id=l):s.params=r.call(arguments,0),e.namedParams&&1===s.params.length&&(s.params=s.params[0]),t(s)}}function o(e,n,r,o){if(!r)return i("requested to execute non-existent procedure "+e),n&&t({id:n,error:{code:-32601,message:"Procedure not found."}}),void 0;i("requested to execute procedure "+e);var a,s;n?(a=function(e){a=P,t({id:n,result:e})},s=function(e,r){s=P;var o={id:n,error:{code:-32099,message:e}};r&&(o.error.data=r),t(o)}):a=s=P,c(o)||(o=[o]);try{var l=r.method.apply(r.scope,o.concat([a,s]));w(l)||a(l)}catch(u){s(u.message)}}var a,i=G.getTracer("easyXDM.stack.RpcBehavior"),s=n.serializer||$(),l=0,u={};return a={incoming:function(e){var r=s.parse(e);if(r.method)i("received request to execute method "+r.method+(r.id?" using callback id "+r.id:"")),n.handle?n.handle(r,t):o(r.method,r.id,n.local[r.method],r.params);else{i("received return value destined to callback with id "+r.id);var a=u[r.id];r.error?a.error?a.error(r.error):i("unhandled error returned."):a.success&&a.success(r.result),delete u[r.id]}},init:function(){if(i("init"),n.remote){i("creating stubs");for(var t in n.remote)n.remote.hasOwnProperty(t)&&(e[t]=r(n.remote[t],t))}a.down.init()},destroy:function(){i("destroy");for(var t in n.remote)n.remote.hasOwnProperty(t)&&e.hasOwnProperty(t)&&delete e[t];a.down.destroy()}}},F.easyXDM=L}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);