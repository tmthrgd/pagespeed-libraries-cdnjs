/**
 * CSS on-demand for AngularJS
 * @version v1.0.0
 * @author DOOR3, Alex Castillo
 * @link http://door3.github.io/angular-css
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
 "use strict";(function(e){var t=e.module("door3.css",[]);t.config(["$logProvider",function(e){e.debugEnabled(false)}]);t.provider("$css",[function(){var r=this.defaults={element:"link",rel:"stylesheet",type:"text/css",container:"head",method:"append",weight:0};this.$get=["$rootScope","$injector","$window","$timeout","$compile","$http","$filter","$log",function(i,s,o,u,a,f,l,c){function b(e,t,n){if(n&&t.hasOwnProperty("css"))h.bind([S(t.css)],n)}function w(e,t,n){if(n)h.remove(h.getFromRoute(n));if(t)h.add(h.getFromRoute(t))}function E(e,t,n,r){if(r)h.remove(h.getFromState(r));if(t)h.add(h.getFromState(t))}function S(t){if(!t)return;if(e.isString(t)){t=e.extend({href:t},g)}if(e.isArray(t)&&e.isString(t[0])){e.forEach(t,function(n){t=e.extend({href:n},g)})}if(e.isObject(t)&&!e.isArray(t)){t=e.extend(t,g)}if(e.isArray(t)&&e.isObject(t[0])){e.forEach(t,function(n){t=e.extend(n,g)})}return t}function x(e){if(!e)return c.error("No stylesheets provided");var t="?cache=";if(e.href.indexOf(t)===-1)e.href=e.href+(e.bustCache?t+(new Date).getTime():"")}function T(e,t){if(!e||!t)return c.error("filterBy: missing array or property");return l("filter")(e,function(e){return e[t]})}function N(e){if(!e)return c.error("No stylesheet provided");d[e.href]=o.matchMedia(e.media);v[e.href]=function(t){u(function(){if(t.matches){i.stylesheets.push(e)}else{var n=i.stylesheets.indexOf(l("filter")(i.stylesheets,{href:e.href})[0]);if(n!==-1)i.stylesheets.splice(n,1)}})};d[e.href].addListener(v[e.href]);v[e.href](d[e.href])}function C(t){if(!t)return c.error("No stylesheet provided");if(i&&e.isDefined(d)&&d[t.href]&&e.isDefined(v)){d[t.href].removeListener(v[t.href])}}function k(e){if(!e)return c.error("No stylesheet provided");return!!(e.media&&m.indexOf(e.media)===-1&&o.matchMedia)}var h={};var p='<link ng-repeat="stylesheet in stylesheets track by $index | orderBy: \'weight\' " rel="{{ stylesheet.rel }}" type="{{ stylesheet.type }}" ng-href="{{ stylesheet.href }}" ng-attr-media="{{ stylesheet.media }}">';var d={},v={},m=["print"],g=e.extend({},r),y=e.element(document.querySelector?document.querySelector(g.container):document.getElementsByTagName(g.container)[0]);e.forEach(n,function(e,t){if(e.hasOwnProperty("css"))n[t]=S(e.css)});i.stylesheets=[];y[g.method](a(p)(i));i.$on("$directiveAdd",b);i.$on("$routeChangeStart",w);i.$on("$stateChangeStart",E);h.getFromRoute=function(t){if(!t)return c.error("Get From Route: No route provided");var n=null,r=[];if(t.$$route&&t.$$route.css)n=t.$$route.css;else if(t.css)n=t.css;if(n){if(e.isArray(n)){e.forEach(n,function(e){r.push(S(e))})}else r.push(S(n))}return r};h.getFromRoutes=function(t){if(!t)return c.error("Get From Routes: No routes provided");var n=[];e.forEach(t,function(e){var t=h.getFromRoute(e);if(t.length)n.push(t[0])});return n};h.getFromState=function(t){if(!t)return c.error("Get From State: No state provided");var n=[];if(e.isDefined(t.views)){e.forEach(t.views,function(e){if(e.css)n.push(S(e.css))})}if(e.isDefined(t.children)){e.forEach(t.children,function(t){if(t.css)n.push(S(t.css));if(e.isDefined(t.children)){e.forEach(t.children,function(e){if(e.css)n.push(S(e.css))})}})}if(e.isDefined(t.css)){if(e.isArray(t.css)){e.forEach(t.css,function(e){n.push(S(e))})}else n.push(S(t.css))}return n};h.getFromStates=function(t){if(!t)return c.error("Get From States: No states provided");var n=[];e.forEach(t,function(t){var r=h.getFromState(t);if(e.isArray(r)){e.forEach(r,function(e){n.push(e)})}else n.push(r)});return n};h.preload=function(t,r){if(!t){t=[];if(n.length)Array.prototype.push.apply(t,n);if(s.has("$route"))Array.prototype.push.apply(t,h.getFromRoutes(s.get("$route").routes));if(s.has("$state"))Array.prototype.push.apply(t,h.getFromStates(s.get("$state").get()))}t=T(t,"preload");e.forEach(t,function(n,i){f.get(n.href).success(function(n){c.debug("preload response: "+n);if(t.length===i+1&&e.isFunction(r))r(t)}).error(function(e){c.error("Incorrect path for "+n.href)})})};h.bind=function(t,n){if(!t||!n)return c.error("No scope or stylesheets provided");var r=[];if(e.isArray(t)){e.forEach(t,function(e){r.push(S(e))})}else r.push(S(t));h.add(r);c.debug("$css.bind(): Added",r);n.$on("$destroy",function(){h.remove(r);c.debug("$css.bind(): Removed",r)})};h.add=function(t,n){if(!t)return c.error("No stylesheets provided");if(!e.isArray(t))t=[t];e.forEach(t,function(e){e=S(e);if(e.href&&!l("filter")(i.stylesheets,{href:e.href}).length){x(e);if(k(e))N(e);else i.stylesheets.push(e);c.debug("$css.add(): "+e.href)}});i.$broadcast("$cssAdd",t,i.stylesheets)};h.remove=function(t,n){if(!t)return c.error("No stylesheets provided");t=l("filter")(t,function(e){return!e.persist});e.forEach(t,function(e){var t=i.stylesheets.indexOf(l("filter")(i.stylesheets,{href:e.href})[0]);if(t!==-1)i.stylesheets.splice(t,1);C(e);c.debug("$css.remove(): "+e.href)});i.$broadcast("$cssRemove",t,i.stylesheets)};h.removeAll=function(){if(i&&i.hasOwnProperty("stylesheets"))i.stylesheets.length=0;c.debug("all stylesheets removed")};h.preload();return h}]}]);t.filter("$cssLinks",function(){return function(t){if(!t||!e.isArray(t))return t;var n="";e.forEach(t,function(e){n+='<link rel="'+e.rel+'" type="'+e.type+'" href="'+e.href+'"';n+=e.media?' media="'+e.media+'"':"";n+=">\n\n"});return n}});t.run(["$css",function(e){}]);var n=[];var r=e.module;e.module=function(){var t=r.apply(this,arguments);var i=t.directive;t.directive=function(t,r){var s=e.isFunction(r)?r:r[r.length-1];var o=r();o.directiveName=t;n.push(o);return i.apply(this,arguments)};return t};var i=e.module;e.module=function(){var t=i.apply(this,arguments);t.config(["$provide","$injector","$cssProvider",function(t,r,i){e.forEach(n,function(e){var n=e.directiveName+"Directive";if(r.has(n)){t.decorator(n,["$delegate","$rootScope",function(e,t){var n=e[0];var r=n.compile;n.compile=function(e,i){var s=r?r.apply(this,arguments):false;return function(e,r,i){if(s)s.apply(this,arguments);t.$broadcast("$directiveAdd",n,e)}};return e}])}})}]);return t}})(angular)