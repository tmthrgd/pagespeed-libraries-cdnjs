!function(){var t,e,r,n,i,o,s,a,u,h,l,p,c,d,f,y,v,m,g,_,w,S,b,A,E,U,C,O,P,T,x,R=[].indexOf||function(t){for(var e=0,r=this.length;r>e;e++)if(e in this&&this[e]===t)return e;return-1},D={}.hasOwnProperty,k=function(t,e){function r(){this.constructor=t}for(var n in e)D.call(e,n)&&(t[n]=e[n]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};if(t=function(){return null},t.Util={},t.Http={},t.File={},t.Util.EventSource=function(){function t(t){this._cancelable=t&&t.cancelable,this._listeners=[]}return t.prototype.addListener=function(t){if("function"!=typeof t)throw new TypeError("Invalid listener type; expected function");return R.call(this._listeners,t)<0&&this._listeners.push(t),this},t.prototype.removeListener=function(t){var e,r,n,i,o,s;if(this._listeners.indexOf)r=this._listeners.indexOf(t),-1!==r&&this._listeners.splice(r,1);else for(s=this._listeners,e=i=0,o=s.length;o>i;e=++i)if(n=s[e],n===t){this._listeners.splice(e,1);break}return this},t.prototype.dispatch=function(t){var e,r,n,i,o;for(o=this._listeners,n=0,i=o.length;i>n;n++)if(e=o[n],r=e(t),this._cancelable&&r===!1)return!1;return!0},t}(),t.AccountInfo=function(){function e(t){var e;this._json=t,this.name=t.display_name,this.email=t.email,this.countryCode=t.country||null,this.uid=t.uid.toString(),t.public_app_url?(this.publicAppUrl=t.public_app_url,e=this.publicAppUrl.length-1,e>=0&&"/"===this.publicAppUrl.substring(e)&&(this.publicAppUrl=this.publicAppUrl.substring(0,e))):this.publicAppUrl=null,this.referralUrl=t.referral_link,this.quota=t.quota_info.quota,this.privateBytes=t.quota_info.normal||0,this.sharedBytes=t.quota_info.shared||0,this.usedQuota=this.privateBytes+this.sharedBytes}return e.parse=function(e){return e&&"object"==typeof e?new t.AccountInfo(e):e},e.prototype.name=null,e.prototype.email=null,e.prototype.countryCode=null,e.prototype.uid=null,e.prototype.referralUrl=null,e.prototype.publicAppUrl=null,e.prototype.quota=null,e.prototype.usedQuota=null,e.prototype.privateBytes=null,e.prototype.sharedBytes=null,e.prototype.json=function(){return this._json},e}(),t.ApiError=function(){function t(t,e,r){var n,i;if(this.method=e,this.url=r,this.status=t.status,t.responseType)try{n=t.response||t.responseText}catch(o){i=o;try{n=t.responseText}catch(o){i=o,n=null}}else try{n=t.responseText}catch(o){i=o,n=null}if(n)try{this.responseText=n.toString(),this.response=JSON.parse(n)}catch(o){i=o,this.response=null}else this.responseText="(no response)",this.response=null}return t.prototype.status=null,t.prototype.method=null,t.prototype.url=null,t.prototype.responseText=null,t.prototype.response=null,t.NETWORK_ERROR=0,t.NO_CONTENT=304,t.INVALID_PARAM=400,t.INVALID_TOKEN=401,t.OAUTH_ERROR=403,t.NOT_FOUND=404,t.INVALID_METHOD=405,t.NOT_ACCEPTABLE=406,t.CONFLICT=409,t.RATE_LIMITED=503,t.OVER_QUOTA=507,t.prototype.toString=function(){return"Dropbox API error "+this.status+" from "+this.method+" "+this.url+" :: "+this.responseText},t.prototype.inspect=function(){return this.toString()},t}(),t.AuthDriver=function(){function e(){}return e.prototype.authType=function(){return"code"},e.prototype.url=function(){return"https://some.url"},e.prototype.doAuthorize=function(t,e,r,n){return n({code:"access-code"})},e.prototype.getStateParam=function(e,r){return r(t.Util.Oauth.randomAuthStateParam())},e.prototype.resumeAuthorize=function(t,e,r){return r({code:"access-code"})},e.prototype.onAuthStateChange=function(t,e){return e()},e.oauthQueryParams=["access_token","expires_in","scope","token_type","code","error","error_description","error_uri","mac_key","mac_algorithm"].sort(),e}(),t.AuthDriver.autoConfigure=function(e){if("undefined"!=typeof chrome&&(chrome.extension||chrome.app&&chrome.app.runtime))return e.authDriver(new t.AuthDriver.Chrome),void 0;if("undefined"!=typeof window){if(window.cordova)return e.authDriver(new t.AuthDriver.Cordova),void 0;window&&window.navigator&&e.authDriver(new t.AuthDriver.Redirect)}},t.AuthDriver.BrowserBase=function(){function e(t){t?(this.rememberUser="rememberUser"in t?t.rememberUser:!0,this.scope=t.scope||"default"):(this.rememberUser=!0,this.scope="default"),this.storageKey=null,this.stateRe=/^[^#]+\#(.*&)?state=([^&]+)(&|$)/}return e.prototype.authType=function(){return"token"},e.prototype.onAuthStepChange=function(e,r){var n=this;switch(this.setStorageKey(e),e.authStep){case t.Client.RESET:return this.loadCredentials(function(i){return i?(e.setCredentials(i),e.authStep!==t.Client.DONE?r():n.rememberUser?(e.setCredentials(i),e.getAccountInfo(function(i){return i&&i.status===t.ApiError.INVALID_TOKEN?(e.reset(),n.forgetCredentials(r)):r()})):n.forgetCredentials(r)):r()});case t.Client.DONE:return this.rememberUser?this.storeCredentials(e.credentials(),r):this.forgetCredentials(r);case t.Client.SIGNED_OUT:return this.forgetCredentials(r);case t.Client.ERROR:return this.forgetCredentials(r);default:return r(),this}},e.prototype.setStorageKey=function(t){return this.storageKey="dropbox-auth:"+this.scope+":"+t.appHash(),this},e.prototype.storeCredentials=function(t,e){return localStorage.setItem(this.storageKey,JSON.stringify(t)),e(),this},e.prototype.loadCredentials=function(t){var e,r;if(r=localStorage.getItem(this.storageKey),!r)return t(null),this;try{t(JSON.parse(r))}catch(n){e=n,t(null)}return this},e.prototype.forgetCredentials=function(t){return localStorage.removeItem(this.storageKey),t(),this},e.prototype.locationStateParam=function(e){var r,n;return r=e||t.AuthDriver.BrowserBase.currentLocation(),n=this.stateRe.exec(r),n?decodeURIComponent(n[2]):null},e.currentLocation=function(){return window.location.href},e.cleanupLocation=function(){var t,e;window.history&&window.history.replaceState?(e=this.currentLocation(),t=e.indexOf("#"),window.history.replaceState({},document.title,e.substring(0,t))):window.location.hash=""},e}(),t.AuthDriver.Redirect=function(e){function r(t){r.__super__.constructor.call(this,t),this.receiverUrl=this.baseUrl(t)}return k(r,e),r.prototype.baseUrl=function(e){var r,n,i;if(i=t.AuthDriver.BrowserBase.currentLocation(),e){if(e.redirectUrl)return e.redirectUrl;if(e&&e.redirectFile)return r=t.AuthDriver.BrowserBase.currentLocation().split("/"),r[r.length-1]=e.redirectFile,r.join("/")}return n=i.indexOf("#"),-1!==n&&(i=i.substring(0,n)),i},r.prototype.url=function(){return this.receiverUrl},r.prototype.doAuthorize=function(t,e,r){return this.storeCredentials(r.credentials(),function(){return window.location.assign(t)})},r.prototype.resumeAuthorize=function(e,r,n){var i;return this.locationStateParam()===e?(i=t.AuthDriver.BrowserBase.currentLocation(),t.AuthDriver.BrowserBase.cleanupLocation(),n(t.Util.Oauth.queryParamsFromUrl(i))):this.forgetCredentials(function(){return n({error:"Authorization error"})})},r}(t.AuthDriver.BrowserBase),t.AuthDriver.Popup=function(e){function r(t){r.__super__.constructor.call(this,t),this.receiverUrl=this.baseUrl(t)}return k(r,e),r.prototype.url=function(){return this.receiverUrl},r.prototype.doAuthorize=function(t,e,r,n){return this.listenForMessage(e,n),this.openWindow(t)},r.prototype.baseUrl=function(e){var r;if(e){if(e.receiverUrl)return e.receiverUrl;if(e.receiverFile)return r=t.AuthDriver.BrowserBase.currentLocation().split("/"),r[r.length-1]=e.receiverFile,r.join("/")}return t.AuthDriver.BrowserBase.currentLocation()},r.prototype.openWindow=function(t){return window.open(t,"_dropboxOauthSigninWindow",this.popupWindowSpec(980,700))},r.prototype.popupWindowSpec=function(t,e){var r,n,i,o,s,a,u,h,l,p;return s=null!=(u=window.screenX)?u:window.screenLeft,a=null!=(h=window.screenY)?h:window.screenTop,o=null!=(l=window.outerWidth)?l:document.documentElement.clientWidth,r=null!=(p=window.outerHeight)?p:document.documentElement.clientHeight,n=Math.round(s+(o-t)/2),i=Math.round(a+(r-e)/2.5),s>n&&(n=s),a>i&&(i=a),"width="+t+",height="+e+","+("left="+n+",top="+i)+"dialog=yes,dependent=yes,scrollbars=yes,location=yes"},r.prototype.listenForMessage=function(e,r){var n,i=this;return n=function(o){var s;return s=o.data?o.data:o,i.locationStateParam(s)===e?(e=!1,window.removeEventListener("message",n),t.AuthDriver.Popup.onMessage.removeListener(n),r(t.Util.Oauth.queryParamsFromUrl(s))):void 0},window.addEventListener("message",n,!1),t.AuthDriver.Popup.onMessage.addListener(n)},r.locationOrigin=function(t){var e;return(e=/^(file:\/\/[^\?\#]*)(\?|\#|$)/.exec(t))?e[1]:(e=/^([^\:]+\:\/\/[^\/\?\#]*)(\/|\?|\#|$)/.exec(t),e?e[1]:t)},r.oauthReceiver=function(){window.addEventListener("load",function(){var e,r,n,i,o;if(o=window.location.href,t.AuthDriver.BrowserBase.cleanupLocation(),n=window.opener,window.parent!==window.top&&(n||(n=window.parent)),n){try{i=window.location.origin||locationOrigin(o),n.postMessage(o,i)}catch(s){r=s}try{n.Dropbox.AuthDriver.Popup.onMessage.dispatch(o)}catch(s){e=s}}return window.close()})},r.onMessage=new t.Util.EventSource,r}(t.AuthDriver.BrowserBase),e=null,r=null,"undefined"!=typeof chrome&&null!==chrome&&(chrome.runtime&&(chrome.runtime.onMessage&&(e=chrome.runtime.onMessage),chrome.runtime.sendMessage&&(r=function(t){return chrome.runtime.sendMessage(t)})),chrome.extension&&(chrome.extension.onMessage&&(e||(e=chrome.extension.onMessage)),chrome.extension.sendMessage&&(r||(r=function(t){return chrome.extension.sendMessage(t)}))),e||function(){var e,r;return r=function(e){return e.Dropbox?(t.AuthDriver.Chrome.prototype.onMessage=e.Dropbox.AuthDriver.Chrome.onMessage,t.AuthDriver.Chrome.prototype.sendMessage=e.Dropbox.AuthDriver.Chrome.sendMessage):(e.Dropbox=t,t.AuthDriver.Chrome.prototype.onMessage=new t.Util.EventSource,t.AuthDriver.Chrome.prototype.sendMessage=function(e){return t.AuthDriver.Chrome.prototype.onMessage.dispatch(e)})},chrome.extension&&chrome.extension.getBackgroundPage&&(e=chrome.extension.getBackgroundPage())?r(e):chrome.runtime&&chrome.runtime.getBackgroundPage?chrome.runtime.getBackgroundPage(function(t){return r(t)}):void 0}()),t.AuthDriver.Chrome=function(n){function i(t){var e;i.__super__.constructor.call(this,t),e=t&&t.receiverPath||"chrome_oauth_receiver.html",this.useQuery=!0,this.receiverUrl=this.expandUrl(e),this.storageKey="dropbox_js_"+this.scope+"_credentials"}return k(i,n),i.prototype.onMessage=e,i.prototype.sendMessage=r,i.prototype.expandUrl=function(t){return chrome.runtime&&chrome.runtime.getURL?chrome.runtime.getURL(t):chrome.extension&&chrome.extension.getURL?chrome.extension.getURL(t):t},i.prototype.onAuthStepChange=function(e,r){var n=this;switch(e.authStep){case t.Client.RESET:return this.loadCredentials(function(t){if(t){if(t.authStep)return n.forgetCredentials(r);e.setCredentials(t)}return r()});case t.Client.DONE:return this.storeCredentials(e.credentials(),r);case t.Client.SIGNED_OUT:return this.forgetCredentials(r);case t.Client.ERROR:return this.forgetCredentials(r);default:return r()}},i.prototype.doAuthorize=function(e,r,n,i){var o,s,a,u,h=this;return(null!=(s=chrome.identity)?s.launchWebAuthFlow:void 0)?chrome.identity.launchWebAuthFlow({url:e,interactive:!0},function(e){return h.locationStateParam(e)===r?(r=!1,i(t.Util.Oauth.queryParamsFromUrl(e))):void 0}):(null!=(a=chrome.experimental)?null!=(u=a.identity)?u.launchWebAuthFlow:void 0:void 0)?chrome.experimental.identity.launchWebAuthFlow({url:e,interactive:!0},function(e){return h.locationStateParam(e)===r?(r=!1,i(t.Util.Oauth.queryParamsFromUrl(e))):void 0}):(o={handle:null},this.listenForMessage(r,o,i),this.openWindow(e,function(t){return o.handle=t}))},i.prototype.openWindow=function(t,e){return chrome.tabs&&chrome.tabs.create?(chrome.tabs.create({url:t,active:!0,pinned:!1},function(t){return e(t)}),this):this},i.prototype.closeWindow=function(t){return chrome.tabs&&chrome.tabs.remove&&t.id?(chrome.tabs.remove(t.id),this):chrome.app&&chrome.app.window&&t.close?(t.close(),this):this},i.prototype.url=function(){return this.receiverUrl},i.prototype.listenForMessage=function(e,r,n){var i,o=this;return i=function(s,a){var u;if((!a||!a.tab||a.tab.url.substring(0,o.receiverUrl.length)===o.receiverUrl)&&s.dropbox_oauth_receiver_href)return u=s.dropbox_oauth_receiver_href,o.locationStateParam(u)===e?(e=!1,r.handle&&o.closeWindow(r.handle),o.onMessage.removeListener(i),n(t.Util.Oauth.queryParamsFromUrl(u))):void 0},this.onMessage.addListener(i)},i.prototype.storeCredentials=function(t,e){var r;return r={},r[this.storageKey]=t,chrome.storage.local.set(r,e),this},i.prototype.loadCredentials=function(t){var e=this;return chrome.storage.local.get(this.storageKey,function(r){return t(r[e.storageKey]||null)}),this},i.prototype.forgetCredentials=function(t){return chrome.storage.local.remove(this.storageKey,t),this},i.oauthReceiver=function(){return window.addEventListener("load",function(){var e,r;return e=new t.AuthDriver.Chrome,r=window.location.href,window.location.hash="",e.sendMessage({dropbox_oauth_receiver_href:r}),window.close?window.close():void 0})},i}(t.AuthDriver.BrowserBase),t.AuthDriver.Cordova=function(t){function e(t){t?(this.rememberUser="rememberUser"in t?t.rememberUser:!0,this.scope=t.scope||"default"):(this.rememberUser=!0,this.scope="default"),this.scope=(null!=t?t.scope:void 0)||"default"}return k(e,t),e.prototype.doAuthorize=function(t,e,r,n){var i,o,s,a;return o=window.open(t,"_blank","location=yes"),a=!1,i=/^[^/]*\/\/[^/]*\//.exec(t)[0],s=function(e){return e.url===t&&a===!1?(a=!0,void 0):e.url&&e.url.substring(0,i.length)!==i?(a=!1,void 0):"exit"===e.type||a?(o.removeEventListener("loadstop",s),o.removeEventListener("exit",s),"exit"!==e.type&&o.close(),n()):void 0},o.addEventListener("loadstop",s),o.addEventListener("exit",s)},e.prototype.url=function(){return null},e}(t.AuthDriver.BrowserBase),t.AuthDriver.NodeServer=function(){function t(t){this._port=(null!=t?t.port:void 0)||8912,(null!=t?t.tls:void 0)?(this._tlsOptions=t.tls,("string"==typeof this._tlsOptions||this._tlsOptions instanceof Buffer)&&(this._tlsOptions={key:this._tlsOptions,cert:this._tlsOptions})):this._tlsOptions=null,this._faviconFile=(null!=t?t.favicon:void 0)||null,this._fs=require("fs"),this._http=require("http"),this._https=require("https"),this._open=require("open"),this._callbacks={},this._nodeUrl=require("url"),this.createApp()}return t.prototype.authType=function(){return"code"},t.prototype.url=function(){return"https://localhost:"+this._port+"/oauth_callback"},t.prototype.doAuthorize=function(t,e,r,n){return this._callbacks[e]=n,this.openBrowser(t)},t.prototype.openBrowser=function(t){if(!t.match(/^https?:\/\//))throw new Error("Not a http/https URL: "+t);return"BROWSER"in process.env?this._open(t,process.env.BROWSER):this._open(t)},t.prototype.createApp=function(){var t=this;return this._app=this._tlsOptions?this._https.createServer(this._tlsOptions,function(e,r){return t.doRequest(e,r)}):this._http.createServer(function(e,r){return t.doRequest(e,r)}),this._app.listen(this._port)},t.prototype.closeServer=function(){return this._app.close()},t.prototype.doRequest=function(t,e){var r,n,i,o=this;return i=this._nodeUrl.parse(t.url,!0),"/oauth_callback"===i.pathname&&(n=i.query.state,this._callbacks[n]&&(this._callbacks[n](i.query),delete this._callbacks[n])),r="",t.on("data",function(t){return r+=t}),t.on("end",function(){return o._faviconFile&&"/favicon.ico"===i.pathname?o.sendFavicon(e):o.closeBrowser(e)})},t.prototype.closeBrowser=function(t){var e;return e='<!doctype html>\n<script type="text/javascript">window.close();</script>\n<p>Please close this window.</p>',t.writeHead(200,{"Content-Length":e.length,"Content-Type":"text/html"}),t.write(e),t.end()},t.prototype.sendFavicon=function(t){return this._fs.readFile(this._faviconFile,function(e,r){return t.writeHead(200,{"Content-Length":r.length,"Content-Type":"image/x-icon"}),t.write(r),t.end()})},t}(),t.AuthError=function(){function t(t){var e;if(!t.error)throw new Error("Not an OAuth 2.0 error: "+JSON.stringify(t));e="object"==typeof t.error&&t.error.error?t.error:t,this.code=e.error,this.description=e.error_description||null,this.uri=e.error_uri||null}return t.prototype.code=null,t.prototype.description=null,t.prototype.uri=null,t.ACCESS_DENIED="access_denied",t.INVALID_REQUEST="invalid_request",t.UNAUTHORIZED_CLIENT="unauthorized_client",t.INVALID_GRANT="invalid_grant",t.INVALID_SCOPE="invalid_scope",t.UNSUPPORTED_GRANT_TYPE="unsupported_grant_type",t.UNSUPPORTED_RESPONSE_TYPE="unsupported_response_type",t.SERVER_ERROR="server_error",t.TEMPORARILY_UNAVAILABLE="temporarily_unavailable",t.prototype.toString=function(){return"Dropbox OAuth error "+this.code+" :: "+this.description},t.prototype.inspect=function(){return this.toString()},t}(),t.Client=function(){function e(e){var r=this;this.apiServer=e.server||this.defaultApiServer(),this.authServer=e.authServer||this.defaultAuthServer(),this.fileServer=e.fileServer||this.defaultFileServer(),this.downloadServer=e.downloadServer||this.defaultDownloadServer(),this.onXhr=new t.Util.EventSource({cancelable:!0}),this.onError=new t.Util.EventSource,this.onAuthStepChange=new t.Util.EventSource,this.xhrOnErrorHandler=function(t,e){return r.handleXhrError(t,e)},this.oauth=new t.Util.Oauth(e),this.uid=e.uid||null,this.authStep=this.oauth.step(),this.driver=null,this.filter=null,this.authError=null,this._credentials=null,this.setupUrls()}return e.prototype.onXhr=null,e.prototype.onError=null,e.prototype.onAuthStepChange=null,e.prototype.authDriver=function(t){return this.driver=t,this},e.prototype.dropboxUid=function(){return this.uid},e.prototype.credentials=function(){return this._credentials||this.computeCredentials(),this._credentials},e.prototype.authenticate=function(e,r){var i,o,s,a,u,h=this;if(r||"function"!=typeof e||(r=e,e=null),i=e&&"interactive"in e?e.interactive:!0,!this.driver&&this.authStep!==n.DONE&&(t.AuthDriver.autoConfigure(this),!this.driver))throw new Error("OAuth driver auto-configuration failed. Call authDriver.");if(this.authStep===n.ERROR)throw new Error("Client got in an error state. Call reset() to reuse it!");return a=function(){return h.authStep=h.oauth.step(),h.authStep===n.ERROR&&(h.authError=h.oauth.error()),h._credentials=null,h.onAuthStepChange.dispatch(h),u()},s=function(){return h.authStep=n.ERROR,h._credentials=null,h.onAuthStepChange.dispatch(h),u()},o=null,u=function(){var e;if(o!==h.authStep&&(o=h.authStep,h.driver&&h.driver.onAuthStepChange))return h.driver.onAuthStepChange(h,u),void 0;switch(h.authStep){case n.RESET:return i?(h.driver.getStateParam&&h.driver.getStateParam(function(t){return h.client.authStep===n.RESET&&h.oauth.setAuthStateParam(t),a()}),h.oauth.setAuthStateParam(t.Util.Oauth.randomAuthStateParam()),a()):(r&&r(null,h),void 0);case n.PARAM_SET:return i?(e=h.authorizeUrl(),h.driver.doAuthorize(e,h.oauth.authStateParam(),h,function(t){return h.oauth.processRedirectParams(t),t.uid&&(h.uid=t.uid),a()})):(r&&r(null,h),void 0);case n.PARAM_LOADED:return h.driver.resumeAuthorize?h.driver.resumeAuthorize(h.oauth.authStateParam(),h,function(t){return h.oauth.processRedirectParams(t),t.uid&&(h.uid=t.uid),a()}):(h.oauth.setAuthStateParam(h.oauth.authStateParam()),a(),void 0);case n.AUTHORIZED:return h.getAccessToken(function(t,e){return t?(h.authError=t,s()):(h.oauth.processRedirectParams(e),h.uid=e.uid,a())});case n.DONE:r&&r(null,h);break;case n.SIGNED_OUT:return h.authStep=n.RESET,h.reset(),u();case n.ERROR:r&&r(h.authError,h)}},u(),this},e.prototype.isAuthenticated=function(){return this.authStep===n.DONE},e.prototype.signOut=function(e,r){var i,o,s=this;if(r||"function"!=typeof e||(r=e,e=null),i=e&&e.mustInvalidate,this.authStep!==n.DONE)throw new Error("This client doesn't have a user's token");return o=new t.Util.Xhr("POST",this.urls.signOut),o.signWithOauth(this.oauth),this.dispatchXhr(o,function(e){if(e)if(e.status===t.ApiError.INVALID_TOKEN)e=null;else if(i)return r&&r(e),void 0;return s.authStep=n.RESET,s.reset(),s.authStep=n.SIGNED_OUT,s.onAuthStepChange.dispatch(s),s.driver&&s.driver.onAuthStepChange?s.driver.onAuthStepChange(s,function(){return r?r(null):void 0}):r?r(null):void 0})},e.prototype.signOff=function(t,e){return this.signOut(t,e)},e.prototype.getAccountInfo=function(e,r){var n,i;return r||"function"!=typeof e||(r=e,e=null),n=!1,e&&e.httpCache&&(n=!0),i=new t.Util.Xhr("GET",this.urls.accountInfo),i.signWithOauth(this.oauth,n),this.dispatchXhr(i,function(e,n){return r(e,t.AccountInfo.parse(n),n)})},e.prototype.getUserInfo=function(t,e){return this.getAccountInfo(t,e)},e.prototype.readFile=function(e,r,n){var i,o,s,a,u,h,l;return n||"function"!=typeof r||(n=r,r=null),o={},h="text",a=null,i=!1,r&&(r.versionTag?o.rev=r.versionTag:r.rev&&(o.rev=r.rev),r.arrayBuffer?h="arraybuffer":r.blob?h="blob":r.buffer?h="buffer":r.binary&&(h="b"),r.length?(null!=r.start?(u=r.start,s=r.start+r.length-1):(u="",s=r.length),a="bytes="+u+"-"+s):null!=r.start&&(a="bytes="+r.start+"-"),r.httpCache&&(i=!0)),l=new t.Util.Xhr("GET",""+this.urls.getFile+"/"+this.urlEncodePath(e)),l.setParams(o).signWithOauth(this.oauth,i),l.setResponseType(h),a&&(a&&l.setHeader("Range",a),l.reportResponseHeaders()),this.dispatchXhr(l,function(e,r,i,o){var s;return s=o?t.Http.RangeInfo.parse(o["content-range"]):null,n(e,r,t.File.Stat.parse(i),s)})},e.prototype.writeFile=function(e,r,n,i){var o;return i||"function"!=typeof n||(i=n,n=null),o=t.Util.Xhr.canSendForms&&"object"==typeof r,o?this.writeFileUsingForm(e,r,n,i):this.writeFileUsingPut(e,r,n,i)},e.prototype.writeFileUsingForm=function(e,r,n,i){var o,s,a,u;return a=e.lastIndexOf("/"),-1===a?(o=e,e=""):(o=e.substring(a),e=e.substring(0,a)),s={file:o},n&&(n.noOverwrite&&(s.overwrite="false"),n.lastVersionTag?s.parent_rev=n.lastVersionTag:(n.parentRev||n.parent_rev)&&(s.parent_rev=n.parentRev||n.parent_rev)),u=new t.Util.Xhr("POST",""+this.urls.postFile+"/"+this.urlEncodePath(e)),u.setParams(s).signWithOauth(this.oauth).setFileField("file",o,r,"application/octet-stream"),delete s.file,this.dispatchXhr(u,function(e,r){return i?i(e,t.File.Stat.parse(r)):void 0})},e.prototype.writeFileUsingPut=function(e,r,n,i){var o,s;return o={},n&&(n.noOverwrite&&(o.overwrite="false"),n.lastVersionTag?o.parent_rev=n.lastVersionTag:(n.parentRev||n.parent_rev)&&(o.parent_rev=n.parentRev||n.parent_rev)),s=new t.Util.Xhr("POST",""+this.urls.putFile+"/"+this.urlEncodePath(e)),s.setBody(r).setParams(o).signWithOauth(this.oauth),this.dispatchXhr(s,function(e,r){return i?i(e,t.File.Stat.parse(r)):void 0})},e.prototype.resumableUploadStep=function(e,r,n){var i,o;return r?(i={offset:r.offset},r.tag&&(i.upload_id=r.tag)):i={offset:0},o=new t.Util.Xhr("POST",this.urls.chunkedUpload),o.setBody(e).setParams(i).signWithOauth(this.oauth),this.dispatchXhr(o,function(e,r){return e&&e.status===t.ApiError.INVALID_PARAM&&e.response&&e.response.upload_id&&e.response.offset?n(null,t.Http.UploadCursor.parse(e.response)):n(e,t.Http.UploadCursor.parse(r))})},e.prototype.resumableUploadFinish=function(e,r,n,i){var o,s;return i||"function"!=typeof n||(i=n,n=null),o={upload_id:r.tag},n&&(n.lastVersionTag?o.parent_rev=n.lastVersionTag:(n.parentRev||n.parent_rev)&&(o.parent_rev=n.parentRev||n.parent_rev),n.noOverwrite&&(o.overwrite="false")),s=new t.Util.Xhr("POST",""+this.urls.commitChunkedUpload+"/"+this.urlEncodePath(e)),s.setParams(o).signWithOauth(this.oauth),this.dispatchXhr(s,function(e,r){return i?i(e,t.File.Stat.parse(r)):void 0})},e.prototype.stat=function(e,r,n){var i,o,s;return n||"function"!=typeof r||(n=r,r=null),o={},i=!1,r&&(r.versionTag?o.rev=r.versionTag:r.rev&&(o.rev=r.rev),r.contentHash?o.hash=r.contentHash:r.hash&&(o.hash=r.hash),(r.removed||r.deleted)&&(o.include_deleted="true"),r.readDir&&(o.list="true",r.readDir!==!0&&(o.file_limit=r.readDir.toString())),r.cacheHash&&(o.hash=r.cacheHash),r.httpCache&&(i=!0)),o.include_deleted||(o.include_deleted="false"),o.list||(o.list="false"),s=new t.Util.Xhr("GET",""+this.urls.metadata+"/"+this.urlEncodePath(e)),s.setParams(o).signWithOauth(this.oauth,i),this.dispatchXhr(s,function(e,r){var i,o,s;return s=t.File.Stat.parse(r),i=(null!=r?r.contents:void 0)?function(){var e,n,i,s;for(i=r.contents,s=[],e=0,n=i.length;n>e;e++)o=i[e],s.push(t.File.Stat.parse(o));return s}():void 0,n(e,s,i)})},e.prototype.readdir=function(t,e,r){var n;return r||"function"!=typeof e||(r=e,e=null),n={readDir:!0},e&&(null!=e.limit&&(n.readDir=e.limit),e.versionTag?n.versionTag=e.versionTag:e.rev&&(n.versionTag=e.rev),e.contentHash?n.contentHash=e.contentHash:e.hash&&(n.contentHash=e.hash),(e.removed||e.deleted)&&(n.removed=e.removed||e.deleted),e.httpCache&&(n.httpCache=e.httpCache)),this.stat(t,n,function(t,e,n){var i,o;return i=n?function(){var t,e,r;for(r=[],t=0,e=n.length;e>t;t++)o=n[t],r.push(o.name);return r}():null,r(t,i,e,n)})},e.prototype.metadata=function(t,e,r){return this.stat(t,e,r)},e.prototype.makeUrl=function(e,r,n){var i,o,s,a,u,h=this;return n||"function"!=typeof r||(n=r,r=null),o=r&&(r["long"]||r.longUrl||r.downloadHack)?{short_url:"false"}:{},e=this.urlEncodePath(e),s=""+this.urls.shares+"/"+e,i=!1,a=!1,r&&(r.downloadHack?(i=!0,a=!0):r.download&&(i=!0,s=""+this.urls.media+"/"+e)),u=new t.Util.Xhr("POST",s).setParams(o).signWithOauth(this.oauth),this.dispatchXhr(u,function(e,r){return a&&(null!=r?r.url:void 0)&&(r.url=r.url.replace(h.authServer,h.downloadServer)),n(e,t.File.ShareUrl.parse(r,i))})},e.prototype.history=function(e,r,n){var i,o,s;return n||"function"!=typeof r||(n=r,r=null),o={},i=!1,r&&(null!=r.limit&&(o.rev_limit=r.limit),r.httpCache&&(i=!0)),s=new t.Util.Xhr("GET",""+this.urls.revisions+"/"+this.urlEncodePath(e)),s.setParams(o).signWithOauth(this.oauth,i),this.dispatchXhr(s,function(e,r){var i,o;return o=r?function(){var e,n,o;for(o=[],e=0,n=r.length;n>e;e++)i=r[e],o.push(t.File.Stat.parse(i));return o}():void 0,n(e,o)})},e.prototype.revisions=function(t,e,r){return this.history(t,e,r)},e.prototype.thumbnailUrl=function(t,e){var r;return r=this.thumbnailXhr(t,e),r.paramsToUrl().url},e.prototype.readThumbnail=function(e,r,n){var i,o;return n||"function"!=typeof r||(n=r,r=null),i="b",r&&(r.blob&&(i="blob"),r.arrayBuffer&&(i="arraybuffer"),r.buffer&&(i="buffer")),o=this.thumbnailXhr(e,r),o.setResponseType(i),this.dispatchXhr(o,function(e,r,i){return n(e,r,t.File.Stat.parse(i))})},e.prototype.thumbnailXhr=function(e,r){var n,i;return n={},r&&(r.format?n.format=r.format:r.png&&(n.format="png"),r.size&&(n.size=r.size)),i=new t.Util.Xhr("GET",""+this.urls.thumbnails+"/"+this.urlEncodePath(e)),i.setParams(n).signWithOauth(this.oauth)},e.prototype.revertFile=function(e,r,n){var i;return i=new t.Util.Xhr("POST",""+this.urls.restore+"/"+this.urlEncodePath(e)),i.setParams({rev:r}).signWithOauth(this.oauth),this.dispatchXhr(i,function(e,r){return n?n(e,t.File.Stat.parse(r)):void 0})},e.prototype.restore=function(t,e,r){return this.revertFile(t,e,r)},e.prototype.findByName=function(e,r,n,i){var o,s,a;return i||"function"!=typeof n||(i=n,n=null),s={query:r},o=!1,n&&(null!=n.limit&&(s.file_limit=n.limit),(n.removed||n.deleted)&&(s.include_deleted=!0),n.httpCache&&(o=!0)),a=new t.Util.Xhr("GET",""+this.urls.search+"/"+this.urlEncodePath(e)),a.setParams(s).signWithOauth(this.oauth,o),this.dispatchXhr(a,function(e,r){var n,o;return o=r?function(){var e,i,o;for(o=[],e=0,i=r.length;i>e;e++)n=r[e],o.push(t.File.Stat.parse(n));return o}():void 0,i(e,o)})},e.prototype.search=function(t,e,r,n){return this.findByName(t,e,r,n)},e.prototype.makeCopyReference=function(e,r){var n;return n=new t.Util.Xhr("GET",""+this.urls.copyRef+"/"+this.urlEncodePath(e)),n.signWithOauth(this.oauth),this.dispatchXhr(n,function(e,n){return r(e,t.File.CopyReference.parse(n))})},e.prototype.copyRef=function(t,e){return this.makeCopyReference(t,e)},e.prototype.pullChanges=function(e,r){var n,i;return r||"function"!=typeof e||(r=e,e=null),n=e?e.cursorTag?{cursor:e.cursorTag}:{cursor:e}:{},i=new t.Util.Xhr("POST",this.urls.delta),i.setParams(n).signWithOauth(this.oauth),this.dispatchXhr(i,function(e,n){return r(e,t.Http.PulledChanges.parse(n))})},e.prototype.delta=function(t,e){return this.pullChanges(t,e)},e.prototype.mkdir=function(e,r){var n;return n=new t.Util.Xhr("POST",this.urls.fileopsCreateFolder),n.setParams({root:"auto",path:this.normalizePath(e)}).signWithOauth(this.oauth),this.dispatchXhr(n,function(e,n){return r?r(e,t.File.Stat.parse(n)):void 0})},e.prototype.remove=function(e,r){var n;return n=new t.Util.Xhr("POST",this.urls.fileopsDelete),n.setParams({root:"auto",path:this.normalizePath(e)}).signWithOauth(this.oauth),this.dispatchXhr(n,function(e,n){return r?r(e,t.File.Stat.parse(n)):void 0})},e.prototype.unlink=function(t,e){return this.remove(t,e)},e.prototype["delete"]=function(t,e){return this.remove(t,e)},e.prototype.copy=function(e,r,n){var i,o,s;return n||"function"!=typeof i||(n=i,i=null),o={root:"auto",to_path:this.normalizePath(r)},e instanceof t.File.CopyReference?o.from_copy_ref=e.tag:o.from_path=this.normalizePath(e),s=new t.Util.Xhr("POST",this.urls.fileopsCopy),s.setParams(o).signWithOauth(this.oauth),this.dispatchXhr(s,function(e,r){return n?n(e,t.File.Stat.parse(r)):void 0})},e.prototype.move=function(e,r,n){var i,o;return n||"function"!=typeof i||(n=i,i=null),o=new t.Util.Xhr("POST",this.urls.fileopsMove),o.setParams({root:"auto",from_path:this.normalizePath(e),to_path:this.normalizePath(r)}).signWithOauth(this.oauth),this.dispatchXhr(o,function(e,r){return n?n(e,t.File.Stat.parse(r)):void 0})},e.prototype.reset=function(){var t;return this.uid=null,this.oauth.reset(),t=this.authStep,this.authStep=this.oauth.step(),t!==this.authStep&&this.onAuthStepChange.dispatch(this),this.authError=null,this._credentials=null,this},e.prototype.setCredentials=function(t){var e;return e=this.authStep,this.oauth.setCredentials(t),this.authStep=this.oauth.step(),this.uid=t.uid||null,this.authError=null,this._credentials=null,e!==this.authStep&&this.onAuthStepChange.dispatch(this),this},e.prototype.appHash=function(){return this.oauth.appHash()},e.prototype.setupUrls=function(){return this.urls={authorize:""+this.authServer+"/1/oauth2/authorize",token:""+this.apiServer+"/1/oauth2/token",signOut:""+this.apiServer+"/1/unlink_access_token",accountInfo:""+this.apiServer+"/1/account/info",getFile:""+this.fileServer+"/1/files/auto",postFile:""+this.fileServer+"/1/files/auto",putFile:""+this.fileServer+"/1/files_put/auto",metadata:""+this.apiServer+"/1/metadata/auto",delta:""+this.apiServer+"/1/delta",revisions:""+this.apiServer+"/1/revisions/auto",restore:""+this.apiServer+"/1/restore/auto",search:""+this.apiServer+"/1/search/auto",shares:""+this.apiServer+"/1/shares/auto",media:""+this.apiServer+"/1/media/auto",copyRef:""+this.apiServer+"/1/copy_ref/auto",thumbnails:""+this.fileServer+"/1/thumbnails/auto",chunkedUpload:""+this.fileServer+"/1/chunked_upload",commitChunkedUpload:""+this.fileServer+"/1/commit_chunked_upload/auto",fileopsCopy:""+this.apiServer+"/1/fileops/copy",fileopsCreateFolder:""+this.apiServer+"/1/fileops/create_folder",fileopsDelete:""+this.apiServer+"/1/fileops/delete",fileopsMove:""+this.apiServer+"/1/fileops/move"}},e.prototype.authStep=null,e.ERROR=0,e.RESET=1,e.PARAM_SET=2,e.PARAM_LOADED=3,e.AUTHORIZED=4,e.DONE=5,e.SIGNED_OUT=6,e.prototype.urlEncodePath=function(e){return t.Util.Xhr.urlEncodeValue(this.normalizePath(e)).replace(/%2F/gi,"/")},e.prototype.normalizePath=function(t){var e;if("/"===t.substring(0,1)){for(e=1;"/"===t.substring(e,e+1);)e+=1;return t.substring(e)}return t},e.prototype.authorizeUrl=function(){var e;return e=this.oauth.authorizeUrlParams(this.driver.authType(),this.driver.url()),this.urls.authorize+"?"+t.Util.Xhr.urlEncode(e)},e.prototype.getAccessToken=function(e){var r,n;return r=this.oauth.accessTokenParams(this.driver.url()),n=new t.Util.Xhr("POST",this.urls.token).setParams(r).addOauthParams(this.oauth),this.dispatchXhr(n,function(r,n){return r&&r.status===t.ApiError.INVALID_PARAM&&r.response&&r.response.error&&(r=new t.AuthError(r.response)),e(r,n)})},e.prototype.dispatchXhr=function(t,e){var r;return t.setCallback(e),t.onError=this.xhrOnErrorHandler,t.prepare(),r=t.xhr,this.onXhr.dispatch(t)&&t.send(),r},e.prototype.handleXhrError=function(e,r){var i=this;
return e.status===t.ApiError.INVALID_TOKEN&&this.authStep===n.DONE&&(this.authError=e,this.authStep=n.ERROR,this.onAuthStepChange.dispatch(this),this.driver&&this.driver.onAuthStepChange)?(this.driver.onAuthStepChange(this,function(){return i.onError.dispatch(e),r(e)}),null):(this.onError.dispatch(e),r(e),void 0)},e.prototype.defaultApiServer=function(){return"https://api.dropbox.com"},e.prototype.defaultAuthServer=function(){return this.apiServer.replace("api","www")},e.prototype.defaultFileServer=function(){return this.apiServer.replace("api","api-content")},e.prototype.defaultDownloadServer=function(){return this.apiServer.replace("api","dl")},e.prototype.computeCredentials=function(){var t;t=this.oauth.credentials(),this.uid&&(t.uid=this.uid),this.apiServer!==this.defaultApiServer()&&(t.server=this.apiServer),this.authServer!==this.defaultAuthServer()&&(t.authServer=this.authServer),this.fileServer!==this.defaultFileServer()&&(t.fileServer=this.fileServer),this.downloadServer!==this.defaultDownloadServer()&&(t.downloadServer=this.downloadServer),this._credentials=t},e}(),n=t.Client,t.File.ShareUrl=function(){function e(e,r){this.url=e.url,this.expiresAt=t.Util.parseDate(e.expires),this.isDirect=r===!0?!0:r===!1?!1:"direct"in e?e.direct:Date.now()-this.expiresAt<=864e5,this.isPreview=!this.isDirect,this._json=null}return e.parse=function(e,r){return e&&"object"==typeof e?new t.File.ShareUrl(e,r):e},e.prototype.url=null,e.prototype.expiresAt=null,e.prototype.isDirect=null,e.prototype.isPreview=null,e.prototype.json=function(){return this._json||(this._json={url:this.url,expires:this.expiresAt.toUTCString(),direct:this.isDirect})},e}(),t.File.CopyReference=function(){function e(e){"object"==typeof e?(this.tag=e.copy_ref,this.expiresAt=t.Util.parseDate(e.expires),this._json=e):(this.tag=e,this.expiresAt=new Date(1e3*Math.ceil(Date.now()/1e3)),this._json=null)}return e.parse=function(e){return!e||"object"!=typeof e&&"string"!=typeof e?e:new t.File.CopyReference(e)},e.prototype.tag=null,e.prototype.expiresAt=null,e.prototype.json=function(){return this._json||(this._json={copy_ref:this.tag,expires:this.expiresAt.toUTCString()})},e}(),t.File.Stat=function(){function e(e){var r,n,i,o;switch(this._json=e,this.path=e.path,"/"!==this.path.substring(0,1)&&(this.path="/"+this.path),r=this.path.length-1,r>=0&&"/"===this.path.substring(r)&&(this.path=this.path.substring(0,r)),n=this.path.lastIndexOf("/"),this.name=this.path.substring(n+1),this.isFolder=e.is_dir||!1,this.isFile=!this.isFolder,this.isRemoved=e.is_deleted||!1,this.typeIcon=e.icon,this.modifiedAt=(null!=(i=e.modified)?i.length:void 0)?t.Util.parseDate(e.modified):null,this.clientModifiedAt=(null!=(o=e.client_mtime)?o.length:void 0)?t.Util.parseDate(e.client_mtime):null,e.root){case"dropbox":this.inAppFolder=!1;break;case"app_folder":this.inAppFolder=!0;break;default:this.inAppFolder=null}this.size=e.bytes||0,this.humanSize=e.size||"",this.hasThumbnail=e.thumb_exists||!1,this.versionTag=e.rev,this.contentHash=e.hash||null,this.mimeType=this.isFolder?e.mime_type||"inode/directory":e.mime_type||"application/octet-stream"}return e.parse=function(e){return e&&"object"==typeof e?new t.File.Stat(e):e},e.prototype.path=null,e.prototype.name=null,e.prototype.inAppFolder=null,e.prototype.isFolder=null,e.prototype.isFile=null,e.prototype.isRemoved=null,e.prototype.typeIcon=null,e.prototype.versionTag=null,e.prototype.contentHash=null,e.prototype.mimeType=null,e.prototype.size=null,e.prototype.humanSize=null,e.prototype.hasThumbnail=null,e.prototype.modifiedAt=null,e.prototype.clientModifiedAt=null,e.prototype.json=function(){return this._json},e}(),t.Http.PulledChanges=function(){function e(e){var r;this.blankSlate=e.reset||!1,this.cursorTag=e.cursor,this.shouldPullAgain=e.has_more,this.shouldBackOff=!this.shouldPullAgain,this.changes=e.cursor&&e.cursor.length?function(){var n,i,o,s;for(o=e.entries,s=[],n=0,i=o.length;i>n;n++)r=o[n],s.push(t.Http.PulledChange.parse(r));return s}():[]}return e.parse=function(e){return e&&"object"==typeof e?new t.Http.PulledChanges(e):e},e.prototype.blankSlate=void 0,e.prototype.cursorTag=void 0,e.prototype.changes=void 0,e.prototype.shouldPullAgain=void 0,e.prototype.shouldBackOff=void 0,e.prototype.cursor=function(){return this.cursorTag},e}(),t.Http.PulledChange=function(){function e(e){this.path=e[0],this.stat=t.File.Stat.parse(e[1]),this.stat?this.wasRemoved=!1:(this.stat=null,this.wasRemoved=!0)}return e.parse=function(e){return e&&"object"==typeof e?new t.Http.PulledChange(e):e},e.prototype.path=void 0,e.prototype.wasRemoved=void 0,e.prototype.stat=void 0,e}(),t.Http.RangeInfo=function(){function e(t){var e;(e=/^bytes (\d*)-(\d*)\/(.*)$/.exec(t))?(this.start=parseInt(e[1]),this.end=parseInt(e[2]),this.size="*"===e[3]?null:parseInt(e[3])):(this.start=0,this.end=0,this.size=null)}return e.parse=function(e){return"string"==typeof e?new t.Http.RangeInfo(e):e},e.prototype.start=null,e.prototype.size=null,e.prototype.end=null,e}(),t.Http.UploadCursor=function(){function e(t){this.replace(t)}return e.parse=function(e){return!e||"object"!=typeof e&&"string"!=typeof e?e:new t.Http.UploadCursor(e)},e.prototype.tag=null,e.prototype.offset=null,e.prototype.expiresAt=null,e.prototype.json=function(){return this._json||(this._json={upload_id:this.tag,offset:this.offset,expires:this.expiresAt.toUTCString()})},e.prototype.replace=function(e){return"object"==typeof e?(this.tag=e.upload_id||null,this.offset=e.offset||0,this.expiresAt=t.Util.parseDate(e.expires)||Date.now(),this._json=e):(this.tag=e||null,this.offset=0,this.expiresAt=new Date(1e3*Math.floor(Date.now()/1e3)),this._json=null),this},e}(),"function"==typeof d&&"function"==typeof m?(d=function(t){return window.atob(t)},m=function(t){return window.btoa(t)}):"undefined"==typeof window&&"undefined"==typeof self||"undefined"==typeof navigator||"string"!=typeof navigator.userAgent?(d=function(t){var e,r;return e=new Buffer(t,"base64"),function(){var t,n,i;for(i=[],r=t=0,n=e.length;n>=0?n>t:t>n;r=n>=0?++t:--t)i.push(String.fromCharCode(e[r]));return i}().join("")},m=function(t){var e,r;return e=new Buffer(function(){var e,n,i;for(i=[],r=e=0,n=t.length;n>=0?n>e:e>n;r=n>=0?++e:--e)i.push(t.charCodeAt(r));return i}()),e.toString("base64")}):(y="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",g=function(t,e,r){var n,i;for(i=3-e,t<<=8*i,n=3;n>=i;)r.push(y.charAt(63&t>>6*n)),n-=1;for(n=e;3>n;)r.push("="),n+=1;return null},f=function(t,e,r){var n,i;for(i=4-e,t<<=6*i,n=2;n>=i;)r.push(String.fromCharCode(255&t>>8*n)),n-=1;return null},m=function(t){var e,r,n,i,o,s;for(i=[],e=0,r=0,n=o=0,s=t.length;s>=0?s>o:o>s;n=s>=0?++o:--o)e=e<<8|t.charCodeAt(n),r+=1,3===r&&(g(e,r,i),e=r=0);return r>0&&g(e,r,i),i.join("")},d=function(t){var e,r,n,i,o,s,a;for(o=[],e=0,n=0,i=s=0,a=t.length;(a>=0?a>s:s>a)&&(r=t.charAt(i),"="!==r);i=a>=0?++s:--s)e=e<<6|y.indexOf(r),n+=1,4===n&&(f(e,n,o),e=n=0);return n>0&&f(e,n,o),o.join("")}),t.Util.atob=d,t.Util.btoa=m,t.Util.hmac=function(t,e){return c(w(P(t),P(e),t.length,e.length))},t.Util.sha1=function(t){return c(O(P(t),t.length))},"undefined"!=typeof require)try{_=require("crypto"),_.createHmac&&_.createHash&&(t.Util.hmac=function(t,e){var r;return r=_.createHmac("sha1",e),r.update(t),r.digest("base64")},t.Util.sha1=function(t){var e;return e=_.createHash("sha1"),e.update(t),e.digest("base64")})}catch(F){U=F}if(w=function(t,e,r,n){var i,o,s,a;return e.length>16&&(e=O(e,n)),s=function(){var t,r;for(r=[],o=t=0;16>t;o=++t)r.push(909522486^e[o]);return r}(),a=function(){var t,r;for(r=[],o=t=0;16>t;o=++t)r.push(1549556828^e[o]);return r}(),i=O(s.concat(t),64+r),O(a.concat(i),84)},O=function(t,e){var r,n,i,o,s,a,u,h,l,c,d,f,y,v,m,g,_,w;for(t[e>>2]|=1<<31-((3&e)<<3),t[(e+8>>6<<4)+15]=e<<3,g=Array(80),r=1732584193,i=-271733879,s=-1732584194,u=271733878,l=-1009589776,f=0,m=t.length;m>f;){for(n=r,o=i,a=s,h=u,c=l,y=w=0;80>w;y=++w)g[y]=16>y?t[f+y]:C(g[y-3]^g[y-8]^g[y-14]^g[y-16],1),20>y?(d=i&s|~i&u,v=1518500249):40>y?(d=i^s^u,v=1859775393):60>y?(d=i&s|i&u|s&u,v=-1894007588):(d=i^s^u,v=-899497514),_=p(p(C(r,5),d),p(p(l,g[y]),v)),l=u,u=s,s=C(i,30),i=r,r=_;r=p(r,n),i=p(i,o),s=p(s,a),u=p(u,h),l=p(l,c),f+=16}return[r,i,s,u,l]},C=function(t,e){return t<<e|t>>>32-e},p=function(t,e){var r,n;return n=(65535&t)+(65535&e),r=(t>>16)+(e>>16)+(n>>16),r<<16|65535&n},c=function(t){var e,r,n,i,o;for(i="",e=0,n=4*t.length;n>e;)r=e,o=(255&t[r>>2]>>(3-(3&r)<<3))<<16,r+=1,o|=(255&t[r>>2]>>(3-(3&r)<<3))<<8,r+=1,o|=255&t[r>>2]>>(3-(3&r)<<3),i+=x[63&o>>18],i+=x[63&o>>12],e+=1,i+=e>=n?"=":x[63&o>>6],e+=1,i+=e>=n?"=":x[63&o],e+=1;return i},x="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",P=function(t){var e,r,n,i,o;for(e=[],n=255,r=i=0,o=t.length;o>=0?o>i:i>o;r=o>=0?++i:--i)e[r>>2]|=(t.charCodeAt(r)&n)<<(3-(3&r)<<3);return e},t.Util.Oauth=function(){function e(t){this._id=null,this._secret=null,this._stateParam=null,this._authCode=null,this._token=null,this._tokenKey=null,this._tokenKid=null,this._error=null,this._appHash=null,this._loaded=null,this.setCredentials(t)}return e.prototype.setCredentials=function(t){if(t.key)this._id=t.key;else{if(!t.token)throw new Error("No API key supplied");this._id=null}return this._secret=t.secret||null,this._appHash=null,this._error=null,this._loaded=!0,this.reset(),t.token?(this._token=t.token,t.tokenKey&&(this._tokenKey=t.tokenKey,this._tokenKid=t.tokenKid)):t.oauthCode?this._authCode=t.oauthCode:t.oauthStateParam&&(this._stateParam=t.oauthStateParam),this},e.prototype.credentials=function(){var t;return t={},this._id&&(t.key=this._id),this._secret&&(t.secret=this._secret),null!==this._token?(t.token=this._token,this._tokenKey&&(t.tokenKey=this._tokenKey,t.tokenKid=this._tokenKid)):null!==this._authCode?t.oauthCode=this._authCode:null!==this._stateParam&&(t.oauthStateParam=this._stateParam),t},e.prototype.step=function(){return null!==this._token?t.Client.DONE:null!==this._authCode?t.Client.AUTHORIZED:null!==this._stateParam?this._loaded?t.Client.PARAM_LOADED:t.Client.PARAM_SET:null!==this._error?t.Client.ERROR:t.Client.RESET},e.prototype.setAuthStateParam=function(t){if(null===this._id)throw new Error("No API key supplied, cannot do authorization");return this.reset(),this._loaded=!1,this._stateParam=t,this},e.prototype.checkAuthStateParam=function(t){return this._stateParam===t&&null!==this._stateParam},e.prototype.authStateParam=function(){return this._stateParam},e.prototype.error=function(){return this._error},e.prototype.processRedirectParams=function(e){var r;if(e.error){if(null===this._id)throw new Error("No API key supplied, cannot process errors");return this.reset(),this._error=new t.AuthError(e),!0}if(e.code){if(null===this._id)throw new Error("No API key supplied, cannot do Authorization Codes");return this.reset(),this._loaded=!1,this._authCode=e.code,!0}if(r=e.token_type){if(r=r.toLowerCase(),"bearer"!==r&&"mac"!==r)throw new Error("Unimplemented token type "+r);if(this.reset(),this._loaded=!1,"mac"===r){if("hmac-sha-1"!==e.mac_algorithm)throw new Error("Unimplemented MAC algorithms "+e.mac_algorithm);this._tokenKey=e.mac_key,this._tokenKid=e.kid}return this._token=e.access_token,!0}return!1},e.prototype.authHeader=function(e,r,n){var i,o;return null===this._token?(o=null===this._secret?t.Util.btoa(""+this._id+":"):t.Util.btoa(""+this._id+":"+this._secret),"Basic "+o):null===this._tokenKey?"Bearer "+this._token:(i=this.macParams(e,r,n),"MAC kid="+i.kid+" ts="+i.ts+" "+("access_token="+this._token+" mac="+i.mac))},e.prototype.addAuthParams=function(t,e,r){var n;return null===this._token?(r.client_id=this._id,null!==this._secret&&(r.client_secret=this._secret)):(null!==this._tokenKey&&(n=this.macParams(t,e,r),r.kid=n.kid,r.ts=n.ts,r.mac=n.mac),r.access_token=this._token),r},e.prototype.authorizeUrlParams=function(t,e){var r;if("token"!==t&&"code"!==t)throw new Error("Unimplemented /authorize response type "+t);return r={client_id:this._id,state:this._stateParam,response_type:t},e&&(r.redirect_uri=e),r},e.prototype.accessTokenParams=function(t){var e;return e={grant_type:"authorization_code",code:this._authCode},t&&(e.redirect_uri=t),e},e.queryParamsFromUrl=function(t){var e,r,n,i,o,s,a,u,h,l;if(i=/^[^?#]+(\?([^\#]*))?(\#(.*))?$/.exec(t),!i)return{};for(a=i[2]||"",e=i[4]||"",r=e.indexOf("?"),-1!==r&&(e=e.substring(r+1)),s={},l=a.split("&").concat(e.split("&")),u=0,h=l.length;h>u;u++)n=l[u],o=n.indexOf("="),-1!==o&&(s[decodeURIComponent(n.substring(0,o))]=decodeURIComponent(n.substring(o+1)));return s},e.prototype.macParams=function(e,r,n){var i,o;return i={kid:this._tokenKid,ts:t.Util.Oauth.timestamp()},o=e.toUpperCase()+"&"+t.Util.Xhr.urlEncodeValue(r)+"&"+t.Util.Xhr.urlEncodeValue(t.Util.Xhr.urlEncode(n)),i.mac=t.Util.hmac(o,this._tokenKey),i},e.prototype.appHash=function(){return this._appHash?this._appHash:this._appHash=t.Util.sha1("oauth2-"+this._id).replace(/[\/+=]/g,"")},e.prototype.reset=function(){return this._stateParam=null,this._authCode=null,this._token=null,this._tokenKey=null,this._tokenKid=null,this},e.timestamp=function(){return Math.floor(Date.now()/1e3)},e.randomAuthStateParam=function(){return["oas",Date.now().toString(36),Math.random().toString(36)].join("_")},e}(),null==Date.now&&(t.Util.Oauth.timestamp=function(){return Math.floor((new Date).getTime()/1e3)}),2274814865e3===new Date("Fri, 31 Jan 2042 21:01:05 +0000").valueOf()?b=function(t){return new Date(t)}:2274814865e3===Date.parse("Fri, 31 Jan 2042 21:01:05 +0000")?b=function(t){return new Date(Date.parse(t))}:(E=/^\w+\, (\d+) (\w+) (\d+) (\d+)\:(\d+)\:(\d+) (\+\d+|UTC|GMT)$/,A={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11},b=function(t){var e;return(e=E.exec(t))?new Date(Date.UTC(parseInt(e[3]),A[e[2]],parseInt(e[1]),parseInt(e[4]),parseInt(e[5]),parseInt(e[6]),0)):0/0}),t.Util.parseDate=b,"undefined"==typeof XMLHttpRequest||"undefined"==typeof window&&"undefined"==typeof self||"undefined"==typeof navigator||"string"!=typeof navigator.userAgent?(u=require("xhr2"),a=!1,o=!1,s=!1):("undefined"==typeof XDomainRequest||"withCredentials"in new XMLHttpRequest?(u=XMLHttpRequest,a=!1,o="undefined"!=typeof FormData&&-1===navigator.userAgent.indexOf("Firefox")):(u=XDomainRequest,a=!0,o=!1),s=!0),"undefined"==typeof Uint8Array)i=null,l=!1,h=!1;else if(Object.getPrototypeOf?i=Object.getPrototypeOf(Object.getPrototypeOf(new Uint8Array(0))).constructor:Object.__proto__&&(i=new Uint8Array(0).__proto__.__proto__.constructor),"undefined"==typeof Blob)l=!1,h=!0;else{try{2===new Blob([new Uint8Array(2)]).size?(l=!0,h=!0):(h=!1,l=2===new Blob([new ArrayBuffer(2)]).size)}catch(F){v=F,h=!1,l=!1,"undefined"!=typeof WebKitBlobBuilder&&-1!==navigator.userAgent.indexOf("Android")&&(o=!1)}i===Object&&(h=!1)}if(t.Util.Xhr=function(){function e(t,e){this.method=t,this.isGet="GET"===this.method,this.url=e,this.wantHeaders=!1,this.headers={},this.params=null,this.body=null,this.preflight=!(this.isGet||"POST"===this.method),this.signed=!1,this.completed=!1,this.responseType=null,this.callback=null,this.xhr=null,this.onError=null}return e.Request=u,e.ieXdr=a,e.canSendForms=o,e.doesPreflight=s,e.ArrayBufferView=i,e.sendArrayBufferView=h,e.wrapBlob=l,e.prototype.xhr=null,e.prototype.onError=null,e.prototype.setParams=function(t){if(this.signed)throw new Error("setParams called after addOauthParams or addOauthHeader");if(this.params)throw new Error("setParams cannot be called twice");return this.params=t,this},e.prototype.setCallback=function(t){return this.callback=t,this},e.prototype.signWithOauth=function(e,r){return t.Util.Xhr.ieXdr?this.addOauthParams(e):this.preflight||!t.Util.Xhr.doesPreflight?this.addOauthHeader(e):this.isGet&&r?this.addOauthHeader(e):this.addOauthParams(e)},e.prototype.addOauthParams=function(t){if(this.signed)throw new Error("Request already has an OAuth signature");return this.params||(this.params={}),t.addAuthParams(this.method,this.url,this.params),this.signed=!0,this},e.prototype.addOauthHeader=function(t){if(this.signed)throw new Error("Request already has an OAuth signature");return this.params||(this.params={}),this.signed=!0,this.setHeader("Authorization",t.authHeader(this.method,this.url,this.params))},e.prototype.setBody=function(t){if(this.isGet)throw new Error("setBody cannot be called on GET requests");if(null!==this.body)throw new Error("Request already has a body");return"string"==typeof t||"undefined"!=typeof FormData&&t instanceof FormData||(this.headers["Content-Type"]="application/octet-stream",this.preflight=!0),this.body=t,this},e.prototype.setResponseType=function(t){return this.responseType=t,this},e.prototype.setHeader=function(t,e){var r;if(this.headers[t])throw r=this.headers[t],new Error("HTTP header "+t+" already set to "+r);if("Content-Type"===t)throw new Error("Content-Type is automatically computed based on setBody");return this.preflight=!0,this.headers[t]=e,this},e.prototype.reportResponseHeaders=function(){return this.wantHeaders=!0},e.prototype.setFileField=function(e,r,n,i){var o,s,a,u;if(null!==this.body)throw new Error("Request already has a body");if(this.isGet)throw new Error("setFileField cannot be called on GET requests");if("object"==typeof n){"undefined"!=typeof ArrayBuffer&&(n instanceof ArrayBuffer?t.Util.Xhr.sendArrayBufferView&&(n=new Uint8Array(n)):!t.Util.Xhr.sendArrayBufferView&&0===n.byteOffset&&n.buffer instanceof ArrayBuffer&&(n=n.buffer)),i||(i="application/octet-stream");try{n=new Blob([n],{type:i})}catch(h){v=h,window.WebKitBlobBuilder&&(a=new WebKitBlobBuilder,a.append(n),(o=a.getBlob(i))&&(n=o))}"undefined"!=typeof File&&n instanceof File&&(n=new Blob([n],{type:n.type})),u=n instanceof Blob}else u=!1;return u?(this.body=new FormData,this.body.append(e,n,r)):(i||(i="application/octet-stream"),s=this.multipartBoundary(),this.headers["Content-Type"]="multipart/form-data; boundary="+s,this.body=["--",s,"\r\n",'Content-Disposition: form-data; name="',e,'"; filename="',r,'"\r\n',"Content-Type: ",i,"\r\n","Content-Transfer-Encoding: binary\r\n\r\n",n,"\r\n","--",s,"--","\r\n"].join(""))},e.prototype.multipartBoundary=function(){return[Date.now().toString(36),Math.random().toString(36)].join("----")},e.prototype.paramsToUrl=function(){var e;return this.params&&(e=t.Util.Xhr.urlEncode(this.params),0!==e.length&&(this.url=[this.url,"?",e].join("")),this.params=null),this},e.prototype.paramsToBody=function(){if(this.params){if(null!==this.body)throw new Error("Request already has a body");if(this.isGet)throw new Error("paramsToBody cannot be called on GET requests");this.headers["Content-Type"]="application/x-www-form-urlencoded",this.body=t.Util.Xhr.urlEncode(this.params),this.params=null}return this},e.prototype.prepare=function(){var e,r,n,i,o=this;if(r=t.Util.Xhr.ieXdr,this.isGet||null!==this.body||r?(this.paramsToUrl(),null!==this.body&&"string"==typeof this.body&&(this.headers["Content-Type"]="text/plain; charset=utf8")):this.paramsToBody(),this.xhr=new t.Util.Xhr.Request,r?(this.xhr.onload=function(){return o.onXdrLoad()},this.xhr.onerror=function(){return o.onXdrError()},this.xhr.ontimeout=function(){return o.onXdrError()},this.xhr.onprogress=function(){}):this.xhr.onreadystatechange=function(){return o.onReadyStateChange()},this.xhr.open(this.method,this.url,!0),!r){i=this.headers;for(e in i)D.call(i,e)&&(n=i[e],this.xhr.setRequestHeader(e,n))}return this.responseType&&("b"===this.responseType?this.xhr.overrideMimeType&&this.xhr.overrideMimeType("text/plain; charset=x-user-defined"):this.xhr.responseType=this.responseType),this},e.prototype.send=function(e){var r,n;if(this.callback=e||this.callback,null!==this.body){r=this.body,t.Util.Xhr.sendArrayBufferView?r instanceof ArrayBuffer&&(r=new Uint8Array(r)):0===r.byteOffset&&r.buffer instanceof ArrayBuffer&&(r=r.buffer);try{this.xhr.send(r)}catch(i){if(n=i,t.Util.Xhr.sendArrayBufferView||!t.Util.Xhr.wrapBlob)throw n;r=new Blob([r],{type:"application/octet-stream"}),this.xhr.send(r)}}else this.xhr.send();return this},e.urlEncode=function(t){var e,r,n;e=[];for(r in t)n=t[r],e.push(this.urlEncodeValue(r)+"="+this.urlEncodeValue(n));return e.sort().join("&")},e.urlEncodeValue=function(t){return encodeURIComponent(t.toString()).replace(/\!/g,"%21").replace(/'/g,"%27").replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/\*/g,"%2A")},e.urlDecode=function(t){var e,r,n,i,o,s;for(r={},s=t.split("&"),i=0,o=s.length;o>i;i++)n=s[i],e=n.split("="),r[decodeURIComponent(e[0])]=decodeURIComponent(e[1]);return r},e.prototype.onReadyStateChange=function(){var e,r,n,i,o,s,a,u,h,l,p,c,d,f;if(4!==this.xhr.readyState)return!0;if(this.completed)return!0;if(this.completed=!0,this.xhr.status<200||this.xhr.status>=300)return r=new t.ApiError(this.xhr,this.method,this.url),this.onError?this.onError(r,this.callback):this.callback(r),!0;if(this.wantHeaders?(e=this.xhr.getAllResponseHeaders(),s=e?t.Util.Xhr.parseResponseHeaders(e):this.guessResponseHeaders(),l=s["x-dropbox-metadata"]):(s=void 0,l=this.xhr.getResponseHeader("x-dropbox-metadata")),null!=l?l.length:void 0)try{h=JSON.parse(l)}catch(y){u=y,h=void 0}else h=void 0;if(this.responseType){if("b"===this.responseType){for(o=null!=this.xhr.responseText?this.xhr.responseText:this.xhr.response,n=[],a=d=0,f=o.length;f>=0?f>d:d>f;a=f>=0?++d:--d)n.push(String.fromCharCode(255&o.charCodeAt(a)));c=n.join(""),this.callback(null,c,h,s)}else this.callback(null,this.xhr.response,h,s);return!0}switch(c=null!=this.xhr.responseText?this.xhr.responseText:this.xhr.response,i=this.xhr.getResponseHeader("Content-Type"),i&&(p=i.indexOf(";"),-1!==p&&(i=i.substring(0,p))),i){case"application/x-www-form-urlencoded":this.callback(null,t.Util.Xhr.urlDecode(c),h,s);break;case"application/json":case"text/javascript":this.callback(null,JSON.parse(c),h,s);break;default:this.callback(null,c,h,s)}return!0},e.parseResponseHeaders=function(t){var e,r,n,i,o,s,a,u;for(n={},r=t.split("\n"),a=0,u=r.length;u>a;a++)i=r[a],e=i.indexOf(":"),o=i.substring(0,e).trim().toLowerCase(),s=i.substring(e+1).trim(),n[o]=s;return n},e.prototype.guessResponseHeaders=function(){var t,e,r,n,i,o;for(t={},o=["cache-control","content-language","content-range","content-type","expires","last-modified","pragma","x-dropbox-metadata"],n=0,i=o.length;i>n;n++)e=o[n],r=this.xhr.getResponseHeader(e),r&&(t[e]=r);return t},e.prototype.onXdrLoad=function(){var e,r,n;if(this.completed)return!0;if(this.completed=!0,n=this.xhr.responseText,e=this.wantHeaders?{"content-type":this.xhr.contentType}:void 0,r=void 0,this.responseType)return this.callback(null,n,r,e),!0;switch(this.xhr.contentType){case"application/x-www-form-urlencoded":this.callback(null,t.Util.Xhr.urlDecode(n),r,e);break;case"application/json":case"text/javascript":this.callback(null,JSON.parse(n),r,e);break;default:this.callback(null,n,r,e)}return!0},e.prototype.onXdrError=function(){var e;return this.completed?!0:(this.completed=!0,e=new t.ApiError(this.xhr,this.method,this.url),this.onError?this.onError(e,this.callback):this.callback(e),!0)},e}(),"undefined"!=typeof module&&"exports"in module)module.exports=t;else if("undefined"!=typeof window&&null!==window)if(window.Dropbox)for(S in t)D.call(t,S)&&(T=t[S],window.Dropbox[S]=T);else window.Dropbox=t;else{if("undefined"==typeof self||null===self)throw new Error("This library only supports node.js and modern browsers.");self.Dropbox=t}}.call(this);
//# sourceMappingURL=dropbox.min.map