(function(a,e){"function"===typeof define&&define.amd?define(e):a.FlipDiv=e()})(this,function(){"function"!==typeof Date.now&&(Date.now=function(){return(new Date).getTime()});var a={create:function(e){return function(){var d,g,k;function p(f){a.extend(b,f);M=R="";menuAngle=b.angle;contentsAngle=b.angle/-2;switch(b.position){case "top":F="50% 0%";v="rotateX("+menuAngle+"deg) translateY(-100%) translateY("+b.overlap+"px)";w="50% 0";G="translateY("+b.height+"px) rotateX("+contentsAngle+"deg)";x={top:"-"+(b.height-b.overlap)+"px"};H={top:"0px"};y={top:"0px"};I={top:b.height+"px"};break;case "right":F="100% 50%";v="rotateY("+menuAngle+"deg) translateX(100%) translateX(-2px) scale(1.01)";w="100% 50%";G="translateX(-"+b.width+"px) rotateY("+contentsAngle+"deg)";x={right:"-"+(b.width-b.overlap)+"px"};H={right:"0px"};y={left:"0px"};I={left:"-"+b.width+"px"};break;case "bottom":F="50% 100%";v="rotateX("+-menuAngle+"deg) translateY(100%) translateY(-"+b.overlap+"px)";w="50% 100%";G="translateY(-"+b.height+"px) rotateX("+-contentsAngle+"deg)";x={bottom:"-"+(b.height-b.overlap)+"px"};H={bottom:"0px"};y={top:"0px"};I={top:"-"+b.height+"px"};break;default:F="100% 50%",v="translateX(-100%) translateX("+b.overlap+"px) scale(1.01) rotateY("+-menuAngle+"deg)",w="0 50%",G="translateX("+b.width+"px) rotateY("+-contentsAngle+"deg)",x={left:"-"+(b.width-b.overlap)+"px"},H={left:"0px"},y={left:"0px"},I={left:b.width+"px"}}a.hasClass(c.wrapper,"flipDiv-"+b.position)||a.addClass(c.wrapper,"flipDiv-"+b.position);d=c.wrapper.style.cssText;c.wrapper.style[a.prefix("perspective")]="800px";c.wrapper.style[a.prefix("perspectiveOrigin")]=w;c.cover&&c.cover.parentNode.removeChild(c.cover);c.cover=document.createElement("div");c.cover.style.position="absolute";c.cover.style.display="block";c.cover.style.width="100%";c.cover.style.height="100%";c.cover.style.left=0;c.cover.style.top=0;c.cover.style.zIndex=1E3;c.cover.style.visibility="hidden";c.cover.style.opacity=0;try{c.cover.style.background="rgba(0, 0, 0, 0.4)",c.cover.style.background="-ms-linear-gradient("+b.position+","+b.gradient,c.cover.style.background="-moz-linear-gradient("+b.position+","+b.gradient,c.cover.style.background="-webkit-linear-gradient("+b.position+","+b.gradient}catch(e){}J&&(c.cover.style[a.prefix("transition")]="all "+b.transitionDuration+" "+b.transitionEasing);c.contents.appendChild(c.cover);f=c.menu.style;switch(b.position){case "top":f.width="100%";f.height=b.height+"px";break;case "right":f.right="0";f.width=b.width+"px";f.height="100%";break;case "bottom":f.bottom="0";f.width="100%";f.height=b.height+"px";break;case "left":f.width=b.width+"px",f.height="100%"}g=f.cssText;f.position="fixed";f.display="block";J?(f[a.prefix("transform")]=v,f[a.prefix("transformOrigin")]=F,f[a.prefix("transition")]="all "+b.transitionDuration+" "+b.transitionEasing):a.extend(f,x);f=c.contents.style;k=f.cssText;J?(f[a.prefix("transform")]=M,f[a.prefix("transformOrigin")]=w,f[a.prefix("transition")]="all "+b.transitionDuration+" "+b.transitionEasing):(f.position=f.position.match(/relative|absolute|fixed/gi)?f.position:"relative",a.extend(f,y));"ontouchstart"in window&&(b.touch.enabled||!0===b.touch?(a.bindEvent(document,"touchstart",N),a.bindEvent(document,"touchend",q)):(a.unbindEvent(document,"touchstart",N),a.unbindEvent(document,"touchend",q)));b.mouse?(a.bindEvent(document,"mousedown",l),a.bindEvent(document,"mouseup",z),a.bindEvent(document,"mousemove",K)):(a.unbindEvent(document,"mousedown",l),a.unbindEvent(document,"mouseup",z),a.unbindEvent(document,"mousemove",K))}function m(){n||(n=!0,a.addClass(c.wrapper,"flipDiv-active"),c.cover.style.visibility="visible",J?(a.bindEventOnce(c.wrapper,"transitionend",function(){a.dispatchEvent(c.menu,"opened")}),c.cover.style.opacity=1,c.contents.style[a.prefix("transform")]=G,c.menu.style[a.prefix("transform")]=R):(A&&A.stop(),A=a.animate(c.menu,H,500),B&&B.stop(),B=a.animate(c.contents,I,500),C&&C.stop(),C=a.animate(c.cover,{opacity:1},500)),a.dispatchEvent(c.menu,"open"))}function h(){n&&(n=!1,a.removeClass(c.wrapper,"flipDiv-active"),J?(a.bindEventOnce(c.wrapper,"transitionend",function(){a.dispatchEvent(c.menu,"closed")}),c.cover.style.visibility="hidden",c.cover.style.opacity=0,c.contents.style[a.prefix("transform")]=M,c.menu.style[a.prefix("transform")]=v):(A&&A.stop(),A=a.animate(c.menu,x,500),B&&B.stop(),B=a.animate(c.contents,y,500),C&&C.stop(),C=a.animate(c.cover,{opacity:0},500,function(){c.cover.style.visibility="hidden";a.dispatchEvent(c.menu,"closed")})),a.dispatchEvent(c.menu,"close"))}function l(b){O=!0}function K(a){if(!O){var e=a.clientX-P;a=a.clientY-Q;switch(b.position){case "top":a>b.height?h():a<b.threshold&&m();break;case "right":a=c.wrapper.offsetWidth;e<a-b.width?h():e>a-b.threshold&&m();break;case "bottom":e=c.wrapper.offsetHeight;a<e-b.height?h():a>e-b.threshold&&m();break;case "left":e>b.width?h():e<b.threshold&&m()}}}function z(b){O=!1}function N(b){r=b.touches[0].clientX-P;t=b.touches[0].clientY-Q;D=E=null;S=(new Date).getTime();a.bindEvent(document,"touchmove",T)}function T(a){E=a.touches[0].clientX-P;D=a.touches[0].clientY-Q;u=null;var e=(!0===b.touch||!0===b.touch.edgeOnly)&&!n;Math.abs(D-t)<Math.abs(E-r)?b.swipeThreshold<r-E&&(c.wrapper.offsetWidth-b.touchAreaThreshold<r||!e)?u=U:b.swipeThreshold<E-r&&(r<b.touchAreaThreshold||!e)&&(u=V):b.swipeThreshold<t-D&&(c.wrapper.offsetHeight-b.touchAreaThreshold<t||!e)?u=W:b.swipeThreshold<D-t&&(t<b.touchAreaThreshold||!e)&&(u=X);(new Date).getTime()<S+b.swipeCancelTimeout&&u&&u()&&a.preventDefault()}function q(e){a.unbindEvent(document,"touchmove",T);null===E&&null===D&&null===u&&("top"===b.position&&t>b.height||"right"===b.position&&r<c.wrapper.offsetWidth-b.width||"bottom"===b.position&&t<c.wrapper.offsetHeight-b.height||"left"===b.position&&r>b.width)&&h()}function V(){if("right"===b.position&&n)return h(),!0;if("left"===b.position&&!n)return m(),!0}function U(){if("right"===b.position&&!n)return m(),!0;if("left"===b.position&&n)return h(),!0}function X(){if("bottom"===b.position&&n)return h(),!0;if("top"===b.position&&!n)return m(),!0}function W(){if("bottom"===b.position&&!n)return m(),!0;if("top"===b.position&&n)return h(),!0}if(!e||!e.menuElement||!e.contentsElement)throw"You need to specify which menu and contents elements to use.";if(e.menuElement.parentNode!==e.contentsElement.parentNode)throw"The menu and contents elements must have the same parent.";var J="WebkitPerspective"in document.body.style||"MozPerspective"in document.body.style||"msPerspective"in document.body.style||"OPerspective"in document.body.style||"perspective"in document.body.style,b={width:300,height:300,position:"left",threshold:5,swipeThreshold:40,touchAreaThreshold:40,swipeCancelTimeout:200,angle:30,overlap:6,transitionDuration:"0.5s",transitionEasing:"ease",gradient:"rgba(0,0,0,0.20) 0%, rgba(0,0,0,0.65) 100%)",mouse:!0,touch:!0},c={menu:e.menuElement,contents:e.contentsElement,wrapper:e.menuElement.parentNode,cover:null},P=c.wrapper.offsetLeft,Q=c.wrapper.offsetTop,r=null,t=null,E=null,D=null,u=null,S,n=!1,O=!1,F,v,R,x,H,w,M,G,y,I;k=g=d=void 0;var L=[],A,B,C;p(e);return{configure:p,open:m,close:h,destroy:function(){c.wrapper.style.cssText=d;c.menu.style.cssText=g;c.contents.style.cssText=k;c.cover&&c.cover.parentNode&&c.cover.parentNode.removeChild(c.cover);a.unbindEvent(document,"touchstart",N);a.unbindEvent(document,"touchend",q);a.unbindEvent(document,"mousedown",l);a.unbindEvent(document,"mouseup",z);a.unbindEvent(document,"mousemove",K);for(var b in L)this.removeEventListener(L[b][0],L[b][1]);L=[]},isOpen:function(){return n},addEventListener:function(b,e){L.push([b,e]);c.menu&&a.bindEvent(c.menu,b,e)},removeEventListener:function(b,e){c.menu&&a.unbindEvent(c.menu,b,e)}}}()},animate:function(a,d,g,k){return function(){function p(){var d=1-Math.pow(1-(Date.now()-K)/g,5),l;for(l in h){var q=h[l];a.style[l]=q.start+(q.end-q.start)*d+q.unit}1>d?z=setTimeout(p,1E3/60):(k&&k(),m())}function m(){clearTimeout(z)}var h={},l;for(l in d)h[l]={start:parseFloat(a.style[l])||0,end:parseFloat(d[l]),unit:"string"===typeof d[l]&&d[l].match(/px|em|%/gi)?d[l].match(/px|em|%/gi)[0]:""};var K=Date.now(),z;p();return{stop:m}}()},extend:function(a,d){for(var g in d)a[g]=d[g]},prefix:function(a,d){for(var g=a.slice(0,1).toUpperCase()+a.slice(1),k=["Webkit","Moz","O","ms"],p=0,m=k.length;p<m;p++){var h=k[p];if("undefined"!==typeof(d||document.body).style[h+g])return h+g}return a},hasClass:function(a,d){return-1!=a.className.search(d)},addClass:function(a,d){a.className=a.className.replace(/\s+$/gi,"")+" "+d},removeClass:function(a,d){a.className=a.className.replace(d,"")},bindEvent:function(a,d,g){a.addEventListener?a.addEventListener(d,g,!1):a.attachEvent("on"+d,g)},unbindEvent:function(a,d,g){a.removeEventListener?a.removeEventListener(d,g,!1):a.detachEvent("on"+d,g)},bindEventOnce:function(a,d,g){var k=this,p=function(){k.unbindEvent(a,d,p);g.apply(this,arguments)};this.bindEvent(a,d,p)},dispatchEvent:function(e,d,g){if(e){var k=document.createEvent("HTMLEvents",1,2);k.initEvent(d,!0,!0);a.extend(k,g);e.dispatchEvent(k)}},getQuery:function(){var a={};location.search.replace(/[A-Z0-9]+?=([\w|:|\/\.]*)/gi,function(d){a[d.split("=").shift()]=d.split("=").pop()});return a}};return a});