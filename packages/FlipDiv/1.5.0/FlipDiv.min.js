(function(a,f){"function"===typeof define&&define.amd?define(f):a.FlipDiv=f()})(this,function(){"function"!==typeof Date.now&&(Date.now=function(){return(new Date).getTime()});var a={create:function(f){return function(){var e,g,k;function p(d){a.extend(b,d);L=Q="";menuAngle=b.angle;contentsAngle=b.angle/-2;switch(b.position){case "top":E="50% 0%";r="rotateX("+menuAngle+"deg) translateY(-100%) translateY("+b.overlap+"px)";t="50% 0";F="translateY("+b.height+"px) rotateX("+contentsAngle+"deg)";u={top:"-"+(b.height-b.overlap)+"px"};G={top:"0px"};v={top:"0px"};H={top:b.height+"px"};break;case "right":E="100% 50%";r="rotateY("+menuAngle+"deg) translateX(100%) translateX(-2px) scale(1.01)";t="100% 50%";F="translateX(-"+b.width+"px) rotateY("+contentsAngle+"deg)";u={right:"-"+(b.width-b.overlap)+"px"};G={right:"0px"};v={left:"0px"};H={left:"-"+b.width+"px"};break;case "bottom":E="50% 100%";r="rotateX("+-menuAngle+"deg) translateY(100%) translateY(-"+b.overlap+"px)";t="50% 100%";F="translateY(-"+b.height+"px) rotateX("+-contentsAngle+"deg)";u={bottom:"-"+(b.height-b.overlap)+"px"};G={bottom:"0px"};v={top:"0px"};H={top:"-"+b.height+"px"};break;default:E="100% 50%",r="translateX(-100%) translateX("+b.overlap+"px) scale(1.01) rotateY("+-menuAngle+"deg)",t="0 50%",F="translateX("+b.width+"px) rotateY("+-contentsAngle+"deg)",u={left:"-"+(b.width-b.overlap)+"px"},G={left:"0px"},v={left:"0px"},H={left:b.width+"px"}}a.addClass(c.wrapper,"flipDiv-"+b.position);e=c.wrapper.style.cssText;c.wrapper.style[a.prefix("perspective")]="800px";c.wrapper.style[a.prefix("perspectiveOrigin")]=t;c.cover&&c.cover.parentNode.removeChild(c.cover);c.cover=document.createElement("div");c.cover.style.position="absolute";c.cover.style.display="block";c.cover.style.width="100%";c.cover.style.height="100%";c.cover.style.left=0;c.cover.style.top=0;c.cover.style.zIndex=1E3;c.cover.style.visibility="hidden";c.cover.style.opacity=0;try{c.cover.style.background="rgba(0, 0, 0, 0.4)",c.cover.style.background="-ms-linear-gradient("+b.position+","+b.gradient,c.cover.style.background="-moz-linear-gradient("+b.position+","+b.gradient,c.cover.style.background="-webkit-linear-gradient("+b.position+","+b.gradient}catch(f){}I&&(c.cover.style[a.prefix("transition")]="all "+b.transitionDuration+" "+b.transitionEasing);c.contents.appendChild(c.cover);d=c.menu.style;switch(b.position){case "top":d.width="100%";d.height=b.height+"px";break;case "right":d.right="0";d.width=b.width+"px";d.height="100%";break;case "bottom":d.bottom="0";d.width="100%";d.height=b.height+"px";break;case "left":d.width=b.width+"px",d.height="100%"}g=d.cssText;d.position="fixed";d.display="block";I?(d[a.prefix("transform")]=r,d[a.prefix("transformOrigin")]=E,d[a.prefix("transition")]="all "+b.transitionDuration+" "+b.transitionEasing):a.extend(d,u);d=c.contents.style;k=d.cssText;I?(d[a.prefix("transform")]=L,d[a.prefix("transformOrigin")]=t,d[a.prefix("transition")]="all "+b.transitionDuration+" "+b.transitionEasing):(d.position=d.position.match(/relative|absolute|fixed/gi)?d.position:"relative",a.extend(d,v));"ontouchstart"in window&&(b.touch?(a.bindEvent(document,"touchstart",M),a.bindEvent(document,"touchend",q)):(a.unbindEvent(document,"touchstart",M),a.unbindEvent(document,"touchend",q)));b.mouse?(a.bindEvent(document,"mousedown",l),a.bindEvent(document,"mouseup",w),a.bindEvent(document,"mousemove",J)):(a.unbindEvent(document,"mousedown",l),a.unbindEvent(document,"mouseup",w),a.unbindEvent(document,"mousemove",J))}function m(){n||(n=!0,a.addClass(c.wrapper,"flipDiv-active"),c.cover.style.visibility="visible",I?(a.bindEventOnce(c.wrapper,"transitionend",function(){a.dispatchEvent(c.menu,"opened")}),c.cover.style.opacity=1,c.contents.style[a.prefix("transform")]=F,c.menu.style[a.prefix("transform")]=Q):(x&&x.stop(),x=a.animate(c.menu,G,500),y&&y.stop(),y=a.animate(c.contents,H,500),z&&z.stop(),z=a.animate(c.cover,{opacity:1},500)),a.dispatchEvent(c.menu,"open"))}function h(){n&&(n=!1,a.removeClass(c.wrapper,"flipDiv-active"),I?(a.bindEventOnce(c.wrapper,"transitionend",function(){a.dispatchEvent(c.menu,"closed")}),c.cover.style.visibility="hidden",c.cover.style.opacity=0,c.contents.style[a.prefix("transform")]=L,c.menu.style[a.prefix("transform")]=r):(x&&x.stop(),x=a.animate(c.menu,u,500),y&&y.stop(),y=a.animate(c.contents,v,500),z&&z.stop(),z=a.animate(c.cover,{opacity:0},500,function(){c.cover.style.visibility="hidden";a.dispatchEvent(c.menu,"closed")})),a.dispatchEvent(c.menu,"close"))}function l(b){N=!0}function J(d){if(!N){var a=d.clientX-O;d=d.clientY-P;switch(b.position){case "top":d>b.height?h():d<b.threshold&&m();break;case "right":d=c.wrapper.offsetWidth;a<d-b.width?h():a>d-b.threshold&&m();break;case "bottom":a=c.wrapper.offsetHeight;d<a-b.height?h():d>a-b.threshold&&m();break;case "left":a>b.width?h():a<b.threshold&&m()}}}function w(b){N=!1}function M(b){A=b.touches[0].clientX-O;B=b.touches[0].clientY-P;C=D=null;a.bindEvent(document,"touchmove",R)}function R(c){D=c.touches[0].clientX-O;C=c.touches[0].clientY-P;var a=null;Math.abs(D-A)>Math.abs(C-B)?D<A-b.threshold?a=S:D>A+b.threshold&&(a=T):C<B-b.threshold?a=U:C>B+b.threshold&&(a=V);a&&a()&&c.preventDefault()}function q(d){a.unbindEvent(document,"touchmove",R);null===D&&null===C&&("top"===b.position&&B>b.height||"right"===b.position&&A<c.wrapper.offsetWidth-b.width||"bottom"===b.position&&B<c.wrapper.offsetHeight-b.height||"left"===b.position&&A>b.width)&&h()}function T(){if("right"===b.position&&n)return h(),!0;if("left"===b.position&&!n)return m(),!0}function S(){if("right"===b.position&&!n)return m(),!0;if("left"===b.position&&n)return h(),!0}function V(){if("bottom"===b.position&&n)return h(),!0;if("top"===b.position&&!n)return m(),!0}function U(){if("bottom"===b.position&&!n)return m(),!0;if("top"===b.position&&n)return h(),!0}if(!f||!f.menuElement||!f.contentsElement)throw"You need to specify which menu and contents elements to use.";if(f.menuElement.parentNode!==f.contentsElement.parentNode)throw"The menu and contents elements must have the same parent.";var I="WebkitPerspective"in document.body.style||"MozPerspective"in document.body.style||"msPerspective"in document.body.style||"OPerspective"in document.body.style||"perspective"in document.body.style,b={width:300,height:300,position:"left",threshold:40,angle:30,overlap:6,transitionDuration:"0.5s",transitionEasing:"ease",gradient:"rgba(0,0,0,0.20) 0%, rgba(0,0,0,0.65) 100%)",mouse:!0,touch:!0},c={menu:f.menuElement,contents:f.contentsElement,wrapper:f.menuElement.parentNode,cover:null},O=c.wrapper.offsetLeft,P=c.wrapper.offsetTop,A=null,B=null,D=null,C=null,n=!1,N=!1,E,r,Q,u,G,t,L,F,v,H;k=g=e=void 0;var K=[],x,y,z;p(f);return{configure:p,open:m,close:h,destroy:function(){c.wrapper.style.cssText=e;c.menu.style.cssText=g;c.contents.style.cssText=k;c.cover&&c.cover.parentNode&&c.cover.parentNode.removeChild(c.cover);a.unbindEvent(document,"touchstart",M);a.unbindEvent(document,"touchend",q);a.unbindEvent(document,"mousedown",l);a.unbindEvent(document,"mouseup",w);a.unbindEvent(document,"mousemove",J);for(var b in K)this.removeEventListener(K[b][0],K[b][1]);K=[]},isOpen:function(){return n},addEventListener:function(b,f){K.push([b,f]);c.menu&&a.bindEvent(c.menu,b,f)},removeEventListener:function(b,f){c.menu&&a.unbindEvent(c.menu,b,f)}}}()},animate:function(a,e,g,k){return function(){function p(){var e=1-Math.pow(1-(Date.now()-J)/g,5),l;for(l in h){var q=h[l];a.style[l]=q.start+(q.end-q.start)*e+q.unit}1>e?w=setTimeout(p,1E3/60):(k&&k(),m())}function m(){clearTimeout(w)}var h={},l;for(l in e)h[l]={start:parseFloat(a.style[l])||0,end:parseFloat(e[l]),unit:"string"===typeof e[l]&&e[l].match(/px|em|%/gi)?e[l].match(/px|em|%/gi)[0]:""};var J=Date.now(),w;p();return{stop:m}}()},extend:function(a,e){for(var g in e)a[g]=e[g]},prefix:function(a,e){for(var g=a.slice(0,1).toUpperCase()+a.slice(1),k=["Webkit","Moz","O","ms"],p=0,m=k.length;p<m;p++){var h=k[p];if("undefined"!==typeof(e||document.body).style[h+g])return h+g}return a},addClass:function(a,e){a.className=a.className.replace(/\s+$/gi,"")+" "+e},removeClass:function(a,e){a.className=a.className.replace(e,"")},bindEvent:function(a,e,g){a.addEventListener?a.addEventListener(e,g,!1):a.attachEvent("on"+e,g)},unbindEvent:function(a,e,g){a.removeEventListener?a.removeEventListener(e,g,!1):a.detachEvent("on"+e,g)},bindEventOnce:function(a,e,g){var k=this,p=function(){k.unbindEvent(a,e,p);g.apply(this,arguments)};this.bindEvent(a,e,p)},dispatchEvent:function(f,e,g){if(f){var k=document.createEvent("HTMLEvents",1,2);k.initEvent(e,!0,!0);a.extend(k,g);f.dispatchEvent(k)}},getQuery:function(){var a={};location.search.replace(/[A-Z0-9]+?=([\w|:|\/\.]*)/gi,function(e){a[e.split("=").shift()]=e.split("=").pop()});return a}};return a});