/**
 * @preserve Copyright (c) 2013 Petka Antonov
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:</p>
 *
 * The above copyright notice and this permission notice shall be included in
 * all copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
 * THE SOFTWARE.
 */
!function(e,t,i,n,r){"use strict";function o(e){return e.replace(y,b)}function s(e,t,i){try{return e.call(t,i)}catch(n){return g.e=n,g}}function l(e,t,i,n){try{return e.call(t,i,n)}catch(r){return g.e=r,g}}function u(e,t){try{return e.apply(void 0,t)}catch(i){return g.e=i,g}}function a(e,t){var n,r=e.length,o=new i(r+1);for(n=0;r>n;++n)o[n]=e[n];return o[n]=t,o}function c(e,n){function r(t){for(var r=new i(t),o=0,s=r.length;s>o;++o)r[o]="a"+(o+1);var l=t>0?",":"";return"string"==typeof e&&n===F?"this['"+e+"']("+r.join(",")+l+" fn);"+"break;":(void 0===n?"callback("+r.join(",")+l+" fn);":"callback.call("+(n===F?"this":"receiver")+", "+r.join(",")+l+" fn);")+"break;"}var o="string"==typeof e?e+"Async":"promisified";return new t("Promise","callback","receiver","withAppended","return function "+o+'( a1, a2, a3, a4, a5 ) {"use strict";'+"var len = arguments.length;"+"var resolver = Promise.pending( "+o+" );"+"var fn = function fn( err, value ) {"+"if( err ) {"+"resolver.reject( err );"+"}"+"else {"+"if( arguments.length > 2 ) {"+"    var len = arguments.length;"+"    var val = new Array(len - 1);"+"    for( var i = 1; i < len; ++i ) {"+"        val[ i - 1 ] = arguments[i];"+"    }"+"    value = val;"+"}"+"resolver.fulfill( value );"+"}"+"};"+"try{"+"switch( len ) {"+"case 1:"+r(1)+"case 2:"+r(2)+"case 3:"+r(3)+"case 0:"+r(0)+"case 4:"+r(4)+"case 5:"+r(5)+"default: "+("string"==typeof e?"this['"+e+"'].apply(":"callback.apply(")+(n===F?"this":"receiver")+", withAppended( arguments, fn ) ); break;"+"}"+"}"+"catch(e){ "+"resolver.reject(e);"+"}"+"return resolver.promise;"+"};")($,e,n,a)}function h(e,i,n){return n=o(""+n),i=o(""+i),new t("create","'use strict';\n"+e+".prototype = create(Error.prototype);"+e+".prototype.constructor = "+e+";"+"function "+e+"(msg){"+"if( Error.captureStackTrace ) {"+"Error.captureStackTrace(this, this.constructor);"+"}"+"Error.call(this, msg);"+"this.message = typeof msg === 'string'"+"? msg"+": '"+n+"';"+"this.name = '"+i+"';"+"} return "+e+";")(w)}function f(){}function _(){}function d(e){return A.test(e)&&!S.test(e)}function v(e){return d(e)?"."+e:"['"+o(e)+"']"}function p(e){if(V.call(C,e))return C[e];var i=new t("obj","return obj"+v(""+e)+";");return C[e]=i,i}function m(e){if(V.call(P,e))return P[e];var i=new t("obj","return obj"+v(""+e)+"();");return P[e]=i,i}var g={e:{}},y=/[\r\n\u2028\u2029']/g,b=function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)},w=r.create||function(e){function t(){}return t.prototype=e,new t},j=function(e,t){function i(){this.constructor=e,this.constructor$=t;for(var i in t.prototype)n.call(t.prototype,i)&&"$"!==i.charAt(i.length-1)&&(this[i+"$"]=t.prototype[i])}var n={}.hasOwnProperty;return i.prototype=t.prototype,e.prototype=new i,e.prototype},F={};"undefined"==typeof e.TypeError&&(e.TypeError=h("TypeError","TypeError"));var R=h("CancellationError","Cancel","cancellation error"),k=h("TimeoutError","Timeout","timeout error"),T=function(){function e(e,t){this.captureStackTrace(e,t)}var t=new RegExp("\\b(?:Promise(?:Array|Spawn)?\\$_\\w+|tryCatch(?:1|2|Apply)|setTimeout|makeNodePromisified|processImmediate|nextTick|Async\\$\\w+)\\b"),i=null,o=null,s=j(e,n);s.captureStackTrace=function(e,t){l(this,e,t)},e.possiblyUnhandledRejection=function(e){if("object"==typeof console){var t=e.stack,i="Possibly unhandled "+o(t,e);"function"==typeof console.error?console.error(i):"function"==typeof console.log&&console.log(i)}},e.combine=function(e,n){for(var r=e.length-1,o=n.length-1;o>=0;--o){var s=n[o];if(e[r]!==s)break;e.pop(),r--}e.push("From previous event:");for(var l=e.concat(n),u=[],o=0,a=l.length;a>o;++o)t.test(l[o])||o>0&&!i.test(l[o])&&"From previous event:"!==l[o]||u.push(l[o]);return u},e.isSupported=function(){return"function"==typeof l};var l=function u(){if("number"==typeof n.stackTraceLimit&&"function"==typeof n.captureStackTrace){i=/^\s*at\s*/,o=function(e,t){return"string"==typeof e?e:t.name+". "+t.message};var e=n.captureStackTrace;return function(t,i,r){var o=-1;r||(o=n.stackTraceLimit,n.stackTraceLimit=Math.max(1,0|Math.min(1e4,o)/3)),e(t,i),r||(n.stackTraceLimit=o)}}var t=new n;if("string"==typeof t.stack&&"function"==typeof"".startsWith&&t.stack.startsWith("stackDetection@")&&"stackDetection"===u.name){r.defineProperty(n,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),i=/@/;var s=/[@\n]/;return o=function(e,t){return"string"==typeof e?t.name+". "+t.message+"\n"+e:t.name+". "+t.message},function(e,t){var i,r=t.name,o=(new n).stack,l=o.split(s),u=l.length;for(i=0;u>i&&l[i]!==r;i+=2);l=l.slice(i+2),u=l.length-2;var a="";for(i=0;u>i;i+=2)a+=l[i],a+="@",a+=l[i+1],a+="\n";e.stack=a}}return null}();return e}(),C=new f,P=new _,A=/^[a-zA-Z$_][a-zA-Z0-9$_]*$/,S=new RegExp("^(?:__proto__|undefined|NaN|Infinity|this|false|true|null|eval|arguments|break|case|catch|continue|debugger|default|delete|do|else|finally|for|function|if|in|instanceof|new|return|switch|throw|try|typeof|var|void|while|with|class|enum|export|extends|import|super|implements|interface|let|package|private|protected|public|static|yield)$"),V={}.hasOwnProperty,E=function(){function t(){this._isTickUsed=!1,this._length=0,this._backupBuffer=[];var e=this._functionBuffer=new i(3e3),t=this;this.consumeFunctionBuffer=function(){t._consumeFunctionBuffer()};for(var n=0,r=e.length;r>n;++n)e[n]=void 0}var n;if("undefined"!=typeof process&&null!==process&&"function"==typeof process.cwd)n="undefined"!=typeof e.setImmediate?function(t){e.setImmediate(t)}:function(e){process.nextTick(e)};else if("function"==typeof MutationObserver&&"undefined"!=typeof document&&"function"==typeof document.createElement)n=function(){var e=document.createElement("div"),t=void 0,i=new MutationObserver(function(){var e=t;t=void 0,e()}),n=!0;return i.observe(e,{attributes:!0,childList:!0,characterData:!0}),function(i){t=i,n=!n,e.setAttribute("class",n?"foo":"bar")}}();else if("function"==typeof e.postMessage&&"function"!=typeof e.importScripts&&"function"==typeof e.addEventListener&&"function"==typeof e.removeEventListener){var r="bluebird_message_key_"+Math.random();n=function(){function t(t){if(t.source===e&&t.data===r){var n=i;i=void 0,n()}}var i=void 0;return e.addEventListener("message",t,!1),function(t){i=t,e.postMessage(r,"*")}}()}else n="function"==typeof MessageChannel?function(){var e=void 0,t=new MessageChannel;return t.port1.onmessage=function(){var t=e;e=void 0,t()},function(i){e=i,t.port2.postMessage(null)}}():e.setTimeout?function(e){setTimeout(e,4)}:function(e){e()};var o=t.prototype;return o.haveItemsQueued=function(){return this._length>0},o.invokeLater=function(e,t,i){this._backupBuffer.push(e,t,i),this._isTickUsed||(n(this.consumeFunctionBuffer),this._isTickUsed=!0)},o.invoke=function(e,t,i){var r=this._functionBuffer,o=r.length,s=this._length;s===o?r.push(e,t,i):(r[s+0]=e,r[s+1]=t,r[s+2]=i),this._length=s+3,this._isTickUsed||(n(this.consumeFunctionBuffer),this._isTickUsed=!0)},o._consumeFunctionBuffer=function(){for(var e=this._functionBuffer,t=0;t<this._length;t+=3)e[t+0].call(e[t+1],e[t+2]),e[t+0]=e[t+1]=e[t+2]=void 0;if(this._reset(),this._backupBuffer.length){for(var i=this._backupBuffer,t=0;t<i.length;t+=3)i[t+0].call(i[t+1],i[t+2]);i.length=0}},o._reset=function(){this._isTickUsed=!1,this._length=0},t}(),O=new E,x=function(){function e(){this.errorObj=g,this.__id__=0,this.treshold=1e3,this.thenableCache=new i(this.treshold),this.promiseCache=new i(this.treshold),this._compactQueued=!1}var t=e.prototype;t.couldBe=function(e){if(null===e||"undefined"==typeof e||"string"==typeof e||"boolean"==typeof e||"number"==typeof e)return!1;var t=e.__id_$thenable__;return"number"==typeof t&&void 0!==this.thenableCache[t]?!0:"then"in e},t.is=function(e,t){var i=e.__id_$thenable__;return"number"==typeof i&&void 0!==this.thenableCache[i]?(t.ref=this.thenableCache[i],t.promise=this.promiseCache[i],!0):this._thenableSlowCase(e,t)},t.addCache=function(e,t){var i=this.__id__;this.__id__=i+1;var n=this._descriptor(i);r.defineProperty(e,"__id_$thenable__",n),this.thenableCache[i]=e,this.promiseCache[i]=t,this.thenableCache.length>this.treshold&&!this._compactQueued&&(this._compactQueued=!0,O.invokeLater(this._compactCache,this,void 0))},t.deleteCache=function(e){var t=e.__id_$thenable__;-1!==t&&(this.thenableCache[t]=void 0,this.promiseCache[t]=void 0,e.__id_$thenable__=-1)};var n={value:0,enumerable:!1,writable:!0,configurable:!0};return t._descriptor=function(e){return n.value=e,n},t._compactCache=function(){for(var e=this.thenableCache,t=this.promiseCache,i=0,n=0,r=0,o=e.length;o>r;++r){var s=e[r];void 0===s?i++:(t[n]=t[r],s.__id_$thenable__=n,e[n++]=s)}var l=e.length-i;if(l===this.__id__)this.treshold*=2;else for(var r=l,o=e.length;o>r;++r)t[n]=e[r]=void 0;this.__id__=l,this._compactQueued=!1},t._thenableSlowCase=function(e,t){try{var i=e.then;return"function"==typeof i?(t.ref=i,!0):!1}catch(n){return this.errorObj.e=n,t.ref=this.errorObj,!0}},e}(),L=function(){function e(e,t){this._instances=e,this._callback=t}var t=e.prototype;return t.doFilter=function(e){if(null===e||"object"!=typeof e)throw e;for(var t=this._callback,i=0,n=this._instances.length;n>i;++i){var r=this._instances[i];if(e instanceof r){var o=s(t,void 0,e);if(o===g)throw o.e;return o}}throw e},e}(),$=function(){function o(e){return null===e?!1:"object"==typeof e||"function"==typeof e}function a(e){return"object"!=typeof e?!1:e instanceof f}function h(e){return"object"!=typeof e?!1:e instanceof S}function f(e){"function"==typeof e&&this._resolveResolver(e),this._bitField=67108864,this._fulfill0=void 0,this._reject0=void 0,this._progress0=void 0,this._promise0=void 0,this._receiver0=void 0,this._resolvedValue=void 0,this._cancellationParent=void 0,W&&(this._traceParent=this._peekContext())}function _(e){throw e}function d(e,t){return this.isFulfilled()?e._then(function(){return t},_,void 0,this,void 0,d):e._then(function(){throw t},_,void 0,this,void 0,d)}function v(e){var t=this,i=l(t,void 0,null,e);i===g&&O.invokeLater(_,void 0,i.e)}function y(e){var t=this,i=s(t,void 0,e);i===g&&O.invokeLater(_,void 0,i.e)}function b(e){for(var t=this,i=!1,n=0,r=e.length;r>n;++n)if(void 0!==e[n]||n in e){var o=t(e[n],n,r);if(!i&&a(o)){if(o.isFulfilled()){e[n]=o._resolvedValue;continue}i=!0}e[n]=o}return i?f.all(e):e}function w(e,t){var i=this,n=e.length,r=void 0,o=0;if(void 0!==t)r=t,o=0;else if(o=1,n>0)for(var s=0;n>s;++s)if(void 0!==e[s]||s in e){r=e[s],o=s+1;break}for(var s=o;n>s;++s)(void 0!==e[s]||s in e)&&(r=i(r,e[s],s,n));return r}function j(e,t,i){return f._all(e,M,j).promise().then(function(e){return w.call(t,e,i)})}function C(){}function P(e,t){if(o(e)){if(e instanceof f)return e;var i={ref:null,promise:null};if(J.is(e,i)){if(null!=i.promise)return i.promise;var n=f.pending(t),r=i.ref;if(r===g)return n.reject(r.e),n.promise;J.addCache(e,n.promise);var s=!1,u=l(r,e,function a(t){if(!s){s=!0,J.deleteCache(e);var i=P(t);i===t?n.fulfill(t):t===e?n.promise._resolveFulfill(t):i._then(n.fulfill,n.reject,void 0,n,void 0,a)}},function(t){s||(s=!0,J.deleteCache(e),n.reject(t))});return u!==g||s||(n.reject(u.e),J.deleteCache(e)),n.promise}}return e}var S=n,V=i,E=V.isArray||function(e){return e instanceof V},$={},J=new x(g),z=f.prototype,W=!1;f.longStackTraces=function(){if(O.haveItemsQueued()&&W===!1)throw new n("Cannot enable long stack traces after promises have been created");W=!0},f.hasLongStackTraces=function(){return W},z._setTrace=function et(e,t){if(W){var i=this._peekContext(),n=void 0===i;this._trace=void 0!==t&&t._traceParent===i?t._trace:new T("function"==typeof e?e:et,n)}return this},z.toString=function(){return"[object Promise]"},z.caught=z["catch"]=function(e){var t=arguments.length;if(t>1){var r,o=new i(t-1),s=0;for(r=0;t-1>r;++r){var l=arguments[r];if("function"!=typeof l||!(l.prototype instanceof n||l===n))throw new TypeError("A catch filter must be an error constructor");o[s++]=l}o.length=s,e=arguments[r];var u=new L(o,e);return this._then(void 0,u.doFilter,void 0,u,void 0,this.caught)}return this._then(void 0,e,void 0,void 0,void 0,this.caught)},z.progressed=function(e){return this._then(void 0,void 0,e,void 0,void 0,this.progressed)},z.lastly=z["finally"]=function(e){var t=function(t){var i=e(t);if(a(i))return d.call(this,i,t);if(this.isRejected())throw t;return t};return this._then(t,t,void 0,this,void 0,this.lastly)},z.inspect=function(){return new I(this)},z.cancel=function(){if(!this.isCancellable())return this;for(var e=this;void 0!==e._cancellationParent;)e=e._cancellationParent;if(e===this){var t=new R;this._attachExtraTrace(t),this._reject(t)}else e.cancel(void 0);return this},z.uncancellable=function(){var e=new f;return e._setTrace(this.uncancellable,this),e._unsetCancellable(),e._assumeStateOf(this,!0),e},z.fork=function(e,t,i){var n=this._then(e,t,i,void 0,void 0,this.fork);return n._cancellationParent=void 0,n},z.call=function(e){var t=arguments.length;if(2>t)return this._callFast(e);for(var n=new i(t-1),r=1;t>r;++r)n[r-1]=arguments[r];return this._callSlow(e,n)},z.get=function(e){return this._then(p(e),void 0,void 0,void 0,void 0,this.get)},z.then=function(e,t,i){return this._then(e,t,i,void 0,void 0,this.then)},z.done=function(e,t,i){var n=this._then(e,t,i,void 0,void 0,this.done);n._setIsFinal()},z.spread=function(e,t){return this._then(e,t,void 0,$,void 0,this.spread)},z.isFulfilled=function(){return(268435456&this._bitField)>0},z.isRejected=function(){return(134217728&this._bitField)>0},z.isPending=function(){return!this.isResolved()},z.isResolved=function(){return(402653184&this._bitField)>0},z.isCancellable=function(){return!this.isResolved()&&this._cancellable()},z.toJSON=function(){var e=this.inspect(),t={isFulfilled:!1,isRejected:!1};return e.isFulfilled()?(t.fulfillmentValue=e.value(),t.isFulfilled=!0):e.isRejected()&&(t.rejectionReason=e.error(),t.isRejected=!0),t},z.nodeify=function(e){return"function"==typeof e&&this._then(v,y,void 0,e,null,this.nodeify),this},z.map=function(e){return f.map(this,e)},z.all=function(){return f.all(this)},z.any=function(){return f.any(this)},z.settle=function(){return f.settle(this)},z.some=function(e){return f.some(this,e)},z.reduce=function(e,t){return f.reduce(this,e,t)},f.is=a,f.settle=function(e){var t=f._all(e,B);return t.promise()},f.all=function(e){var t=f._all(e,M);return t.promise()},f.join=function(){for(var e=new i(arguments.length),t=0,n=e.length;n>t;++t)e[t]=arguments[t];return f._all(e,M).promise()},f.any=function(e){var t=f._all(e,U);return t.promise()},f.some=function(e,t){var i=f._all(e,D);if((0|t)!==t)throw new TypeError("howMany must be an integer");var n=i.length();return t=Math.max(0,Math.min(t,n)),i._howMany=t,i.promise()},f.map=function(e,t){if("function"!=typeof t)throw new TypeError("fn is not a function");return f.all(e)._then(b,void 0,void 0,t,void 0,f.map)},f.reduce=function(e,t,i){if("function"!=typeof t)throw new TypeError("fn is not a function");return void 0!==i?j(e,t,i):f.all(e)._then(w,void 0,void 0,t,void 0,f.all)},f.fulfilled=function(e,t){var i=new f;return i._setTrace("function"==typeof t?t:f.fulfilled,void 0),i._tryAssumeStateOf(e,!1)?i:(i._cleanValues(),i._setFulfilled(),i._resolvedValue=e,i)},f.rejected=function(e){var t=new f;return t._setTrace(f.rejected,void 0),t._cleanValues(),t._setRejected(),t._resolvedValue=e,t},f.pending=function(e){var t=new f;return t._setTrace(e,void 0),new N(t)},f.cast=function(e,t){var i=P(e,t);return i instanceof f?i:f.fulfilled(i,t)},f["try"]=f.attempt=function(e){return f.fulfilled().then(e)},f.onPossiblyUnhandledRejection=function(e){T.possiblyUnhandledRejection="function"==typeof e?e:void 0},f.coroutine=function(e){if("function"!=typeof e)throw new TypeError("generatorFunction must be a function");if(!Q.isSupported())throw new n("Attempting to use Promise.coroutine without generatorFunction support");var t=Q;return function i(){var n=e.apply(this,arguments),r=new t(void 0,void 0,i);return r._generator=n,r._next(void 0),r.promise()}},f.spawn=function(e){if("function"!=typeof e)throw new TypeError("generatorFunction must be a function");if(!Q.isSupported()){var t=f.pending(f.spawn);return t.reject(new n("Attempting to use Promise.spawn without generatorFunction support")),t.promise}var i=new Q(e,this,f.spawn),r=i.promise();return i._run(f.spawn),r};var Z={},q={value:Z,writable:!0,configurable:!1,enumerable:!1};f.promisify=function(e,t){if("object"==typeof e&&null!==e){if(e.__processedBluebirdAsync__!==Z){for(var i in e)e.hasOwnProperty(i)&&A.test(i)&&"function"==typeof e[i]&&(e[i+"Async"]=c(i,F));r.defineProperty(e,"__processedBluebirdAsync__",q),C.prototype=e}return e}return c(e,t)},z._then=function(e,t,i,n,r,o){var s=void 0!==r,l=s?r:new f;if(W&&!s){var u=this._peekContext()===this._traceParent;l._traceParent=u?this._traceParent:this,l._setTrace("function"==typeof o?o:this._then,this)}var a=this._addCallbacks(e,t,i,l,n);if(this.isResolved()?this._resolveLast(a):!s&&this.isCancellable()&&(l._cancellationParent=this),this._isDelegated()){this._unsetDelegated();var c=this._resolvedValue;this._tryThenable(c)||this._fulfill(c)}return l},z._length=function(){return 16777215&this._bitField},z._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},z._setLength=function(e){this._bitField=-16777216&this._bitField|16777215&e},z._cancellable=function(){return(67108864&this._bitField)>0},z._setFulfilled=function(){this._bitField=268435456|this._bitField},z._setRejected=function(){this._bitField=134217728|this._bitField},z._setFollowing=function(){this._bitField=536870912|this._bitField},z._setDelegated=function(){this._bitField=-1073741824|this._bitField},z._setIsFinal=function(){this._bitField=33554432|this._bitField},z._isFinal=function(){return(33554432&this._bitField)>0},z._isDelegated=function(){return-1073741824===(-1073741824&this._bitField)},z._unsetDelegated=function(){this._bitField=1073741823&this._bitField},z._setCancellable=function(){this._bitField=67108864|this._bitField},z._unsetCancellable=function(){this._bitField=-67108865&this._bitField},z._receiverAt=function(e){return 0===e?this._receiver0:this[e+4-5]},z._promiseAt=function(e){return 0===e?this._promise0:this[e+3-5]},z._fulfillAt=function(e){return 0===e?this._fulfill0:this[e+0-5]},z._rejectAt=function(e){return 0===e?this._reject0:this[e+1-5]},z._progressAt=function(e){return 0===e?this._progress0:this[e+2-5]},z._unsetAt=function(e){0===e?this._fulfill0=this._reject0=this._progress0=this._promise0=this._receiver0=void 0:this[e-5+0]=this[e-5+1]=this[e-5+2]=this[e-5+3]=this[e-5+4]=void 0};var G=new t("p","'use strict';return function Promise$_fulfiller(a){ p.fulfill( a ); }"),H=new t("p","'use strict';return function Promise$_rejecter(a){ p.reject( a ); }");z._resolveResolver=function(e){this._setTrace(this._resolveResolver,void 0);var t=new N(this);this._pushContext();var i=l(e,this,G(t),H(t));this._popContext(),i===g&&t.reject(i.e)},z._addCallbacks=function(e,t,i,n,r){e="function"==typeof e?e:void 0,t="function"==typeof t?t:void 0,i="function"==typeof i?i:void 0;var o=this._length();return 0===o?(this._fulfill0=e,this._reject0=t,this._progress0=i,this._promise0=n,this._receiver0=r,this._setLength(o+5),o):(this[o-5+0]=e,this[o-5+1]=t,this[o-5+2]=i,this[o-5+3]=n,this[o-5+4]=r,this._setLength(o+5),o)},z._callFast=function(e){return this._then(m(e),void 0,void 0,void 0,void 0,this.call)},z._callSlow=function(e,t){return this._then(function(i){return i[e].apply(i,t)},void 0,void 0,void 0,void 0,this.call)},z._resolveLast=function(e){var t,i=this._promiseAt(e),n=this._receiverAt(e);t=this.isFulfilled()?this._fulfillAt(e):this._rejectAt(e),this._unsetAt(e);var r=this._resolvedValue,o=r;void 0!==t?this._resolvePromise(t,n,r,i):this.isFulfilled()?i._fulfill(o):i._reject(o)},z._spreadSlowCase=function(e,t,i){t._assumeStateOf(f.all(i)._then(e,void 0,void 0,$,void 0,this._spreadSlowCase),!1)},z._resolveThenable=function(e,t){if(null!=t.promise)return this._assumeStateOf(t.promise,!0),void 0;if(t.ref===g)this._attachExtraTrace(t.ref.e),this._reject(t.ref.e);else{J.addCache(e,this);var i=t.ref,n=e,r=this,o={},s=!1,u=function h(t){if(!s||this===o){s=!0;var i=r._fulfill,l=P(t);if(l!==t||l instanceof f&&l.isPending())return t===e?(i.call(r,t),J.deleteCache(n)):l._then(h,a,void 0,o,void 0,h),void 0;if(l instanceof f){var i=l.isFulfilled()?r._fulfill:r._reject;if(t=t._resolvedValue,l=P(t),l!==t||l instanceof f&&l!==t)return l._then(h,a,void 0,o,void 0,h),void 0}i.call(r,t),J.deleteCache(n)}},a=function _(t){if(!s||this===o){var i=r._reject;s=!0;var l=P(t);if(l!==t||l instanceof f&&l.isPending())return t===e?(i.call(r,t),J.deleteCache(n)):l._then(u,_,void 0,o,void 0,u),void 0;if(l instanceof f){var i=l.isFulfilled()?r._fulfill:r._reject;if(t=t._resolvedValue,l=P(t),l!==t||l instanceof f&&l.isPending())return l._then(u,_,void 0,o,void 0,u),void 0}i.call(r,t),J.deleteCache(n)}},c=l(i,e,u,a);c!==g||s||(this._attachExtraTrace(c.e),this._reject(c.e),J.deleteCache(e))}},z._tryThenable=function(e){var t;return J.is(e,t={ref:null,promise:null})?(this._resolveThenable(e,t),!0):!1};var K=L.prototype.doFilter;z._resolvePromise=function(e,t,i,n){if(h(i)&&(i.__handled=!0),!a(n))return e.call(t,i,n);var r;if(t===$){if(!E(i))return this._spreadSlowCase(e,n,i),void 0;for(var o=0,l=i.length;l>o;++o)if(a(i[o]))return this._spreadSlowCase(e,n,i),void 0;n._pushContext(),r=u(e,i)}else n._pushContext(),r=s(e,t,i);if(n._popContext(),r===g)e!==K&&n._attachExtraTrace(r.e),n._reject(r.e);else if(r===n)n._reject(new TypeError("Circular thenable chain"));else{if(n._tryAssumeStateOf(r,!0))return;if(J.couldBe(r)){if(0===n._length())return n._resolvedValue=r,n._setDelegated(),void 0;if(n._tryThenable(r))return}n._fulfill(r)}},z._assumeStateOf=function(e,t){this._setFollowing(),e.isPending()?(e._cancellable()&&(this._cancellationParent=e),e._then(this._resolveFulfill,this._resolveReject,this._resolveProgress,this,void 0,this._tryAssumeStateOf)):e.isFulfilled()?t?this._resolveFulfill(e._resolvedValue):this._resolveFulfill(e._resolvedValue):t?this._resolveReject(e._resolvedValue):this._resolveReject(e._resolvedValue),W&&null==e._traceParent&&(e._traceParent=this)},z._tryAssumeStateOf=function(e,t){return!a(e)||this._isFollowingOrFulfilledOrRejected()?!1:(this._assumeStateOf(e,t),!0)},z._attachExtraTrace=function(e){if(W&&h(e)){var t=this,i=e.stack;i=i?i.split("\n"):[];for(var r=1;null!=t&&null!=t._trace;)i=T.combine(i,t._trace.stack.split("\n")),t=t._traceParent;var o=n.stackTraceLimit+r,s=i.length;s>o&&(i.length=o),e.stack=i.length<=r?"(No stack trace)":i.join("\n")}},z._notifyUnhandledRejection=function(e){e.__handled||(e.__handled=!0,T.possiblyUnhandledRejection(e))},z._unhandledRejection=function(e){e.__handled||O.invokeLater(this._notifyUnhandledRejection,this,e)},z._cleanValues=function(){this._cancellationParent=void 0},z._fulfill=function(e){this._isFollowingOrFulfilledOrRejected()||this._resolveFulfill(e)},z._reject=function(e){this._isFollowingOrFulfilledOrRejected()||this._resolveReject(e)},z._progress=function(e){this._isFollowingOrFulfilledOrRejected()||this._resolveProgress(e)},z._resolveFulfill=function(e){this._cleanValues(),this._setFulfilled(),this._resolvedValue=e;for(var t=this._length(),i=0;t>i;i+=5){var n=this._fulfillAt(i),r=this._promiseAt(i),o=this._receiverAt(i);this._unsetAt(i),void 0!==n?this._resolvePromise(n,o,e,r):r._fulfill(e)}},z._resolveReject=function(e){if(this._cleanValues(),this._setRejected(),this._resolvedValue=e,this._isFinal())return O.invokeLater(_,void 0,e),void 0;for(var t=this._length(),i=!1,n=0;t>n;n+=5){var r=this._rejectAt(n),o=this._promiseAt(n),s=this._receiverAt(n);this._unsetAt(n),void 0!==r?(i=!0,this._resolvePromise(r,s,e,o)):(i||(i=o._length()>0),o._reject(e))}!i&&h(e)&&void 0!==T.possiblyUnhandledRejection&&e.__handled!==!0&&(e.__handled=!1,this._unhandledRejection(e))},z._resolveProgress=function(e){for(var t=this._length(),i=0;t>i;i+=5){var n=this._progressAt(i),r=this._promiseAt(i);if(a(r)){var o=e;void 0!==n?(this._pushContext(),o=s(n,this._receiverAt(i),e),this._popContext(),o===g?null!=o.e&&"StopProgressPropagation"===o.e.name?o.e.__handled=!0:(r._attachExtraTrace(o.e),r._progress(o.e)):a(o)?o._then(r._progress,null,null,r,void 0,this._progress):r._progress(o)):r._progress(o)}else n.call(this._receiverAt(i),e,r)}};var X=[];z._peekContext=function(){var e=X.length-1;return e>=0?X[e]:void 0},z._pushContext=function(){W&&X.push(this)},z._popContext=function(){W&&X.pop()},f._all=function tt(e,t,i){if(a(e)||E(e))return new t(e,"function"==typeof i?i:tt);throw new TypeError("expecting an array or a promise")};var Y=e.Promise;return f.noConflict=function(){return e.Promise===f&&(e.Promise=Y),f},T.isSupported()||(f.longStackTraces=function(){},T.possiblyUnhandledRejection=function(){},f.onPossiblyUnhandledRejection=function(){},W=!1),f.CancellationError=R,f.TimeoutError=k,f.TypeError=TypeError,f}(),M=function(){function e(e){return null===e?void 0:e}function t(e){return"object"!=typeof e?!1:e instanceof $}function n(e,t){this._values=e,this._resolver=$.pending(t),this._length=0,this._totalResolved=0,this._init(void 0,s)}function r(e){this._value=e}var o={}.hasOwnProperty,s=[],l=i,u=l.isArray||function(e){return e instanceof l},a=n.prototype;a.length=function(){return this._length},a.promise=function(){return this._resolver.promise},a._init=function(n,s){var l=this._values;if(t(l)){if(l.isPending())return l._then(this._init,this._reject,void 0,this,s,this.constructor),void 0;if(l.isRejected())return this._reject(l._resolvedValue),void 0;if(l=l._resolvedValue,!u(l))return this._fulfill(e(s)),void 0;this._values=l}if(!l.length)return this._fulfill(e(s)),void 0;for(var a=l.length,c=a,h=new i(a),f=0;a>f;++f){var _=l[f];void 0!==_||o.call(l,f)?(_=$.cast(_),_._then(this._promiseFulfilled,this._promiseRejected,this._promiseProgressed,this,r.get(f),this.constructor),h[f]=_):c--}this._values=h,this._length=c},a._isResolved=function(){return null===this._values},a._fulfill=function(e){this._values=null,this._resolver.fulfill(e)},a._reject=function(e){this._values=null,this._resolver.reject(e)},a._promiseProgressed=function(e,t){this._isResolved()||this._resolver.progress({index:t.valueOf(),value:e})},a._promiseFulfilled=function(e,t){if(!this._isResolved()){this._values[t.valueOf()]=e;var i=++this._totalResolved;i>=this._length&&this._fulfill(this._values)}},a._promiseRejected=function(e){this._isResolved()||(this._totalResolved++,this._reject(e))},r.prototype.valueOf=function(){return this._value},r.get=function(e){return 256>e?c[e]:new r(e)};for(var c=[],h=0;256>h;++h)c.push(new r(h));return n}(),B=function(){function e(e,t){this.constructor$(e,t)}var t=j(e,M);t._promiseResolved=function(e,t){this._values[e]=t;var i=++this._totalResolved;i>=this._length&&this._fulfill(this._values)};var i=(new $)._setTrace();return t._promiseFulfilled=function(e,t){if(!this._isResolved()){var n=new I(i);n._bitField=268435456,n._resolvedValue=e,this._promiseResolved(t.valueOf(),n)}},t._promiseRejected=function(e,t){if(!this._isResolved()){var n=new I(i);n._bitField=134217728,n._resolvedValue=e,this._promiseResolved(t.valueOf(),n)}},e}(),U=function(){function e(e,t){this.constructor$(e,t)}var t=j(e,M);return t._init=function(){this._init$(void 0,null)},t._promiseFulfilled=function(e){this._isResolved()||(++this._totalResolved,this._fulfill(e))},t._promiseRejected=function(e,t){if(!this._isResolved()){var i=++this._totalResolved;this._values[t.valueOf()]=e,i>=this._length&&this._reject(this._values)}},e}(),D=function(){function e(e,t){this.constructor$(e,t)}var t=j(e,M);return t._init=function(){this._init$(void 0,[]),this._howMany=0,this._rejected=0,this._rejectionValues=new i(this.length()),this._resolutionValues=new i(this.length()),this._isResolved()||this._howMany>this._canPossiblyFulfill()&&this._reject([])},t._canPossiblyFulfill=function(){return this._totalResolved-this._rejected+(this.length()-this._totalResolved)},t._promiseFulfilled=function(e){if(!this._isResolved()){var t=this._totalResolved;this._resolutionValues[t]=e,this._totalResolved=t+1,t+1===this._howMany&&(this._resolutionValues.length=this._howMany,this._fulfill(this._resolutionValues),this._resolutionValues=this._rejectionValues=null)}},t._promiseRejected=function(e){this._isResolved()||(this._rejectionValues[this._rejected]=e,this._rejected++,this._totalResolved++,this._howMany>this._canPossiblyFulfill()&&(this._rejectionValues.length=this._rejected,this._reject(this._rejectionValues),this._resolutionValues=this._rejectionValues=null))},e}(),I=function(){function e(e){this._bitField=e._bitField,this._resolvedValue=e.isResolved()?e._resolvedValue:void 0}var t=e.prototype;return t.isFulfilled=function(){return(268435456&this._bitField)>0},t.isRejected=function(){return(134217728&this._bitField)>0},t.isPending=function(){return 0===(402653184&this._bitField)},t.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise");return this._resolvedValue},t.error=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise");return this._resolvedValue},e}(),N=function(){function e(e){this.promise=e}var t=e.prototype;return t.toString=function(){return"[object PromiseResolver]"},t.fulfill=function(e){this.promise._tryAssumeStateOf(e,!1)||this.promise._fulfill(e)},t.reject=function(e){this.promise._attachExtraTrace(e),this.promise._reject(e)},t.progress=function(e){this.promise._progress(e)},t.cancel=function(){this.promise.cancel(void 0)},t.timeout=function(){this.reject(new k("timeout"))},t.isResolved=function(){return this.promise.isResolved()},t.toJSON=function(){return this.promise.toJSON()},e}(),Q=function(){function e(e,t,i){this._resolver=$.pending(i),this._generatorFunction=e,this._receiver=t,this._generator=void 0}var i=function(){try{return new t("(function*(){})"),!0}catch(e){return!1}}(),n=e.prototype;return n.promise=function(){return this._resolver.promise},n._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},n._continue=function(e){if(e===g)return this._generator=void 0,this._resolver.reject(e.e),void 0;var t=e.value;e.done===!0?(this._generator=void 0,this._resolver.fulfill(t)):$.cast(t)._then(this._next,this._throw,void 0,this,null,void 0)},n._throw=function(e){this.promise()._attachExtraTrace(e),this._continue(s(this._generator["throw"],this._generator,e))},n._next=function(e){this._continue(s(this._generator.next,this._generator,e))},e.isSupported=new t("return "+i),e}();return"undefined"!=typeof module&&module.exports?module.exports=$:"function"==typeof define&&define.amd?define("Promise",[],function(){return $}):e.Promise=$,$}(new Function("return this")(),Function,Array,Error,Object);