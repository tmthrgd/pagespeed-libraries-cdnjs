/*! audio5 2015-02-07 */
(function(t,i,e){"use strict";"undefined"!=typeof module&&module.exports?module.exports=e(i,t):"function"==typeof define&&define.amd?define(function(){return e(i,t)}):t[i]=e(i,t)})(window,"Audio5js",function(t,i){"use strict";function e(t){this.message=t}function s(t){var i,e={};for(i in t)e[i]="object"==typeof t[i]?s(t[i]):t[i];return e}var n=i.ActiveXObject;e.prototype=Error();var a=function(t,i){var e,n=s(i);for(e in n)n.hasOwnProperty(e)&&(t[e]=n[e]);return t},o=function(t,i){return a(t.prototype,i)},r={on:function(t,i,e){this.subscribe(t,i,e,!1)},one:function(t,i,e){this.subscribe(t,i,e,!0)},off:function(t,i){if(void 0!==this.channels[t]){var e,s;for(e=0,s=this.channels[t].length;s>e;e++){var n=this.channels[t][e].fn;if(n===i){this.channels[t].splice(e,1);break}}}},subscribe:function(t,i,e,s){void 0===this.channels&&(this.channels={}),this.channels[t]=this.channels[t]||[],this.channels[t].push({fn:i,ctx:e,once:s||!1})},trigger:function(t){if(this.channels&&this.channels.hasOwnProperty(t)){for(var i=Array.prototype.slice.call(arguments,1),e=[];this.channels[t].length>0;){var s=this.channels[t].shift();"function"==typeof s.fn&&s.fn.apply(s.ctx,i),s.once||e.push(s)}this.channels[t]=e}}},d={flash_embed_code:function(i,e,s){var a,o='<param name="movie" value="'+e+"?playerInstance=window."+t+"_flash.instances['"+i+"']&datetime="+s+'"/>'+'<param name="wmode" value="transparent"/>'+'<param name="allowscriptaccess" value="always" />'+"</object>";return a=n?'<object classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1" id="'+i+'">':'<object type="application/x-shockwave-flash" data="'+e+"?playerInstance=window."+t+"_flash.instances['"+i+"']&datetime="+s+'" width="1" height="1" id="'+i+'" >',a+o},can_play:function(t){var i,e=document.createElement("audio");switch(t){case"mp3":i="audio/mpeg;";break;case"vorbis":i='audio/ogg; codecs="vorbis"';break;case"opus":i='audio/ogg; codecs="opus"';break;case"webm":i='audio/webm; codecs="vorbis"';break;case"mp4":i='audio/mp4; codecs="mp4a.40.5"';break;case"wav":i='audio/wav; codecs="1"'}return void 0!==i?"mp3"===t&&navigator.userAgent.match(/Android/i)&&navigator.userAgent.match(/Firefox/i)?!0:!!e.canPlayType&&""!==e.canPlayType(i):!1},has_flash:function(){var t=!1;if(navigator.plugins&&navigator.plugins.length&&navigator.plugins["Shockwave Flash"])t=!0;else if(navigator.mimeTypes&&navigator.mimeTypes.length){var i=navigator.mimeTypes["application/x-shockwave-flash"];t=i&&i.enabledPlugin}else try{var e=new n("ShockwaveFlash.ShockwaveFlash");t="object"==typeof e}catch(s){}return t}(),embedFlash:function(e,s){var n=document.createElement("div");if(n.style.position="absolute",n.style.width="1px",n.style.height="1px",n.style.top="1px",document.body.appendChild(n),"object"==typeof i.swfobject){var a={playerInstance:"window."+t+"_flash.instances['"+s+"']"},o={allowscriptaccess:"always",wmode:"transparent"};n.innerHTML='<div id="'+s+'"></div>',swfobject.embedSWF(e+"?ts="+((new Date).getTime()+Math.random()),s,"1","1","9.0.0",null,a,o)}else{var r=(new Date).getTime()+Math.random();n.innerHTML=this.flash_embed_code(s,e,r)}return document.getElementById(s)},formatTime:function(t){var i,e=parseInt(t/3600,10)%24,s=parseInt(t/60,10)%60,n=parseInt(t%60,10),a=(10>s?"0"+s:s)+":"+(10>n?"0"+n:n);return i=e>0?(10>e?"0"+e:e)+":"+a:a}};d.use_flash=d.can_play("mp3");var h,u,l,c={playing:!1,vol:1,duration:0,position:0,load_percent:0,seekable:!1,ready:null},f=i[t+"_flash"]=i[t+"_flash"]||{instances:{},count:0};u=function(){if(d.use_flash&&!d.has_flash)throw Error("Flash Plugin Missing")},u.prototype={init:function(i){f.count+=1,this.id=t+f.count,f.instances[this.id]=this,this.embed(i)},embed:function(t){d.embedFlash(t,this.id)},eiReady:function(){this.audio=document.getElementById(this.id),this.trigger("ready")},eiLoadStart:function(){this.trigger("loadstart")},eiLoadedMetadata:function(){this.trigger("loadedmetadata")},eiCanPlay:function(){this.trigger("canplay")},eiTimeUpdate:function(t,i,e){this.position=t,this.duration=i,this.seekable=e,this.trigger("timeupdate",t,this.seekable?i:null)},eiProgress:function(t,i,e){this.load_percent=t,this.duration=i,this.seekable=e,this.trigger("progress",t)},eiLoadError:function(t){this.trigger("error",t)},eiPlay:function(){this.playing=!0,this.trigger("play")},eiPause:function(){this.playing=!1,this.trigger("pause")},eiEnded:function(){this.pause(),this.trigger("ended")},eiSeeking:function(){this.trigger("seeking")},eiSeeked:function(){this.trigger("seeked")},reset:function(){this.seekable=!1,this.duration=0,this.position=0,this.load_percent=0},load:function(t){this.reset(),this.audio.load(t)},play:function(){this.audio.pplay()},pause:function(){this.audio.ppause()},volume:function(t){return void 0===t||isNaN(parseInt(t,10))?this.vol:(this.audio.setVolume(t),this.vol=t,void 0)},seek:function(t){try{this.audio.seekTo(t),this.position=t}catch(i){}},destroyAudio:function(){this.audio&&(this.pause(),this.audio.parentNode.removeChild(this.audio),delete f.instances[this.id],delete this.audio)}},o(u,r),o(u,c),l=function(){},l.prototype={init:function(){this.trigger("ready")},createAudio:function(){this.audio=new Audio,this.audio.autoplay=!1,this.audio.preload="auto",this.audio.autobuffer=!0,this.bindEvents()},destroyAudio:function(){if(this.audio){this.pause(),this.unbindEvents();try{this.audio.setAttribute("src","")}finally{delete this.audio}}},setupEventListeners:function(){this.listeners={loadstart:this.onLoadStart.bind(this),canplay:this.onLoad.bind(this),loadedmetadata:this.onLoadedMetadata.bind(this),play:this.onPlay.bind(this),pause:this.onPause.bind(this),ended:this.onEnded.bind(this),error:this.onError.bind(this),timeupdate:this.onTimeUpdate.bind(this),seeking:this.onSeeking.bind(this),seeked:this.onSeeked.bind(this)}},bindEvents:function(){void 0===this.listeners&&this.setupEventListeners(),this.audio.addEventListener("loadstart",this.listeners.loadstart,!1),this.audio.addEventListener("canplay",this.listeners.canplay,!1),this.audio.addEventListener("loadedmetadata",this.listeners.loadedmetadata,!1),this.audio.addEventListener("play",this.listeners.play,!1),this.audio.addEventListener("pause",this.listeners.pause,!1),this.audio.addEventListener("ended",this.listeners.ended,!1),this.audio.addEventListener("error",this.listeners.error,!1),this.audio.addEventListener("timeupdate",this.listeners.timeupdate,!1),this.audio.addEventListener("seeking",this.listeners.seeking,!1),this.audio.addEventListener("seeked",this.listeners.seeked,!1)},unbindEvents:function(){this.audio.removeEventListener("loadstart",this.listeners.loadstart),this.audio.removeEventListener("canplay",this.listeners.canplay),this.audio.removeEventListener("loadedmetadata",this.listeners.loadedmetadata),this.audio.removeEventListener("play",this.listeners.play),this.audio.removeEventListener("pause",this.listeners.pause),this.audio.removeEventListener("ended",this.listeners.ended),this.audio.removeEventListener("error",this.listeners.error),this.audio.removeEventListener("timeupdate",this.listeners.timeupdate),this.audio.removeEventListener("seeking",this.listeners.seeking),this.audio.removeEventListener("seeked",this.listeners.seeked)},onLoadStart:function(){this.trigger("loadstart")},onLoad:function(){return this.audio?(this.seekable=this.audio.seekable&&this.audio.seekable.length>0,this.seekable&&(this.timer=setInterval(this.onProgress.bind(this),250)),this.trigger("canplay"),void 0):setTimeout(this.onLoad.bind(this),100)},onLoadedMetadata:function(){this.trigger("loadedmetadata")},onPlay:function(){this.playing=!0,this.trigger("play")},onPause:function(){this.playing=!1,this.trigger("pause")},onEnded:function(){this.playing=!1,this.trigger("ended")},onTimeUpdate:function(){if(this.audio&&this.playing){try{this.position=this.audio.currentTime,this.duration=1/0===this.audio.duration?null:this.audio.duration}catch(t){}this.trigger("timeupdate",this.position,this.duration)}},onProgress:function(){this.audio&&null!==this.audio.buffered&&this.audio.buffered.length&&(this.duration=1/0===this.audio.duration?null:this.audio.duration,this.load_percent=parseInt(100*(this.audio.buffered.end(this.audio.buffered.length-1)/this.duration),10),this.trigger("progress",this.load_percent),this.load_percent>=100&&this.clearLoadProgress())},onError:function(t){this.trigger("error",t)},onSeeking:function(){this.trigger("seeking")},onSeeked:function(){this.trigger("seeked")},clearLoadProgress:function(){void 0!==this.timer&&(clearInterval(this.timer),delete this.timer)},reset:function(){this.clearLoadProgress(),this.seekable=!1,this.duration=0,this.position=0,this.load_percent=0},load:function(t){this.reset(),void 0===this.audio&&this.createAudio(),this.audio.setAttribute("src",t),this.audio.load()},play:function(){this.audio.play()},pause:function(){this.audio.pause()},volume:function(t){if(void 0===t||isNaN(parseInt(t,10)))return this.vol;var i=0>t?0:Math.min(1,t);this.audio.volume=i,this.vol=i},seek:function(t){var i=this.playing;this.position=t,this.audio.currentTime=t,i?this.play():null!==this.audio.buffered&&this.audio.buffered.length&&this.trigger("timeupdate",this.position,this.duration)}},o(l,r),o(l,c);var p={swf_path:"/swf/audiojs.swf",throw_errors:!0,format_time:!0,codecs:["mp3"]};return h=function(t){t=t||{};var i;for(i in p)p.hasOwnProperty(i)&&!t.hasOwnProperty(i)&&(t[i]=p[i]);this.init(t)},h.can_play=function(t){return d.can_play(t)},h.prototype={init:function(t){this.ready=!1,this.settings=t,this.audio=this.getPlayer(),this.bindAudioEvents(),this.settings.use_flash?this.audio.init(t.swf_path):this.audio.init()},getPlayer:function(){var t,i,e,s;if(this.settings.use_flash)e=new u,this.settings.player={engine:"flash",codec:"mp3"};else{for(t=0,i=this.settings.codecs.length;i>t;t++)if(s=this.settings.codecs[t],h.can_play(s)){e=new l,this.settings.use_flash=!1,this.settings.player={engine:"html",codec:s};break}void 0===e&&(this.settings.use_flash=!h.can_play("mp3"),e=this.settings.use_flash?new u:new l,this.settings.player={engine:this.settings.use_flash?"flash":"html",codec:"mp3"})}return e},bindAudioEvents:function(){this.audio.on("ready",this.onReady,this),this.audio.on("loadstart",this.onLoadStart,this),this.audio.on("loadedmetadata",this.onLoadedMetadata,this),this.audio.on("play",this.onPlay,this),this.audio.on("pause",this.onPause,this),this.audio.on("ended",this.onEnded,this),this.audio.on("canplay",this.onCanPlay,this),this.audio.on("timeupdate",this.onTimeUpdate,this),this.audio.on("progress",this.onProgress,this),this.audio.on("error",this.onError,this),this.audio.on("seeking",this.onSeeking,this),this.audio.on("seeked",this.onSeeked,this)},unbindAudioEvents:function(){this.audio.off("ready",this.onReady),this.audio.off("loadstart",this.onLoadStart),this.audio.off("loadedmetadata",this.onLoadedMetadata),this.audio.off("play",this.onPlay),this.audio.off("pause",this.onPause),this.audio.off("ended",this.onEnded),this.audio.off("canplay",this.onCanPlay),this.audio.off("timeupdate",this.onTimeUpdate),this.audio.off("progress",this.onProgress),this.audio.off("error",this.onError),this.audio.off("seeking",this.onSeeking),this.audio.off("seeked",this.onSeeked)},load:function(t){var i=this,e=function(t){i.audio.load(t),i.trigger("load")};this.ready?e(t):this.on("ready",e)},play:function(){this.playing||this.audio.play()},pause:function(){this.playing&&this.audio.pause()},playPause:function(){this[this.playing?"pause":"play"]()},volume:function(t){return void 0===t||isNaN(parseInt(t,10))?this.vol:(this.audio.volume(t),this.vol=t,void 0)},seek:function(t){this.audio.seek(t),this.position=t},destroy:function(){this.unbindAudioEvents(),this.audio.destroyAudio()},onReady:function(){this.ready=!0,"function"==typeof this.settings.ready&&this.settings.ready.call(this,this.settings.player),this.trigger("ready")},onLoadStart:function(){this.trigger("loadstart")},onLoadedMetadata:function(){this.trigger("loadedmetadata")},onPlay:function(){this.playing=!0,this.trigger("play")},onPause:function(){this.playing=!1,this.trigger("pause")},onEnded:function(){this.playing=!1,this.trigger("ended")},onError:function(){var t=new e("Audio Error. Failed to Load Audio");if(this.settings.throw_errors)throw t;this.trigger("error",t)},onCanPlay:function(){this.trigger("canplay")},onSeeking:function(){this.trigger("seeking")},onSeeked:function(){this.trigger("seeked")},onTimeUpdate:function(t,i){this.position=this.settings.format_time?d.formatTime(t):t,this.duration!==i&&(this.duration=this.settings.format_time&&null!==i?d.formatTime(i):i),this.trigger("timeupdate",this.position,this.duration)},onProgress:function(t){this.duration=this.audio.duration,this.load_percent=t,this.trigger("progress",t)}},o(h,r),o(h,c),h});