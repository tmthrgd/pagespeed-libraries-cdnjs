!function(e){"use strict";var t,n=e.Backbone,r=e._,i=n.$,o=e.console&&e.console.warn,s=e.console&&e.console.trace,a=n.View.prototype._configure,l=(n.View.prototype.render,Array.prototype.push),c=Array.prototype.concat,u=Array.prototype.splice,p=n.View.extend({constructor:function(e){e=e||{},p.setupView(this,e),n.View.call(this,e)},insertView:function(e,t){return t?this.setView(e,t,!0):this.setView(e,!0)},insertViews:function(e){return r.isArray(e)?this.setViews({"":e}):(r.each(e,function(t,n){e[n]=r.isArray(t)?t:[t]}),this.setViews(e))},getView:function(e){return null==e&&(e=arguments[1]),this.getViews(e).first().value()},getViews:function(e){var t=r.chain(this.views).map(function(e){return r.isArray(e)?e:[e]},this).flatten().value();return"string"==typeof e?r.chain([this.views[e]]).flatten():"object"==typeof e?r.chain([r.where(t,e)]).flatten():r.chain("function"==typeof e?r.filter(t,e):t)},removeView:function(e){return this.getViews(e).each(function(e){e.remove()})},setView:function(e,t,n){var i,o,s,a=this;if("string"!=typeof e&&(n=t,t=e,e=""),this.views=this.views||{},i=t.__manager__,o=this.views[e],!i)throw new Error("Please set `View#manage` property with selector '"+e+"' to `true`.");return s=t.getAllOptions(),i.parent=a,i.selector=e,t.on("all",function(e){"beforeRender"!==e&&"afterRender"!==e&&a.trigger.apply(a,arguments)},t),n?(this.views[e]=c.call([],o||[],t),i.insert=!0,t):(i.hasRendered&&s.partial(a.$el,t.$el,a.__manager__,i),o&&r.each(c.call([],o),function(e){e.remove()}),this.views[e]=t)},setViews:function(e){return r.each(e,function(e,t){return r.isArray(e)?r.each(e,function(e){this.insertView(t,e)},this):void this.setView(t,e)},this),this},render:function(){function t(){function t(){var t=a.afterRender;t&&t.call(i,i),i.trigger("afterRender",i),c.noel&&i.$el.length>1&&o&&!a.suppressWarnings&&(e.console.warn("Using `el: false` with multiple top level elements is not supported."),s&&e.console.trace())}var n;return u&&(a.contains(u.el,i.el)||a.partial(u.$el,i.$el,f,c)),i.delegateEvents(),c.hasRendered=!0,(n=c.queue.shift())?n():delete c.queue,f&&f.queue?u.once("afterRender",t):t(),h.resolveWith(i,[i])}function n(){{var e=i.getAllOptions(),n=i.__manager__,o=n.parent;o&&o.__manager__}i._render(p._viewRender,e).done(function(){if(!r.keys(i.views).length)return t();var n=r.map(i.views,function(e){var t=r.isArray(e);return t&&e.length?r.reduce(e.slice(1),function(e,t){return e.then(function(){return t.render()})},e[0].render()):t?e:e.render()});e.when(n).done(t)})}var i=this,a=i.getAllOptions(),c=i.__manager__,u=c.parent,f=u&&u.__manager__,h=a.deferred();return c.queue?l.call(c.queue,n):(c.queue=[],n(i,h)),h.view=i,h},remove:function(){return p._removeView(this,!0),this._remove.apply(this,arguments)},getAllOptions:function(){return r.extend({},this,p.prototype.options,this.options)}},{_cache:{},_makeAsync:function(e,t){var n=e.deferred();return n.async=function(){return n._isAsync=!0,t},n},_viewRender:function(e,t){function n(n){n&&(u.noel?(c=i(n),e.$el.slice(1).remove(),e.$el.replaceWith(c),e.setElement(c,!1)):t.html(e.$el,n)),l.resolveWith(e,[e])}function o(e,r){var i,o=p._makeAsync(t,function(e){n(e)});p.cache(s,r),r&&(i=t.render.call(o,r,e)),o._isAsync||n(i)}var s,a,l,c,u=e.__manager__;return{render:function(){var n=e.serialize||t.serialize,i=e.template||t.template;return r.isFunction(n)&&(n=n.call(e)),l=p._makeAsync(t,function(e){o(n,e)}),"string"==typeof i&&(s=t.prefix+i),(a=p.cache(s))?(o(n,a,s),l):("string"==typeof i?a=t.fetch.call(l,t.prefix+i):"function"==typeof i?a=i:null!=i&&(a=t.fetch.call(l,i)),l._isAsync||o(n,a),l)}}},_removeViews:function(e,t){"boolean"==typeof e&&(t=e,e=this),e=e||this,e.getViews().each(function(e){(e.__manager__.hasRendered||t)&&p._removeView(e,t)})},_removeView:function(e,t){var n,i=e.__manager__,o="boolean"==typeof e.keep?e.keep:e.options.keep;if(!o&&i.insert===!0||t){if(p.cleanViews(e),e._removeViews(!0),e.$el.remove(),!i.parent)return;if(n=i.parent.views[i.selector],r.isArray(n))return r.each(r.clone(n),function(e,t){e&&e.__manager__===i&&u.call(n,t,1)});delete i.parent.views[i.selector]}},cache:function(e,t){return e in this._cache&&null==t?this._cache[e]:null!=e&&null!=t?this._cache[e]=t:void 0},cleanViews:function(e){r.each(c.call([],e),function(e){e.unbind(),e.model instanceof n.Model&&e.model.off(null,null,e),e.collection instanceof n.Collection&&e.collection.off(null,null,e),e.stopListening(),r.result(e.getAllOptions(),"cleanup")})},configure:function(e){r.extend(p.prototype.options,e),e.manage&&(n.View.prototype.manage=!0),e.el===!1&&(n.View.prototype.el=!1),e.suppressWarnings===!0&&(n.View.prototype.suppressWarnings=!0)},setupView:function(e,i){r.each(c.call([],e),function(e){if(!e.__manager__){var o,s,a,l=p.prototype,u=r.pick(e,t);r.defaults(e,{views:{},__manager__:{},_removeViews:p._removeViews,_removeView:p._removeView},p.prototype),i=e.options=r.defaults(i||{},e.options,l.options),a=r.pick(i,c.call(["events"],r.values(i.events))),r.extend(e,a),(u.render===p.prototype.render||u.render===n.View.prototype.render)&&delete u.render,r.extend(i,u),e._remove=n.View.prototype.remove,e._render=function(e,t){var n=this,r=n.__manager__,i=t.beforeRender;return r.hasRendered&&this._removeViews(),i&&i.call(this,this),this.trigger("beforeRender",this),e(this,t).render()},e.render=p.prototype.render,e.remove!==l.remove&&(e._remove=e.remove,e.remove=l.remove),o=i.views||e.views,r.keys(o).length&&(s=o,e.views={},e.setViews(s)),e.options.template?e.options.template=i.template:e.template&&(i.template=e.template)}})}});n.Layout=p,p.VERSION="0.8.6",n.View.prototype._configure=function(e){var t,n;return("el"in e?e.el===!1:this.el===!1)&&(t=!0),n=a.apply(this,arguments),(e.manage||this.manage)&&p.setupView(this),this.__manager__&&(this.__manager__.noel=t,this.__manager__.suppressWarnings=e.suppressWarnings),n},p.prototype.options={prefix:"",deferred:function(){return i.Deferred()},fetch:function(e){return r.template(i(e).html())},partial:function(e,t,n,r){if(r.selector)if(n.noel){var i=e.filter(r.selector);e=i.length?i:e.find(r.selector)}else e=e.find(r.selector);r.insert?this.insert(e,t):this.html(e,t)},html:function(e,t){e.html(t)},insert:function(e,t){e.append(t)},when:function(e){return i.when.apply(null,e)},render:function(e,t){return e(t)},contains:function(e,t){return i.contains(e,t)}},t=r.keys(p.prototype.options)}("object"==typeof global?global:this);