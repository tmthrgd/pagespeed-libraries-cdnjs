!function(e){"use strict";var t,n=e.Backbone,r=e._,i=e.$,o=n.View.prototype._configure,a=(n.View.prototype.render,Array.prototype.push),s=Array.prototype.concat,c=Array.prototype.splice,u=n.View.extend({constructor:function(e){e=e||{},u.setupView(this,e),n.View.call(this,e)},insertView:function(e,t){return t?this.setView(e,t,!0):this.setView(e,!0)},insertViews:function(e){return r.isArray(e)?this.setViews({"":e}):(r.each(e,function(t,n){e[n]=r.isArray(t)?t:[t]}),this.setViews(e))},getView:function(e){return this.getViews(e).first().value()},getViews:function(e){var t=r.chain(this.views).map(function(e){return r.isArray(e)?e:[e]},this).flatten().value();return"string"==typeof e?r.chain([this.views[e]]).flatten():r.chain("function"==typeof e?r.filter(t,e):t)},setView:function(e,t,n){var i,o,a,c=this;if("string"!=typeof e&&(n=t,t=e,e=""),this.views=this.views||{},i=t.__manager__,o=this.views[e],!i)throw new Error("Please set `View#manage` property with selector '"+e+"' to `true`.");return a=t._options(),i.parent=c,i.selector=e,n?(this.views[e]=s.call([],o||[],t),i.append=!0,t):(i.hasRendered&&a.partial(c.el,i.selector,t.el,i.append),o&&r.each(s.call([],o),function(e){e.remove()}),this.views[e]=t)},setViews:function(e){return r.each(e,function(e,t){return r.isArray(e)?r.each(e,function(e){this.insertView(t,e)},this):void this.setView(t,e)},this),this},render:function(){function e(){function e(){var e=i.afterRender;e&&e.call(n,n),n.trigger("afterRender",n)}var t,r;return s&&(i.contains(s.el,n.el)||i.partial(s.el,o.selector,n.el,o.append)),n.delegateEvents(),o.hasRendered=!0,l.resolveWith(n,[n]),(t=o.queue.shift())?t():delete o.queue,c&&c.queue?(r=function(){s.off("afterRender",r,this),e()},s.on("afterRender",r,n)):void e()}function t(){{var t=n._options(),i=n.__manager__,o=i.parent;o&&o.__manager__}n._render(u._viewRender,t).done(function(){if(!r.keys(n.views).length)return e();var i=r.map(n.views,function(e){var n=r.isArray(e);return n&&e.length?e[0].render().pipe(function(){return t.when(r.map(e.slice(1),function(e){return e.render()}))}):n?e:e.render()});t.when(i).done(function(){e()})})}var n=this,i=n._options(),o=n.__manager__,s=o.parent,c=s&&s.__manager__,l=i.deferred();return o.queue?a.call(o.queue,function(){t()}):(o.queue=[],t(n,l)),l.view=n,l},remove:function(){return u._removeView(this,!0),this._remove.apply(this,arguments)},_options:function(){return u.augment({},this,u.prototype.options,this.options)}},{_cache:{},_makeAsync:function(e,t){var n=e.deferred();return n.async=function(){return n._isAsync=!0,t},n},_viewRender:function(e,t){function n(n){n&&t.html(e.$el,n),s.resolveWith(e,[e])}function i(e,r){var i,a=u._makeAsync(t,function(e){n(e)});u.cache(o,r),r&&(i=t.render.call(a,r,e)),a._isAsync||n(i)}{var o,a,s;e.__manager__}return{render:function(){var n=e.serialize||t.serialize,c=e.data||t.data,l=n||c,p=e.template||t.template;return r.isFunction(l)&&(l=l.call(e)),s=u._makeAsync(t,function(e){i(l,e)}),"string"==typeof p&&(o=t.prefix+p),(a=u.cache(o))?(i(l,a,o),s):("string"==typeof p?a=t.fetch.call(s,t.prefix+p):null!=p&&(a=t.fetch.call(s,p)),s._isAsync||i(l,a),s)}}},_removeViews:function(e,t){"boolean"==typeof e&&(t=e,e=this),e=e||this,e.getViews().each(function(e){(e.__manager__.hasRendered||t)&&u._removeView(e,t)})},_removeView:function(e,t){var n,i=e.__manager__,o="boolean"==typeof e.keep?e.keep:e.options.keep;if(!o&&(i.append===!0||t)){if(u.cleanViews(e),e._removeViews(!0),e.$el.remove(),!i.parent)return;if(n=i.parent.views[i.selector],r.isArray(n))return r.each(r.clone(n),function(e,t){e&&e.__manager__===i&&c.call(n,t,1)});delete i.parent.views[i.selector]}},cleanViews:function(e){r.each(s.call([],e),function(e){e.unbind(),e.model instanceof n.Model&&e.model.off(null,null,e),e.collection instanceof n.Collection&&e.collection.off(null,null,e),e.cleanup&&e.cleanup.call(e)})},cache:function(e,t){return e in this._cache?this._cache[e]:null!=e&&null!=t?this._cache[e]=t:void 0},configure:function(e){this.augment(u.prototype.options,e),e.manage&&(n.View.prototype.manage=!0)},augment:r.forIn?function(e){return r.reduce(Array.prototype.slice.call(arguments,1),function(e,t){return r.forIn(t,function(t,n){e[n]=t}),e},e)}:r.extend,setupView:function(e,i){if(!e.__manager__){var o,a,c,l=n.LayoutManager.prototype,p=r.pick(e,t);r.defaults(e,{views:{},__manager__:{},_removeViews:u._removeViews,_removeView:u._removeView},u.prototype),i=e.options=r.defaults(i||{},e.options,l.options),c=r.pick(i,s.call(["events"],r.values(i.events))),u.augment(e,c),(p.render===u.prototype.render||p.render===n.View.prototype.render)&&delete p.render,u.augment(i,p),e._remove=n.View.prototype.remove,e._render=function(e,t){var n=this,r=n.__manager__,i=t.beforeRender;return r.hasRendered&&this._removeViews(),i&&i.call(this,this),this.trigger("beforeRender",this),e(this,t).render()},e.render=u.prototype.render,e.remove!==l.remove&&(e._remove=e.remove,e.remove=l.remove),o=i.views||e.views,r.keys(o).length&&(a=o,e.views={},e.setViews(a)),e.options.template?e.options.template=i.template:e.template&&(i.template=e.template,delete e.template)}}});n.Layout=n.LayoutView=n.LayoutManager=u,u.VERSION="0.7.5",n.View.prototype._configure=function(){var e=o.apply(this,arguments);return this.manage&&u.setupView(this),e},u.prototype.options={prefix:"",deferred:function(){return i.Deferred()},fetch:function(e){return r.template(i(e).html())},partial:function(e,t,n,r){var o=t?i(e).find(t):i(e);this[r?"append":"html"](o,n)},html:function(e,t){e.html(t)},append:function(e,t){e.append(t)},when:function(e){return i.when.apply(null,e)},render:function(e,t){return e(t)},contains:function(e,t){return i.contains(e,t)}},t=r.keys(u.prototype.options)}(this);