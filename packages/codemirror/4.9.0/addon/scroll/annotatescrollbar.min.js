!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(t,e){this.cm=t,this.className=e,this.annotations=[],this.div=t.getWrapperElement().appendChild(document.createElement("div")),this.div.style.cssText="position: absolute; right: 0; top: 0; z-index: 7; pointer-events: none",this.computeScale();var o=this;t.on("refresh",this.resizeHandler=function(){o.computeScale()&&o.redraw()})}t.defineExtension("annotateScrollbar",function(t){return new e(this,t)}),e.prototype.computeScale=function(){var t=this.cm,e=(t.getWrapperElement().clientHeight-t.display.barHeight)/t.heightAtLine(t.lastLine()+1,"local");return e!=this.hScale?(this.hScale=e,!0):void 0},e.prototype.update=function(t){this.annotations=t,this.redraw()},e.prototype.redraw=function(){var t=this.cm,e=this.hScale;if(t.display.barWidth){for(var o,i=document.createDocumentFragment(),r=this.annotations,n=0;n<r.length;n++){for(var a=r[n],s=o||t.charCoords(a.from,"local").top*e,c=t.charCoords(a.to,"local").bottom*e;n<r.length-1&&(o=t.charCoords(r[n+1].from,"local").top*e,!(o>c+.9));)a=r[++n],c=t.charCoords(a.to,"local").bottom*e;var h=Math.max(c-s,3),d=i.appendChild(document.createElement("div"));d.style.cssText="position: absolute; right: 0px; width: "+Math.max(t.display.barWidth-1,2)+"px; top: "+s+"px; height: "+h+"px",d.className=this.className}this.div.textContent="",this.div.appendChild(i)}},e.prototype.clear=function(){this.cm.off("refresh",this.resizeHandler),this.div.parentNode.removeChild(this.div)}});