!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],t):t(CodeMirror)}(function(t){"use strict";function e(e,s){var n=s&&s.schemaInfo,a=s&&s.quoteChar||'"';if(n){var i=e.getCursor(),o=e.getTokenAt(i);if(/^<\/?$/.test(o.string)&&o.end==i.ch){var l=e.getTokenAt(r(i.line,i.ch+1));l.start==i.ch&&/\btag\b/.test(l.type)&&(o=l)}var f=t.innerMode(e.getMode(),o.state);if("xml"==f.mode.name){var g,c,h=[],p=!1,u=/\btag\b/.test(o.type)&&!/>$/.test(o.string),d=u&&/^\w/.test(o.string);if(d){var v=e.getLine(i.line).slice(Math.max(0,o.start-2),o.start),m=/<\/$/.test(v)?"close":/<$/.test(v)?"open":null;m&&(c=o.start-("close"==m?2:1))}else u&&"<"==o.string?m="open":u&&"</"==o.string&&(m="close");if(!u&&!f.state.tagName||m){d&&(g=o.string),p=m;var y=f.state.context,x=y&&n[y.tagName],b=y?x&&x.children:n["!top"];if(b&&"close"!=m)for(var O=0;O<b.length;++O)g&&0!=b[O].lastIndexOf(g,0)||h.push("<"+b[O]);else if("close"!=m)for(var w in n)!n.hasOwnProperty(w)||"!top"==w||"!attrs"==w||g&&0!=w.lastIndexOf(g,0)||h.push("<"+w);y&&(!g||"close"==m&&0==y.tagName.lastIndexOf(g,0))&&h.push("</"+y.tagName+">")}else{var x=n[f.state.tagName],A=x&&x.attrs,I=n["!attrs"];if(!A&&!I)return;if(A){if(I){var P={};for(var M in I)I.hasOwnProperty(M)&&(P[M]=I[M]);for(var M in A)A.hasOwnProperty(M)&&(P[M]=A[M]);A=P}}else A=I;if("string"==o.type||"="==o.string){var N,v=e.getRange(r(i.line,Math.max(0,i.ch-60)),r(i.line,"string"==o.type?o.start:o.end)),$=v.match(/([^\s\u00a0=<>\"\']+)=$/);if(!$||!A.hasOwnProperty($[1])||!(N=A[$[1]]))return;if("function"==typeof N&&(N=N.call(this,e)),"string"==o.type){g=o.string;var C=0;/['"]/.test(o.string.charAt(0))&&(a=o.string.charAt(0),g=o.string.slice(1),C++);var j=o.string.length;/['"]/.test(o.string.charAt(j-1))&&(a=o.string.charAt(j-1),g=o.string.substr(C,j-2)),p=!0}for(var O=0;O<N.length;++O)g&&0!=N[O].lastIndexOf(g,0)||h.push(a+N[O]+a)}else{"attribute"==o.type&&(g=o.string,p=!0);for(var k in A)!A.hasOwnProperty(k)||g&&0!=k.lastIndexOf(g,0)||h.push(k)}}return{list:h,from:p?r(i.line,null==c?o.start:c):i,to:p?r(i.line,o.end):i}}}}var r=t.Pos;t.registerHelper("hint","xml",e)});