!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(t){"use strict";function r(r){var e=r.doc.modeOption;return"sql"===e&&(e="text/x-sql"),t.resolveMode(e).keywords}function e(t,r){var e=t.length,n=r.substr(0,e);return t.toUpperCase()===n.toUpperCase()}function n(t,r,n,o){for(var i in n)n.hasOwnProperty(i)&&(Array.isArray(n)&&(i=n[i]),e(r,i)&&t.push(o(i)))}function o(t,r){var e=r.getCursor(),o=r.getTokenAt(e),i="`"==o.string.charAt(0),s=o.string.substr(1),a=r.getTokenAt(p(e.line,o.start));if("."==o.string.charAt(0)||"."==a.string){if("."==a.string)var a=r.getTokenAt(p(e.line,o.start-1));var l=a.string,g=!1;l.match(/`/g)&&(g=!0,l=l.replace(/`/g,"")),f.hasOwnProperty(l)||(l=u(l,r));var d=f[l];if(!d)return;i?n(t,s,d,function(t){return"`"+t+"`"}):g?n(t,s,d,function(t){return".`"+t+"`"}):n(t,s,d,function(t){return"."+t})}else{for(;o.start&&"."==s.charAt(0);)o=r.getTokenAt(p(e.line,o.start-1)),s=o.string+s;i?(n(t,s,f,function(t){return"`"+t+"`"}),n(t,s,c,function(t){return"`"+t+"`"})):(n(t,s,f,function(t){return t}),n(t,s,c,function(t){return t}))}}function i(t,r){if(t)for(var e=/[,;]/g,n=t.split(" "),o=0;o<n.length;o++)r(n[o]?n[o].replace(e,""):"")}function s(t){return t.line+t.ch/Math.pow(10,6)}function a(t){return p(Math.floor(t),+t.toString().split(".").pop())}function u(t,r){for(var e=r.doc,n=e.getValue(),o=t.toUpperCase(),u="",c="",l=[],d={start:p(0,0),end:p(r.lastLine(),r.getLineHandle(r.lastLine()).length)},h=n.indexOf(g.QUERY_DIV);-1!=h;)l.push(e.posFromIndex(h)),h=n.indexOf(g.QUERY_DIV,h+1);l.unshift(p(0,0)),l.push(p(r.lastLine(),r.getLineHandle(r.lastLine()).text.length));for(var v=0,A=s(r.getCursor()),m=0;m<l.length;m++){var b=s(l[m]);if(A>v&&b>=A){d={start:a(v),end:a(b)};break}v=b}for(var q=e.getRange(d.start,d.end,!1),m=0;m<q.length;m++){var y=q[m];if(i(y,function(t){var r=t.toUpperCase();r===o&&f.hasOwnProperty(u)&&(c=u),r!==g.ALIAS_KEYWORD&&(u=t)}),c)break}return c}var f,c,l,g={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},p=t.Pos;t.registerHelper("hint","sql",function(t,e){f=e&&e.tables||{};var i=e&&e.defaultTable;c=i&&f[i]||[],l=l||r(t);var s,a,u,g=t.getCursor(),d=[],h=t.getTokenAt(g);return h.string.match(/^[.`\w@]\w*$/)?(u=h.string,s=h.start,a=h.end):(s=a=g.ch,u=""),"."==u.charAt(0)||"`"==u.charAt(0)?o(d,t):(n(d,u,f,function(t){return t}),n(d,u,c,function(t){return t}),n(d,u,l,function(t){return t.toUpperCase()})),{list:d,from:p(g.line,s),to:p(g.line,a)}})});