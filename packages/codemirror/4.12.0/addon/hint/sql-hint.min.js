!function(t){"object"==typeof exports&&"object"==typeof module?t(require("../../lib/codemirror"),require("../../mode/sql/sql")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../../mode/sql/sql"],t):t(CodeMirror)}(function(t){"use strict";function r(r){var e=r.doc.modeOption;return"sql"===e&&(e="text/x-sql"),t.resolveMode(e).keywords}function e(t,r){var e=t.length,n=r.substr(0,e);return t.toUpperCase()===n.toUpperCase()}function n(t,r,n,i){for(var o in n)n.hasOwnProperty(o)&&(Array.isArray(n)&&(o=n[o]),e(r,o)&&t.push(i(o)))}function i(t,r,e,i){var o="`"==r.string.charAt(0),s=r.string.substr(1),a=i.getTokenAt(p(t.line,r.start));if("."==r.string.charAt(0)||"."==a.string){if("."==a.string)var a=i.getTokenAt(p(t.line,r.start-1));var l=a.string,g=!1;l.match(/`/g)&&(g=!0,l=l.replace(/`/g,"")),f.hasOwnProperty(l)||(l=u(l,i));var h=f[l];if(!h)return;o?n(e,s,h,function(t){return"`"+t+"`"}):g?n(e,s,h,function(t){return".`"+t+"`"}):n(e,s,h,function(t){return"."+t})}else{for(;r.start&&"."==s.charAt(0);)r=i.getTokenAt(p(t.line,r.start-1)),s=r.string+s;o?(n(e,s,f,function(t){return"`"+t+"`"}),n(e,s,c,function(t){return"`"+t+"`"})):(n(e,s,f,function(t){return t}),n(e,s,c,function(t){return t}))}}function o(t,r){if(t)for(var e=/[,;]/g,n=t.split(" "),i=0;i<n.length;i++)r(n[i]?n[i].replace(e,""):"")}function s(t){return t.line+t.ch/Math.pow(10,6)}function a(t){return p(Math.floor(t),+t.toString().split(".").pop())}function u(t,r){for(var e=r.doc,n=e.getValue(),i=t.toUpperCase(),u="",c="",l=[],h={start:p(0,0),end:p(r.lastLine(),r.getLineHandle(r.lastLine()).length)},d=n.indexOf(g.QUERY_DIV);-1!=d;)l.push(e.posFromIndex(d)),d=n.indexOf(g.QUERY_DIV,d+1);l.unshift(p(0,0)),l.push(p(r.lastLine(),r.getLineHandle(r.lastLine()).text.length));for(var v=0,A=s(r.getCursor()),m=0;m<l.length;m++){var b=s(l[m]);if(A>v&&b>=A){h={start:a(v),end:a(b)};break}v=b}for(var q=e.getRange(h.start,h.end,!1),m=0;m<q.length;m++){var y=q[m];if(o(y,function(t){var r=t.toUpperCase();r===i&&f.hasOwnProperty(u)&&(c=u),r!==g.ALIAS_KEYWORD&&(u=t)}),c)break}return c}var f,c,l,g={QUERY_DIV:";",ALIAS_KEYWORD:"AS"},p=t.Pos;t.registerHelper("hint","sql",function(t,e){f=e&&e.tables||{};var o=e&&e.defaultTable;c=o&&f[o]||[],l=l||r(t);var s,a,u,g=t.getCursor(),h=[],d=t.getTokenAt(g);return d.end>g.ch&&(d.end=g.ch,d.string=d.string.slice(0,g.ch-d.start)),d.string.match(/^[.`\w@]\w*$/)?(u=d.string,s=d.start,a=d.end):(s=a=g.ch,u=""),"."==u.charAt(0)||"`"==u.charAt(0)?i(g,d,h,t):(n(h,u,f,function(t){return t}),n(h,u,c,function(t){return t}),n(h,u,l,function(t){return t.toUpperCase()})),{list:h,from:p(g.line,s),to:p(g.line,a)}})});