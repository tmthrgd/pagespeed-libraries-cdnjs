(function(){"use strict";function t(e,t,n){var r=n.paragraphStart||e.getHelper(t,"paragraphStart");for(var i=t.line,s=e.firstLine();i>s;--i){var o=e.getLine(i);if(r&&r.test(o))break;if(!/\S/.test(o)){++i;break}}var u=n.paragraphEnd||e.getHelper(t,"paragraphEnd");for(var a=t.line+1,f=e.lastLine();a<=f;++a){var o=e.getLine(a);if(u&&u.test(o)){++a;break}if(!/\S/.test(o))break}return{from:i,to:a}}function n(e,t,n,r){for(var i=t;i>0;--i)if(n.test(e.slice(i-1,i+1)))break;i==0&&(i=t);var s=i;if(r)while(e.charAt(s-1)==" ")--s;return{from:s,to:i}}function r(t,r,i,s){r=t.clipPos(r),i=t.clipPos(i);var o=s.column||80,u=s.wrapOn||/\s\S|-[^\.\d]/,a=s.killTrailingSpace!==!1,f=[],l="",c=r.line,h=t.getRange(r,i,!1);if(!h.length)return null;var p=h[0].match(/^[ \t]*/)[0];for(var d=0;d<h.length;++d){var v=h[d],m=l.length,g=0;l&&v&&!u.test(l.charAt(l.length-1)+v.charAt(0))&&(l+=" ",g=1);var y="";d&&(y=v.match(/^\s*/)[0],v=v.slice(y.length)),l+=v;if(d){var b=l.length>o&&p==y&&n(l,o,u,a);!b||b.from!=m||b.to!=m+g?f.push({text:[g?" ":""],from:e(c,m),to:e(c+1,y.length)}):(l=p+v,++c)}while(l.length>o){var w=n(l,o,u,a);f.push({text:["",p],from:e(c,w.from),to:e(c,w.to)}),l=p+l.slice(w.to),++c}}return f.length&&t.operation(function(){for(var e=0;e<f.length;++e){var n=f[e];t.replaceRange(n.text,n.from,n.to)}}),f.length?{from:f[0].from,to:CodeMirror.changeEnd(f[f.length-1])}:null}var e=CodeMirror.Pos;CodeMirror.defineExtension("wrapParagraph",function(n,i){i=i||{},n||(n=this.getCursor());var s=t(this,n,i);return r(this,e(s.from,0),e(s.to-1),i)}),CodeMirror.defineExtension("wrapRange",function(e,t,n){return r(this,e,t,n||{})}),CodeMirror.defineExtension("wrapParagraphsInRange",function(n,i,s){s=s||{};var o=this,u=[];for(var a=n.line;a<=i.line;){var f=t(o,e(a,0),s);u.push(f),a=f.to}var l=!1;return u.length&&o.operation(function(){for(var t=u.length-1;t>=0;--t)l=l||r(o,e(u[t].from,0),e(u[t].to-1),s)}),l})})();