(function(){function t(t,r,i,s){this.atOccurrence=!1,this.doc=t,s==null&&typeof r=="string"&&(s=!1),i=i?t.clipPos(i):e(0,0),this.pos={from:i,to:i};if(typeof r!="string")r.global||(r=new RegExp(r.source,r.ignoreCase?"ig":"g")),this.matches=function(n,i){if(n){r.lastIndex=0;var s=t.getLine(i.line).slice(0,i.ch),o=0,u,a;for(;;){r.lastIndex=o;var f=r.exec(s);if(!f)break;u=f,a=u.index,o=u.index+(u[0].length||1);if(o==s.length)break}var l=u&&u[0].length||0;l||(a==0&&s.length==0?u=undefined:a!=t.getLine(i.line).length&&l++)}else{r.lastIndex=i.ch;var s=t.getLine(i.line),u=r.exec(s),l=u&&u[0].length||0,a=u&&u.index;a+l!=s.length&&!l&&(l=1)}if(u&&l)return{from:e(i.line,a),to:e(i.line,a+l),match:u}};else{var o=r;s&&(r=r.toLowerCase());var u=s?function(e){return e.toLowerCase()}:function(e){return e},a=r.split("\n");if(a.length==1)r.length?this.matches=function(i,s){if(i){var a=t.getLine(s.line).slice(0,s.ch),f=u(a),l=f.lastIndexOf(r);if(l>-1)return l=n(a,f,l),{from:e(s.line,l),to:e(s.line,l+o.length)}}else{var a=t.getLine(s.line).slice(s.ch),f=u(a),l=f.indexOf(r);if(l>-1)return l=n(a,f,l)+s.ch,{from:e(s.line,l),to:e(s.line,l+o.length)}}}:this.matches=function(){};else{var f=o.split("\n");this.matches=function(n,r){var i=a.length-1;if(n){if(r.line-(a.length-1)<t.firstLine())return;if(u(t.getLine(r.line).slice(0,f[i].length))!=a[a.length-1])return;var s=e(r.line,f[i].length);for(var o=r.line-1,l=i-1;l>=1;--l,--o)if(a[l]!=u(t.getLine(o)))return;var c=t.getLine(o),h=c.length-f[0].length;if(u(c.slice(h))!=a[0])return;return{from:e(o,h),to:s}}if(r.line+(a.length-1)>t.lastLine())return;var c=t.getLine(r.line),h=c.length-f[0].length;if(u(c.slice(h))!=a[0])return;var p=e(r.line,h);for(var o=r.line+1,l=1;l<i;++l,++o)if(a[l]!=u(t.getLine(o)))return;if(t.getLine(o).slice(0,f[i].length)!=a[i])return;return{from:p,to:e(o,f[i].length)}}}}}function n(e,t,n){if(e.length==t.length)return n;for(var r=Math.min(n,e.length);;){var i=e.slice(0,r).toLowerCase().length;if(i<n)++r;else{if(!(i>n))return r;--r}}}var e=CodeMirror.Pos;t.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){function i(t){var r=e(t,0);return n.pos={from:r,to:r},n.atOccurrence=!1,!1}var n=this,r=this.doc.clipPos(t?this.pos.from:this.pos.to);for(;;){if(this.pos=this.matches(t,r))return this.atOccurrence=!0,this.pos.match||!0;if(t){if(!r.line)return i(0);r=e(r.line-1,this.doc.getLine(r.line-1).length)}else{var s=this.doc.lineCount();if(r.line==s-1)return i(s);r=e(r.line+1,0)}}},from:function(){if(this.atOccurrence)return this.pos.from},to:function(){if(this.atOccurrence)return this.pos.to},replace:function(t){if(!this.atOccurrence)return;var n=CodeMirror.splitLines(t);this.doc.replaceRange(n,this.pos.from,this.pos.to),this.pos.to=e(this.pos.from.line+n.length-1,n[n.length-1].length+(n.length==1?this.pos.from.ch:0))}},CodeMirror.defineExtension("getSearchCursor",function(e,n,r){return new t(this.doc,e,n,r)}),CodeMirror.defineDocExtension("getSearchCursor",function(e,n,r){return new t(this,e,n,r)})})();