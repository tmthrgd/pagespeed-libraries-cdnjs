(function(){"use strict";function t(e,t){return e.line==t.line&&e.ch==t.ch}function r(e){n.push(e),n.length>50&&n.shift()}function i(e){if(!n.length)return r(e);n[n.length-1]+=e}function s(e){return n[n.length-(e?Math.min(e,1):1)]||""}function o(){return n.length>1&&n.pop(),s()}function a(e,n,s,o,a){a==null&&(a=e.getRange(n,s)),o&&u&&u.cm==e&&t(n,u.pos)&&e.isClean(u.gen)?i(a):r(a),e.replaceRange("",n,s,"+delete"),o?u={cm:e,pos:n,gen:e.changeGeneration()}:u=null}function f(e,t,n){return e.findPosH(t,n,"char",!0)}function l(e,t,n){return e.findPosH(t,n,"word",!0)}function c(e,t,n){return e.findPosV(t,n,"line",e.doc.sel.goalColumn)}function h(e,t,n){return e.findPosV(t,n,"page",e.doc.sel.goalColumn)}function p(t,n,r){var i=n.line,s=t.getLine(i),o=/\S/.test(r<0?s.slice(0,n.ch):s.slice(n.ch)),u=t.firstLine(),a=t.lastLine();for(;;){i+=r;if(i<u||i>a)return t.clipPos(e(i-r,r<0?0:null));s=t.getLine(i);var f=/\S/.test(s);if(f)o=!0;else if(o)return e(i,0)}}function d(t,n,r){var i=n.line,s=n.ch,o=t.getLine(n.line),u=!1;for(;;){var a=o.charAt(s+(r<0?-1:0));if(!a){if(i==(r<0?t.firstLine():t.lastLine()))return e(i,s);o=t.getLine(i+r);if(!/\S/.test(o))return e(i,s);i+=r,s=r<0?o.length:0;continue}if(u&&/[!?.]/.test(a))return e(i,s+(r>0?1:0));u||(u=/\w/.test(a)),s+=r}}function v(n,r,i){var s;if(n.findMatchingBracket&&(s=n.findMatchingBracket(r,!0))&&s.match&&(s.forward?1:-1)==i)return i>0?e(s.to.line,s.to.ch+1):s.to;for(var o=!0;;o=!1){var u=n.getTokenAt(r),a=e(r.line,i<0?u.start:u.end);if(!(o&&i>0&&u.end==r.ch||!/\w/.test(u.string)))return a;var f=n.findPosH(a,i,"char");if(t(a,f))return r;r=f}}function m(e,t){var n=e.state.emacsPrefix;return n?(T(e),n=="-"?-1:Number(n)):t?null:1}function g(e){var t=typeof e=="string"?function(t){t.execCommand(e)}:e;return function(e){var n=m(e);t(e);for(var r=1;r<n;++r)t(e)}}function y(e,n,r){var i=e.getCursor(),s=m(e);s<0&&(r=-r,s=-s);for(var o=0;o<s;++o){var u=n(e,i,r);if(t(u,i))break;i=u}return i}function b(e,t){var n=function(n){n.extendSelection(y(n,e,t))};return n.motion=!0,n}function w(e,t,n){a(e,e.getCursor(),y(e,t,n),!0)}function E(e,t){if(e.state.emacsPrefix){t!="-"&&(e.state.emacsPrefix+=t);return}e.state.emacsPrefix=t,e.on("keyHandled",x),e.on("inputRead",N)}function x(e,t){!e.state.emacsPrefixMap&&!S.hasOwnProperty(t)&&T(e)}function T(e){e.state.emacsPrefix=null,e.off("keyHandled",x),e.off("inputRead",N)}function N(e,t){var n=m(e);if(n>1&&t.origin=="+input"){var r=t.text.join("\n"),i="";for(var s=1;s<n;++s)i+=r;e.replaceSelection(i,"end","+input")}}function C(e){e.state.emacsPrefixMap=!0,e.addKeyMap(H),e.on("keyHandled",k),e.on("inputRead",k)}function k(e,t){if(!(typeof t!="string"||!/^\d$/.test(t)&&t!="Ctrl-U"))return;e.removeKeyMap(H),e.state.emacsPrefixMap=!1,e.off("keyHandled",k),e.off("inputRead",k)}function L(e){e.setCursor(e.getCursor()),e.setExtending(!0),e.on("change",function(){e.setExtending(!1)})}function A(e){e.setExtending(!1),e.setCursor(e.getCursor())}function O(e,t,n){e.openDialog?e.openDialog(t+': <input type="text" style="width: 10em"/>',n,{bottom:!0}):n(prompt(t,""))}function M(e,t){var n=e.getCursor(),r=e.findPosH(n,1,"word");e.replaceRange(t(e.getRange(n,r)),n,r),e.setCursor(r)}function _(t){var n=t.getCursor(),r=n.line,i=n.ch,s=[];while(r>=t.firstLine()){var o=t.getLine(r);for(var u=i==null?o.length:i;u>0;){var i=o.charAt(--u);if(i==")")s.push("(");else if(i=="]")s.push("[");else if(i=="}")s.push("{");else if(/[\(\{\[]/.test(i)&&(!s.length||s.pop()!=i))return t.extendSelection(e(r,u))}--r,i=null}}function D(e){e.execCommand("clearSearch"),A(e)}function B(e){H[e]=function(t){E(t,e)},P["Ctrl-"+e]=function(t){E(t,e)},S["Ctrl-"+e]=!0}var e=CodeMirror.Pos,n=[],u=null,S={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0},P=CodeMirror.keyMap.emacs={"Ctrl-W":function(e){a(e,e.getCursor("start"),e.getCursor("end"))},"Ctrl-K":g(function(t){var n=t.getCursor(),r=t.clipPos(e(n.line)),i=t.getRange(n,r);/\S/.test(i)||(i+="\n",r=e(n.line+1,0)),a(t,n,r,!0,i)}),"Alt-W":function(e){r(e.getSelection()),A(e)},"Ctrl-Y":function(e){var t=e.getCursor();e.replaceRange(s(m(e)),t,t,"paste"),e.setSelection(t,e.getCursor())},"Alt-Y":function(e){e.replaceSelection(o())},"Ctrl-Space":L,"Ctrl-Shift-2":L,"Ctrl-F":b(f,1),"Ctrl-B":b(f,-1),Right:b(f,1),Left:b(f,-1),"Ctrl-D":function(e){w(e,f,1)},Delete:function(e){w(e,f,1)},"Ctrl-H":function(e){w(e,f,-1)},Backspace:function(e){w(e,f,-1)},"Alt-F":b(l,1),"Alt-B":b(l,-1),"Alt-D":function(e){w(e,l,1)},"Alt-Backspace":function(e){w(e,l,-1)},"Ctrl-N":b(c,1),"Ctrl-P":b(c,-1),Down:b(c,1),Up:b(c,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":b(h,-1),"Ctrl-V":b(h,1),PageUp:b(h,-1),PageDown:b(h,1),"Ctrl-Up":b(p,-1),"Ctrl-Down":b(p,1),"Alt-A":b(d,-1),"Alt-E":b(d,1),"Alt-K":function(e){w(e,d,1)},"Ctrl-Alt-K":function(e){w(e,v,1)},"Ctrl-Alt-Backspace":function(e){w(e,v,-1)},"Ctrl-Alt-F":b(v,1),"Ctrl-Alt-B":b(v,-1),"Shift-Ctrl-Alt-2":function(e){e.setSelection(y(e,v,1),e.getCursor())},"Ctrl-Alt-T":function(e){var t=v(e,e.getCursor(),-1),n=v(e,t,1),r=v(e,n,1),i=v(e,r,-1);e.replaceRange(e.getRange(i,r)+e.getRange(n,i)+e.getRange(t,n),t,r)},"Ctrl-Alt-U":g(_),"Alt-Space":function(t){var n=t.getCursor(),r=n.ch,i=n.ch,s=t.getLine(n.line);while(r&&/\s/.test(s.charAt(r-1)))--r;while(i<s.length&&/\s/.test(s.charAt(i)))++i;t.replaceRange(" ",e(n.line,r),e(n.line,i))},"Ctrl-O":g(function(e){e.replaceSelection("\n","start")}),"Ctrl-T":g(function(t){var n=t.getCursor();n.ch<t.getLine(n.line).length&&(n=e(n.line,n.ch+1));var r=t.findPosH(n,-2,"char"),i=t.getRange(r,n);if(i.length!=2)return;t.setSelection(r,n),t.replaceSelection(i.charAt(1)+i.charAt(0),"end")}),"Alt-C":g(function(e){M(e,function(e){var t=e.search(/\w/);return t==-1?e:e.slice(0,t)+e.charAt(t).toUpperCase()+e.slice(t+1).toLowerCase()})}),"Alt-U":g(function(e){M(e,function(e){return e.toUpperCase()})}),"Alt-L":g(function(e){M(e,function(e){return e.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":g("undo"),"Shift-Ctrl--":g("undo"),"Ctrl-Z":g("undo"),"Cmd-Z":g("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findNext","Ctrl-R":"findPrev","Ctrl-G":D,"Shift-Alt-5":"replace","Alt-/":"autocomplete","Ctrl-J":"newlineAndIndent",Enter:!1,Tab:"indentAuto","Alt-G":function(e){e.setOption("keyMap","emacs-Alt-G")},"Ctrl-X":function(e){e.setOption("keyMap","emacs-Ctrl-X")},"Ctrl-Q":function(e){e.setOption("keyMap","emacs-Ctrl-Q")},"Ctrl-U":C};CodeMirror.keyMap["emacs-Ctrl-X"]={Tab:function(e){e.indentSelection(m(e,!0)||e.getOption("indentUnit"))},"Ctrl-X":function(e){e.setSelection(e.getCursor("head"),e.getCursor("anchor"))},"Ctrl-S":"save","Ctrl-W":"save",S:"saveAll",F:"open",U:g("undo"),K:"close",Delete:function(e){a(e,e.getCursor(),d(e,e.getCursor(),1),!0)},auto:"emacs",nofallthrough:!0,disableInput:!0},CodeMirror.keyMap["emacs-Alt-G"]={G:function(e){var t=m(e,!0);if(t!=null&&t>0)return e.setCursor(t-1);O(e,"Goto line",function(t){var n;t&&!isNaN(n=Number(t))&&n==n|0&&n>0&&e.setCursor(n-1)})},auto:"emacs",nofallthrough:!0,disableInput:!0},CodeMirror.keyMap["emacs-Ctrl-Q"]={Tab:g("insertTab"),auto:"emacs",nofallthrough:!0};var H={"Ctrl-G":T};for(var j=0;j<10;++j)B(String(j));B("-")})();