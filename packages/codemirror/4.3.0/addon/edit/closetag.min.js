(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../fold/xml-fold"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../fold/xml-fold"],a)}else{a(CodeMirror)}}})(function(b){b.defineOption("autoCloseTags",false,function(h,k,i){if(i!=b.Init&&i){h.removeKeyMap("autoCloseTags")}if(!k){return}var j={name:"autoCloseTags"};if(typeof k!="object"||k.whenClosing){j["'/'"]=function(l){return e(l)}}if(typeof k!="object"||k.whenOpening){j["'>'"]=function(l){return a(l)}}h.addKeyMap(j)});var d=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"];var c=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"];function a(w){if(w.getOption("disableInput")){return b.Pass}var j=w.listSelections(),q=[];for(var r=0;r<j.length;r++){if(!j[r].empty()){return b.Pass}var v=j[r].head,x=w.getTokenAt(v);var y=b.innerMode(w.getMode(),x.state),h=y.state;if(y.mode.name!="xml"||!h.tagName){return b.Pass}var k=w.getOption("autoCloseTags"),s=y.mode.configuration=="html";var m=(typeof k=="object"&&k.dontCloseTags)||(s&&d);var u=(typeof k=="object"&&k.indentTags)||(s&&c);var p=h.tagName;if(x.end>v.ch){p=p.slice(0,p.length-x.end+v.ch)}var t=p.toLowerCase();if(!p||x.type=="string"&&(x.end!=v.ch||!/[\"\']/.test(x.string.charAt(x.string.length-1))||x.string.length==1)||x.type=="tag"&&h.type=="closeTag"||x.string.indexOf("/")==(x.string.length-1)||m&&g(m,t)>-1||f(w,p,v,h,true)){return b.Pass}var o=u&&g(u,t)>-1;q[r]={indent:o,text:">"+(o?"\n\n":"")+"</"+p+">",newPos:o?b.Pos(v.line+1,0):b.Pos(v.line,v.ch+1)}}for(var r=j.length-1;r>=0;r--){var n=q[r];w.replaceRange(n.text,j[r].head,j[r].anchor,"+insert");var l=w.listSelections().slice(0);l[r]={head:n.newPos,anchor:n.newPos};w.setSelections(l);if(n.indent){w.indentLine(n.newPos.line,null,true);w.indentLine(n.newPos.line+1,null,true)}}}function e(h){if(h.getOption("disableInput")){return b.Pass}var j=h.listSelections(),n=[];for(var m=0;m<j.length;m++){if(!j[m].empty()){return b.Pass}var p=j[m].head,l=h.getTokenAt(p);var k=b.innerMode(h.getMode(),l.state),o=k.state;if(l.type=="string"||l.string.charAt(0)!="<"||l.start!=p.ch-1||k.mode.name!="xml"||!o.context||!o.context.tagName||f(h,o.context.tagName,p,o)){return b.Pass}n[m]="/"+o.context.tagName+">"}h.replaceSelections(n)}function g(l,h){if(l.indexOf){return l.indexOf(h)}for(var j=0,k=l.length;j<k;++j){if(l[j]==h){return j}}return -1}function f(q,j,p,h,s){if(!b.scanForClosingTag){return false}var k=Math.min(q.lastLine()+1,p.line+500);var r=b.scanForClosingTag(q,p,null,k);if(!r||r.tag!=j){return false}var l=h.context;for(var n=s?1:0;l&&l.tagName==j;l=l.prev){++n}p=r.to;for(var m=1;m<n;m++){var o=b.scanForClosingTag(q,p,null,k);if(!o||o.tag!=j){return false}p=o.to}return true}});