(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(A){var s=A.Pos;var g="http://www.w3.org/2000/svg";function k(H,I){this.mv=H;this.type=I;this.classes=I=="left"?{chunk:"CodeMirror-merge-l-chunk",start:"CodeMirror-merge-l-chunk-start",end:"CodeMirror-merge-l-chunk-end",insert:"CodeMirror-merge-l-inserted",del:"CodeMirror-merge-l-deleted",connect:"CodeMirror-merge-l-connect"}:{chunk:"CodeMirror-merge-r-chunk",start:"CodeMirror-merge-r-chunk-start",end:"CodeMirror-merge-r-chunk-end",insert:"CodeMirror-merge-r-inserted",del:"CodeMirror-merge-r-deleted",connect:"CodeMirror-merge-r-connect"}}k.prototype={constructor:k,init:function(J,I,H){this.edit=this.mv.edit;this.orig=A(J,w({value:I,readOnly:true},w(H)));this.diff=b(o(I),o(H.value));this.diffOutOfDate=false;this.showDifferences=H.showDifferences!==false;this.forceUpdate=C(this);E(this,true,false);p(this)},setShowDifferences:function(H){H=H!==false;if(H!=this.showDifferences){this.showDifferences=H;this.forceUpdate("full")}}};function z(H){if(H.diffOutOfDate){H.diff=b(H.orig.getValue(),H.edit.getValue());H.diffOutOfDate=false;A.signal(H.edit,"updateDiff",H.diff)}}function C(H){var I={from:0,to:0,marked:[]};var N={from:0,to:0,marked:[]};var M;function L(O){if(O=="full"){if(H.svg){v(H.svg)}v(H.copyButtons);c(H.edit,I.marked,H.classes);c(H.orig,N.marked,H.classes);I.from=I.to=N.from=N.to=0}z(H);if(H.showDifferences){u(H.edit,H.diff,I,DIFF_INSERT,H.classes);u(H.orig,H.diff,N,DIFF_DELETE,H.classes)}q(H)}function K(O){clearTimeout(M);M=setTimeout(L,O==true?250:100)}function J(){if(!H.diffOutOfDate){H.diffOutOfDate=true;I.from=I.to=N.from=N.to=0}K(true)}H.edit.on("change",J);H.orig.on("change",J);H.edit.on("markerAdded",K);H.edit.on("markerCleared",K);H.orig.on("markerAdded",K);H.orig.on("markerCleared",K);H.edit.on("viewportChange",K);H.orig.on("viewportChange",K);L();return L}function p(H){H.edit.on("scroll",function(){D(H,DIFF_INSERT)&&q(H)});H.orig.on("scroll",function(){D(H,DIFF_DELETE)&&q(H)})}function D(T,L){if(T.diffOutOfDate){return false}if(!T.lockScroll){return true}var M,O,J=+new Date;if(L==DIFF_INSERT){M=T.edit;O=T.orig}else{M=T.orig;O=T.edit}if(M.state.scrollSetBy==T&&(M.state.scrollSetAt||0)+50>J){return false}var H=M.getScrollInfo(),I=0.5*H.clientHeight,R=H.top+I;var X=M.lineAtHeight(R,"local");var V=G(T.diff,X,L==DIFF_INSERT);var Y=r(M,L==DIFF_INSERT?V.edit:V.orig);var Q=r(O,L==DIFF_INSERT?V.orig:V.edit);var P=(R-Y.top)/(Y.bot-Y.top);var K=(Q.top-I)+P*(Q.bot-Q.top);var N,S;if(K>H.top&&(S=H.top/I)<1){K=K*S+H.top*(1-S)}else{if((N=H.height-H.clientHeight-H.top)<I){var W=O.getScrollInfo();var U=W.height-W.clientHeight-K;if(U>N&&(S=N/I)<1){K=K*S+(W.height-W.clientHeight-N)*(1-S)}}}O.scrollTo(H.left,K);O.state.scrollSetAt=J;O.state.scrollSetBy=T;return true}function r(H,I){var J=I.after;if(J==null){J=H.lastLine()+1}return{top:H.heightAtLine(I.before||0,"local"),bot:H.heightAtLine(J,"local")}}function E(H,J,I){H.lockScroll=J;if(J&&I!=false){D(H,DIFF_INSERT)&&q(H)}H.lockButton.innerHTML=J?"\u21db\u21da":"\u21db&nbsp;&nbsp;\u21da"}function c(K,H,J){for(var I=0;I<H.length;++I){var L=H[I];if(L instanceof A.TextMarker){L.clear()}else{if(L.parent){K.removeLineClass(L,"background",J.chunk);K.removeLineClass(L,"background",J.start);K.removeLineClass(L,"background",J.end)}}}H.length=0}function u(K,M,L,J,I){var H=K.getViewport();K.operation(function(){if(L.from==L.to||H.from-L.to>20||L.from-H.to>20){c(K,L.marked,I);n(K,M,J,L.marked,H.from,H.to,I);L.from=H.from;L.to=H.to}else{if(H.from<L.from){n(K,M,J,L.marked,H.from,L.from,I);L.from=H.from}if(H.to>L.to){n(K,M,J,L.marked,L.to,H.to,I);L.to=H.to}}})}function n(O,R,N,X,W,J,Z){var P=s(0,0);var T=s(W,0),S=O.clipPos(s(J-1));var H=N==DIFF_DELETE?Z.del:Z.insert;function Q(ai,ae){var ah=Math.max(W,ai),af=Math.min(J,ae);for(var ag=ah;ag<af;++ag){var ad=O.addLineClass(ag,"background",Z.chunk);if(ag==ai){O.addLineClass(ad,"background",Z.start)}if(ag==ae-1){O.addLineClass(ad,"background",Z.end)}X.push(ad)}if(ai==ae&&ah==ae&&af==ae){if(ah){X.push(O.addLineClass(ah-1,"background",Z.end))}else{X.push(O.addLineClass(ah,"background",Z.start))}}}var ac=0;for(var Y=0;Y<R.length;++Y){var V=R[Y],I=V[0],U=V[1];if(I==DIFF_EQUAL){var M=P.line+(d(R,Y)?0:1);t(P,U);var L=P.line+(h(R,Y)?1:0);if(L>M){if(Y){Q(ac,M)}ac=L}}else{if(I==N){var K=t(P,U,true);var ab=l(T,P),aa=j(S,K);if(!i(ab,aa)){X.push(O.markText(ab,aa,{className:H}))}P=K}}}if(ac<=P.line){Q(ac,P.line+1)}}function q(K){if(!K.showDifferences){return}if(K.svg){v(K.svg);var I=K.gap.offsetWidth;x(K.svg,"width",I,"height",K.gap.offsetHeight)}v(K.copyButtons);var M=K.type=="left";var N=K.edit.getViewport(),J=K.orig.getViewport();var H=K.edit.getScrollInfo().top,L=K.orig.getScrollInfo().top;e(K.diff,function(S,U,V,R){if(V>N.to||R<N.from||S>J.to||U<J.from){return}var O=K.orig.heightAtLine(S,"local")-L,X=O;if(K.svg){var Q=K.edit.heightAtLine(V,"local")-H;if(M){var T=O;O=Q;Q=T}var W=K.orig.heightAtLine(U,"local")-L;var Z=K.edit.heightAtLine(R,"local")-H;if(M){var T=W;W=Z;Z=T}var aa=" C "+I/2+" "+Q+" "+I/2+" "+O+" "+(I+2)+" "+O;var Y=" C "+I/2+" "+W+" "+I/2+" "+Z+" -1 "+Z;x(K.svg.appendChild(document.createElementNS(g,"path")),"d","M -1 "+Q+aa+" L "+(I+2)+" "+W+Y+" z","class",K.classes.connect)}var P=K.copyButtons.appendChild(f("div",K.type=="left"?"\u21dd":"\u21dc","CodeMirror-merge-copy"));P.title="Revert chunk";P.chunk={topEdit:V,botEdit:R,topOrig:S,botOrig:U};P.style.top=X+"px"})}function F(I,H){if(I.diffOutOfDate){return}I.edit.replaceRange(I.orig.getRange(s(H.topOrig,0),s(H.botOrig,0)),s(H.topEdit,0),s(H.botEdit,0))}var B=A.MergeView=function(M,V){if(!(this instanceof B)){return new B(M,V)}var P=V.origLeft,N=V.origRight==null?V.orig:V.origRight;var S=P!=null,W=N!=null;var Q=1+(S?1:0)+(W?1:0);var J=[],L=this.left=null,T=this.right=null;if(S){L=this.left=new k(this,"left");var I=f("div",null,"CodeMirror-merge-pane");J.push(I);J.push(y(L))}var O=f("div",null,"CodeMirror-merge-pane");J.push(O);if(W){T=this.right=new k(this,"right");J.push(y(T));var R=f("div",null,"CodeMirror-merge-pane");J.push(R)}(W?R:O).className+=" CodeMirror-merge-pane-rightmost";J.push(f("div",null,null,"height: 0; clear: both;"));var K=this.wrap=M.appendChild(f("div",J,"CodeMirror-merge CodeMirror-merge-"+Q+"pane"));this.edit=A(O,w(V));if(L){L.init(I,P,V)}if(T){T.init(R,N,V)}var H=function(){if(L){q(L)}if(T){q(T)}};A.on(window,"resize",H);var U=setInterval(function(){for(var X=K.parentNode;X&&X!=document.body;X=X.parentNode){}if(!X){clearInterval(U);A.off(window,"resize",H)}},5000)};function y(K){var J=K.lockButton=f("div",null,"CodeMirror-merge-scrolllock");J.title="Toggle locked scrolling";var L=f("div",[J],"CodeMirror-merge-scrolllock-wrap");A.on(J,"click",function(){E(K,!K.lockScroll)});K.copyButtons=f("div",null,"CodeMirror-merge-copybuttons-"+K.type);A.on(K.copyButtons,"click",function(N){var M=N.target||N.srcElement;if(M.chunk){F(K,M.chunk)}});var I=[K.copyButtons,L];var H=document.createElementNS&&document.createElementNS(g,"svg");if(H&&!H.createSVGRect){H=null}K.svg=H;if(H){I.push(H)}return K.gap=f("div",I,"CodeMirror-merge-gap")}B.prototype={constuctor:B,editor:function(){return this.edit},rightOriginal:function(){return this.right&&this.right.orig},leftOriginal:function(){return this.left&&this.left.orig},setShowDifferences:function(H){if(this.right){this.right.setShowDifferences(H)}if(this.left){this.left.setShowDifferences(H)}},rightChunks:function(){return this.right&&m(this.right)},leftChunks:function(){return this.left&&m(this.left)}};function o(H){if(typeof H=="string"){return H}else{return H.getValue()}}var a=new diff_match_patch();function b(I,H){var L=a.diff_main(I,H);a.diff_cleanupSemantic(L);for(var K=0;K<L.length;++K){var J=L[K];if(!J[1]){L.splice(K--,1)}else{if(K&&L[K-1][0]==J[0]){L.splice(K--,1);L[K][1]+=J[1]}}}return L}function e(U,M){var R=0,Q=0;var V=s(0,0),T=s(0,0);for(var J=0;J<U.length;++J){var I=U[J],S=I[0];if(S==DIFF_EQUAL){var H=d(U,J)?0:1;var L=V.line+H,K=T.line+H;t(V,I[1],null,T);var N=h(U,J)?1:0;var P=V.line+N,O=T.line+N;if(P>L){if(J){M(Q,K,R,L)}R=P;Q=O}}else{t(S==DIFF_INSERT?V:T,I[1])}}if(R<=V.line||Q<=T.line){M(Q,T.line+1,R,V.line+1)}}function m(H){z(H);var I=[];e(H.diff,function(L,K,J,M){I.push({origFrom:L,origTo:K,editFrom:J,editTo:M})});return I}function h(J,H){if(H==J.length-1){return true}var I=J[H+1][1];if(I.length==1||I.charCodeAt(0)!=10){return false}if(H==J.length-2){return true}I=J[H+2][1];return I.length>1&&I.charCodeAt(0)==10}function d(J,H){if(H==0){return true}var I=J[H-1][1];if(I.charCodeAt(I.length-1)!=10){return false}if(H==1){return true}I=J[H-2][1];return I.charCodeAt(I.length-1)==10}function G(M,N,J){var I,H,L,K;e(M,function(O,T,R,P){var Q=J?R:O;var S=J?P:T;if(H==null){if(Q>N){H=R;K=O}else{if(S>N){H=P;K=T}}}if(S<=N){I=P;L=T}else{if(Q<=N){I=R;L=O}}});return{edit:{before:I,after:H},orig:{before:L,after:K}}}function f(H,L,K,J){var M=document.createElement(H);if(K){M.className=K}if(J){M.style.cssText=J}if(typeof L=="string"){M.appendChild(document.createTextNode(L))}else{if(L){for(var I=0;I<L.length;++I){M.appendChild(L[I])}}}return M}function v(I){for(var H=I.childNodes.length;H>0;--H){I.removeChild(I.firstChild)}}function x(H){for(var I=1;I<arguments.length;I+=2){H.setAttribute(arguments[I],arguments[I+1])}}function w(I,H){if(!H){H={}}for(var J in I){if(I.hasOwnProperty(J)){H[J]=I[J]}}return H}function t(N,L,M,I){var K=M?s(N.line,N.ch):N,H=0;for(;;){var J=L.indexOf("\n",H);if(J==-1){break}++K.line;if(I){++I.line}H=J+1}K.ch=(H?0:K.ch)+(L.length-H);if(I){I.ch=(H?0:I.ch)+(L.length-H)}return K}function j(I,H){return(I.line-H.line||I.ch-H.ch)<0?I:H}function l(I,H){return(I.line-H.line||I.ch-H.ch)>0?I:H}function i(I,H){return I.line==H.line&&I.ch==H.ch}});