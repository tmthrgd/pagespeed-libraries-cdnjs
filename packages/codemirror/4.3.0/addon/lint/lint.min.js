(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(o){var b="CodeMirror-lint-markers";var p=/^(?:error|warning)$/;function f(x,w){var v=document.createElement("div");v.className="CodeMirror-lint-tooltip";v.appendChild(w.cloneNode(true));document.body.appendChild(v);function u(y){if(!v.parentNode){return o.off(document,"mousemove",u)}v.style.top=Math.max(0,y.clientY-v.offsetHeight-5)+"px";v.style.left=(y.clientX+5)+"px"}o.on(document,"mousemove",u);u(x);if(v.style.opacity!=null){v.style.opacity=1}return v}function k(u){if(u.parentNode){u.parentNode.removeChild(u)}}function i(u){if(!u.parentNode){return}if(u.style.opacity==null){k(u)}u.style.opacity=0;setTimeout(function(){k(u)},600)}function t(y,w,v){var x=f(y,w);function u(){o.off(v,"mouseout",u);if(x){i(x);x=null}}var z=setInterval(function(){if(x){for(var A=v;;A=A.parentNode){if(A==document.body){return}if(!A){u();break}}}if(!x){return clearInterval(z)}},400);o.on(v,"mouseout",u)}function m(u,w,v){this.marked=[];this.options=w;this.timeout=null;this.hasGutter=v;this.onMouseOver=function(x){n(u,x)}}function a(u,v){if(v instanceof Function){return{getAnnotations:v}}if(!v||v===true){v={}}if(!v.getAnnotations){v.getAnnotations=u.getHelper(o.Pos(0,0),"lint")}if(!v.getAnnotations){throw new Error("Required option 'getAnnotations' missing (lint addon)")}return v}function e(u){var w=u.state.lint;if(w.hasGutter){u.clearGutter(b)}for(var v=0;v<w.marked.length;++v){w.marked[v].clear()}w.marked.length=0}function s(z,x,u,y){var v=document.createElement("div"),w=v;v.className="CodeMirror-lint-marker-"+x;if(u){w=v.appendChild(document.createElement("div"));w.className="CodeMirror-lint-marker-multiple"}if(y!=false){o.on(w,"mouseover",function(A){t(A,z,w)})}return v}function g(v,u){if(v=="error"){return v}else{return u}}function h(y){var v=[];for(var w=0;w<y.length;++w){var x=y[w],u=x.from.line;(v[u]||(v[u]=[])).push(x)}return v}function c(w){var u=w.severity;if(!p.test(u)){u="error"}var v=document.createElement("div");v.className="CodeMirror-lint-message-"+u;v.appendChild(document.createTextNode(w.message));return v}function r(u){var w=u.state.lint,v=w.options;if(v.async){v.getAnnotations(u,l,v)}else{l(u,v.getAnnotations(u.getValue(),v.options))}}function l(B,A){e(B);var v=B.state.lint,D=v.options;var z=h(A);for(var E=0;E<z.length;++E){var x=z[E];if(!x){continue}var F=null;var w=v.hasGutter&&document.createDocumentFragment();for(var y=0;y<x.length;++y){var u=x[y];var C=u.severity;if(!p.test(C)){C="error"}F=g(F,C);if(D.formatAnnotation){u=D.formatAnnotation(u)}if(v.hasGutter){w.appendChild(c(u))}if(u.to){v.marked.push(B.markText(u.from,u.to,{className:"CodeMirror-lint-mark-"+C,__annotation:u}))}}if(v.hasGutter){B.setGutterMarker(E,b,s(w,F,x.length>1,v.options.tooltips))}}if(D.onUpdateLinting){D.onUpdateLinting(A,z,B)}}function q(u){var v=u.state.lint;clearTimeout(v.timeout);v.timeout=setTimeout(function(){r(u)},v.options.delay||500)}function j(u,w){var v=w.target||w.srcElement;t(w,c(u),v)}var d=[0,0,0,5,0,-5,5,0,-5,0];function n(u,A){if(!/\bCodeMirror-lint-mark-/.test((A.target||A.srcElement).className)){return}for(var x=0;x<d.length;x+=2){var w=u.findMarksAt(u.coordsChar({left:A.clientX+d[x],top:A.clientY+d[x+1]},"client"));for(var v=0;v<w.length;++v){var y=w[v],z=y.__annotation;if(z){return j(z,A)}}}}o.defineOption("lint",false,function(u,A,v){if(v&&v!=o.Init){e(u);u.off("change",q);o.off(u.getWrapperElement(),"mouseover",u.state.lint.onMouseOver);delete u.state.lint}if(A){var w=u.getOption("gutters"),y=false;for(var x=0;x<w.length;++x){if(w[x]==b){y=true}}var z=u.state.lint=new m(u,a(u,A),y);u.on("change",q);if(z.options.tooltips!=false){o.on(u.getWrapperElement(),"mouseover",z.onMouseOver)}r(u)}})});