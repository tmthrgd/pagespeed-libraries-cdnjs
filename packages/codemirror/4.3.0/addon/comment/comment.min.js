(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){var b={};var e=/[^\s\u00a0]/;var c=a.Pos;function d(g){var f=g.search(e);return f==-1?0:f}a.commands.toggleComment=function(f){var j=Infinity,g=f.listSelections(),k=null;for(var h=g.length-1;h>=0;h--){var m=g[h].from(),l=g[h].to();if(m.line>=j){continue}if(l.line>=j){l=c(j,0)}j=m.line;if(k==null){if(f.uncomment(m,l)){k="un"}else{f.lineComment(m,l);k="line"}}else{if(k=="un"){f.uncomment(m,l)}else{f.lineComment(m,l)}}}};a.defineExtension("lineComment",function(k,l,o){if(!o){o=b}var m=this,h=m.getModeAt(k);var n=o.lineComment||h.lineComment;if(!n){if(o.blockCommentStart||h.blockCommentStart){o.fullLines=true;m.blockComment(k,l,o)}return}var j=m.getLine(k.line);if(j==null){return}var g=Math.min(l.ch!=0||l.line==k.line?l.line+1:l.line,m.lastLine()+1);var f=o.padding==null?" ":o.padding;var i=o.commentBlankLines||k.line==l.line;m.operation(function(){if(o.indent){var r=j.slice(0,d(j));for(var q=k.line;q<g;++q){var p=m.getLine(q),s=r.length;if(!i&&!e.test(p)){continue}if(p.slice(0,s)!=r){s=d(p)}m.replaceRange(r+n+f,c(q,0),c(q,s))}}else{for(var q=k.line;q<g;++q){if(i||e.test(m.getLine(q))){m.replaceRange(n+f,c(q,0))}}}})});a.defineExtension("blockComment",function(j,k,n){if(!n){n=b}var m=this,h=m.getModeAt(j);var i=n.blockCommentStart||h.blockCommentStart;var l=n.blockCommentEnd||h.blockCommentEnd;if(!i||!l){if((n.lineComment||h.lineComment)&&n.fullLines!=false){m.lineComment(j,k,n)}return}var g=Math.min(k.line,m.lastLine());if(g!=j.line&&k.ch==0&&e.test(m.getLine(g))){--g}var f=n.padding==null?" ":n.padding;if(j.line>g){return}m.operation(function(){if(n.fullLines!=false){var q=e.test(m.getLine(g));m.replaceRange(f+l,c(g));m.replaceRange(i+f,c(j.line,0));var o=n.blockCommentLead||h.blockCommentLead;if(o!=null){for(var p=j.line+1;p<=g;++p){if(p!=g||q){m.replaceRange(o+f,c(p,0))}}}}else{m.replaceRange(l,k);m.replaceRange(i,j)}})});a.defineExtension("uncomment",function(x,h,j){if(!j){j=b}var v=this,s=v.getModeAt(x);var k=Math.min(h.line,v.lastLine()),l=Math.min(x.line,k);var u=j.lineComment||s.lineComment,g=[];var A=j.padding==null?" ":j.padding,n;lineComment:{if(!u){break lineComment}for(var y=l;y<=k;++y){var o=v.getLine(y);var p=o.indexOf(u);if(p>-1&&!/comment/.test(v.getTokenTypeAt(c(y,p+1)))){p=-1}if(p==-1&&(y!=k||y==l)&&e.test(o)){break lineComment}if(p>-1&&e.test(o.slice(0,p))){break lineComment}g.push(o)}v.operation(function(){for(var D=l;D<=k;++D){var B=g[D-l];var E=B.indexOf(u),C=E+u.length;if(E<0){continue}if(B.slice(C,C+A.length)==A){C+=A.length}n=true;v.replaceRange("",c(D,E),c(D,C))}});if(n){return true}}var q=j.blockCommentStart||s.blockCommentStart;var f=j.blockCommentEnd||s.blockCommentEnd;if(!q||!f){return false}var z=j.blockCommentLead||s.blockCommentLead;var w=v.getLine(l),m=k==l?w:v.getLine(k);var r=w.indexOf(q),t=m.lastIndexOf(f);if(t==-1&&l!=k){m=v.getLine(--k);t=m.lastIndexOf(f)}if(r==-1||t==-1||!/comment/.test(v.getTokenTypeAt(c(l,r+1)))||!/comment/.test(v.getTokenTypeAt(c(k,t+1)))){return false}v.operation(function(){v.replaceRange("",c(k,t-(A&&m.slice(t-A.length,t)==A?A.length:0)),c(k,t+f.length));var E=r+q.length;if(A&&w.slice(E,E+A.length)==A){E+=A.length}v.replaceRange("",c(l,r),c(l,E));if(z){for(var D=l+1;D<=k;++D){var C=v.getLine(D),F=C.indexOf(z);if(F==-1||e.test(C.slice(0,F))){continue}var B=F+z.length;if(A&&C.slice(B,B+A.length)==A){B+=A.length}v.replaceRange("",c(D,F),c(D,B))}}});return true})});