(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(d){var f="CodeMirror-hint";var e="CodeMirror-hint-active";d.showHint=function(j,k,l){if(!k){return j.showHint(l)}if(l&&l.async){k.async=true}var m={hint:k};if(l){for(var n in l){m[n]=l[n]}}return j.showHint(m)};d.defineExtension("showHint",function(l){if(this.listSelections().length>1||this.somethingSelected()){return}if(this.state.completionActive){this.state.completionActive.close()}var k=this.state.completionActive=new a(this,l);var j=k.options.hint;if(!j){return}d.signal(this,"startCompletion",this);if(j.async){j(this,function(m){k.showHints(m)},k.options)}else{return k.showHints(j(this,k.options))}});function a(j,k){this.cm=j;this.options=this.buildOptions(k);this.widget=this.onClose=null}a.prototype={close:function(){if(!this.active()){return}this.cm.state.completionActive=null;if(this.widget){this.widget.close()}if(this.onClose){this.onClose()}d.signal(this.cm,"endCompletion",this.cm)},active:function(){return this.cm.state.completionActive==this},pick:function(l,k){var j=l.list[k];if(j.hint){j.hint(this.cm,l,j)}else{this.cm.replaceRange(i(j),j.from||l.from,j.to||l.to,"complete")}d.signal(l,"pick",j);this.close()},showHints:function(j){if(!j||!j.list.length||!this.active()){return this.close()}if(this.options.completeSingle&&j.list.length==1){this.pick(j,0)}else{this.showWidget(j)}},showWidget:function(o){this.widget=new h(this,o);d.signal(o,"shown");var v=0,l=this,k;var w=this.options.closeCharacters;var s=this.cm.getCursor(),p=this.cm.getLine(s.line).length;var t=window.requestAnimationFrame||function(x){return setTimeout(x,1000/60)};var q=window.cancelAnimationFrame||clearTimeout;function n(){if(k){return}k=true;l.close();l.cm.off("cursorActivity",j);if(o){d.signal(o,"close")}}function m(){if(k){return}d.signal(o,"update");var x=l.options.hint;if(x.async){x(l.cm,u,l.options)}else{u(x(l.cm,l.options))}}function u(x){o=x;if(k){return}if(!o||!o.list.length){return n()}if(l.widget){l.widget.close()}l.widget=new h(l,o)}function r(){if(v){q(v);v=0}}function j(){r();var y=l.cm.getCursor(),x=l.cm.getLine(y.line);if(y.line!=s.line||x.length-y.ch!=p-s.ch||y.ch<s.ch||l.cm.somethingSelected()||(y.ch&&w.test(x.charAt(y.ch-1)))){l.close()}else{v=t(m);if(l.widget){l.widget.close()}}}this.cm.on("cursorActivity",j);this.onClose=n},buildOptions:function(k){var l=this.cm.options.hintOptions;var j={};for(var m in b){j[m]=b[m]}if(l){for(var m in l){if(l[m]!==undefined){j[m]=l[m]}}}if(k){for(var m in k){if(k[m]!==undefined){j[m]=k[m]}}}return j}};function i(j){if(typeof j=="string"){return j}else{return j.text}}function c(n,q){var k={Up:function(){q.moveFocus(-1)},Down:function(){q.moveFocus(1)},PageUp:function(){q.moveFocus(-q.menuSize()+1,true)},PageDown:function(){q.moveFocus(q.menuSize()-1,true)},Home:function(){q.setFocus(0)},End:function(){q.setFocus(q.length-1)},Enter:q.pick,Tab:q.pick,Esc:q.close};var p=n.options.customKeys;var m=p?{}:k;function l(r,t){var s;if(typeof t!="string"){s=function(u){return t(u,q)}}else{if(k.hasOwnProperty(t)){s=k[t]}else{s=t}}m[r]=s}if(p){for(var o in p){if(p.hasOwnProperty(o)){l(o,p[o])}}}var j=n.options.extraKeys;if(j){for(var o in j){if(j.hasOwnProperty(o)){l(o,j[o])}}}return m}function g(k,j){while(j&&j!=k){if(j.nodeName.toUpperCase()==="LI"&&j.parentNode==k){return j}j=j.parentNode}}function h(w,G){this.completion=w;this.data=G;var n=this,s=w.cm;var D=this.hints=document.createElement("ul");D.className="CodeMirror-hints";this.selectedHint=G.selectedHint||0;var r=G.list;for(var F=0;F<r.length;++F){var m=D.appendChild(document.createElement("li")),l=r[F];var k=f+(F!=this.selectedHint?"":" "+e);if(l.className!=null){k=l.className+" "+k}m.className=k;if(l.render){l.render(m,G,l)}else{m.appendChild(document.createTextNode(l.displayText||i(l)))}m.hintId=F}var q=s.cursorCoords(w.options.alignWithWord?G.from:null);var o=q.left,A=q.bottom,y=true;D.style.left=o+"px";D.style.top=A+"px";var t=window.innerWidth||Math.max(document.body.offsetWidth,document.documentElement.offsetWidth);var E=window.innerHeight||Math.max(document.body.offsetHeight,document.documentElement.offsetHeight);(w.options.container||document.body).appendChild(D);var u=D.getBoundingClientRect(),v=u.bottom-E;if(v>0){var B=u.bottom-u.top,j=u.top-(q.bottom-q.top);if(j-B>0){D.style.top=(A=j-B)+"px";y=false}else{if(B>E){D.style.height=(E-5)+"px";D.style.top=(A=q.bottom-u.top)+"px";var p=s.getCursor();if(G.from.ch!=p.ch){q=s.cursorCoords(p);D.style.left=(o=q.left)+"px";u=D.getBoundingClientRect()}}}}var x=u.left-t;if(x>0){if(u.right-u.left>t){D.style.width=(t-5)+"px";x-=(u.right-u.left)-t}D.style.left=(o=q.left-x)+"px"}s.addKeyMap(this.keyMap=c(w,{moveFocus:function(I,H){n.changeActive(n.selectedHint+I,H)},setFocus:function(H){n.changeActive(H)},menuSize:function(){return n.screenAmount()},length:r.length,close:function(){w.close()},pick:function(){n.pick()},data:G}));if(w.options.closeOnUnfocus){var C;s.on("blur",this.onBlur=function(){C=setTimeout(function(){w.close()},100)});s.on("focus",this.onFocus=function(){clearTimeout(C)})}var z=s.getScrollInfo();s.on("scroll",this.onScroll=function(){var K=s.getScrollInfo(),J=s.getWrapperElement().getBoundingClientRect();var I=A+z.top-K.top;var H=I-(window.pageYOffset||(document.documentElement||document.body).scrollTop);if(!y){H+=D.offsetHeight}if(H<=J.top||H>=J.bottom){return w.close()}D.style.top=I+"px";D.style.left=(o+z.left-K.left)+"px"});d.on(D,"dblclick",function(I){var H=g(D,I.target||I.srcElement);if(H&&H.hintId!=null){n.changeActive(H.hintId);n.pick()}});d.on(D,"click",function(I){var H=g(D,I.target||I.srcElement);if(H&&H.hintId!=null){n.changeActive(H.hintId);if(w.options.completeOnSingleClick){n.pick()}}});d.on(D,"mousedown",function(){setTimeout(function(){s.focus()},20)});d.signal(G,"select",r[0],D.firstChild);return true}h.prototype={close:function(){if(this.completion.widget!=this){return}this.completion.widget=null;this.hints.parentNode.removeChild(this.hints);this.completion.cm.removeKeyMap(this.keyMap);var j=this.completion.cm;if(this.completion.options.closeOnUnfocus){j.off("blur",this.onBlur);j.off("focus",this.onFocus)}j.off("scroll",this.onScroll)},pick:function(){this.completion.pick(this.data,this.selectedHint)},changeActive:function(j,l){if(j>=this.data.list.length){j=l?this.data.list.length-1:0}else{if(j<0){j=l?0:this.data.list.length-1}}if(this.selectedHint==j){return}var k=this.hints.childNodes[this.selectedHint];k.className=k.className.replace(" "+e,"");k=this.hints.childNodes[this.selectedHint=j];k.className+=" "+e;if(k.offsetTop<this.hints.scrollTop){this.hints.scrollTop=k.offsetTop-3}else{if(k.offsetTop+k.offsetHeight>this.hints.scrollTop+this.hints.clientHeight){this.hints.scrollTop=k.offsetTop+k.offsetHeight-this.hints.clientHeight+3}}d.signal(this.data,"select",this.data.list[this.selectedHint],k)},screenAmount:function(){return Math.floor(this.hints.clientHeight/this.hints.firstChild.offsetHeight)||1}};d.registerHelper("hint","auto",function(j,k){var m=j.getHelpers(j.getCursor(),"hint"),o;if(m.length){for(var l=0;l<m.length;l++){var n=m[l](j,k);if(n&&n.list.length){return n}}}else{if(o=j.getHelper(j.getCursor(),"hintWords")){if(o){return d.hint.fromList(j,{words:o})}}else{if(d.hint.anyword){return d.hint.anyword(j,k)}}}});d.registerHelper("hint","fromList",function(j,k){var p=j.getCursor(),m=j.getTokenAt(p);var n=[];for(var l=0;l<k.words.length;l++){var o=k.words[l];if(o.slice(0,m.string.length)==m.string){n.push(o)}}if(n.length){return{list:n,from:d.Pos(p.line,m.start),to:d.Pos(p.line,m.end)}}});d.commands.autocomplete=d.showHint;var b={hint:d.hint.auto,completeSingle:true,alignWithWord:true,closeCharacters:/[\s()\[\]{};:>,]/,closeOnUnfocus:true,completeOnSingleClick:false,container:null,customKeys:null,extraKeys:null};d.defineOption("hintOptions",null)});