(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("rst",function(e,o){var d=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/;var c=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/;var h=/^``[^`\s](?:[^`]*[^`\s])``/;var l=/^(?:[\d]+(?:[\.,]\d+)*)/;var b=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/;var n=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/;var f="[Hh][Tt][Tt][Pp][Ss]?://";var g="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})";var j="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*";var m=new RegExp("^"+f+g+j);var i={token:function(p){if(p.match(d)&&p.match(/\W+|$/,false)){return"strong"}if(p.match(c)&&p.match(/\W+|$/,false)){return"em"}if(p.match(h)&&p.match(/\W+|$/,false)){return"string-2"}if(p.match(l)){return"number"}if(p.match(b)){return"positive"}if(p.match(n)){return"negative"}if(p.match(m)){return"link"}while(p.next()!=null){if(p.match(d,false)){break}if(p.match(c,false)){break}if(p.match(h,false)){break}if(p.match(l,false)){break}if(p.match(b,false)){break}if(p.match(n,false)){break}if(p.match(m,false)){break}}return null}};var k=a.getMode(e,o.backdrop||"rst-base");return a.overlayMode(k,i,true)},"python","stex");a.defineMode("rst-base",function(N){function C(ac){var ab=Array.prototype.slice.call(arguments,1);return ac.replace(/{(\d+)}/g,function(ad,ae){return typeof ab[ae]!="undefined"?ab[ae]:ad})}function d(ab){this.message=ab}d.prototype.toString=function(){return"AssertException: "+this.message};function M(ac,ab){if(!ac){throw new d(ab)}return ac}var o=a.getMode(N,"python");var c=a.getMode(N,"stex");var p="\\s+";var q="(?:\\s*|\\W|$)",x=new RegExp(C("^{0}",q));var J="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",T=new RegExp(C("^{0}",J));var S="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)";var t=C("(?:{0}|`{1}`)",J,S);var j="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)";var h="(?:[^\\`]+)",v=new RegExp(C("^{0}",h));var I=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$");var R=new RegExp(C("^\\.\\.{0}",p));var s=new RegExp(C("^_{0}:{1}|^__:{1}",t,q));var F=new RegExp(C("^{0}::{1}",t,q));var w=new RegExp(C("^\\|{0}\\|{1}{2}::{3}",j,p,t,q));var r=new RegExp(C("^\\[(?:\\d+|#{0}?|\\*)]{1}",t,q));var E=new RegExp(C("^\\[{0}\\]{1}",t,q));var Y=new RegExp(C("^\\|{0}\\|",j));var H=new RegExp(C("^\\[(?:\\d+|#{0}?|\\*)]_",t));var O=new RegExp(C("^\\[{0}\\]_",t));var D=new RegExp(C("^{0}__?",t));var B=new RegExp(C("^`{0}`_",h));var l=new RegExp(C("^:{0}:`{1}`{2}",J,h,q));var W=new RegExp(C("^`{1}`:{0}:{2}",J,h,q));var U=new RegExp(C("^:{0}:{1}",J,q));var n=new RegExp(C("^{0}",t));var Z=new RegExp(C("^::{0}",q));var g=new RegExp(C("^\\|{0}\\|",j));var A=new RegExp(C("^{0}",p));var V=new RegExp(C("^{0}",t));var G=new RegExp(C("^::{0}",q));var z=new RegExp("^_");var y=new RegExp(C("^{0}|_",t));var m=new RegExp(C("^:{0}",q));var L=new RegExp("^::\\s*$");var X=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");function f(ad,ac){var ab=null;if(ad.sol()&&ad.match(X,false)){b(ac,P,{mode:o,local:a.startState(o)})}else{if(ad.sol()&&ad.match(R)){b(ac,Q);ab="meta"}else{if(ad.sol()&&ad.match(I)){b(ac,f);ab="header"}else{if(i(ac)==l||ad.match(l,false)){switch(k(ac)){case 0:b(ac,f,aa(l,1));M(ad.match(/^:/));ab="meta";break;case 1:b(ac,f,aa(l,2));M(ad.match(T));ab="keyword";if(ad.current().match(/^(?:math|latex)/)){ac.tmp_stex=true}break;case 2:b(ac,f,aa(l,3));M(ad.match(/^:`/));ab="meta";break;case 3:if(ac.tmp_stex){ac.tmp_stex=undefined;ac.tmp={mode:c,local:a.startState(c)}}if(ac.tmp){if(ad.peek()=="`"){b(ac,f,aa(l,4));ac.tmp=undefined;break}ab=ac.tmp.mode.token(ad,ac.tmp.local);break}b(ac,f,aa(l,4));M(ad.match(v));ab="string";break;case 4:b(ac,f,aa(l,5));M(ad.match(/^`/));ab="meta";break;case 5:b(ac,f,aa(l,6));M(ad.match(x));break;default:b(ac,f);M(ad.current()=="")}}else{if(i(ac)==W||ad.match(W,false)){switch(k(ac)){case 0:b(ac,f,aa(W,1));M(ad.match(/^`/));ab="meta";break;case 1:b(ac,f,aa(W,2));M(ad.match(v));ab="string";break;case 2:b(ac,f,aa(W,3));M(ad.match(/^`:/));ab="meta";break;case 3:b(ac,f,aa(W,4));M(ad.match(T));ab="keyword";break;case 4:b(ac,f,aa(W,5));M(ad.match(/^:/));ab="meta";break;case 5:b(ac,f,aa(W,6));M(ad.match(x));break;default:b(ac,f);M(ad.current()=="")}}else{if(i(ac)==U||ad.match(U,false)){switch(k(ac)){case 0:b(ac,f,aa(U,1));M(ad.match(/^:/));ab="meta";break;case 1:b(ac,f,aa(U,2));M(ad.match(T));ab="keyword";break;case 2:b(ac,f,aa(U,3));M(ad.match(/^:/));ab="meta";break;case 3:b(ac,f,aa(U,4));M(ad.match(x));break;default:b(ac,f);M(ad.current()=="")}}else{if(i(ac)==Y||ad.match(Y,false)){switch(k(ac)){case 0:b(ac,f,aa(Y,1));M(ad.match(g));ab="variable-2";break;case 1:b(ac,f,aa(Y,2));if(ad.match(/^_?_?/)){ab="link"}break;default:b(ac,f);M(ad.current()=="")}}else{if(ad.match(H)){b(ac,f);ab="quote"}else{if(ad.match(O)){b(ac,f);ab="quote"}else{if(ad.match(D)){b(ac,f);if(!ad.peek()||ad.peek().match(/^\W$/)){ab="link"}}else{if(i(ac)==B||ad.match(B,false)){switch(k(ac)){case 0:if(!ad.peek()||ad.peek().match(/^\W$/)){b(ac,f,aa(B,1))}else{ad.match(B)}break;case 1:b(ac,f,aa(B,2));M(ad.match(/^`/));ab="link";break;case 2:b(ac,f,aa(B,3));M(ad.match(v));break;case 3:b(ac,f,aa(B,4));M(ad.match(/^`_/));ab="link";break;default:b(ac,f);M(ad.current()=="")}}else{if(ad.match(L)){b(ac,K)}else{if(ad.next()){b(ac,f)}}}}}}}}}}}}}return ab}function Q(ad,ac){var ab=null;if(i(ac)==w||ad.match(w,false)){switch(k(ac)){case 0:b(ac,Q,aa(w,1));M(ad.match(g));ab="variable-2";break;case 1:b(ac,Q,aa(w,2));M(ad.match(A));break;case 2:b(ac,Q,aa(w,3));M(ad.match(V));ab="keyword";break;case 3:b(ac,Q,aa(w,4));M(ad.match(G));ab="meta";break;default:b(ac,f);M(ad.current()=="")}}else{if(i(ac)==F||ad.match(F,false)){switch(k(ac)){case 0:b(ac,Q,aa(F,1));M(ad.match(n));ab="keyword";if(ad.current().match(/^(?:math|latex)/)){ac.tmp_stex=true}else{if(ad.current().match(/^python/)){ac.tmp_py=true}}break;case 1:b(ac,Q,aa(F,2));M(ad.match(Z));ab="meta";if(ad.match(/^latex\s*$/)||ac.tmp_stex){ac.tmp_stex=undefined;b(ac,P,{mode:c,local:a.startState(c)})}break;case 2:b(ac,Q,aa(F,3));if(ad.match(/^python\s*$/)||ac.tmp_py){ac.tmp_py=undefined;b(ac,P,{mode:o,local:a.startState(o)})}break;default:b(ac,f);M(ad.current()=="")}}else{if(i(ac)==s||ad.match(s,false)){switch(k(ac)){case 0:b(ac,Q,aa(s,1));M(ad.match(z));M(ad.match(y));ab="link";break;case 1:b(ac,Q,aa(s,2));M(ad.match(m));ab="meta";break;default:b(ac,f);M(ad.current()=="")}}else{if(ad.match(r)){b(ac,f);ab="quote"}else{if(ad.match(E)){b(ac,f);ab="quote"}else{ad.eatSpace();if(ad.eol()){b(ac,f)}else{ad.skipToEnd();b(ac,u);ab="comment"}}}}}}return ab}function u(ac,ab){return e(ac,ab,"comment")}function K(ac,ab){return e(ac,ab,"meta")}function e(ad,ac,ab){if(ad.eol()||ad.eatSpace()){ad.skipToEnd();return ab}else{b(ac,f);return null}}function P(ac,ab){if(ab.ctx.mode&&ab.ctx.local){if(ac.sol()){if(!ac.eatSpace()){b(ab,f)}return null}return ab.ctx.mode.token(ac,ab.ctx.local)}b(ab,f);return null}function aa(ab,ac,ae,ad){return{phase:ab,stage:ac,mode:ae,local:ad}}function b(ad,ac,ab){ad.tok=ac;ad.ctx=ab||{}}function k(ab){return ab.ctx.stage||0}function i(ab){return ab.ctx.phase}return{startState:function(){return{tok:f,ctx:aa(undefined,0)}},copyState:function(ad){var ab=ad.ctx,ac=ad.tmp;if(ab.local){ab={mode:ab.mode,local:a.copyState(ab.mode,ab.local)}}if(ac){ac={mode:ac.mode,local:a.copyState(ac.mode,ac.local)}}return{tok:ad.tok,ctx:ab,tmp:ac}},innerMode:function(ab){return ab.tmp?{state:ab.tmp.local,mode:ab.tmp.mode}:ab.ctx.mode?{state:ab.ctx.local,mode:ab.ctx.mode}:null},token:function(ac,ab){return ab.tok(ac,ab)}}},"python","stex");a.defineMIME("text/x-rst","rst")});