(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(a){a.defineMode("ruby",function(f){function b(s){var r={};for(var p=0,q=s.length;p<q;++p){r[s[p]]=true}return r}var k=b(["alias","and","BEGIN","begin","break","case","class","def","defined?","do","else","elsif","END","end","ensure","false","for","if","in","module","next","not","or","redo","rescue","retry","return","self","super","then","true","undef","unless","until","when","while","yield","nil","raise","throw","catch","fail","loop","callcc","caller","lambda","proc","public","protected","private","require","load","require_relative","extend","autoload","__END__","__FILE__","__LINE__","__dir__"]);var j=b(["def","class","case","for","while","module","then","catch","loop","proc","begin"]);var e=b(["end","until"]);var d={"[":"]","{":"}","(":")"};var m;function c(p,r,q){q.tokenize.push(p);return p(r,q)}function g(u,s){m=null;if(u.sol()&&u.match("=begin")&&u.eol()){s.tokenize.push(l);return"comment"}if(u.eatSpace()){return null}var r=u.next(),p;if(r=="`"||r=="'"||r=='"'){return c(n(r,"string",r=='"'||r=="`"),u,s)}else{if(r=="/"&&!u.eol()&&u.peek()!=" "){if(u.eat("=")){return"operator"}return c(n(r,"string-2",true),u,s)}else{if(r=="%"){var q="string",v=true;if(u.eat("s")){q="atom"}else{if(u.eat(/[WQ]/)){q="string"}else{if(u.eat(/[r]/)){q="string-2"}else{if(u.eat(/[wxq]/)){q="string";v=false}}}}var t=u.eat(/[^\w\s]/);if(!t){return"operator"}if(d.propertyIsEnumerable(t)){t=d[t]}return c(n(t,q,v,true),u,s)}else{if(r=="#"){u.skipToEnd();return"comment"}else{if(r=="<"&&(p=u.match(/^<-?[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/))){return c(i(p[1]),u,s)}else{if(r=="0"){if(u.eat("x")){u.eatWhile(/[\da-fA-F]/)}else{if(u.eat("b")){u.eatWhile(/[01]/)}else{u.eatWhile(/[0-7]/)}}return"number"}else{if(/\d/.test(r)){u.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/);return"number"}else{if(r=="?"){while(u.match(/^\\[CM]-/)){}if(u.eat("\\")){u.eatWhile(/\w/)}else{u.next()}return"string"}else{if(r==":"){if(u.eat("'")){return c(n("'","atom",false),u,s)}if(u.eat('"')){return c(n('"',"atom",true),u,s)}if(u.eat(/[\<\>]/)){u.eat(/[\<\>]/);return"atom"}if(u.eat(/[\+\-\*\/\&\|\:\!]/)){return"atom"}if(u.eat(/[a-zA-Z$@_]/)){u.eatWhile(/[\w]/);u.eat(/[\?\!\=]/);return"atom"}return"operator"}else{if(r=="@"&&u.match(/^@?[a-zA-Z_]/)){u.eat("@");u.eatWhile(/[\w]/);return"variable-2"}else{if(r=="$"){if(u.eat(/[a-zA-Z_]/)){u.eatWhile(/[\w]/)}else{if(u.eat(/\d/)){u.eat(/\d/)}else{u.next()}}return"variable-3"}else{if(/[a-zA-Z_]/.test(r)){u.eatWhile(/[\w]/);u.eat(/[\?\!]/);if(u.eat(":")){return"atom"}return"ident"}else{if(r=="|"&&(s.varList||s.lastTok=="{"||s.lastTok=="do")){m="|";return null}else{if(/[\(\)\[\]{}\\;]/.test(r)){m=r;return null}else{if(r=="-"&&u.eat(">")){return"arrow"}else{if(/[=+\-\/*:\.^%<>~|]/.test(r)){u.eatWhile(/[=+\-\/*:\.^%<>~|]/);return"operator"}else{return null}}}}}}}}}}}}}}}}}function o(){var p=1;return function(r,q){if(r.peek()=="}"){p--;if(p==0){q.tokenize.pop();return q.tokenize[q.tokenize.length-1](r,q)}}else{if(r.peek()=="{"){p++}}return g(r,q)}}function h(){var p=false;return function(r,q){if(p){q.tokenize.pop();return q.tokenize[q.tokenize.length-1](r,q)}p=true;return g(r,q)}}function n(p,q,s,r){return function(w,u){var v=false,t;if(u.context.type==="read-quoted-paused"){u.context=u.context.prev;w.eat("}")}while((t=w.next())!=null){if(t==p&&(r||!v)){u.tokenize.pop();break}if(s&&t=="#"&&!v){if(w.eat("{")){if(p=="}"){u.context={prev:u.context,type:"read-quoted-paused"}}u.tokenize.push(o());break}else{if(/[@\$]/.test(w.peek())){u.tokenize.push(h());break}}}v=!v&&t=="\\"}return q}}function i(p){return function(r,q){if(r.match(p)){q.tokenize.pop()}else{r.skipToEnd()}return"string"}}function l(q,p){if(q.sol()&&q.match("=end")&&q.eol()){p.tokenize.pop()}q.skipToEnd();return"comment"}return{startState:function(){return{tokenize:[g],indented:0,context:{type:"top",indented:-f.indentUnit},continuedLine:false,lastTok:null,varList:false}},token:function(t,q){if(t.sol()){q.indented=t.indentation()}var p=q.tokenize[q.tokenize.length-1](t,q),s;if(p=="ident"){var r=t.current();p=k.propertyIsEnumerable(t.current())?"keyword":/^[A-Z]/.test(r)?"tag":(q.lastTok=="def"||q.lastTok=="class"||q.varList)?"def":"variable";if(j.propertyIsEnumerable(r)){s="indent"}else{if(e.propertyIsEnumerable(r)){s="dedent"}else{if((r=="if"||r=="unless")&&t.column()==t.indentation()){s="indent"}else{if(r=="do"&&q.context.indented<q.indented){s="indent"}}}}}if(m||(p&&p!="comment")){q.lastTok=r||m||p}if(m=="|"){q.varList=!q.varList}if(s=="indent"||/[\(\[\{]/.test(m)){q.context={prev:q.context,type:m||p,indented:q.indented}}else{if((s=="dedent"||/[\)\]\}]/.test(m))&&q.context.prev){q.context=q.context.prev}}if(t.eol()){q.continuedLine=(m=="\\"||p=="operator")}return p},indent:function(t,p){if(t.tokenize[t.tokenize.length-1]!=g){return 0}var s=p&&p.charAt(0);var r=t.context;var q=r.type==d[s]||r.type=="keyword"&&/^(?:end|until|else|elsif|when|rescue)\b/.test(p);return r.indented+(q?0:f.indentUnit)+(t.continuedLine?f.indentUnit:0)},electricChars:"}de",lineComment:"#"}});a.defineMIME("text/x-ruby","ruby")});