(function(a){if(typeof exports=="object"&&typeof module=="object"){a(require("../lib/codemirror"))}else{if(typeof define=="function"&&define.amd){define(["../lib/codemirror"],a)}else{a(CodeMirror)}}})(function(v){var k=v.Pos;function K(O,i){return O.line==i.line&&O.ch==i.ch}var n=[];function L(i){n.push(i);if(n.length>50){n.shift()}}function C(i){if(!n.length){return L(i)}n[n.length-1]+=i}function e(i){return n[n.length-(i?Math.min(i,1):1)]||""}function t(){if(n.length>1){n.pop()}return e()}var y=null;function r(i,R,Q,P,O){if(O==null){O=i.getRange(R,Q)}if(P&&y&&y.cm==i&&K(R,y.pos)&&i.isClean(y.gen)){C(O)}else{L(O)}i.replaceRange("",R,Q,"+delete");if(P){y={cm:i,pos:R,gen:i.changeGeneration()}}else{y=null}}function c(i,P,O){return i.findPosH(P,O,"char",true)}function d(i,P,O){return i.findPosH(P,O,"word",true)}function x(i,P,O){return i.findPosV(P,O,"line",i.doc.sel.goalColumn)}function s(i,P,O){return i.findPosV(P,O,"page",i.doc.sel.goalColumn)}function B(S,R,O){var T=R.line,V=S.getLine(T);var U=/\S/.test(O<0?V.slice(0,R.ch):V.slice(R.ch));var i=S.firstLine(),P=S.lastLine();for(;;){T+=O;if(T<i||T>P){return S.clipPos(k(T-O,O<0?0:null))}V=S.getLine(T);var Q=/\S/.test(V);if(Q){U=true}else{if(U){return k(T,0)}}}}function b(i,U,Q){var O=U.line,S=U.ch;var T=i.getLine(U.line),P=false;for(;;){var R=T.charAt(S+(Q<0?-1:0));if(!R){if(O==(Q<0?i.firstLine():i.lastLine())){return k(O,S)}T=i.getLine(O+Q);if(!/\S/.test(T)){return k(O,S)}O+=Q;S=Q<0?T.length:0;continue}if(P&&/[!?.]/.test(R)){return k(O,S+(Q>0?1:0))}if(!P){P=/\w/.test(R)}S+=Q}}function f(i,U,O){var R;if(i.findMatchingBracket&&(R=i.findMatchingBracket(U,true))&&R.match&&(R.forward?1:-1)==O){return O>0?k(R.to.line,R.to.ch+1):R.to}for(var T=true;;T=false){var Q=i.getTokenAt(U);var S=k(U.line,O<0?Q.start:Q.end);if(T&&O>0&&Q.end==U.ch||!/\w/.test(Q.string)){var P=i.findPosH(S,O,"char");if(K(S,P)){return U}else{U=P}}else{return S}}}function j(i,O){var P=i.state.emacsPrefix;if(!P){return O?null:1}G(i);return P=="-"?-1:Number(P)}function E(O){var i=typeof O=="string"?function(P){P.execCommand(O)}:O;return function(P){var R=j(P);i(P);for(var Q=1;Q<R;++Q){i(P)}}}function u(O,T,P){var U=O.getCursor(),S=j(O);if(S<0){P=-P;S=-S}for(var R=0;R<S;++R){var Q=T(O,U,P);if(K(Q,U)){break}U=Q}return U}function m(P,i){var O=function(Q){Q.extendSelection(u(Q,P,i))};O.motion=true;return O}function F(i,P,O){r(i,i.getCursor(),u(i,P,O),true)}function z(i,O){if(i.state.emacsPrefix){if(O!="-"){i.state.emacsPrefix+=O}return}i.state.emacsPrefix=O;i.on("keyHandled",h);i.on("inputRead",A)}var g={"Alt-G":true,"Ctrl-X":true,"Ctrl-Q":true,"Ctrl-U":true};function h(O,i){if(!O.state.emacsPrefixMap&&!g.hasOwnProperty(i)){G(O)}}function G(i){i.state.emacsPrefix=null;i.off("keyHandled",h);i.off("inputRead",A)}function A(P,S){var T=j(P);if(T>1&&S.origin=="+input"){var R=S.text.join("\n"),O="";for(var Q=1;Q<T;++Q){O+=R}P.replaceSelection(O)}}function q(i){i.state.emacsPrefixMap=true;i.addKeyMap(l);i.on("keyHandled",p);i.on("inputRead",p)}function p(O,i){if(typeof i=="string"&&(/^\d$/.test(i)||i=="Ctrl-U")){return}O.removeKeyMap(l);O.state.emacsPrefixMap=false;O.off("keyHandled",p);O.off("inputRead",p)}function D(i){i.setCursor(i.getCursor());i.setExtending(!i.getExtending());i.on("change",function(){i.setExtending(false)})}function H(i){i.setExtending(false);i.setCursor(i.getCursor())}function N(i,P,O){if(i.openDialog){i.openDialog(P+': <input type="text" style="width: 10em"/>',O,{bottom:true})}else{O(prompt(P,""))}}function I(i,Q){var P=i.getCursor(),O=i.findPosH(P,1,"word");i.replaceRange(Q(i.getRange(P,O)),P,O);i.setCursor(O)}function a(P){var U=P.getCursor(),Q=U.line,S=U.ch;var O=[];while(Q>=P.firstLine()){var T=P.getLine(Q);for(var R=S==null?T.length:S;R>0;){var S=T.charAt(--R);if(S==")"){O.push("(")}else{if(S=="]"){O.push("[")}else{if(S=="}"){O.push("{")}else{if(/[\(\{\[]/.test(S)&&(!O.length||O.pop()!=S)){return P.extendSelection(k(Q,R))}}}}}--Q;S=null}}function o(i){i.execCommand("clearSearch");H(i)}var w=v.keyMap.emacs={"Ctrl-W":function(i){r(i,i.getCursor("start"),i.getCursor("end"))},"Ctrl-K":E(function(i){var Q=i.getCursor(),O=i.clipPos(k(Q.line));var P=i.getRange(Q,O);if(!/\S/.test(P)){P+="\n";O=k(Q.line+1,0)}r(i,Q,O,true,P)}),"Alt-W":function(i){L(i.getSelection());H(i)},"Ctrl-Y":function(i){var O=i.getCursor();i.replaceRange(e(j(i)),O,O,"paste");i.setSelection(O,i.getCursor())},"Alt-Y":function(i){i.replaceSelection(t(),"around","paste")},"Ctrl-Space":D,"Ctrl-Shift-2":D,"Ctrl-F":m(c,1),"Ctrl-B":m(c,-1),Right:m(c,1),Left:m(c,-1),"Ctrl-D":function(i){F(i,c,1)},Delete:function(i){F(i,c,1)},"Ctrl-H":function(i){F(i,c,-1)},Backspace:function(i){F(i,c,-1)},"Alt-F":m(d,1),"Alt-B":m(d,-1),"Alt-D":function(i){F(i,d,1)},"Alt-Backspace":function(i){F(i,d,-1)},"Ctrl-N":m(x,1),"Ctrl-P":m(x,-1),Down:m(x,1),Up:m(x,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":m(s,-1),"Ctrl-V":m(s,1),PageUp:m(s,-1),PageDown:m(s,1),"Ctrl-Up":m(B,-1),"Ctrl-Down":m(B,1),"Alt-A":m(b,-1),"Alt-E":m(b,1),"Alt-K":function(i){F(i,b,1)},"Ctrl-Alt-K":function(i){F(i,f,1)},"Ctrl-Alt-Backspace":function(i){F(i,f,-1)},"Ctrl-Alt-F":m(f,1),"Ctrl-Alt-B":m(f,-1),"Shift-Ctrl-Alt-2":function(i){i.setSelection(u(i,f,1),i.getCursor())},"Ctrl-Alt-T":function(i){var O=f(i,i.getCursor(),-1),Q=f(i,O,1);var R=f(i,Q,1),P=f(i,R,-1);i.replaceRange(i.getRange(P,R)+i.getRange(Q,P)+i.getRange(O,Q),O,R)},"Ctrl-Alt-U":E(a),"Alt-Space":function(i){var R=i.getCursor(),Q=R.ch,P=R.ch,O=i.getLine(R.line);while(Q&&/\s/.test(O.charAt(Q-1))){--Q}while(P<O.length&&/\s/.test(O.charAt(P))){++P}i.replaceRange(" ",k(R.line,Q),k(R.line,P))},"Ctrl-O":E(function(i){i.replaceSelection("\n","start")}),"Ctrl-T":E(function(i){i.execCommand("transposeChars")}),"Alt-C":E(function(i){I(i,function(O){var P=O.search(/\w/);if(P==-1){return O}return O.slice(0,P)+O.charAt(P).toUpperCase()+O.slice(P+1).toLowerCase()})}),"Alt-U":E(function(i){I(i,function(O){return O.toUpperCase()})}),"Alt-L":E(function(i){I(i,function(O){return O.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":E("undo"),"Shift-Ctrl--":E("undo"),"Ctrl-Z":E("undo"),"Cmd-Z":E("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findNext","Ctrl-R":"findPrev","Ctrl-G":o,"Shift-Alt-5":"replace","Alt-/":"autocomplete","Ctrl-J":"newlineAndIndent",Enter:false,Tab:"indentAuto","Alt-G":function(i){i.setOption("keyMap","emacs-Alt-G")},"Ctrl-X":function(i){i.setOption("keyMap","emacs-Ctrl-X")},"Ctrl-Q":function(i){i.setOption("keyMap","emacs-Ctrl-Q")},"Ctrl-U":q};v.keyMap["emacs-Ctrl-X"]={Tab:function(i){i.indentSelection(j(i,true)||i.getOption("indentUnit"))},"Ctrl-X":function(i){i.setSelection(i.getCursor("head"),i.getCursor("anchor"))},"Ctrl-S":"save","Ctrl-W":"save",S:"saveAll",F:"open",U:E("undo"),K:"close",Delete:function(i){r(i,i.getCursor(),b(i,i.getCursor(),1),true)},auto:"emacs",nofallthrough:true,disableInput:true};v.keyMap["emacs-Alt-G"]={G:function(i){var O=j(i,true);if(O!=null&&O>0){return i.setCursor(O-1)}N(i,"Goto line",function(Q){var P;if(Q&&!isNaN(P=Number(Q))&&P==P|0&&P>0){i.setCursor(P-1)}})},auto:"emacs",nofallthrough:true,disableInput:true};v.keyMap["emacs-Ctrl-Q"]={Tab:E("insertTab"),auto:"emacs",nofallthrough:true};var l={"Ctrl-G":G};function M(i){l[i]=function(O){z(O,i)};w["Ctrl-"+i]=function(O){z(O,i)};g["Ctrl-"+i]=true}for(var J=0;J<10;++J){M(String(J))}M("-")});