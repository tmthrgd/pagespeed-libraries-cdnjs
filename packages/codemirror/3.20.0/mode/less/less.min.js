/*
  LESS mode - http://www.lesscss.org/
  Ported to CodeMirror by Peter Kroon <plakroon@gmail.com>
  Report bugs/issues here: https://github.com/marijnh/CodeMirror/issues
  GitHub: @peterkroon
*/CodeMirror.defineMode("less",function(e){function r(e,t){return n=t,e}function s(e,t){var s=e.next();if(s=="@")return e.eatWhile(/[\w\-]/),r("meta",e.current());if(s=="/"&&e.eat("*"))return t.tokenize=u,u(e,t);if(s=="<"&&e.eat("!"))return t.tokenize=a,a(e,t);if(s=="=")r(null,"compare");else{if(s=="|"&&e.eat("="))return r(null,"compare");if(s=='"'||s=="'")return t.tokenize=f(s),t.tokenize(e,t);if(s=="/"){if(e.eat("/"))return t.tokenize=o,o(e,t);if(n=="string"||n=="(")return r("string","string");if(t.stack[t.stack.length-1]!==undefined)return r(null,s);e.eatWhile(/[\a-zA-Z0-9\-_.\s]/);if(/\/|\)|#/.test(e.peek()||e.eatSpace()&&e.peek()===")")||e.eol())return r("string","string")}else{if(s=="!")return e.match(/^\s*\w*/),r("keyword","important");if(/\d/.test(s))return e.eatWhile(/[\w.%]/),r("number","unit");if(/[,+<>*\/]/.test(s))return e.peek()=="="||n=="a"?r("string","string"):s===","?r(null,s):r(null,"select-op");if(/[;{}:\[\]()~\|]/.test(s)){if(s==":")return e.eatWhile(/[a-z\\\-]/),i.test(e.current())?r("tag","tag"):e.peek()==":"?(e.next(),e.eatWhile(/[a-z\\\-]/),e.current().match(/\:\:\-(o|ms|moz|webkit)\-/)?r("string","string"):i.test(e.current().substring(1))?r("tag","tag"):r(null,s)):r(null,s);if(s!="~")return r(null,s);if(n=="r")return r("string","string")}else{if(s==".")return n=="("?r("string","string"):(e.eatWhile(/[\a-zA-Z0-9\-_]/),e.peek()===" "&&e.eatSpace(),e.peek()===")"||n===":"?r("number","unit"):e.current().length>1&&t.stack[t.stack.length-1]==="rule"&&e.peek().match(/{|,|\+|\(/)===null?r("number","unit"):r("tag","tag"));if(s=="#")return e.eatWhile(/[A-Za-z0-9]/),e.current().length==4||e.current().length==7?e.current().match(/[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}/,false)!=null?e.current().substring(1)!=e.current().match(/[A-Fa-f0-9]{6}|[A-Fa-f0-9]{3}/,false)?r("atom","tag"):(e.eatSpace(),/[\/<>.(){!$%^&*_\-\\?=+\|#'~`]/.test(e.peek())?n==="select-op"?r("number","unit"):r("atom","tag"):e.peek()=="}"?r("number","unit"):/[a-zA-Z\\]/.test(e.peek())?r("atom","tag"):e.eol()?r("atom","tag"):r("number","unit")):(e.eatWhile(/[\w\\\-]/),r("atom",e.current())):(e.eatWhile(/[\w\\\-]/),t.stack[t.stack.length-1]==="rule"?r("atom",e.current()):r("atom",e.current()));if(s=="&")return e.eatWhile(/[\w\-]/),r(null,s);e.eatWhile(/[\w\\\-_%.{]/);if(e.current().match(/\\/)===null){if(n=="string")return t.stack[t.stack.length-1]==="{"&&e.peek()===":"?r("variable","variable"):(e.peek()==="/"&&e.eatWhile(/[\w\\\-_%.{:\/]/),r(n,e.current()));if(e.current().match(/(^http$|^https$)/)!=null)return e.eatWhile(/[\w\\\-_%.{:\/]/),e.peek()==="/"&&e.eatWhile(/[\w\\\-_%.{:\/]/),r("string","string");if(e.peek()=="<"||e.peek()==">"||e.peek()=="+")return n!=="("||e.current()!=="n"&&e.current()!=="-n"?r("tag","tag"):r("string",e.current());if(/\(/.test(e.peek()))return e.current()==="when"?r("variable","variable"):t.stack[t.stack.length-1]==="@media"&&e.current()==="and"?r("variable",e.current()):r(null,s);if(e.peek()=="/"&&t.stack[t.stack.length-1]!==undefined)return e.peek()==="/"&&e.eatWhile(/[\w\\\-_%.{:\/]/),r("string",e.current());if(e.current().match(/\-\d|\-.\d/))return r("number","unit");if(/\/|[\s\)]/.test(e.peek()||e.eol()||e.eatSpace()&&e.peek()=="/")&&e.current().indexOf(".")!==-1)return e.current().substring(e.current().length-1,e.current().length)=="{"?(e.backUp(1),r("tag","tag")):(e.eatSpace(),/[{<>.a-zA-Z\/]/.test(e.peek())||e.eol()?r("tag","tag"):r("string","string"));if(e.eol()||e.peek()=="["||e.peek()=="#"||n=="tag"){if(e.current().substring(e.current().length-1,e.current().length)=="{")e.backUp(1);else{if(t.stack[t.stack.length-1]==="border-color"||t.stack[t.stack.length-1]==="background-position"||t.stack[t.stack.length-1]==="font-family")return r(null,e.current());if(n==="tag")return r("tag","tag");if((n===":"||n==="unit")&&t.stack[t.stack.length-1]==="rule")return r(null,e.current());if(t.stack[t.stack.length-1]==="rule"&&n==="tag")return r("string",e.current());if(t.stack[t.stack.length-1]===";"&&n===":")return r(null,e.current());if(e.peek()==="#"&&n!==undefined&&n.match(/\+|,|tag|select\-op|}|{|;/g)===null)return r("string",e.current());if(n==="variable")return r(null,e.current());if(t.stack[t.stack.length-1]==="{"&&n==="comment")return r("variable",e.current());if(t.stack.length===0&&(n===";"||n==="comment"))return r("tag",e.current());if((t.stack[t.stack.length-1]==="{"||n===";")&&t.stack[t.stack.length-1]!=="@media{")return r("variable",e.current());if(t.stack[t.stack.length-2]==="{"&&t.stack[t.stack.length-1]===";")return r("variable",e.current())}return r("tag","tag")}if(n=="compare"||n=="a"||n=="(")return r("string","string");if(n=="|"||e.current()=="-"||n=="[")return n=="|"&&e.peek().match(/\]|=|\~/)!==null?r("number",e.current()):n=="|"?r("tag","tag"):n=="["?(e.eatWhile(/\w\-/),r("number",e.current())):r(null,s);if(e.peek()==":"||e.eatSpace()&&e.peek()==":"){e.next();var l=e.peek()==":"?!0:!1;if(!l){var c=e.pos,h=e.current().length;e.eatWhile(/[a-z\\\-]/);var p=e.pos;if(e.current().substring(h-1).match(i)!=null)return e.backUp(p-(c-1)),r("tag","tag");e.backUp(p-(c-1))}else e.backUp(1);return l?r("tag","tag"):r("variable","variable")}return t.stack[t.stack.length-1]==="font-family"||t.stack[t.stack.length-1]==="background-position"||t.stack[t.stack.length-1]==="border-color"?r(null,null):t.stack[t.stack.length-1]===null&&n===":"?r(null,e.current()):/\^|\$/.test(e.current())&&e.peek().match(/\~|=/)!==null?r("string","string"):n==="unit"&&t.stack[t.stack.length-1]==="rule"?r(null,"unit"):n==="unit"&&t.stack[t.stack.length-1]===";"?r(null,"unit"):n===")"&&t.stack[t.stack.length-1]==="rule"?r(null,"unit"):n&&n.match("@")!==null&&t.stack[t.stack.length-1]==="rule"?r(null,"unit"):n!==";"&&n!=="}"&&n!==","||t.stack[t.stack.length-1]!==";"?n===";"&&e.peek()!==undefined&&e.peek().match(/{|./)===null||n===";"&&e.eatSpace()&&e.peek().match(/{|./)===null?r("variable",e.current()):n==="@media"&&t.stack[t.stack.length-1]==="@media"||n==="@namespace"?r("tag",e.current()):n==="{"&&t.stack[t.stack.length-1]===";"&&e.peek()==="{"?r("tag","tag"):n!=="{"&&n!==":"||t.stack[t.stack.length-1]!==";"?t.stack[t.stack.length-1]==="{"&&e.eatSpace()&&e.peek().match(/.|#/)===null||n==="select-op"||t.stack[t.stack.length-1]==="rule"&&n===","?r("tag","tag"):n==="variable"&&t.stack[t.stack.length-1]==="rule"?r("tag","tag"):e.eatSpace()&&e.peek()==="{"||e.eol()||e.peek()==="{"?r("tag","tag"):n!==")"||e.current()!="and"&&e.current()!="and "?n!==")"||e.current()!="when"&&e.current()!="when "?n===")"||n==="comment"||n==="{"?r("tag","tag"):e.sol()?r("tag","tag"):e.eatSpace()&&e.peek()==="#"||e.peek()==="#"?r("tag","tag"):t.stack.length===0?r("tag","tag"):n===";"&&e.peek()!==undefined&&e.peek().match(/^[.|\#]/g)!==null?r("tag","tag"):n===":"?(e.eatSpace(),r(null,e.current())):e.current()==="and "||e.current()==="and"?r("variable",e.current()):n===";"&&t.stack[t.stack.length-1]==="{"?r("variable",e.current()):t.stack[t.stack.length-1]==="rule"?r(null,e.current()):r("tag",e.current()):r("variable","variable"):r("variable","variable"):r(null,e.current()):r("tag",e.current())}if(e.current().charAt(e.current().length-1)==="\\"){e.eat(/\'|\"|\)|\(/);while(e.eatWhile(/[\w\\\-_%.{]/))e.eat(/\'|\"|\)|\(/);return r("string",e.current())}}}}}function o(e,t){return e.skipToEnd(),t.tokenize=s,r("comment","comment")}function u(e,t){var n=!1,i;while((i=e.next())!=null){if(n&&i=="/"){t.tokenize=s;break}n=i=="*"}return r("comment","comment")}function a(e,t){var n=0,i;while((i=e.next())!=null){if(n>=2&&i==">"){t.tokenize=s;break}n=i=="-"?n+1:0}return r("comment","comment")}function f(e){return function(t,n){var i=!1,o;while((o=t.next())!=null){if(o==e&&!i)break;i=!i&&o=="\\"}return i||(n.tokenize=s),r("string","string")}}var t=e.indentUnit,n,i=/(^\:root$|^\:nth\-child$|^\:nth\-last\-child$|^\:nth\-of\-type$|^\:nth\-last\-of\-type$|^\:first\-child$|^\:last\-child$|^\:first\-of\-type$|^\:last\-of\-type$|^\:only\-child$|^\:only\-of\-type$|^\:empty$|^\:link|^\:visited$|^\:active$|^\:hover$|^\:focus$|^\:target$|^\:lang$|^\:enabled^\:disabled$|^\:checked$|^\:first\-line$|^\:first\-letter$|^\:before$|^\:after$|^\:not$|^\:required$|^\:invalid$)/;return{startState:function(e){return{tokenize:s,baseIndent:e||0,stack:[]}},token:function(e,t){if(e.eatSpace())return null;var i=t.tokenize(e,t),s=t.stack[t.stack.length-1];if(n=="hash"&&s=="rule")i="atom";else if(i=="variable")if(s=="rule")i=null;else if(!s||s=="@media{")i=e.current()=="when"?"variable":/[\s,|\s\)|\s]/.test(e.peek())?"tag":n;s=="rule"&&/^[\{\};]$/.test(n)&&t.stack.pop(),n=="{"?s=="@media"?t.stack[t.stack.length-1]="@media{":t.stack.push("{"):n=="}"?t.stack.pop():n=="@media"?t.stack.push("@media"):e.current()==="font-family"?t.stack[t.stack.length-1]="font-family":e.current()==="background-position"?t.stack[t.stack.length-1]="background-position":e.current()==="border-color"?t.stack[t.stack.length-1]="border-color":s=="{"&&n!="comment"&&n!=="tag"?t.stack.push("rule"):e.peek()===":"&&e.current().match(/@|#/)===null&&(i=n);if(n!==";"||t.stack[t.stack.length-1]!="font-family"&&t.stack[t.stack.length-1]!="background-position"&&t.stack[t.stack.length-1]!="border-color"){if(n==="tag"&&e.peek()===")"&&e.current().match(/\:/)===null)n=null,i=null;else if(n==="variable"&&e.peek()===")"||n==="variable"&&e.eatSpace()&&e.peek()===")")return r(null,e.current())}else t.stack[t.stack.length-1]=e.current();return i},indent:function(e,n){var r=e.stack.length;return/^\}/.test(n)?r-=e.stack[e.stack.length-1]==="rule"?2:1:e.stack[e.stack.length-2]==="{"&&(r-=e.stack[e.stack.length-1]==="rule"?1:0),e.baseIndent+r*t},electricChars:"}",blockCommentStart:"/*",blockCommentEnd:"*/",lineComment:"//"}}),CodeMirror.defineMIME("text/x-less","less"),CodeMirror.mimeModes.hasOwnProperty("text/css")||CodeMirror.defineMIME("text/css","less");