// TODO actually recognize syntax of TypeScript constructs
CodeMirror.defineMode("javascript",function(e,t){function a(e,t){var n=!1,r;while((r=e.next())!=null){if(r==t&&!n)return!1;n=!n&&r=="\\"}return n}function c(e,t,n){return f=e,l=n,t}function h(e,t){var n=e.next();if(n=='"'||n=="'")return t.tokenize=p(n),t.tokenize(e,t);if(n=="."&&e.match(/^\d+(?:[eE][+\-]?\d+)?/))return c("number","number");if(n=="."&&e.match(".."))return c("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(n))return c(n);if(n=="="&&e.eat(">"))return c("=>");if(n=="0"&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),c("number","number");if(/\d/.test(n))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),c("number","number");if(n=="/")return e.eat("*")?(t.tokenize=d,d(e,t)):e.eat("/")?(e.skipToEnd(),c("comment","comment")):t.lastType=="operator"||t.lastType=="keyword c"||t.lastType=="sof"||/^[\[{}\(,;:]$/.test(t.lastType)?(a(e,"/"),e.eatWhile(/[gimy]/),c("regexp","string-2")):(e.eatWhile(u),c("operator",null,e.current()));if(n=="`")return t.tokenize=v,v(e,t);if(n=="#")return e.skipToEnd(),c("error","error");if(u.test(n))return e.eatWhile(u),c("operator",null,e.current());e.eatWhile(/[\w\$_]/);var r=e.current(),i=o.propertyIsEnumerable(r)&&o[r];return i&&t.lastType!="."?c(i.type,i.style,r):c("variable","variable",r)}function p(e){return function(t,n){return a(t,e)||(n.tokenize=h),c("string","string")}}function d(e,t){var n=!1,r;while(r=e.next()){if(r=="/"&&n){t.tokenize=h;break}n=r=="*"}return c("comment","comment")}function v(e,t){var n=!1,r;while((r=e.next())!=null){if(!n&&(r=="`"||r=="$"&&e.eat("{"))){t.tokenize=h;break}n=!n&&r=="\\"}return c("quasi","string-2",e.current())}function g(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var n=e.string.indexOf("=>",e.start);if(n<0)return;var r=0,i=!1;for(var s=n-1;s>=0;--s){var o=e.string.charAt(s),u=m.indexOf(o);if(u>=0&&u<3){if(!r){++s;break}if(--r==0)break}else if(u>=3&&u<6)++r;else if(/[$\w]/.test(o))i=!0;else if(i&&!r){++s;break}}i&&!r&&(t.fatArrowAt=s)}function b(e,t,n,r,i,s){this.indented=e,this.column=t,this.type=n,this.prev=i,this.info=s,r!=null&&(this.align=r)}function w(e,t){for(var n=e.localVars;n;n=n.next)if(n.name==t)return!0;for(var r=e.context;r;r=r.prev)for(var n=r.vars;n;n=n.next)if(n.name==t)return!0}function E(e,t,n,r,s){var o=e.cc;S.state=e,S.stream=s,S.marked=null,S.cc=o,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);for(;;){var u=o.length?o.pop():i?D:_;if(u(n,r)){while(o.length&&o[o.length-1].lex)o.pop()();return S.marked?S.marked:n=="variable"&&w(e,r)?"variable-2":t}}}function x(){for(var e=arguments.length-1;e>=0;e--)S.cc.push(arguments[e])}function T(){return x.apply(null,arguments),!0}function N(e){function n(t){for(var n=t;n;n=n.next)if(n.name==e)return!0;return!1}var r=S.state;if(r.context){S.marked="def";if(n(r.localVars))return;r.localVars={name:e,next:r.localVars}}else{if(n(r.globalVars))return;t.globalVars&&(r.globalVars={name:e,next:r.globalVars})}}function k(){S.state.context={prev:S.state.context,vars:S.state.localVars},S.state.localVars=C}function L(){S.state.localVars=S.state.context.vars,S.state.context=S.state.context.prev}function A(e,t){var n=function(){var n=S.state,r=n.indented;n.lexical.type=="stat"&&(r=n.lexical.indented),n.lexical=new b(r,S.stream.column(),e,null,n.lexical,t)};return n.lex=!0,n}function O(){var e=S.state;e.lexical.prev&&(e.lexical.type==")"&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function M(e){return function(t){return t==e?T():e==";"?x():T(arguments.callee)}}function _(e,t){return e=="var"?T(A("vardef",t.length),Z,M(";"),O):e=="keyword a"?T(A("form"),D,_,O):e=="keyword b"?T(A("form"),_,O):e=="{"?T(A("}"),Q,O):e==";"?T():e=="if"?T(A("form"),D,_,O,it):e=="function"?T(lt):e=="for"?T(A("form"),st,O,_,O):e=="variable"?T(A("stat"),W):e=="switch"?T(A("form"),D,A("}","switch"),M("{"),Q,O,O):e=="case"?T(D,M(":")):e=="default"?T(M(":")):e=="catch"?T(A("form"),k,M("("),ct,M(")"),_,O,L):e=="module"?T(A("form"),k,vt,L,O):e=="class"?T(A("form"),ht,dt,O):e=="export"?T(A("form"),mt,O):e=="import"?T(A("form"),gt,O):x(A("stat"),D,M(";"),O)}function D(e){return H(e,!1)}function P(e){return H(e,!0)}function H(e,t){if(S.state.fatArrowAt==S.stream.start){var n=t?z:U;if(e=="(")return T(k,K(et,")"),M("=>"),n,L);if(e=="variable")return x(k,et,M("=>"),n,L)}var r=t?I:F;return y.hasOwnProperty(e)?T(r):e=="function"?T(lt):e=="keyword c"?T(t?j:B):e=="("?T(A(")"),B,Et,M(")"),O,r):e=="operator"||e=="spread"?T(t?P:D):e=="["?T(A("]"),P,wt,O,r):e=="{"?T(K(V,"}"),r):T()}function B(e){return e.match(/[;\}\)\],]/)?x():x(D)}function j(e){return e.match(/[;\}\)\],]/)?x():x(P)}function F(e,t){return e==","?T(D):I(e,t,!1)}function I(e,t,n){var r=n==0?F:I,i=n==0?D:P;if(t=="=>")return T(k,n?z:U,L);if(e=="operator")return/\+\+|--/.test(t)?T(r):t=="?"?T(D,M(":"),i):T(i);if(e=="quasi")return S.cc.push(r),q(t);if(e==";")return;if(e=="(")return T(K(P,")","call"),r);if(e==".")return T(X,r);if(e=="[")return T(A("]"),B,M("]"),O,r)}function q(e){if(!e)debugger;return e.slice(e.length-2)!="${"?T():T(D,R)}function R(e){if(e=="}")return S.marked="string-2",S.state.tokenize=v,T()}function U(e){return g(S.stream,S.state),e=="{"?x(_):x(D)}function z(e){return g(S.stream,S.state),e=="{"?x(_):x(P)}function W(e){return e==":"?T(O,_):x(F,M(";"),O)}function X(e){if(e=="variable")return S.marked="property",T()}function V(e,t){if(e=="variable"){S.marked="property";if(t=="get"||t=="set")return T($)}else if(e=="number"||e=="string")S.marked=e+" property";else if(e=="[")return T(D,M("]"),J);if(y.hasOwnProperty(e))return T(J)}function $(e){return e!="variable"?x(J):(S.marked="property",T(lt))}function J(e){if(e==":")return T(P);if(e=="(")return x(lt)}function K(e,t,n){function r(n){if(n==","){var i=S.state.lexical;return i.info=="call"&&(i.pos=(i.pos||0)+1),T(e,r)}return n==t?T():T(M(t))}return function(i){return i==t?T():n===!1?x(e,r):x(A(t,n),e,r,O)}}function Q(e){return e=="}"?T():x(_,Q)}function G(e){if(s&&e==":")return T(Y)}function Y(e){if(e=="variable")return S.marked="variable-3",T()}function Z(){return x(et,G,nt,rt)}function et(e,t){if(e=="variable")return N(t),T();if(e=="[")return T(K(et,"]"));if(e=="{")return T(K(tt,"}"))}function tt(e,t){return e=="variable"&&!S.stream.match(/^\s*:/,!1)?(N(t),T(nt)):(e=="variable"&&(S.marked="property"),T(M(":"),et,nt))}function nt(e,t){if(t=="=")return T(P)}function rt(e){if(e==",")return T(Z)}function it(e,t){if(e=="keyword b"&&t=="else")return T(A("form"),_,O)}function st(e){if(e=="(")return T(A(")"),ot,M(")"))}function ot(e){return e=="var"?T(Z,M(";"),at):e==";"?T(at):e=="variable"?T(ut):x(D,M(";"),at)}function ut(e,t){return t=="in"||t=="of"?(S.marked="keyword",T(D)):T(F,at)}function at(e,t){return e==";"?T(ft):t=="in"||t=="of"?(S.marked="keyword",T(D)):x(D,M(";"),ft)}function ft(e){e!=")"&&T(D)}function lt(e,t){if(t=="*")return S.marked="keyword",T(lt);if(e=="variable")return N(t),T(lt);if(e=="(")return T(k,K(ct,")"),_,L)}function ct(e){return e=="spread"?T(ct):x(et,G)}function ht(e,t){if(e=="variable")return N(t),T(pt)}function pt(e,t){if(t=="extends")return T(D)}function dt(e){if(e=="{")return T(K(V,"}"))}function vt(e,t){if(e=="string")return T(_);if(e=="variable")return N(t),T(bt)}function mt(e,t){return t=="*"?(S.marked="keyword",T(bt,M(";"))):t=="default"?(S.marked="keyword",T(D,M(";"))):x(_)}function gt(e){return e=="string"?T():x(yt,bt)}function yt(e,t){return e=="{"?T(K(yt,"}")):(e=="variable"&&N(t),T())}function bt(e,t){if(t=="from")return S.marked="keyword",T(D)}function wt(e){return e=="for"?x(Et):e==","?T(K(P,"]",!1)):x(K(P,"]",!1))}function Et(e){if(e=="for")return T(st,Et);if(e=="if")return T(D,Et)}var n=e.indentUnit,r=t.statementIndent,i=t.json,s=t.typescript,o=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),n=e("keyword b"),r=e("keyword c"),i=e("operator"),o={type:"atom",style:"atom"},u={"if":e("if"),"while":t,"with":t,"else":n,"do":n,"try":n,"finally":n,"return":r,"break":r,"continue":r,"new":r,"delete":r,"throw":r,"var":e("var"),"const":e("var"),let:e("var"),"function":e("function"),"catch":e("catch"),"for":e("for"),"switch":e("switch"),"case":e("case"),"default":e("default"),"in":i,"typeof":i,"instanceof":i,"true":o,"false":o,"null":o,"undefined":o,NaN:o,Infinity:o,"this":e("this"),module:e("module"),"class":e("class"),"super":e("atom"),yield:r,"export":e("export"),"import":e("import"),"extends":r};if(s){var a={type:"variable",style:"variable-3"},f={"interface":e("interface"),"extends":e("extends"),constructor:e("constructor"),"public":e("public"),"private":e("private"),"protected":e("protected"),"static":e("static"),string:a,number:a,bool:a,any:a};for(var l in f)u[l]=f[l]}return u}(),u=/[+\-*&%=<>!?|~^]/,f,l,m="([{}])",y={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,"this":!0},S={state:null,column:null,marked:null,cc:null},C={name:"this",next:{name:"arguments"}};return O.lex=!0,{startState:function(e){var r={tokenize:h,lastType:"sof",cc:[],lexical:new b((e||0)-n,0,"block",!1),localVars:t.localVars,context:t.localVars&&{vars:t.localVars},indented:0};return t.globalVars&&(r.globalVars=t.globalVars),r},token:function(e,t){e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),g(e,t));if(t.tokenize!=d&&e.eatSpace())return null;var n=t.tokenize(e,t);return f=="comment"?n:(t.lastType=f!="operator"||l!="++"&&l!="--"?f:"incdec",E(t,n,f,l,e))},indent:function(e,i){if(e.tokenize==d)return CodeMirror.Pass;if(e.tokenize!=h)return 0;var s=i&&i.charAt(0),o=e.lexical;for(var u=e.cc.length-1;u>=0;--u){var a=e.cc[u];if(a==O)o=o.prev;else if(a!=it)break}o.type=="stat"&&s=="}"&&(o=o.prev),r&&o.type==")"&&o.prev.type=="stat"&&(o=o.prev);var f=o.type,l=s==f;return f=="vardef"?o.indented+(e.lastType=="operator"||e.lastType==","?o.info+1:0):f=="form"&&s=="{"?o.indented:f=="form"?o.indented+n:f=="stat"?o.indented+(e.lastType=="operator"||e.lastType==","?r||n:0):o.info=="switch"&&!l&&t.doubleIndentSwitch!=0?o.indented+(/^(?:case|default)\b/.test(i)?n:2*n):o.align?o.column+(l?0:1):o.indented+(l?0:n)},electricChars:":{}",blockCommentStart:i?null:"/*",blockCommentEnd:i?null:"*/",lineComment:i?null:"//",fold:"brace",helperType:i?"json":"javascript",jsonMode:i}}),CodeMirror.defineMIME("text/javascript","javascript"),CodeMirror.defineMIME("text/ecmascript","javascript"),CodeMirror.defineMIME("application/javascript","javascript"),CodeMirror.defineMIME("application/ecmascript","javascript"),CodeMirror.defineMIME("application/json",{name:"javascript",json:!0}),CodeMirror.defineMIME("application/x-json",{name:"javascript",json:!0}),CodeMirror.defineMIME("text/typescript",{name:"javascript",typescript:!0}),CodeMirror.defineMIME("application/typescript",{name:"javascript",typescript:!0});