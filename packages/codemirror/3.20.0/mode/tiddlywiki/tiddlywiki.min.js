/***
    |''Name''|tiddlywiki.js|
    |''Description''|Enables TiddlyWikiy syntax highlighting using CodeMirror|
    |''Author''|PMario|
    |''Version''|0.1.7|
    |''Status''|''stable''|
    |''Source''|[[GitHub|https://github.com/pmario/CodeMirror2/blob/tw-syntax/mode/tiddlywiki]]|
    |''Documentation''|http://codemirror.tiddlyspace.com/|
    |''License''|[[MIT License|http://www.opensource.org/licenses/mit-license.php]]|
    |''CoreVersion''|2.5.0|
    |''Requires''|codemirror.js|
    |''Keywords''|syntax highlighting color code mirror codemirror|
    ! Info
    CoreVersion parameter is needed for TiddlyWiki only!
***///{{{
CodeMirror.defineMode("tiddlywiki",function(){function d(e,t,n){return t.tokenize=n,n(e,t)}function g(e,t,n){return v=e,m=n,t}function y(t,h){var p=t.sol(),v;h.block=!1,v=t.peek();if(p&&/[<\/\*{}\-]/.test(v)){if(t.match(c))return h.block=!0,d(t,h,E);if(t.match(o))return g("quote","quote");if(t.match(i)||t.match(s))return g("code","comment");if(t.match(u)||t.match(a)||t.match(f)||t.match(l))return g("code","comment");if(t.match(r))return g("hr","hr")}v=t.next();if(p&&/[\/\*!#;:>|]/.test(v)){if(v=="!")return t.skipToEnd(),g("header","header");if(v=="*")return t.eatWhile("*"),g("list","comment");if(v=="#")return t.eatWhile("#"),g("list","comment");if(v==";")return t.eatWhile(";"),g("list","comment");if(v==":")return t.eatWhile(":"),g("list","comment");if(v==">")return t.eatWhile(">"),g("quote","quote");if(v=="|")return g("table","header")}if(v=="{"&&t.match(/\{\{/))return d(t,h,E);if(/[hf]/i.test(v)&&/[ti]/i.test(t.peek())&&t.match(/\b(ttps?|tp|ile):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$]/i))return g("link","link");if(v=='"')return g("string","string");if(v=="~")return g("text","brace");if(/[\[\]]/.test(v)&&t.peek()==v)return t.next(),g("brace","brace");if(v=="@")return t.eatWhile(n),g("link","link");if(/\d/.test(v))return t.eatWhile(/\d/),g("number","number");if(v=="/"){if(t.eat("%"))return d(t,h,b);if(t.eat("/"))return d(t,h,S)}if(v=="_"&&t.eat("_"))return d(t,h,x);if(v=="-"&&t.eat("-")){if(t.peek()!=" ")return d(t,h,T);if(t.peek()==" ")return g("text","brace")}if(v=="'"&&t.eat("'"))return d(t,h,w);if(v!="<")return g(v);if(t.eat("<"))return d(t,h,N);t.eatWhile(/[\w\$_]/);var m=t.current(),y=e.propertyIsEnumerable(m)&&e[m];return y?g(y.type,y.style,m):g("text",null,m)}function b(e,t){var n=!1,r;while(r=e.next()){if(r=="/"&&n){t.tokenize=y;break}n=r=="%"}return g("comment","comment")}function w(e,t){var n=!1,r;while(r=e.next()){if(r=="'"&&n){t.tokenize=y;break}n=r=="'"}return g("text","strong")}function E(e,t){var n,r=t.block;return r&&e.current()?g("code","comment"):!r&&e.match(p)?(t.tokenize=y,g("code","comment")):r&&e.sol()&&e.match(h)?(t.tokenize=y,g("code","comment")):(n=e.next(),r?g("code","comment"):g("code","comment"))}function S(e,t){var n=!1,r;while(r=e.next()){if(r=="/"&&n){t.tokenize=y;break}n=r=="/"}return g("text","em")}function x(e,t){var n=!1,r;while(r=e.next()){if(r=="_"&&n){t.tokenize=y;break}n=r=="_"}return g("text","underlined")}function T(e,t){var n=!1,r;while(r=e.next()){if(r=="-"&&n){t.tokenize=y;break}n=r=="-"}return g("text","strikethrough")}function N(e,n){var r,i,s;return e.current()=="<<"?g("brace","macro"):(r=e.next(),r?r==">"&&e.peek()==">"?(e.next(),n.tokenize=y,g("brace","macro")):(e.eatWhile(/[\w\$_]/),i=e.current(),s=t.propertyIsEnumerable(i)&&t[i],s?g(s.type,s.style,i):g("macro",null,i)):(n.tokenize=y,g(r)))}var e={},t=function(){function e(e){return{type:e,style:"macro"}}return{allTags:e("allTags"),closeAll:e("closeAll"),list:e("list"),newJournal:e("newJournal"),newTiddler:e("newTiddler"),permaview:e("permaview"),saveChanges:e("saveChanges"),search:e("search"),slider:e("slider"),tabs:e("tabs"),tag:e("tag"),tagging:e("tagging"),tags:e("tags"),tiddler:e("tiddler"),timeline:e("timeline"),today:e("today"),version:e("version"),option:e("option"),"with":e("with"),filter:e("filter")}}(),n=/[\w_\-]/i,r=/^\-\-\-\-+$/,i=/^\/\*\*\*$/,s=/^\*\*\*\/$/,o=/^<<<$/,u=/^\/\/\{\{\{$/,a=/^\/\/\}\}\}$/,f=/^<!--\{\{\{-->$/,l=/^<!--\}\}\}-->$/,c=/^\{\{\{$/,h=/^\}\}\}$/,p=/.*?\}\}\}/,v,m;return{startState:function(){return{tokenize:y,indented:0,level:0}},token:function(e,t){if(e.eatSpace())return null;var n=t.tokenize(e,t);return n},electricChars:""}}),CodeMirror.defineMIME("text/x-tiddlywiki","tiddlywiki");