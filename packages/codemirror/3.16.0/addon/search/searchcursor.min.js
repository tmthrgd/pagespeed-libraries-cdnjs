!function(){function e(e,n,i,r){if(this.atOccurrence=!1,this.doc=e,null==r&&"string"==typeof n&&(r=!1),i=i?e.clipPos(i):t(0,0),this.pos={from:i,to:i},"string"!=typeof n)n.global||(n=new RegExp(n.source,n.ignoreCase?"ig":"g")),this.matches=function(i,r){if(i){n.lastIndex=0;for(var o,s,h=e.getLine(r.line).slice(0,r.ch),c=0;;){n.lastIndex=c;var l=n.exec(h);if(!l)break;if(o=l,s=o.index,c=o.index+(o[0].length||1),c==h.length)break}var f=o&&o[0].length||0;f||(0==s&&0==h.length?o=void 0:s!=e.getLine(r.line).length&&f++)}else{n.lastIndex=r.ch;var h=e.getLine(r.line),o=n.exec(h),f=o&&o[0].length||0,s=o&&o.index;s+f==h.length||f||(f=1)}return o&&f?{from:t(r.line,s),to:t(r.line,s+f),match:o}:void 0};else{r&&(n=n.toLowerCase());var o=r?function(e){return e.toLowerCase()}:function(e){return e},s=n.split("\n");this.matches=1==s.length?n.length?function(i,r){var s,h=o(e.getLine(r.line)),c=n.length;return(i?r.ch>=c&&-1!=(s=h.lastIndexOf(n,r.ch-c)):-1!=(s=h.indexOf(n,r.ch)))?{from:t(r.line,s),to:t(r.line,s+c)}:void 0}:function(){}:function(n,i){var r=i.line,h=n?s.length-1:0,c=s[h],l=o(e.getLine(r)),f=n?l.indexOf(c)+c.length:l.lastIndexOf(c);if(!(n?f>=i.ch||f!=c.length:f<=i.ch||f!=l.length-c.length))for(;;){if(n?!r:r==e.lineCount()-1)return;if(l=o(e.getLine(r+=n?-1:1)),c=s[n?--h:++h],!(h>0&&h<s.length-1)){var u=n?l.lastIndexOf(c):l.indexOf(c)+c.length;if(n?u!=l.length-c.length:u!=c.length)return;var a=t(i.line,f),g=t(r,u);return{from:n?g:a,to:n?a:g}}if(l!=c)return}}}}var t=CodeMirror.Pos;e.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function n(e){var n=t(e,0);return i.pos={from:n,to:n},i.atOccurrence=!1,!1}for(var i=this,r=this.doc.clipPos(e?this.pos.from:this.pos.to);;){if(this.pos=this.matches(e,r))return this.pos.from&&this.pos.to||console.log(this.matches,this.pos),this.atOccurrence=!0,this.pos.match||!0;if(e){if(!r.line)return n(0);r=t(r.line-1,this.doc.getLine(r.line-1).length)}else{var o=this.doc.lineCount();if(r.line==o-1)return n(o);r=t(r.line+1,0)}}},from:function(){return this.atOccurrence?this.pos.from:void 0},to:function(){return this.atOccurrence?this.pos.to:void 0},replace:function(e){if(this.atOccurrence){var n=CodeMirror.splitLines(e);this.doc.replaceRange(n,this.pos.from,this.pos.to),this.pos.to=t(this.pos.from.line+n.length-1,n[n.length-1].length+(1==n.length?this.pos.from.ch:0))}}},CodeMirror.defineExtension("getSearchCursor",function(t,n,i){return new e(this.doc,t,n,i)}),CodeMirror.defineDocExtension("getSearchCursor",function(t,n,i){return new e(this,t,n,i)})}();