!function(){"use strict";function t(t,e){return t.line==e.line&&t.ch==e.ch}function e(t){D.push(t),D.length>50&&D.shift()}function n(t){return D.length?(D[D.length-1]+=t,void 0):e(t)}function r(t){return D[D.length-(t?Math.min(t,1):1)]||""}function o(){return D.length>1&&D.pop(),r()}function i(r,o,i,l,a){null==a&&(a=r.getRange(o,i)),l&&H&&H.cm==r&&t(o,H.pos)&&r.isClean(H.gen)?n(a):e(a),r.replaceRange("",o,i,"+delete"),H=l?{cm:r,pos:o,gen:r.changeGeneration()}:null}function l(t,e,n){return t.findPosH(e,n,"char",!0)}function a(t,e,n){return t.findPosH(e,n,"word",!0)}function c(t,e,n){return t.findPosV(e,n,"line",t.doc.sel.goalColumn)}function u(t,e,n){return t.findPosV(e,n,"page",t.doc.sel.goalColumn)}function f(t,e,n){for(var r=e.line,o=t.getLine(r),i=/\S/.test(0>n?o.slice(0,e.ch):o.slice(e.ch)),l=t.firstLine(),a=t.lastLine();;){if(r+=n,l>r||r>a)return t.clipPos(U(r-n,0>n?0:null));o=t.getLine(r);var c=/\S/.test(o);if(c)i=!0;else if(i)return U(r,0)}}function s(t,e,n){for(var r=e.line,o=e.ch,i=t.getLine(e.line),l=!1;;){var a=i.charAt(o+(0>n?-1:0));if(a){if(l&&/[!?.]/.test(a))return U(r,o+(n>0?1:0));l||(l=/\w/.test(a)),o+=n}else{if(r==(0>n?t.firstLine():t.lastLine()))return U(r,o);if(i=t.getLine(r+n),!/\S/.test(i))return U(r,o);r+=n,o=0>n?i.length:0}}}function g(e,n,r){var o;if(e.findMatchingBracket&&(o=e.findMatchingBracket(n,!0))&&o.match&&(o.forward?1:-1)==r)return r>0?U(o.to.line,o.to.ch+1):o.to;for(var i=!0;;i=!1){var l=e.getTokenAt(n),a=U(n.line,0>r?l.start:l.end);if(!(i&&r>0&&l.end==n.ch)&&/\w/.test(l.string))return a;var c=e.findPosH(a,r,"char");if(t(a,c))return n;n=c}}function C(t,e){var n=t.state.emacsPrefix;return n?(S(t),"-"==n?-1:Number(n)):e?null:1}function d(t){var e="string"==typeof t?function(e){e.execCommand(t)}:t;return function(t){var n=C(t);e(t);for(var r=1;n>r;++r)e(t)}}function p(e,n,r){var o=e.getCursor(),i=C(e);0>i&&(r=-r,i=-i);for(var l=0;i>l;++l){var a=n(e,o,r);if(t(a,o))break;o=a}return o}function h(t,e){var n=function(n){n.extendSelection(p(n,t,e))};return n.motion=!0,n}function A(t,e,n){i(t,t.getCursor(),p(t,e,n),!0)}function v(t,e){return t.state.emacsPrefix?("-"!=e&&(t.state.emacsPrefix+=e),void 0):(t.state.emacsPrefix=e,t.on("keyHandled",m),t.on("inputRead",P),void 0)}function m(t,e){t.state.emacsPrefixMap||b.hasOwnProperty(e)||S(t)}function S(t){t.state.emacsPrefix=null,t.off("keyHandled",m),t.off("inputRead",P)}function P(t,e){var n=C(t);if(n>1&&"+input"==e.origin){for(var r=e.text.join("\n"),o="",i=1;n>i;++i)o+=r;t.replaceSelection(o,"end","+input")}}function L(t){t.state.emacsPrefixMap=!0,t.addKeyMap(G),t.on("keyHandled",M),t.on("inputRead",M)}function M(t,e){("string"!=typeof e||!/^\d$/.test(e)&&"Ctrl-U"!=e)&&(t.removeKeyMap(G),t.state.emacsPrefixMap=!1,t.off("keyHandled",M),t.off("inputRead",M))}function k(t){t.setCursor(t.getCursor()),t.setExtending(!0),t.on("change",function(){t.setExtending(!1)})}function y(t,e,n){t.openDialog?t.openDialog(e+': <input type="text" style="width: 10em"/>',n,{bottom:!0}):n(prompt(e,""))}function R(t,e){var n=t.getCursor(),r=t.findPosH(n,1,"word");t.replaceRange(e(t.getRange(n,r)),n,r),t.setCursor(r)}function x(t){for(var e=t.getCursor(),n=e.line,r=e.ch,o=[];n>=t.firstLine();){for(var i=t.getLine(n),l=null==r?i.length:r;l>0;){var r=i.charAt(--l);if(")"==r)o.push("(");else if("]"==r)o.push("[");else if("}"==r)o.push("{");else if(/[\(\{\[]/.test(r)&&(!o.length||o.pop()!=r))return t.extendSelection(U(n,l))}--n,r=null}}function w(t){G[t]=function(e){v(e,t)},E["Ctrl-"+t]=function(e){v(e,t)},b["Ctrl-"+t]=!0}var U=CodeMirror.Pos,D=[],H=null,b={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0},E=CodeMirror.keyMap.emacs={"Ctrl-W":function(t){i(t,t.getCursor("start"),t.getCursor("end"))},"Ctrl-K":d(function(t){var e=t.getCursor(),n=t.clipPos(U(e.line)),r=t.getRange(e,n);/\S/.test(r)||(r+="\n",n=U(e.line+1,0)),i(t,e,n,!0,r)}),"Alt-W":function(t){e(t.getSelection())},"Ctrl-Y":function(t){var e=t.getCursor();t.replaceRange(r(C(t)),e,e,"paste"),t.setSelection(e,t.getCursor())},"Alt-Y":function(t){t.replaceSelection(o())},"Ctrl-Space":k,"Ctrl-Shift-2":k,"Ctrl-F":h(l,1),"Ctrl-B":h(l,-1),Right:h(l,1),Left:h(l,-1),"Ctrl-D":function(t){A(t,l,1)},Delete:function(t){A(t,l,1)},"Ctrl-H":function(t){A(t,l,-1)},Backspace:function(t){A(t,l,-1)},"Alt-F":h(a,1),"Alt-B":h(a,-1),"Alt-D":function(t){A(t,a,1)},"Alt-Backspace":function(t){A(t,a,-1)},"Ctrl-N":h(c,1),"Ctrl-P":h(c,-1),Down:h(c,1),Up:h(c,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":h(u,-1),"Ctrl-V":h(u,1),PageUp:h(u,-1),PageDown:h(u,1),"Ctrl-Up":h(f,-1),"Ctrl-Down":h(f,1),"Alt-A":h(s,-1),"Alt-E":h(s,1),"Alt-K":function(t){A(t,s,1)},"Ctrl-Alt-K":function(t){A(t,g,1)},"Ctrl-Alt-Backspace":function(t){A(t,g,-1)},"Ctrl-Alt-F":h(g,1),"Ctrl-Alt-B":h(g,-1),"Shift-Ctrl-Alt-2":function(t){t.setSelection(p(t,g,1),t.getCursor())},"Ctrl-Alt-T":function(t){var e=g(t,t.getCursor(),-1),n=g(t,e,1),r=g(t,n,1),o=g(t,r,-1);t.replaceRange(t.getRange(o,r)+t.getRange(n,o)+t.getRange(e,n),e,r)},"Ctrl-Alt-U":d(x),"Alt-Space":function(t){for(var e=t.getCursor(),n=e.ch,r=e.ch,o=t.getLine(e.line);n&&/\s/.test(o.charAt(n-1));)--n;for(;r<o.length&&/\s/.test(o.charAt(r));)++r;t.replaceRange(" ",U(e.line,n),U(e.line,r))},"Ctrl-O":d(function(t){t.replaceSelection("\n","start")}),"Ctrl-T":d(function(t){var e=t.getCursor();e.ch<t.getLine(e.line).length&&(e=U(e.line,e.ch+1));var n=t.findPosH(e,-2,"char"),r=t.getRange(n,e);2==r.length&&(t.setSelection(n,e),t.replaceSelection(r.charAt(1)+r.charAt(0),"end"))}),"Alt-C":d(function(t){R(t,function(t){var e=t.search(/\w/);return-1==e?t:t.slice(0,e)+t.charAt(e).toUpperCase()+t.slice(e+1).toLowerCase()})}),"Alt-U":d(function(t){R(t,function(t){return t.toUpperCase()})}),"Alt-L":d(function(t){R(t,function(t){return t.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":d("undo"),"Shift-Ctrl--":d("undo"),"Ctrl-Z":d("undo"),"Cmd-Z":d("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findNext","Ctrl-R":"findPrev","Ctrl-G":"clearSearch","Shift-Alt-5":"replace","Alt-/":"autocomplete","Ctrl-J":"newlineAndIndent",Enter:!1,Tab:"indentAuto","Alt-G":function(t){t.setOption("keyMap","emacs-Alt-G")},"Ctrl-X":function(t){t.setOption("keyMap","emacs-Ctrl-X")},"Ctrl-Q":function(t){t.setOption("keyMap","emacs-Ctrl-Q")},"Ctrl-U":L};CodeMirror.keyMap["emacs-Ctrl-X"]={Tab:function(t){t.indentSelection(C(t,!0)||t.getOption("indentUnit"))},"Ctrl-X":function(t){t.setSelection(t.getCursor("head"),t.getCursor("anchor"))},"Ctrl-S":"save","Ctrl-W":"save",S:"saveAll",F:"open",U:d("undo"),K:"close",Delete:function(t){i(t,t.getCursor(),sentenceEnd(t,1),!0)},auto:"emacs",nofallthrough:!0,disableInput:!0},CodeMirror.keyMap["emacs-Alt-G"]={G:function(t){var e=C(t,!0);return null!=e&&e>0?t.setCursor(e-1):(y(t,"Goto line",function(e){var n;e&&!isNaN(n=Number(e))&&0|n==n&&n>0&&t.setCursor(n-1)}),void 0)},auto:"emacs",nofallthrough:!0,disableInput:!0},CodeMirror.keyMap["emacs-Ctrl-Q"]={Tab:d("insertTab"),auto:"emacs",nofallthrough:!0};for(var G={"Ctrl-G":S},B=0;10>B;++B)w(String(B));w("-")}();