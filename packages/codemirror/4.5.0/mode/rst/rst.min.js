!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../python/python"),require("../stex/stex"),require("../../addon/mode/overlay")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../python/python","../stex/stex","../../addon/mode/overlay"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("rst",function(t,a){var c=/^\*\*[^\*\s](?:[^\*]*[^\*\s])?\*\*/,n=/^\*[^\*\s](?:[^\*]*[^\*\s])?\*/,r=/^``[^`\s](?:[^`]*[^`\s])``/,o=/^(?:[\d]+(?:[\.,]\d+)*)/,m=/^(?:\s\+[\d]+(?:[\.,]\d+)*)/,s=/^(?:\s\-[\d]+(?:[\.,]\d+)*)/,i="[Hh][Tt][Tt][Pp][Ss]?://",h="(?:[\\d\\w.-]+)\\.(?:\\w{2,6})",l="(?:/[\\d\\w\\#\\%\\&\\-\\.\\,\\/\\:\\=\\?\\~]+)*",u=new RegExp("^"+i+h+l),p={token:function(e){if(e.match(c)&&e.match(/\W+|$/,!1))return"strong";if(e.match(n)&&e.match(/\W+|$/,!1))return"em";if(e.match(r)&&e.match(/\W+|$/,!1))return"string-2";if(e.match(o))return"number";if(e.match(m))return"positive";if(e.match(s))return"negative";if(e.match(u))return"link";for(;!(null==e.next()||e.match(c,!1)||e.match(n,!1)||e.match(r,!1)||e.match(o,!1)||e.match(m,!1)||e.match(s,!1)||e.match(u,!1)););return null}},d=e.getMode(t,a.backdrop||"rst-base");return e.overlayMode(d,p,!0)},"python","stex"),e.defineMode("rst-base",function(t){function a(e){var t=Array.prototype.slice.call(arguments,1);return e.replace(/{(\d+)}/g,function(e,a){return"undefined"!=typeof t[a]?t[a]:e})}function c(e){this.message=e}function n(e,t){if(!e)throw new c(t);return e}function r(t,a){var c=null;if(t.sol()&&t.match(Y,!1))u(a,h,{mode:f,local:e.startState(f)});else if(t.sol()&&t.match(M))u(a,o),c="meta";else if(t.sol()&&t.match($))u(a,r),c="header";else if(d(a)==B||t.match(B,!1))switch(p(a)){case 0:u(a,r,l(B,1)),n(t.match(/^:/)),c="meta";break;case 1:u(a,r,l(B,2)),n(t.match(E)),c="keyword",t.current().match(/^(?:math|latex)/)&&(a.tmp_stex=!0);break;case 2:u(a,r,l(B,3)),n(t.match(/^:`/)),c="meta";break;case 3:if(a.tmp_stex&&(a.tmp_stex=void 0,a.tmp={mode:x,local:e.startState(x)}),a.tmp){if("`"==t.peek()){u(a,r,l(B,4)),a.tmp=void 0;break}c=a.tmp.mode.token(t,a.tmp.local);break}u(a,r,l(B,4)),n(t.match(S)),c="string";break;case 4:u(a,r,l(B,5)),n(t.match(/^`/)),c="meta";break;case 5:u(a,r,l(B,6)),n(t.match(g));break;default:u(a,r),n(""==t.current())}else if(d(a)==D||t.match(D,!1))switch(p(a)){case 0:u(a,r,l(D,1)),n(t.match(/^`/)),c="meta";break;case 1:u(a,r,l(D,2)),n(t.match(S)),c="string";break;case 2:u(a,r,l(D,3)),n(t.match(/^`:/)),c="meta";break;case 3:u(a,r,l(D,4)),n(t.match(E)),c="keyword";break;case 4:u(a,r,l(D,5)),n(t.match(/^:/)),c="meta";break;case 5:u(a,r,l(D,6)),n(t.match(g));break;default:u(a,r),n(""==t.current())}else if(d(a)==F||t.match(F,!1))switch(p(a)){case 0:u(a,r,l(F,1)),n(t.match(/^:/)),c="meta";break;case 1:u(a,r,l(F,2)),n(t.match(E)),c="keyword";break;case 2:u(a,r,l(F,3)),n(t.match(/^:/)),c="meta";break;case 3:u(a,r,l(F,4)),n(t.match(g));break;default:u(a,r),n(""==t.current())}else if(d(a)==I||t.match(I,!1))switch(p(a)){case 0:u(a,r,l(I,1)),n(t.match(K)),c="variable-2";break;case 1:u(a,r,l(I,2)),t.match(/^_?_?/)&&(c="link");break;default:u(a,r),n(""==t.current())}else if(t.match(C))u(a,r),c="quote";else if(t.match(H))u(a,r),c="quote";else if(t.match(P))u(a,r),(!t.peek()||t.peek().match(/^\W$/))&&(c="link");else if(d(a)==z||t.match(z,!1))switch(p(a)){case 0:!t.peek()||t.peek().match(/^\W$/)?u(a,r,l(z,1)):t.match(z);break;case 1:u(a,r,l(z,2)),n(t.match(/^`/)),c="link";break;case 2:u(a,r,l(z,3)),n(t.match(S));break;case 3:u(a,r,l(z,4)),n(t.match(/^`_/)),c="link";break;default:u(a,r),n(""==t.current())}else t.match(X)?u(a,s):t.next()&&u(a,r);return c}function o(t,a){var c=null;if(d(a)==T||t.match(T,!1))switch(p(a)){case 0:u(a,o,l(T,1)),n(t.match(K)),c="variable-2";break;case 1:u(a,o,l(T,2)),n(t.match(L));break;case 2:u(a,o,l(T,3)),n(t.match(N)),c="keyword";break;case 3:u(a,o,l(T,4)),n(t.match(O)),c="meta";break;default:u(a,r),n(""==t.current())}else if(d(a)==q||t.match(q,!1))switch(p(a)){case 0:u(a,o,l(q,1)),n(t.match(G)),c="keyword",t.current().match(/^(?:math|latex)/)?a.tmp_stex=!0:t.current().match(/^python/)&&(a.tmp_py=!0);break;case 1:u(a,o,l(q,2)),n(t.match(J)),c="meta",(t.match(/^latex\s*$/)||a.tmp_stex)&&(a.tmp_stex=void 0,u(a,h,{mode:x,local:e.startState(x)}));break;case 2:u(a,o,l(q,3)),(t.match(/^python\s*$/)||a.tmp_py)&&(a.tmp_py=void 0,u(a,h,{mode:f,local:e.startState(f)}));break;default:u(a,r),n(""==t.current())}else if(d(a)==W||t.match(W,!1))switch(p(a)){case 0:u(a,o,l(W,1)),n(t.match(Q)),n(t.match(U)),c="link";break;case 1:u(a,o,l(W,2)),n(t.match(V)),c="meta";break;default:u(a,r),n(""==t.current())}else t.match(j)?(u(a,r),c="quote"):t.match(A)?(u(a,r),c="quote"):(t.eatSpace(),t.eol()?u(a,r):(t.skipToEnd(),u(a,m),c="comment"));return c}function m(e,t){return i(e,t,"comment")}function s(e,t){return i(e,t,"meta")}function i(e,t,a){return e.eol()||e.eatSpace()?(e.skipToEnd(),a):(u(t,r),null)}function h(e,t){return t.ctx.mode&&t.ctx.local?e.sol()?(e.eatSpace()||u(t,r),null):t.ctx.mode.token(e,t.ctx.local):(u(t,r),null)}function l(e,t,a,c){return{phase:e,stage:t,mode:a,local:c}}function u(e,t,a){e.tok=t,e.ctx=a||{}}function p(e){return e.ctx.stage||0}function d(e){return e.ctx.phase}c.prototype.toString=function(){return"AssertException: "+this.message};var f=e.getMode(t,"python"),x=e.getMode(t,"stex"),k="\\s+",w="(?:\\s*|\\W|$)",g=new RegExp(a("^{0}",w)),b="(?:[^\\W\\d_](?:[\\w!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",E=new RegExp(a("^{0}",b)),y="(?:[^\\W\\d_](?:[\\w\\s!\"#$%&'()\\*\\+,\\-\\./:;<=>\\?]*[^\\W_])?)",R=a("(?:{0}|`{1}`)",b,y),_="(?:[^\\s\\|](?:[^\\|]*[^\\s\\|])?)",v="(?:[^\\`]+)",S=new RegExp(a("^{0}",v)),$=new RegExp("^([!'#$%&\"()*+,-./:;<=>?@\\[\\\\\\]^_`{|}~])\\1{3,}\\s*$"),M=new RegExp(a("^\\.\\.{0}",k)),W=new RegExp(a("^_{0}:{1}|^__:{1}",R,w)),q=new RegExp(a("^{0}::{1}",R,w)),T=new RegExp(a("^\\|{0}\\|{1}{2}::{3}",_,k,R,w)),j=new RegExp(a("^\\[(?:\\d+|#{0}?|\\*)]{1}",R,w)),A=new RegExp(a("^\\[{0}\\]{1}",R,w)),I=new RegExp(a("^\\|{0}\\|",_)),C=new RegExp(a("^\\[(?:\\d+|#{0}?|\\*)]_",R)),H=new RegExp(a("^\\[{0}\\]_",R)),P=new RegExp(a("^{0}__?",R)),z=new RegExp(a("^`{0}`_",v)),B=new RegExp(a("^:{0}:`{1}`{2}",b,v,w)),D=new RegExp(a("^`{1}`:{0}:{2}",b,v,w)),F=new RegExp(a("^:{0}:{1}",b,w)),G=new RegExp(a("^{0}",R)),J=new RegExp(a("^::{0}",w)),K=new RegExp(a("^\\|{0}\\|",_)),L=new RegExp(a("^{0}",k)),N=new RegExp(a("^{0}",R)),O=new RegExp(a("^::{0}",w)),Q=new RegExp("^_"),U=new RegExp(a("^{0}|_",R)),V=new RegExp(a("^:{0}",w)),X=new RegExp("^::\\s*$"),Y=new RegExp("^\\s+(?:>>>|In \\[\\d+\\]:)\\s");return{startState:function(){return{tok:r,ctx:l(void 0,0)}},copyState:function(t){var a=t.ctx,c=t.tmp;return a.local&&(a={mode:a.mode,local:e.copyState(a.mode,a.local)}),c&&(c={mode:c.mode,local:e.copyState(c.mode,c.local)}),{tok:t.tok,ctx:a,tmp:c}},innerMode:function(e){return e.tmp?{state:e.tmp.local,mode:e.tmp.mode}:e.ctx.mode?{state:e.ctx.local,mode:e.ctx.mode}:null},token:function(e,t){return t.tok(e,t)}}},"python","stex"),e.defineMIME("text/x-rst","rst")});