!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror"),require("../fold/xml-fold")):"function"==typeof define&&define.amd?define(["../../lib/codemirror","../fold/xml-fold"],e):e(CodeMirror)}(function(e){function t(t){if(t.getOption("disableInput"))return e.Pass;for(var n=t.listSelections(),l=[],s=0;s<n.length;s++){if(!n[s].empty())return e.Pass;var c=n[s].head,g=t.getTokenAt(c),f=e.innerMode(t.getMode(),g.state),d=f.state;if("xml"!=f.mode.name||!d.tagName)return e.Pass;var u=t.getOption("autoCloseTags"),h="html"==f.mode.configuration,m="object"==typeof u&&u.dontCloseTags||h&&a,p="object"==typeof u&&u.indentTags||h&&i,v=d.tagName;g.end>c.ch&&(v=v.slice(0,v.length-g.end+c.ch));var b=v.toLowerCase();if(!v||"string"==g.type&&(g.end!=c.ch||!/[\"\']/.test(g.string.charAt(g.string.length-1))||1==g.string.length)||"tag"==g.type&&"closeTag"==d.type||g.string.indexOf("/")==g.string.length-1||m&&o(m,b)>-1||r(t,v,c,d,!0))return e.Pass;var y=p&&o(p,b)>-1;l[s]={indent:y,text:">"+(y?"\n\n":"")+"</"+v+">",newPos:y?e.Pos(c.line+1,0):e.Pos(c.line,c.ch+1)}}for(var s=n.length-1;s>=0;s--){var x=l[s];t.replaceRange(x.text,n[s].head,n[s].anchor,"+insert");var P=t.listSelections().slice(0);P[s]={head:x.newPos,anchor:x.newPos},t.setSelections(P),x.indent&&(t.indentLine(x.newPos.line,null,!0),t.indentLine(x.newPos.line+1,null,!0))}}function n(t){if(t.getOption("disableInput"))return e.Pass;for(var n=t.listSelections(),o=[],a=0;a<n.length;a++){if(!n[a].empty())return e.Pass;var i=n[a].head,l=t.getTokenAt(i),s=e.innerMode(t.getMode(),l.state),c=s.state;if("string"==l.type||"<"!=l.string.charAt(0)||l.start!=i.ch-1||"xml"!=s.mode.name||!c.context||!c.context.tagName||r(t,c.context.tagName,i,c))return e.Pass;o[a]="/"+c.context.tagName+">"}t.replaceSelections(o),n=t.listSelections();for(var a=0;a<n.length;a++)(a==n.length-1||n[a].head.line<n[a+1].head.line)&&t.indentLine(n[a].head.line)}function o(e,t){if(e.indexOf)return e.indexOf(t);for(var n=0,o=e.length;o>n;++n)if(e[n]==t)return n;return-1}function r(t,n,o,r,a){if(!e.scanForClosingTag)return!1;var i=Math.min(t.lastLine()+1,o.line+500),l=e.scanForClosingTag(t,o,null,i);if(!l||l.tag!=n)return!1;for(var s=r.context,c=a?1:0;s&&s.tagName==n;s=s.prev)++c;o=l.to;for(var g=1;c>g;g++){var f=e.scanForClosingTag(t,o,null,i);if(!f||f.tag!=n)return!1;o=f.to}return!0}e.defineOption("autoCloseTags",!1,function(o,r,a){if(a!=e.Init&&a&&o.removeKeyMap("autoCloseTags"),r){var i={name:"autoCloseTags"};("object"!=typeof r||r.whenClosing)&&(i["'/'"]=function(e){return n(e)}),("object"!=typeof r||r.whenOpening)&&(i["'>'"]=function(e){return t(e)}),o.addKeyMap(i)}});var a=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],i=["applet","blockquote","body","button","div","dl","fieldset","form","frameset","h1","h2","h3","h4","h5","h6","head","html","iframe","layer","legend","object","ol","p","select","table","ul"]});