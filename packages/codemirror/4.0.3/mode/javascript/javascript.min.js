// TODO actually recognize syntax of TypeScript constructs
(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){"use strict";e.defineMode("javascript",function(t,n){function c(e){var t=!1,n,r=!1;while((n=e.next())!=null){if(!t){if(n=="/"&&!r)return;n=="["?r=!0:r&&n=="]"&&(r=!1)}t=!t&&n=="\\"}}function d(e,t,n){return h=e,p=n,t}function v(e,t){var n=e.next();if(n=='"'||n=="'")return t.tokenize=m(n),t.tokenize(e,t);if(n=="."&&e.match(/^\d+(?:[eE][+\-]?\d+)?/))return d("number","number");if(n=="."&&e.match(".."))return d("spread","meta");if(/[\[\]{}\(\),;\:\.]/.test(n))return d(n);if(n=="="&&e.eat(">"))return d("=>","operator");if(n=="0"&&e.eat(/x/i))return e.eatWhile(/[\da-f]/i),d("number","number");if(/\d/.test(n))return e.match(/^\d*(?:\.\d*)?(?:[eE][+\-]?\d+)?/),d("number","number");if(n=="/")return e.eat("*")?(t.tokenize=g,g(e,t)):e.eat("/")?(e.skipToEnd(),d("comment","comment")):t.lastType=="operator"||t.lastType=="keyword c"||t.lastType=="sof"||/^[\[{}\(,;:]$/.test(t.lastType)?(c(e),e.eatWhile(/[gimy]/),d("regexp","string-2")):(e.eatWhile(f),d("operator","operator",e.current()));if(n=="`")return t.tokenize=y,y(e,t);if(n=="#")return e.skipToEnd(),d("error","error");if(f.test(n))return e.eatWhile(f),d("operator","operator",e.current());e.eatWhile(/[\w\$_]/);var r=e.current(),i=a.propertyIsEnumerable(r)&&a[r];return i&&t.lastType!="."?d(i.type,i.style,r):d("variable","variable",r)}function m(e){return function(t,n){var r=!1,i;if(s&&t.peek()=="@"&&t.match(l))return n.tokenize=v,d("jsonld-keyword","meta");while((i=t.next())!=null){if(i==e&&!r)break;r=!r&&i=="\\"}return r||(n.tokenize=v),d("string","string")}}function g(e,t){var n=!1,r;while(r=e.next()){if(r=="/"&&n){t.tokenize=v;break}n=r=="*"}return d("comment","comment")}function y(e,t){var n=!1,r;while((r=e.next())!=null){if(!n&&(r=="`"||r=="$"&&e.eat("{"))){t.tokenize=v;break}n=!n&&r=="\\"}return d("quasi","string-2",e.current())}function w(e,t){t.fatArrowAt&&(t.fatArrowAt=null);var n=e.string.indexOf("=>",e.start);if(n<0)return;var r=0,i=!1;for(var s=n-1;s>=0;--s){var o=e.string.charAt(s),u=b.indexOf(o);if(u>=0&&u<3){if(!r){++s;break}if(--r==0)break}else if(u>=3&&u<6)++r;else if(/[$\w]/.test(o))i=!0;else if(i&&!r){++s;break}}i&&!r&&(t.fatArrowAt=s)}function S(e,t,n,r,i,s){this.indented=e,this.column=t,this.type=n,this.prev=i,this.info=s,r!=null&&(this.align=r)}function x(e,t){for(var n=e.localVars;n;n=n.next)if(n.name==t)return!0;for(var r=e.context;r;r=r.prev)for(var n=r.vars;n;n=n.next)if(n.name==t)return!0}function T(e,t,n,r,i){var s=e.cc;N.state=e,N.stream=i,N.marked=null,N.cc=s,e.lexical.hasOwnProperty("align")||(e.lexical.align=!0);for(;;){var u=s.length?s.pop():o?B:H;if(u(n,r)){while(s.length&&s[s.length-1].lex)s.pop()();return N.marked?N.marked:n=="variable"&&x(e,r)?"variable-2":t}}}function C(){for(var e=arguments.length-1;e>=0;e--)N.cc.push(arguments[e])}function k(){return C.apply(null,arguments),!0}function L(e){function t(t){for(var n=t;n;n=n.next)if(n.name==e)return!0;return!1}var r=N.state;if(r.context){N.marked="def";if(t(r.localVars))return;r.localVars={name:e,next:r.localVars}}else{if(t(r.globalVars))return;n.globalVars&&(r.globalVars={name:e,next:r.globalVars})}}function O(){N.state.context={prev:N.state.context,vars:N.state.localVars},N.state.localVars=A}function M(){N.state.localVars=N.state.context.vars,N.state.context=N.state.context.prev}function _(e,t){var n=function(){var n=N.state,r=n.indented;n.lexical.type=="stat"&&(r=n.lexical.indented),n.lexical=new S(r,N.stream.column(),e,null,n.lexical,t)};return n.lex=!0,n}function D(){var e=N.state;e.lexical.prev&&(e.lexical.type==")"&&(e.indented=e.lexical.indented),e.lexical=e.lexical.prev)}function P(e){function t(n){return n==e?k():e==";"?C():k(t)}return t}function H(e,t){return e=="var"?k(_("vardef",t.length),rt,P(";"),D):e=="keyword a"?k(_("form"),B,H,D):e=="keyword b"?k(_("form"),H,D):e=="{"?k(_("}"),et,D):e==";"?k():e=="if"?k(_("form"),B,H,D,at):e=="function"?k(dt):e=="for"?k(_("form"),ft,H,D):e=="variable"?k(_("stat"),$):e=="switch"?k(_("form"),B,_("}","switch"),P("{"),et,D,D):e=="case"?k(B,P(":")):e=="default"?k(P(":")):e=="catch"?k(_("form"),O,P("("),vt,P(")"),H,D,M):e=="module"?k(_("form"),O,bt,M,D):e=="class"?k(_("form"),mt,yt,D):e=="export"?k(_("form"),wt,D):e=="import"?k(_("form"),Et,D):C(_("stat"),B,P(";"),D)}function B(e){return F(e,!1)}function j(e){return F(e,!0)}function F(e,t){if(N.state.fatArrowAt==N.stream.start){var n=t?V:X;if(e=="(")return k(O,_(")"),Y(it,")"),D,P("=>"),n,M);if(e=="variable")return C(O,it,P("=>"),n,M)}var r=t?U:R;return E.hasOwnProperty(e)?k(r):e=="function"?k(dt):e=="keyword c"?k(t?q:I):e=="("?k(_(")"),I,Ct,P(")"),D,r):e=="operator"||e=="spread"?k(t?j:B):e=="["?k(_("]"),Tt,D,r):e=="{"?Z(K,"}",null,r):k()}function I(e){return e.match(/[;\}\)\],]/)?C():C(B)}function q(e){return e.match(/[;\}\)\],]/)?C():C(j)}function R(e,t){return e==","?k(B):U(e,t,!1)}function U(e,t,n){var r=n==0?R:U,i=n==0?B:j;if(t=="=>")return k(O,n?V:X,M);if(e=="operator")return/\+\+|--/.test(t)?k(r):t=="?"?k(B,P(":"),i):k(i);if(e=="quasi")return N.cc.push(r),z(t);if(e==";")return;if(e=="(")return Z(j,")","call",r);if(e==".")return k(J,r);if(e=="[")return k(_("]"),I,P("]"),D,r)}function z(e){return e.slice(e.length-2)!="${"?k():k(B,W)}function W(e){if(e=="}")return N.marked="string-2",N.state.tokenize=y,k()}function X(e){return w(N.stream,N.state),e=="{"?C(H):C(B)}function V(e){return w(N.stream,N.state),e=="{"?C(H):C(j)}function $(e){return e==":"?k(D,H):C(R,P(";"),D)}function J(e){if(e=="variable")return N.marked="property",k()}function K(e,t){if(e=="variable"){N.marked="property";if(t=="get"||t=="set")return k(Q)}else if(e=="number"||e=="string")N.marked=s?"property":e+" property";else if(e=="[")return k(B,P("]"),G);if(E.hasOwnProperty(e))return k(G)}function Q(e){return e!="variable"?C(G):(N.marked="property",k(dt))}function G(e){if(e==":")return k(j);if(e=="(")return C(dt)}function Y(e,t){function n(r){if(r==","){var i=N.state.lexical;return i.info=="call"&&(i.pos=(i.pos||0)+1),k(e,n)}return r==t?k():k(P(t))}return function(r){return r==t?k():C(e,n)}}function Z(e,t,n){for(var r=3;r<arguments.length;r++)N.cc.push(arguments[r]);return k(_(t,n),Y(e,t),D)}function et(e){return e=="}"?k():C(H,et)}function tt(e){if(u&&e==":")return k(nt)}function nt(e){if(e=="variable")return N.marked="variable-3",k()}function rt(){return C(it,tt,ot,ut)}function it(e,t){if(e=="variable")return L(t),k();if(e=="[")return Z(it,"]");if(e=="{")return Z(st,"}")}function st(e,t){return e=="variable"&&!N.stream.match(/^\s*:/,!1)?(L(t),k(ot)):(e=="variable"&&(N.marked="property"),k(P(":"),it,ot))}function ot(e,t){if(t=="=")return k(j)}function ut(e){if(e==",")return k(rt)}function at(e,t){if(e=="keyword b"&&t=="else")return k(_("form"),H,D)}function ft(e){if(e=="(")return k(_(")"),lt,P(")"),D)}function lt(e){return e=="var"?k(rt,P(";"),ht):e==";"?k(ht):e=="variable"?k(ct):C(B,P(";"),ht)}function ct(e,t){return t=="in"||t=="of"?(N.marked="keyword",k(B)):k(R,ht)}function ht(e,t){return e==";"?k(pt):t=="in"||t=="of"?(N.marked="keyword",k(B)):C(B,P(";"),pt)}function pt(e){e!=")"&&k(B)}function dt(e,t){if(t=="*")return N.marked="keyword",k(dt);if(e=="variable")return L(t),k(dt);if(e=="(")return k(O,_(")"),Y(vt,")"),D,H,M)}function vt(e){return e=="spread"?k(vt):C(it,tt)}function mt(e,t){if(e=="variable")return L(t),k(gt)}function gt(e,t){if(t=="extends")return k(B)}function yt(e){if(e=="{")return Z(K,"}")}function bt(e,t){if(e=="string")return k(H);if(e=="variable")return L(t),k(xt)}function wt(e,t){return t=="*"?(N.marked="keyword",k(xt,P(";"))):t=="default"?(N.marked="keyword",k(B,P(";"))):C(H)}function Et(e){return e=="string"?k():C(St,xt)}function St(e,t){return e=="{"?Z(St,"}"):(e=="variable"&&L(t),k())}function xt(e,t){if(t=="from")return N.marked="keyword",k(B)}function Tt(e){return e=="]"?k():C(j,Nt)}function Nt(e){return e=="for"?C(Ct,P("]")):e==","?k(Y(j,"]")):C(Y(j,"]"))}function Ct(e){if(e=="for")return k(ft,Ct);if(e=="if")return k(B,Ct)}var r=t.indentUnit,i=n.statementIndent,s=n.jsonld,o=n.json||s,u=n.typescript,a=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),n=e("keyword b"),r=e("keyword c"),i=e("operator"),s={type:"atom",style:"atom"},o={"if":e("if"),"while":t,"with":t,"else":n,"do":n,"try":n,"finally":n,"return":r,"break":r,"continue":r,"new":r,"delete":r,"throw":r,"debugger":r,"var":e("var"),"const":e("var"),let:e("var"),"function":e("function"),"catch":e("catch"),"for":e("for"),"switch":e("switch"),"case":e("case"),"default":e("default"),"in":i,"typeof":i,"instanceof":i,"true":s,"false":s,"null":s,"undefined":s,NaN:s,Infinity:s,"this":e("this"),module:e("module"),"class":e("class"),"super":e("atom"),yield:r,"export":e("export"),"import":e("import"),"extends":r};if(u){var a={type:"variable",style:"variable-3"},f={"interface":e("interface"),"extends":e("extends"),constructor:e("constructor"),"public":e("public"),"private":e("private"),"protected":e("protected"),"static":e("static"),string:a,number:a,bool:a,any:a};for(var l in f)o[l]=f[l]}return o}(),f=/[+\-*&%=<>!?|~^]/,l=/^@(context|id|value|language|type|container|list|set|reverse|index|base|vocab|graph)"/,h,p,b="([{}])",E={atom:!0,number:!0,variable:!0,string:!0,regexp:!0,"this":!0,"jsonld-keyword":!0},N={state:null,column:null,marked:null,cc:null},A={name:"this",next:{name:"arguments"}};return D.lex=!0,{startState:function(e){var t={tokenize:v,lastType:"sof",cc:[],lexical:new S((e||0)-r,0,"block",!1),localVars:n.localVars,context:n.localVars&&{vars:n.localVars},indented:0};return n.globalVars&&typeof n.globalVars=="object"&&(t.globalVars=n.globalVars),t},token:function(e,t){e.sol()&&(t.lexical.hasOwnProperty("align")||(t.lexical.align=!1),t.indented=e.indentation(),w(e,t));if(t.tokenize!=g&&e.eatSpace())return null;var n=t.tokenize(e,t);return h=="comment"?n:(t.lastType=h!="operator"||p!="++"&&p!="--"?h:"incdec",T(t,n,h,p,e))},indent:function(t,s){if(t.tokenize==g)return e.Pass;if(t.tokenize!=v)return 0;var o=s&&s.charAt(0),u=t.lexical;for(var a=t.cc.length-1;a>=0;--a){var f=t.cc[a];if(f==D)u=u.prev;else if(f!=at)break}u.type=="stat"&&o=="}"&&(u=u.prev),i&&u.type==")"&&u.prev.type=="stat"&&(u=u.prev);var l=u.type,c=o==l;return l=="vardef"?u.indented+(t.lastType=="operator"||t.lastType==","?u.info+1:0):l=="form"&&o=="{"?u.indented:l=="form"?u.indented+r:l=="stat"?u.indented+(t.lastType=="operator"||t.lastType==","?i||r:0):u.info=="switch"&&!c&&n.doubleIndentSwitch!=0?u.indented+(/^(?:case|default)\b/.test(s)?r:2*r):u.align?u.column+(c?0:1):u.indented+(c?0:r)},electricChars:":{}",blockCommentStart:o?null:"/*",blockCommentEnd:o?null:"*/",lineComment:o?null:"//",fold:"brace",helperType:o?"json":"javascript",jsonldMode:s,jsonMode:o}}),e.defineMIME("text/javascript","javascript"),e.defineMIME("text/ecmascript","javascript"),e.defineMIME("application/javascript","javascript"),e.defineMIME("application/ecmascript","javascript"),e.defineMIME("application/json",{name:"javascript",json:!0}),e.defineMIME("application/x-json",{name:"javascript",json:!0}),e.defineMIME("application/ld+json",{name:"javascript",jsonld:!0}),e.defineMIME("text/typescript",{name:"javascript",typescript:!0}),e.defineMIME("application/typescript",{name:"javascript",typescript:!0})});