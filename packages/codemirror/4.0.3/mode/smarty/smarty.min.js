/**
 * Smarty 2 and 3 mode.
 */(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){"use strict";e.defineMode("smarty",function(e){var t={rightDelimiter:"}",leftDelimiter:"{",smartyVersion:2};e.hasOwnProperty("leftDelimiter")&&(t.leftDelimiter=e.leftDelimiter),e.hasOwnProperty("rightDelimiter")&&(t.rightDelimiter=e.rightDelimiter),e.hasOwnProperty("smartyVersion")&&e.smartyVersion===3&&(t.smartyVersion=3);var n=["debug","extends","function","include","literal"],r,i={operatorChars:/[+\-*&%=<>!?]/,validIdentifier:/[a-zA-Z0-9_]/,stringChar:/['"]/},s={cont:function(e,t){return r=t,e},chain:function(e,t,n){return t.tokenize=n,n(e,t)}},o={tokenizer:function(e,n){if(e.match(t.leftDelimiter,!0)){if(e.eat("*"))return s.chain(e,n,o.inBlock("comment","*"+t.rightDelimiter));n.depth++;var i=e.eol(),u=/\s/.test(e.peek());return t.smartyVersion===3&&t.leftDelimiter==="{"&&(i||u)?(n.depth--,null):(n.tokenize=o.smarty,r="startTag","tag")}return e.next(),null},smarty:function(e,u){if(e.match(t.rightDelimiter,!0))return t.smartyVersion===3?(u.depth--,u.depth<=0&&(u.tokenize=o.tokenizer)):u.tokenize=o.tokenizer,s.cont("tag",null);if(e.match(t.leftDelimiter,!0))return u.depth++,s.cont("tag","startTag");var a=e.next();if(a=="$")return e.eatWhile(i.validIdentifier),s.cont("variable-2","variable");if(a=="|")return s.cont("operator","pipe");if(a==".")return s.cont("operator","property");if(i.stringChar.test(a))return u.tokenize=o.inAttribute(a),s.cont("string","string");if(i.operatorChars.test(a))return e.eatWhile(i.operatorChars),s.cont("operator","operator");if(a=="["||a=="]")return s.cont("bracket","bracket");if(a=="("||a==")")return s.cont("bracket","operator");if(/\d/.test(a))return e.eatWhile(/\d/),s.cont("number","number");if(u.last=="variable"){if(a=="@")return e.eatWhile(i.validIdentifier),s.cont("property","property");if(a=="|")return e.eatWhile(i.validIdentifier),s.cont("qualifier","modifier")}else{if(u.last=="pipe")return e.eatWhile(i.validIdentifier),s.cont("qualifier","modifier");if(u.last=="whitespace")return e.eatWhile(i.validIdentifier),s.cont("attribute","modifier")}if(u.last=="property")return e.eatWhile(i.validIdentifier),s.cont("property",null);if(/\s/.test(a))return r="whitespace",null;var f="";a!="/"&&(f+=a);var l=null;while(l=e.eat(i.validIdentifier))f+=l;for(var c=0,h=n.length;c<h;c++)if(n[c]==f)return s.cont("keyword","keyword");return/\s/.test(a)?null:s.cont("tag","tag")},inAttribute:function(e){return function(t,n){var r=null,i=null;while(!t.eol()){i=t.peek();if(t.next()==e&&r!=="\\"){n.tokenize=o.smarty;break}r=i}return"string"}},inBlock:function(e,t){return function(n,r){while(!n.eol()){if(n.match(t)){r.tokenize=o.tokenizer;break}n.next()}return e}}};return{startState:function(){return{tokenize:o.tokenizer,mode:"smarty",last:null,depth:0}},token:function(e,t){var n=t.tokenize(e,t);return t.last=r,n},electricChars:""}}),e.defineMIME("text/x-smarty","smarty")});