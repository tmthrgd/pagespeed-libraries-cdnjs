(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){"use strict";e.defineMode("xquery",function(){function r(e,r,i){return t=e,n=i,r}function i(e,t,n){return t.tokenize=n,n(e,t)}function s(t,n){var s=t.next(),l=!1,v=y(t);if(s=="<"){if(t.match("!--",!0))return i(t,n,c);if(t.match("![CDATA",!1))return n.tokenize=h,r("tag","tag");if(t.match("?",!1))return i(t,n,p);var g=t.eat("/");t.eatSpace();var b="",S;while(S=t.eat(/[^\s\u00a0=<>\"\'\/?]/))b+=S;return i(t,n,f(b,g))}if(s=="{")return w(n,{type:"codeblock"}),r("",null);if(s=="}")return E(n),r("",null);if(d(n))return s==">"?r("tag","tag"):s=="/"&&t.eat(">")?(E(n),r("tag","tag")):r("word","variable");if(/\d/.test(s))return t.match(/^\d*(?:\.\d*)?(?:E[+\-]?\d+)?/),r("number","atom");if(s==="("&&t.eat(":"))return w(n,{type:"comment"}),i(t,n,o);if(!!v||s!=='"'&&s!=="'"){if(s==="$")return i(t,n,a);if(s===":"&&t.eat("="))return r("operator","keyword");if(s==="(")return w(n,{type:"paren"}),r("",null);if(s===")")return E(n),r("",null);if(s==="[")return w(n,{type:"bracket"}),r("",null);if(s==="]")return E(n),r("",null);var x=e.propertyIsEnumerable(s)&&e[s];if(v&&s==='"')while(t.next()!=='"');if(v&&s==="'")while(t.next()!=="'");x||t.eatWhile(/[\w\$_-]/);var T=t.eat(":");!t.eat(":")&&T&&t.eatWhile(/[\w\$_-]/),t.match(/^[ \t]*\(/,!1)&&(l=!0);var N=t.current();return x=e.propertyIsEnumerable(N)&&e[N],l&&!x&&(x={type:"function_call",style:"variable def"}),m(n)?(E(n),r("word","variable",N)):((N=="element"||N=="attribute"||x.type=="axis_specifier")&&w(n,{type:"xmlconstructor"}),x?r(x.type,x.style,N):r("word","variable",N))}return i(t,n,u(s))}function o(e,t){var n=!1,i=!1,s=0,o;while(o=e.next()){if(o==")"&&n){if(!(s>0)){E(t);break}s--}else o==":"&&i&&s++;n=o==":",i=o=="("}return r("comment","comment")}function u(e,t){return function(n,i){var o;if(g(i)&&n.current()==e)return E(i),t&&(i.tokenize=t),r("string","string");w(i,{type:"string",name:e,tokenize:u(e,t)});if(n.match("{",!1)&&v(i))return i.tokenize=s,r("string","string");while(o=n.next()){if(o==e){E(i),t&&(i.tokenize=t);break}if(n.match("{",!1)&&v(i))return i.tokenize=s,r("string","string")}return r("string","string")}}function a(e,t){var n=/[\w\$_-]/;if(e.eat('"')){while(e.next()!=='"');e.eat(":")}else e.eatWhile(n),e.match(":=",!1)||e.eat(":");return e.eatWhile(n),t.tokenize=s,r("variable","variable")}function f(e,t){return function(n,i){return n.eatSpace(),t&&n.eat(">")?(E(i),i.tokenize=s,r("tag","tag")):(n.eat("/")||w(i,{type:"tag",name:e,tokenize:s}),n.eat(">")?(i.tokenize=s,r("tag","tag")):(i.tokenize=l,r("tag","tag")))}}function l(e,t){var n=e.next();if(n=="/"&&e.eat(">"))return v(t)&&E(t),d(t)&&E(t),r("tag","tag");if(n==">")return v(t)&&E(t),r("tag","tag");if(n=="=")return r("",null);if(n=='"'||n=="'")return i(e,t,u(n,l));v(t)||w(t,{type:"attribute",tokenize:l}),e.eat(/[a-zA-Z_:]/),e.eatWhile(/[-a-zA-Z0-9_:.]/),e.eatSpace();if(e.match(">",!1)||e.match("/",!1))E(t),t.tokenize=s;return r("attribute","attribute")}function c(e,t){var n;while(n=e.next())if(n=="-"&&e.match("->",!0))return t.tokenize=s,r("comment","comment")}function h(e,t){var n;while(n=e.next())if(n=="]"&&e.match("]",!0))return t.tokenize=s,r("comment","comment")}function p(e,t){var n;while(n=e.next())if(n=="?"&&e.match(">",!0))return t.tokenize=s,r("comment","comment meta")}function d(e){return b(e,"tag")}function v(e){return b(e,"attribute")}function m(e){return b(e,"xmlconstructor")}function g(e){return b(e,"string")}function y(e){return e.current()==='"'?e.match(/^[^\"]+\"\:/,!1):e.current()==="'"?e.match(/^[^\"]+\'\:/,!1):!1}function b(e,t){return e.stack.length&&e.stack[e.stack.length-1].type==t}function w(e,t){e.stack.push(t)}function E(e){e.stack.pop();var t=e.stack.length&&e.stack[e.stack.length-1].tokenize;e.tokenize=t||s}var e=function(){function e(e){return{type:e,style:"keyword"}}var t=e("keyword a"),n=e("keyword b"),r=e("keyword c"),i=e("operator"),s={type:"atom",style:"atom"},o={type:"punctuation",style:null},u={type:"axis_specifier",style:"qualifier"},a={"if":t,"switch":t,"while":t,"for":t,"else":n,then:n,"try":n,"finally":n,"catch":n,element:r,attribute:r,let:r,"implements":r,"import":r,module:r,namespace:r,"return":r,"super":r,"this":r,"throws":r,where:r,"private":r,",":o,"null":s,"fn:false()":s,"fn:true()":s},f=["after","ancestor","ancestor-or-self","and","as","ascending","assert","attribute","before","by","case","cast","child","comment","declare","default","define","descendant","descendant-or-self","descending","document","document-node","element","else","eq","every","except","external","following","following-sibling","follows","for","function","if","import","in","instance","intersect","item","let","module","namespace","node","node","of","only","or","order","parent","precedes","preceding","preceding-sibling","processing-instruction","ref","return","returns","satisfies","schema","schema-element","self","some","sortby","stable","text","then","to","treat","typeswitch","union","variable","version","where","xquery","empty-sequence"];for(var l=0,c=f.length;l<c;l++)a[f[l]]=e(f[l]);var h=["xs:string","xs:float","xs:decimal","xs:double","xs:integer","xs:boolean","xs:date","xs:dateTime","xs:time","xs:duration","xs:dayTimeDuration","xs:time","xs:yearMonthDuration","numeric","xs:hexBinary","xs:base64Binary","xs:anyURI","xs:QName","xs:byte","xs:boolean","xs:anyURI","xf:yearMonthDuration"];for(var l=0,c=h.length;l<c;l++)a[h[l]]=s;var p=["eq","ne","lt","le","gt","ge",":=","=",">",">=","<","<=",".","|","?","and","or","div","idiv","mod","*","/","+","-"];for(var l=0,c=p.length;l<c;l++)a[p[l]]=i;var d=["self::","attribute::","child::","descendant::","descendant-or-self::","parent::","ancestor::","ancestor-or-self::","following::","preceding::","following-sibling::","preceding-sibling::"];for(var l=0,c=d.length;l<c;l++)a[d[l]]=u;return a}(),t,n;return{startState:function(){return{tokenize:s,cc:[],stack:[]}},token:function(e,t){if(e.eatSpace())return null;var n=t.tokenize(e,t);return n},blockCommentStart:"(:",blockCommentEnd:":)"}}),e.defineMIME("application/xquery","xquery")});