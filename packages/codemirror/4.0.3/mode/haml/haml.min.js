(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed"),require("../ruby/ruby")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed","../ruby/ruby"],e):e(CodeMirror)})(function(e){"use strict";(function(){e.defineMode("haml",function(t){function i(e){return function(t,n){var r=t.peek();return r==e&&n.rubyState.tokenize.length==1?(t.next(),n.tokenize=o,"closeAttributeTag"):s(t,n)}}function s(e,t){return e.match("-#")?(e.skipToEnd(),"comment"):r.token(e,t.rubyState)}function o(e,t){var r=e.peek();if(t.previousToken.style=="comment"&&t.indented>t.previousToken.indented)return e.skipToEnd(),"commentLine";if(t.startOfLine){if(r=="!"&&e.match("!!"))return e.skipToEnd(),"tag";if(e.match(/^%[\w:#\.]+=/))return t.tokenize=s,"hamlTag";if(e.match(/^%[\w:]+/))return"hamlTag";if(r=="/")return e.skipToEnd(),"comment"}if(t.startOfLine||t.previousToken.style=="hamlTag")if(r=="#"||r==".")return e.match(/[\w-#\.]*/),"hamlAttribute";if(t.startOfLine&&!e.match("-->",!1)&&(r=="="||r=="-"))return t.tokenize=s,null;if(t.previousToken.style=="hamlTag"||t.previousToken.style=="closeAttributeTag"||t.previousToken.style=="hamlAttribute"){if(r=="(")return t.tokenize=i(")"),null;if(r=="{")return t.tokenize=i("}"),null}return n.token(e,t.htmlState)}var n=e.getMode(t,{name:"htmlmixed"}),r=e.getMode(t,"ruby");return{startState:function(){var e=n.startState(),t=r.startState();return{htmlState:e,rubyState:t,indented:0,previousToken:{style:null,indented:0},tokenize:o}},copyState:function(t){return{htmlState:e.copyState(n,t.htmlState),rubyState:e.copyState(r,t.rubyState),indented:t.indented,previousToken:t.previousToken,tokenize:t.tokenize}},token:function(e,t){e.sol()&&(t.indented=e.indentation(),t.startOfLine=!0);if(e.eatSpace())return null;var n=t.tokenize(e,t);t.startOfLine=!1,n&&n!="commentLine"&&(t.previousToken={style:n,indented:t.indented});if(e.eol()&&t.tokenize==s){e.backUp(1);var r=e.peek();e.next(),r&&r!=","&&(t.tokenize=o)}return n=="hamlTag"?n="tag":n=="commentLine"?n="comment":n=="hamlAttribute"?n="attribute":n=="closeAttributeTag"&&(n=null),n}}},"htmlmixed","ruby"),e.defineMIME("text/x-haml","haml")})()});