(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror",require("../xml/xml"))):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../xml/xml"],e):e(CodeMirror)})(function(e){"use strict";e.defineMode("markdown",function(t,n){function O(e,t,n){return t.f=t.inline=n,n(e,t)}function M(e,t,n){return t.f=t.block=n,n(e,t)}function _(e){return e.linkTitle=!1,e.em=!1,e.strong=!1,e.quote=0,!r&&e.f==P&&(e.f=F,e.block=D),e.trailingSpace=0,e.trailingSpaceNewLine=!1,e.thisLineHasContent=!1,null}function D(e,t){var r=e.sol(),i=t.list!==!1;t.list!==!1&&t.indentationDiff>=0?(t.indentationDiff<4&&(t.indentation-=t.indentationDiff),t.list=null):t.list!==!1&&t.indentation>0?(t.list=null,t.listDepth=Math.floor(t.indentation/4)):t.list!==!1&&(t.list=!1,t.listDepth=0);var s=null;if(t.indentationDiff>=4)return t.indentation-=4,e.skipToEnd(),f;if(e.eatSpace())return null;if(s=e.match(k))return t.header=s[0].length<=6?s[0].length:6,n.highlightFormatting&&(t.formatting="header"),t.f=t.inline,B(t);if(t.prevLineHasContent&&(s=e.match(L)))return t.header=s[0].charAt(0)=="="?1:2,n.highlightFormatting&&(t.formatting="header"),t.f=t.inline,B(t);if(e.eat(">"))return t.indentation++,t.quote=r?1:t.quote+1,n.highlightFormatting&&(t.formatting="quote"),e.eatSpace(),B(t);if(e.peek()==="[")return O(e,t,U);if(e.match(x,!0))return d;if((!t.prevLineHasContent||i)&&(e.match(T,!1)||e.match(N,!1))){var u=null;return e.match(T,!0)?u="ul":(e.match(N,!0),u="ol"),t.indentation+=4,t.list=!0,t.listDepth++,n.taskLists&&e.match(C,!1)&&(t.taskList=!0),t.f=t.inline,n.highlightFormatting&&(t.formatting=["list","list-"+u]),B(t)}return n.fencedCodeBlocks&&e.match(/^```([\w+#]*)/,!0)?(t.localMode=o(RegExp.$1),t.localMode&&(t.localState=t.localMode.startState()),M(e,t,H),n.highlightFormatting&&(t.formatting="code-block"),t.code=!0,B(t)):O(e,t,t.inline)}function P(e,t){var n=i.token(e,t.htmlState);if(r&&!t.htmlState.tagName&&!t.htmlState.context||t.md_inside&&e.current().indexOf(">")>-1)t.f=F,t.block=D,t.htmlState=null;return n}function H(e,t){if(e.sol()&&e.match(/^```/,!0)){t.localMode=t.localState=null,t.f=F,t.block=D,n.highlightFormatting&&(t.formatting="code-block"),t.code=!0;var r=B(t);return t.code=!1,r}return t.localMode?t.localMode.token(e,t.localState):(e.skipToEnd(),f)}function B(e){var t=[];if(e.formatting){t.push(m),typeof e.formatting=="string"&&(e.formatting=[e.formatting]);for(var r=0;r<e.formatting.length;r++)t.push(m+"-"+e.formatting[r]),e.formatting[r]==="header"&&t.push(m+"-"+e.formatting[r]+"-"+e.header),e.formatting[r]==="quote"&&(!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=e.quote?t.push(m+"-"+e.formatting[r]+"-"+e.quote):t.push("error"))}if(e.taskOpen)return t.push("meta"),t.length?t.join(" "):null;if(e.taskClosed)return t.push("property"),t.length?t.join(" "):null;if(e.linkHref)return t.push(w),t.length?t.join(" "):null;e.strong&&t.push(S),e.em&&t.push(E),e.linkText&&t.push(b),e.code&&t.push(f),e.header&&(t.push(a),t.push(a+"-"+e.header)),e.quote&&(t.push(l),!n.maxBlockquoteDepth||n.maxBlockquoteDepth>=e.quote?t.push(l+"-"+e.quote):t.push(l+"-"+n.maxBlockquoteDepth));if(e.list!==!1){var i=(e.listDepth-1)%3;i?i===1?t.push(h):t.push(p):t.push(c)}return e.trailingSpaceNewLine?t.push("trailing-space-new-line"):e.trailingSpace&&t.push("trailing-space-"+(e.trailingSpace%2?"a":"b")),t.length?t.join(" "):null}function j(e,t){return e.match(A,!0)?B(t):undefined}function F(t,r){var s=r.text(t,r);if(typeof s!="undefined")return s;if(r.list)return r.list=null,B(r);if(r.taskList){var o=t.match(C,!0)[1]!=="x";return o?r.taskOpen=!0:r.taskClosed=!0,n.highlightFormatting&&(r.formatting="task"),r.taskList=!1,B(r)}r.taskOpen=!1,r.taskClosed=!1;if(r.header&&t.match(/^#+$/,!0))return n.highlightFormatting&&(r.formatting="header"),B(r);var a=t.sol(),f=t.next();if(r.escape)return r.escape=!1,B(r);if(f==="\\")return n.highlightFormatting&&(r.formatting="escape"),r.escape=!0,B(r);if(r.linkTitle){r.linkTitle=!1;var l=f;f==="("&&(l=")"),l=(l+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1");var c="^\\s*(?:[^"+l+"\\\\]+|\\\\\\\\|\\\\.)"+l;if(t.match(new RegExp(c),!0))return w}if(f==="`"){var h=r.formatting;n.highlightFormatting&&(r.formatting="code");var p=B(r),d=t.pos;t.eatWhile("`");var m=1+t.pos-d;return r.code?m===u?(r.code=!1,p):(r.formatting=h,B(r)):(u=m,r.code=!0,B(r))}if(r.code)return B(r);if(f==="!"&&t.match(/\[[^\]]*\] ?(?:\(|\[)/,!1))return t.match(/\[[^\]]*\]/),r.inline=r.f=q,v;if(f==="["&&t.match(/.*\](\(| ?\[)/,!1))return r.linkText=!0,n.highlightFormatting&&(r.formatting="link"),B(r);if(f==="]"&&r.linkText){n.highlightFormatting&&(r.formatting="link");var b=B(r);return r.linkText=!1,r.inline=r.f=q,b}if(f==="<"&&t.match(/^(https?|ftps?):\/\/(?:[^\\>]|\\.)+>/,!1)){r.f=r.inline=I,n.highlightFormatting&&(r.formatting="link");var b=B(r);return b?b+=" ":b="",b+g}if(f==="<"&&t.match(/^[^> \\]+@(?:[^\\>]|\\.)+>/,!1)){r.f=r.inline=I,n.highlightFormatting&&(r.formatting="link");var b=B(r);return b?b+=" ":b="",b+y}if(f==="<"&&t.match(/^\w/,!1)){if(t.string.indexOf(">")!=-1){var E=t.string.substring(1,t.string.indexOf(">"));/markdown\s*=\s*('|"){0,1}1('|"){0,1}/.test(E)&&(r.md_inside=!0)}return t.backUp(1),r.htmlState=e.startState(i),M(t,r,P)}if(f==="<"&&t.match(/^\/\w*?>/))return r.md_inside=!1,"tag";var S=!1;if(!n.underscoresBreakWords&&f==="_"&&t.peek()!=="_"&&t.match(/(\w)/,!1)){var x=t.pos-2;if(x>=0){var T=t.string.charAt(x);T!=="_"&&T.match(/(\w)/,!1)&&(S=!0)}}if(f==="*"||f==="_"&&!S){if(!a||t.peek()!==" "){if(r.strong===f&&t.eat(f)){n.highlightFormatting&&(r.formatting="strong");var p=B(r);return r.strong=!1,p}if(!r.strong&&t.eat(f))return r.strong=f,n.highlightFormatting&&(r.formatting="strong"),B(r);if(r.em===f){n.highlightFormatting&&(r.formatting="em");var p=B(r);return r.em=!1,p}if(!r.em)return r.em=f,n.highlightFormatting&&(r.formatting="em"),B(r)}}else if(f===" ")if(t.eat("*")||t.eat("_")){if(t.peek()===" ")return B(r);t.backUp(1)}return f===" "&&(t.match(/ +$/,!1)?r.trailingSpace++:r.trailingSpace&&(r.trailingSpaceNewLine=!0)),B(r)}function I(e,t){var r=e.next();if(r===">"){t.f=t.inline=F,n.highlightFormatting&&(t.formatting="link");var i=B(t);return i?i+=" ":i="",i+g}return e.match(/^[^>]+/,!0),g}function q(e,t){if(e.eatSpace())return null;var r=e.next();return r==="("||r==="["?(t.f=t.inline=R(r==="("?")":"]"),n.highlightFormatting&&(t.formatting="link-string"),t.linkHref=!0,B(t)):"error"}function R(e){return function(t,r){var i=t.next();if(i===e){r.f=r.inline=F,n.highlightFormatting&&(r.formatting="link-string");var s=B(r);return r.linkHref=!1,s}return t.match(V(e),!0)&&t.backUp(1),r.linkHref=!0,B(r)}}function U(e,t){return e.match(/^[^\]]*\]:/,!1)?(t.f=z,e.next(),n.highlightFormatting&&(t.formatting="link"),t.linkText=!0,B(t)):O(e,t,F)}function z(e,t){if(e.match(/^\]:/,!0)){t.f=t.inline=W,n.highlightFormatting&&(t.formatting="link");var r=B(t);return t.linkText=!1,r}return e.match(/^[^\]]+/,!0),b}function W(e,t){return e.eatSpace()?null:(e.match(/^[^\s]+/,!0),e.peek()===undefined?t.linkTitle=!0:e.match(/^(?:\s+(?:"(?:[^"\\]|\\\\|\\.)+"|'(?:[^'\\]|\\\\|\\.)+'|\((?:[^)\\]|\\\\|\\.)+\)))?/,!0),t.f=t.inline=F,w)}function V(e){return X[e]||(e=(e+"").replace(/([.?*+^$[\]\\(){}|-])/g,"\\$1"),X[e]=new RegExp("^(?:[^\\\\]|\\\\.)*?("+e+")")),X[e]}var r=e.modes.hasOwnProperty("xml"),i=e.getMode(t,r?{name:"xml",htmlMode:!0}:"text/plain"),s={html:"htmlmixed",js:"javascript",json:"application/json",c:"text/x-csrc","c++":"text/x-c++src",java:"text/x-java",csharp:"text/x-csharp","c#":"text/x-csharp",scala:"text/x-scala"},o=function(){var n,r={},i={},o,u=[];for(var a in e.modes)e.modes.propertyIsEnumerable(a)&&u.push(a);for(n=0;n<u.length;n++)r[u[n]]=u[n];var f=[];for(var a in e.mimeModes)e.mimeModes.propertyIsEnumerable(a)&&f.push({mime:a,mode:e.mimeModes[a]});for(n=0;n<f.length;n++)o=f[n].mime,i[o]=f[n].mime;for(var l in s)if(s[l]in r||s[l]in i)r[l]=s[l];return function(n){return r[n]?e.getMode(t,r[n]):null}}();n.highlightFormatting===undefined&&(n.highlightFormatting=!1),n.maxBlockquoteDepth===undefined&&(n.maxBlockquoteDepth=0),n.underscoresBreakWords===undefined&&(n.underscoresBreakWords=!0),n.fencedCodeBlocks===undefined&&(n.fencedCodeBlocks=!1),n.taskLists===undefined&&(n.taskLists=!1);var u=0,a="header",f="comment",l="quote",c="variable-2",h="variable-3",p="keyword",d="hr",v="tag",m="formatting",g="link",y="link",b="link",w="string",E="em",S="strong",x=/^([*\-=_])(?:\s*\1){2,}\s*$/,T=/^[*\-+]\s+/,N=/^[0-9]+\.\s+/,C=/^\[(x| )\](?=\s)/,k=/^#+/,L=/^(?:\={1,}|-{1,})$/,A=/^[^#!\[\]*_\\<>` "'(]+/,X=[],$={startState:function(){return{f:D,prevLineHasContent:!1,thisLineHasContent:!1,block:D,htmlState:null,indentation:0,inline:F,text:j,escape:!1,formatting:!1,linkText:!1,linkHref:!1,linkTitle:!1,em:!1,strong:!1,header:0,taskList:!1,list:!1,listDepth:0,quote:0,trailingSpace:0,trailingSpaceNewLine:!1}},copyState:function(t){return{f:t.f,prevLineHasContent:t.prevLineHasContent,thisLineHasContent:t.thisLineHasContent,block:t.block,htmlState:t.htmlState&&e.copyState(i,t.htmlState),indentation:t.indentation,localMode:t.localMode,localState:t.localMode?e.copyState(t.localMode,t.localState):null,inline:t.inline,text:t.text,escape:!1,formatting:!1,linkTitle:t.linkTitle,em:t.em,strong:t.strong,header:t.header,taskList:t.taskList,list:t.list,listDepth:t.listDepth,quote:t.quote,trailingSpace:t.trailingSpace,trailingSpaceNewLine:t.trailingSpaceNewLine,md_inside:t.md_inside}},token:function(e,t){t.formatting=!1;if(e.sol()){var n=e.match(/^\s*$/,!0)||t.header;t.header=0;if(n)return t.prevLineHasContent=!1,_(t);t.prevLineHasContent=t.thisLineHasContent,t.thisLineHasContent=!0,t.escape=!1,t.taskList=!1,t.code=!1,t.trailingSpace=0,t.trailingSpaceNewLine=!1,t.f=t.block;var r=e.match(/^\s*/,!0)[0].replace(/\t/g,"    ").length,i=Math.floor((r-t.indentation)/4)*4;i>4&&(i=4);var s=t.indentation+i;t.indentationDiff=s-t.indentation,t.indentation=s;if(r>0)return null}return t.f(e,t)},innerMode:function(e){return e.block==P?{state:e.htmlState,mode:i}:e.localState?{state:e.localState,mode:e.localMode}:{state:e,mode:$}},blankLine:_,getType:B,fold:"markdown"};return $},"xml"),e.defineMIME("text/x-markdown","markdown")});