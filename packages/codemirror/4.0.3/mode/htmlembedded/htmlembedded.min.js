(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror"),require("../htmlmixed/htmlmixed")):typeof define=="function"&&define.amd?define(["../../lib/codemirror","../htmlmixed/htmlmixed"],e):e(CodeMirror)})(function(e){"use strict";e.defineMode("htmlembedded",function(t,n){function u(e,t){return e.match(r,!1)?(t.token=a,s.token(e,t.scriptState)):o.token(e,t.htmlState)}function a(e,t){return e.match(i,!1)?(t.token=u,o.token(e,t.htmlState)):s.token(e,t.scriptState)}var r=n.scriptStartRegex||/^<%/i,i=n.scriptEndRegex||/^%>/i,s,o;return{startState:function(){return s=s||e.getMode(t,n.scriptingModeSpec),o=o||e.getMode(t,"htmlmixed"),{token:n.startOpen?a:u,htmlState:e.startState(o),scriptState:e.startState(s)}},token:function(e,t){return t.token(e,t)},indent:function(e,t){if(e.token==u)return o.indent(e.htmlState,t);if(s.indent)return s.indent(e.scriptState,t)},copyState:function(t){return{token:t.token,htmlState:e.copyState(o,t.htmlState),scriptState:e.copyState(s,t.scriptState)}},innerMode:function(e){return e.token==a?{state:e.scriptState,mode:s}:{state:e.htmlState,mode:o}}}},"htmlmixed"),e.defineMIME("application/x-ejs",{name:"htmlembedded",scriptingModeSpec:"javascript"}),e.defineMIME("application/x-aspx",{name:"htmlembedded",scriptingModeSpec:"text/x-csharp"}),e.defineMIME("application/x-jsp",{name:"htmlembedded",scriptingModeSpec:"text/x-java"}),e.defineMIME("application/x-erb",{name:"htmlembedded",scriptingModeSpec:"ruby"})});