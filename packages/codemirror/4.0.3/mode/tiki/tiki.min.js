(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){"use strict";e.defineMode("tiki",function(e){function t(e,t,n){return function(i,s){while(!i.eol()){if(i.match(t)){s.tokenize=r;break}i.next()}return n&&(s.tokenize=n),e}}function n(e){return function(t,n){while(!t.eol())t.next();return n.tokenize=r,e}}function r(e,i){function s(t){return i.tokenize=t,t(e,i)}var o=e.sol(),a=e.next();switch(a){case"{":e.eat("/"),e.eatSpace();var f="",l;while(l=e.eat(/[^\s\u00a0=\"\'\/?(}]/))f+=l;return i.tokenize=u,"tag";case"_":if(e.eat("_"))return s(t("strong","__",r));break;case"'":if(e.eat("'"))return s(t("em","''",r));break;case"(":if(e.eat("("))return s(t("variable-2","))",r));break;case"[":return s(t("variable-3","]",r));case"|":if(e.eat("|"))return s(t("comment","||"));break;case"-":if(e.eat("="))return s(t("header string","=-",r));if(e.eat("-"))return s(t("error tw-deleted","--",r));break;case"=":if(e.match("=="))return s(t("tw-underline","===",r));break;case":":if(e.eat(":"))return s(t("comment","::"));break;case"^":return s(t("tw-box","^"));case"~":if(e.match("np~"))return s(t("meta","~/np~"))}if(o)switch(a){case"!":return e.match("!!!!!")?s(n("header string")):e.match("!!!!")?s(n("header string")):e.match("!!!")?s(n("header string")):e.match("!!")?s(n("header string")):s(n("header string"));case"*":case"#":case"+":return s(n("tw-listitem bracket"))}return null}function u(e,t){var n=e.next(),i=e.peek();return n=="}"?(t.tokenize=r,"tag"):n=="("||n==")"?"bracket":n=="="?(o="equals",i==">"&&(n=e.next(),i=e.peek()),/[\'\"]/.test(i)||(t.tokenize=f()),"operator"):/[\'\"]/.test(n)?(t.tokenize=a(n),t.tokenize(e,t)):(e.eatWhile(/[^\s\u00a0=\"\'\/?]/),"keyword")}function a(e){return function(t,n){while(!t.eol())if(t.next()==e){n.tokenize=u;break}return"string"}}function f(){return function(e,t){while(!e.eol()){var n=e.next(),r=e.peek();if(n==" "||n==","||/[ )}]/.test(r)){t.tokenize=u;break}}return"string"}}function h(){for(var e=arguments.length-1;e>=0;e--)l.cc.push(arguments[e])}function p(){return h.apply(null,arguments),!0}function d(e,t){var n=l.context&&l.context.noIndent;l.context={prev:l.context,pluginName:e,indent:l.indented,startOfLine:t,noIndent:n}}function v(){l.context&&(l.context=l.context.prev)}function m(e){if(e=="openPlugin")return l.pluginName=s,p(b,g(l.startOfLine));if(e=="closePlugin"){var t=!1;return l.context?(t=l.context.pluginName!=s,v()):t=!0,t&&(c="error"),p(y(t))}return e=="string"?((!l.context||l.context.name!="!cdata")&&d("!cdata"),l.tokenize==r&&v(),p()):p()}function g(e){return function(t){return t=="selfclosePlugin"||t=="endPlugin"?p():t=="endPlugin"?(d(l.pluginName,e),p()):p()}}function y(e){return function(t){return e&&(c="error"),t=="endPlugin"?p():h()}}function b(e){return e=="keyword"?(c="attribute",p(b)):e=="equals"?p(w,b):h()}function w(e){return e=="keyword"?(c="string",p()):e=="string"?p(E):h()}function E(e){return e=="string"?p(E):h()}var i=e.indentUnit,s,o,l,c;return{startState:function(){return{tokenize:r,cc:[],indented:0,startOfLine:!0,pluginName:null,context:null}},token:function(e,t){e.sol()&&(t.startOfLine=!0,t.indented=e.indentation());if(e.eatSpace())return null;c=o=s=null;var n=t.tokenize(e,t);if((n||o)&&n!="comment"){l=t;for(;;){var r=t.cc.pop()||m;if(r(o||n))break}}return t.startOfLine=!1,c||n},indent:function(e,t){var n=e.context;if(n&&n.noIndent)return 0;n&&/^{\//.test(t)&&(n=n.prev);while(n&&!n.startOfLine)n=n.prev;return n?n.indent+i:0},electricChars:"/"}}),e.defineMIME("text/tiki","tiki")});