(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../lib/codemirror")):typeof define=="function"&&define.amd?define(["../lib/codemirror"],e):e(CodeMirror)})(function(e){"use strict";function n(e,t){return e.line==t.line&&e.ch==t.ch}function i(e){r.push(e),r.length>50&&r.shift()}function s(e){if(!r.length)return i(e);r[r.length-1]+=e}function o(e){return r[r.length-(e?Math.min(e,1):1)]||""}function u(){return r.length>1&&r.pop(),o()}function f(e,t,r,o,u){u==null&&(u=e.getRange(t,r)),o&&a&&a.cm==e&&n(t,a.pos)&&e.isClean(a.gen)?s(u):i(u),e.replaceRange("",t,r,"+delete"),o?a={cm:e,pos:t,gen:e.changeGeneration()}:a=null}function l(e,t,n){return e.findPosH(t,n,"char",!0)}function c(e,t,n){return e.findPosH(t,n,"word",!0)}function h(e,t,n){return e.findPosV(t,n,"line",e.doc.sel.goalColumn)}function p(e,t,n){return e.findPosV(t,n,"page",e.doc.sel.goalColumn)}function d(e,n,r){var i=n.line,s=e.getLine(i),o=/\S/.test(r<0?s.slice(0,n.ch):s.slice(n.ch)),u=e.firstLine(),a=e.lastLine();for(;;){i+=r;if(i<u||i>a)return e.clipPos(t(i-r,r<0?0:null));s=e.getLine(i);var f=/\S/.test(s);if(f)o=!0;else if(o)return t(i,0)}}function v(e,n,r){var i=n.line,s=n.ch,o=e.getLine(n.line),u=!1;for(;;){var a=o.charAt(s+(r<0?-1:0));if(!a){if(i==(r<0?e.firstLine():e.lastLine()))return t(i,s);o=e.getLine(i+r);if(!/\S/.test(o))return t(i,s);i+=r,s=r<0?o.length:0;continue}if(u&&/[!?.]/.test(a))return t(i,s+(r>0?1:0));u||(u=/\w/.test(a)),s+=r}}function m(e,r,i){var s;if(e.findMatchingBracket&&(s=e.findMatchingBracket(r,!0))&&s.match&&(s.forward?1:-1)==i)return i>0?t(s.to.line,s.to.ch+1):s.to;for(var o=!0;;o=!1){var u=e.getTokenAt(r),a=t(r.line,i<0?u.start:u.end);if(!(o&&i>0&&u.end==r.ch||!/\w/.test(u.string)))return a;var f=e.findPosH(a,i,"char");if(n(a,f))return r;r=f}}function g(e,t){var n=e.state.emacsPrefix;return n?(N(e),n=="-"?-1:Number(n)):t?null:1}function y(e){var t=typeof e=="string"?function(t){t.execCommand(e)}:e;return function(e){var n=g(e);t(e);for(var r=1;r<n;++r)t(e)}}function b(e,t,r){var i=e.getCursor(),s=g(e);s<0&&(r=-r,s=-s);for(var o=0;o<s;++o){var u=t(e,i,r);if(n(u,i))break;i=u}return i}function w(e,t){var n=function(n){n.extendSelection(b(n,e,t))};return n.motion=!0,n}function E(e,t,n){f(e,e.getCursor(),b(e,t,n),!0)}function S(e,t){if(e.state.emacsPrefix){t!="-"&&(e.state.emacsPrefix+=t);return}e.state.emacsPrefix=t,e.on("keyHandled",T),e.on("inputRead",C)}function T(e,t){!e.state.emacsPrefixMap&&!x.hasOwnProperty(t)&&N(e)}function N(e){e.state.emacsPrefix=null,e.off("keyHandled",T),e.off("inputRead",C)}function C(e,t){var n=g(e);if(n>1&&t.origin=="+input"){var r=t.text.join("\n"),i="";for(var s=1;s<n;++s)i+=r;e.replaceSelection(i)}}function k(e){e.state.emacsPrefixMap=!0,e.addKeyMap(B),e.on("keyHandled",L),e.on("inputRead",L)}function L(e,t){if(!(typeof t!="string"||!/^\d$/.test(t)&&t!="Ctrl-U"))return;e.removeKeyMap(B),e.state.emacsPrefixMap=!1,e.off("keyHandled",L),e.off("inputRead",L)}function A(e){e.setCursor(e.getCursor()),e.setExtending(!e.getExtending()),e.on("change",function(){e.setExtending(!1)})}function O(e){e.setExtending(!1),e.setCursor(e.getCursor())}function M(e,t,n){e.openDialog?e.openDialog(t+': <input type="text" style="width: 10em"/>',n,{bottom:!0}):n(prompt(t,""))}function _(e,t){var n=e.getCursor(),r=e.findPosH(n,1,"word");e.replaceRange(t(e.getRange(n,r)),n,r),e.setCursor(r)}function D(e){var n=e.getCursor(),r=n.line,i=n.ch,s=[];while(r>=e.firstLine()){var o=e.getLine(r);for(var u=i==null?o.length:i;u>0;){var i=o.charAt(--u);if(i==")")s.push("(");else if(i=="]")s.push("[");else if(i=="}")s.push("{");else if(/[\(\{\[]/.test(i)&&(!s.length||s.pop()!=i))return e.extendSelection(t(r,u))}--r,i=null}}function P(e){e.execCommand("clearSearch"),O(e)}function j(e){B[e]=function(t){S(t,e)},H["Ctrl-"+e]=function(t){S(t,e)},x["Ctrl-"+e]=!0}var t=e.Pos,r=[],a=null,x={"Alt-G":!0,"Ctrl-X":!0,"Ctrl-Q":!0,"Ctrl-U":!0},H=e.keyMap.emacs={"Ctrl-W":function(e){f(e,e.getCursor("start"),e.getCursor("end"))},"Ctrl-K":y(function(e){var n=e.getCursor(),r=e.clipPos(t(n.line)),i=e.getRange(n,r);/\S/.test(i)||(i+="\n",r=t(n.line+1,0)),f(e,n,r,!0,i)}),"Alt-W":function(e){i(e.getSelection()),O(e)},"Ctrl-Y":function(e){var t=e.getCursor();e.replaceRange(o(g(e)),t,t,"paste"),e.setSelection(t,e.getCursor())},"Alt-Y":function(e){e.replaceSelection(u(),"around","paste")},"Ctrl-Space":A,"Ctrl-Shift-2":A,"Ctrl-F":w(l,1),"Ctrl-B":w(l,-1),Right:w(l,1),Left:w(l,-1),"Ctrl-D":function(e){E(e,l,1)},Delete:function(e){E(e,l,1)},"Ctrl-H":function(e){E(e,l,-1)},Backspace:function(e){E(e,l,-1)},"Alt-F":w(c,1),"Alt-B":w(c,-1),"Alt-D":function(e){E(e,c,1)},"Alt-Backspace":function(e){E(e,c,-1)},"Ctrl-N":w(h,1),"Ctrl-P":w(h,-1),Down:w(h,1),Up:w(h,-1),"Ctrl-A":"goLineStart","Ctrl-E":"goLineEnd",End:"goLineEnd",Home:"goLineStart","Alt-V":w(p,-1),"Ctrl-V":w(p,1),PageUp:w(p,-1),PageDown:w(p,1),"Ctrl-Up":w(d,-1),"Ctrl-Down":w(d,1),"Alt-A":w(v,-1),"Alt-E":w(v,1),"Alt-K":function(e){E(e,v,1)},"Ctrl-Alt-K":function(e){E(e,m,1)},"Ctrl-Alt-Backspace":function(e){E(e,m,-1)},"Ctrl-Alt-F":w(m,1),"Ctrl-Alt-B":w(m,-1),"Shift-Ctrl-Alt-2":function(e){e.setSelection(b(e,m,1),e.getCursor())},"Ctrl-Alt-T":function(e){var t=m(e,e.getCursor(),-1),n=m(e,t,1),r=m(e,n,1),i=m(e,r,-1);e.replaceRange(e.getRange(i,r)+e.getRange(n,i)+e.getRange(t,n),t,r)},"Ctrl-Alt-U":y(D),"Alt-Space":function(e){var n=e.getCursor(),r=n.ch,i=n.ch,s=e.getLine(n.line);while(r&&/\s/.test(s.charAt(r-1)))--r;while(i<s.length&&/\s/.test(s.charAt(i)))++i;e.replaceRange(" ",t(n.line,r),t(n.line,i))},"Ctrl-O":y(function(e){e.replaceSelection("\n","start")}),"Ctrl-T":y(function(e){var n=e.getCursor();n.ch<e.getLine(n.line).length&&(n=t(n.line,n.ch+1));var r=e.findPosH(n,-2,"char"),i=e.getRange(r,n);if(i.length!=2)return;e.setSelection(r,n),e.replaceSelection(i.charAt(1)+i.charAt(0),null,"+transpose")}),"Alt-C":y(function(e){_(e,function(e){var t=e.search(/\w/);return t==-1?e:e.slice(0,t)+e.charAt(t).toUpperCase()+e.slice(t+1).toLowerCase()})}),"Alt-U":y(function(e){_(e,function(e){return e.toUpperCase()})}),"Alt-L":y(function(e){_(e,function(e){return e.toLowerCase()})}),"Alt-;":"toggleComment","Ctrl-/":y("undo"),"Shift-Ctrl--":y("undo"),"Ctrl-Z":y("undo"),"Cmd-Z":y("undo"),"Shift-Alt-,":"goDocStart","Shift-Alt-.":"goDocEnd","Ctrl-S":"findNext","Ctrl-R":"findPrev","Ctrl-G":P,"Shift-Alt-5":"replace","Alt-/":"autocomplete","Ctrl-J":"newlineAndIndent",Enter:!1,Tab:"indentAuto","Alt-G":function(e){e.setOption("keyMap","emacs-Alt-G")},"Ctrl-X":function(e){e.setOption("keyMap","emacs-Ctrl-X")},"Ctrl-Q":function(e){e.setOption("keyMap","emacs-Ctrl-Q")},"Ctrl-U":k};e.keyMap["emacs-Ctrl-X"]={Tab:function(e){e.indentSelection(g(e,!0)||e.getOption("indentUnit"))},"Ctrl-X":function(e){e.setSelection(e.getCursor("head"),e.getCursor("anchor"))},"Ctrl-S":"save","Ctrl-W":"save",S:"saveAll",F:"open",U:y("undo"),K:"close",Delete:function(e){f(e,e.getCursor(),v(e,e.getCursor(),1),!0)},auto:"emacs",nofallthrough:!0,disableInput:!0},e.keyMap["emacs-Alt-G"]={G:function(e){var t=g(e,!0);if(t!=null&&t>0)return e.setCursor(t-1);M(e,"Goto line",function(t){var n;t&&!isNaN(n=Number(t))&&n==n|0&&n>0&&e.setCursor(n-1)})},auto:"emacs",nofallthrough:!0,disableInput:!0},e.keyMap["emacs-Ctrl-Q"]={Tab:y("insertTab"),auto:"emacs",nofallthrough:!0};var B={"Ctrl-G":N};for(var F=0;F<10;++F)j(String(F));j("-")});