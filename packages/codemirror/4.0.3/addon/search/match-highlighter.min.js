// Highlighting text that matches the selection
//
// Defines an option highlightSelectionMatches, which, when enabled,
// will style strings that match the selection throughout the
// document.
//
// The option can be set to true to simply enable it, or to a
// {minChars, style, showToken} object to explicitly configure it.
// minChars is the minimum amount of characters that should be
// selected for the behavior to occur, and style is the token style to
// apply to the matches. This will be prefixed by "cm-" to create an
// actual CSS class name. showToken, when enabled, will cause the
// current token to be highlighted when nothing is selected.
(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){"use strict";function i(e){typeof e=="object"&&(this.minChars=e.minChars,this.style=e.style,this.showToken=e.showToken,this.delay=e.delay),this.style==null&&(this.style=n),this.minChars==null&&(this.minChars=t),this.delay==null&&(this.delay=r),this.overlay=this.timeout=null}function s(e){var t=e.state.matchHighlighter;clearTimeout(t.timeout),t.timeout=setTimeout(function(){o(e)},t.delay)}function o(e){e.operation(function(){var t=e.state.matchHighlighter;t.overlay&&(e.removeOverlay(t.overlay),t.overlay=null);if(!e.somethingSelected()&&t.showToken){var n=t.showToken===!0?/[\w$]/:t.showToken,r=e.getCursor(),i=e.getLine(r.line),s=r.ch,o=s;while(s&&n.test(i.charAt(s-1)))--s;while(o<i.length&&n.test(i.charAt(o)))++o;s<o&&e.addOverlay(t.overlay=a(i.slice(s,o),n,t.style));return}if(e.getCursor("head").line!=e.getCursor("anchor").line)return;var u=e.getSelections()[0].replace(/^\s+|\s+$/g,"");u.length>=t.minChars&&e.addOverlay(t.overlay=a(u,!1,t.style))})}function u(e,t){return(!e.start||!t.test(e.string.charAt(e.start-1)))&&(e.pos==e.string.length||!t.test(e.string.charAt(e.pos)))}function a(e,t,n){return{token:function(r){if(r.match(e)&&(!t||u(r,t)))return n;r.next(),r.skipTo(e.charAt(0))||r.skipToEnd()}}}var t=2,n="matchhighlight",r=100;e.defineOption("highlightSelectionMatches",!1,function(t,n,r){if(r&&r!=e.Init){var u=t.state.matchHighlighter.overlay;u&&t.removeOverlay(u),clearTimeout(t.state.matchHighlighter.timeout),t.state.matchHighlighter=null,t.off("cursorActivity",s)}n&&(t.state.matchHighlighter=new i(n),o(t),t.on("cursorActivity",s))})});