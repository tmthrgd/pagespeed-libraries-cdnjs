// Open simple dialogs on top of an editor. Relies on dialog.css.
(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){function t(e,t,n){var r=e.getWrapperElement(),i;return i=r.appendChild(document.createElement("div")),n?i.className="CodeMirror-dialog CodeMirror-dialog-bottom":i.className="CodeMirror-dialog CodeMirror-dialog-top",typeof t=="string"?i.innerHTML=t:i.appendChild(t),i}function n(e,t){e.state.currentNotificationClose&&e.state.currentNotificationClose(),e.state.currentNotificationClose=t}e.defineExtension("openDialog",function(r,i,s){function f(){if(u)return;u=!0,o.parentNode.removeChild(o)}n(this,null);var o=t(this,r,s&&s.bottom),u=!1,a=this,l=o.getElementsByTagName("input")[0],c;if(l)s&&s.value&&(l.value=s.value),e.on(l,"keydown",function(t){if(s&&s.onKeyDown&&s.onKeyDown(t,l.value,f))return;if(t.keyCode==13||t.keyCode==27)l.blur(),e.e_stop(t),f(),a.focus(),t.keyCode==13&&i(l.value)}),s&&s.onKeyUp&&e.on(l,"keyup",function(e){s.onKeyUp(e,l.value,f)}),s&&s.value&&(l.value=s.value),l.focus(),e.on(l,"blur",f);else if(c=o.getElementsByTagName("button")[0])e.on(c,"click",function(){f(),a.focus()}),c.focus(),e.on(c,"blur",f);return f}),e.defineExtension("openConfirm",function(r,i,s){function c(){if(a)return;a=!0,o.parentNode.removeChild(o),f.focus()}n(this,null);var o=t(this,r,s&&s.bottom),u=o.getElementsByTagName("button"),a=!1,f=this,l=1;u[0].focus();for(var h=0;h<u.length;++h){var p=u[h];(function(t){e.on(p,"click",function(n){e.e_preventDefault(n),c(),t&&t(f)})})(i[h]),e.on(p,"blur",function(){--l,setTimeout(function(){l<=0&&c()},200)}),e.on(p,"focus",function(){++l})}}),e.defineExtension("openNotification",function(r,i){function f(){if(u)return;u=!0,clearTimeout(a),s.parentNode.removeChild(s)}n(this,f);var s=t(this,r,i&&i.bottom),o=i&&(i.duration===undefined?5e3:i.duration),u=!1,a;e.on(s,"click",function(t){e.e_preventDefault(t),f()}),o&&(a=setTimeout(f,i.duration))})});