(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){"use strict";function n(e,t){return e.line-t.line||e.ch-t.ch}function o(e,t,n,r){this.line=t,this.ch=n,this.cm=e,this.text=e.getLine(t),this.min=r?r.from:e.firstLine(),this.max=r?r.to-1:e.lastLine()}function u(e,n){var r=e.cm.getTokenTypeAt(t(e.line,n));return r&&/\btag\b/.test(r)}function a(e){if(e.line>=e.max)return;return e.ch=0,e.text=e.cm.getLine(++e.line),!0}function f(e){if(e.line<=e.min)return;return e.text=e.cm.getLine(--e.line),e.ch=e.text.length,!0}function l(e){for(;;){var t=e.text.indexOf(">",e.ch);if(t==-1){if(a(e))continue;return}if(!u(e,t+1)){e.ch=t+1;continue}var n=e.text.lastIndexOf("/",t),r=n>-1&&!/\S/.test(e.text.slice(n+1,t));return e.ch=t+1,r?"selfClose":"regular"}}function c(e){for(;;){var t=e.ch?e.text.lastIndexOf("<",e.ch-1):-1;if(t==-1){if(f(e))continue;return}if(!u(e,t+1)){e.ch=t;continue}s.lastIndex=t,e.ch=t;var n=s.exec(e.text);if(n&&n.index==t)return n}}function h(e){for(;;){s.lastIndex=e.ch;var t=s.exec(e.text);if(!t){if(a(e))continue;return}if(!u(e,t.index+1)){e.ch=t.index+1;continue}return e.ch=t.index+t[0].length,t}}function p(e){for(;;){var t=e.ch?e.text.lastIndexOf(">",e.ch-1):-1;if(t==-1){if(f(e))continue;return}if(!u(e,t+1)){e.ch=t;continue}var n=e.text.lastIndexOf("/",t),r=n>-1&&!/\S/.test(e.text.slice(n+1,t));return e.ch=t+1,r?"selfClose":"regular"}}function d(e,n){var r=[];for(;;){var i=h(e),s,o=e.line,u=e.ch-(i?i[0].length:0);if(!i||!(s=l(e)))return;if(s=="selfClose")continue;if(i[1]){for(var a=r.length-1;a>=0;--a)if(r[a]==i[2]){r.length=a;break}if(a<0&&(!n||n==i[2]))return{tag:i[2],from:t(o,u),to:t(e.line,e.ch)}}else r.push(i[2])}}function v(e,n){var r=[];for(;;){var i=p(e);if(!i)return;if(i=="selfClose"){c(e);continue}var s=e.line,o=e.ch,u=c(e);if(!u)return;if(u[1])r.push(u[2]);else{for(var a=r.length-1;a>=0;--a)if(r[a]==u[2]){r.length=a;break}if(a<0&&(!n||n==u[2]))return{tag:u[2],from:t(e.line,e.ch),to:t(s,o)}}}}var t=e.Pos,r="A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD",i=r+"-:.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040",s=new RegExp("<(/?)(["+r+"]["+i+"]*)","g");e.registerHelper("fold","xml",function(e,n){var r=new o(e,n.line,0);for(;;){var i=h(r),s;if(!i||r.line!=n.line||!(s=l(r)))return;if(!i[1]&&s!="selfClose"){var n=t(r.line,r.ch),u=d(r,i[2]);return u&&{from:n,to:u.from}}}}),e.findMatchingTag=function(e,r,i){var s=new o(e,r.line,r.ch,i);if(s.text.indexOf(">")==-1&&s.text.indexOf("<")==-1)return;var u=l(s),a=u&&t(s.line,s.ch),f=u&&c(s);if(!u||u=="selfClose"||!f||n(s,r)>0)return;var h={from:t(s.line,s.ch),to:a,tag:f[2]};return f[1]?{open:v(s,f[2]),close:h,at:"close"}:(s=new o(e,a.line,a.ch,i),{open:h,close:d(s,f[2]),at:"open"})},e.findEnclosingTag=function(e,t,n){var r=new o(e,t.line,t.ch,n);for(;;){var i=v(r);if(!i)break;var s=new o(e,t.line,t.ch,n),u=d(s,i.tag);if(u)return{open:i,close:u}}},e.scanForClosingTag=function(e,t,n,r){var i=new o(e,t.line,t.ch,r?{from:0,to:r}:null);return!!d(i,n)}});