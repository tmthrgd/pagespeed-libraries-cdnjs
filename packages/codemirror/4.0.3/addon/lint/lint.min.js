(function(e){typeof exports=="object"&&typeof module=="object"?e(require("../../lib/codemirror")):typeof define=="function"&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)})(function(e){"use strict";function r(t,n){function i(t){if(!r.parentNode)return e.off(document,"mousemove",i);r.style.top=Math.max(0,t.clientY-r.offsetHeight-5)+"px",r.style.left=t.clientX+5+"px"}var r=document.createElement("div");return r.className="CodeMirror-lint-tooltip",r.appendChild(n.cloneNode(!0)),document.body.appendChild(r),e.on(document,"mousemove",i),i(t),r.style.opacity!=null&&(r.style.opacity=1),r}function i(e){e.parentNode&&e.parentNode.removeChild(e)}function s(e){if(!e.parentNode)return;e.style.opacity==null&&i(e),e.style.opacity=0,setTimeout(function(){i(e)},600)}function o(t,n,i){function u(){e.off(i,"mouseout",u),o&&(s(o),o=null)}var o=r(t,n),a=setInterval(function(){if(o)for(var e=i;;e=e.parentNode){if(e==document.body)return;if(!e){u();break}}if(!o)return clearInterval(a)},400);e.on(i,"mouseout",u)}function u(e,t,n){this.marked=[],this.options=t,this.timeout=null,this.hasGutter=n,this.onMouseOver=function(t){b(e,t)}}function a(t,n){if(n instanceof Function)return{getAnnotations:n};if(!n||n===!0)n={};n.getAnnotations||(n.getAnnotations=t.getHelper(e.Pos(0,0),"lint"));if(!n.getAnnotations)throw new Error("Required option 'getAnnotations' missing (lint addon)");return n}function f(e){var n=e.state.lint;n.hasGutter&&e.clearGutter(t);for(var r=0;r<n.marked.length;++r)n.marked[r].clear();n.marked.length=0}function l(t,n,r,i){var s=document.createElement("div"),u=s;return s.className="CodeMirror-lint-marker-"+n,r&&(u=s.appendChild(document.createElement("div")),u.className="CodeMirror-lint-marker-multiple"),i!=0&&e.on(u,"mouseover",function(e){o(e,t,u)}),s}function c(e,t){return e=="error"?e:t}function h(e){var t=[];for(var n=0;n<e.length;++n){var r=e[n],i=r.from.line;(t[i]||(t[i]=[])).push(r)}return t}function p(e){var t=e.severity;n.test(t)||(t="error");var r=document.createElement("div");return r.className="CodeMirror-lint-message-"+t,r.appendChild(document.createTextNode(e.message)),r}function d(e){var t=e.state.lint,n=t.options;n.async?n.getAnnotations(e,v,n):v(e,n.getAnnotations(e.getValue(),n.options))}function v(e,r){f(e);var i=e.state.lint,s=i.options,o=h(r);for(var u=0;u<o.length;++u){var a=o[u];if(!a)continue;var d=null,v=i.hasGutter&&document.createDocumentFragment();for(var m=0;m<a.length;++m){var g=a[m],y=g.severity;n.test(y)||(y="error"),d=c(d,y),s.formatAnnotation&&(g=s.formatAnnotation(g)),i.hasGutter&&v.appendChild(p(g)),g.to&&i.marked.push(e.markText(g.from,g.to,{className:"CodeMirror-lint-mark-"+y,__annotation:g}))}i.hasGutter&&e.setGutterMarker(u,t,l(v,d,a.length>1,i.options.tooltips))}s.onUpdateLinting&&s.onUpdateLinting(r,o,e)}function m(e){var t=e.state.lint;clearTimeout(t.timeout),t.timeout=setTimeout(function(){d(e)},t.options.delay||500)}function g(e,t){var n=t.target||t.srcElement;o(t,p(e),n)}function b(e,t){if(!/\bCodeMirror-lint-mark-/.test((t.target||t.srcElement).className))return;for(var n=0;n<y.length;n+=2){var r=e.findMarksAt(e.coordsChar({left:t.clientX+y[n],top:t.clientY+y[n+1]},"client"));for(var i=0;i<r.length;++i){var s=r[i],o=s.__annotation;if(o)return g(o,t)}}}var t="CodeMirror-lint-markers",n=/^(?:error|warning)$/,y=[0,0,0,5,0,-5,5,0,-5,0];e.defineOption("lint",!1,function(n,r,i){i&&i!=e.Init&&(f(n),n.off("change",m),e.off(n.getWrapperElement(),"mouseover",n.state.lint.onMouseOver),delete n.state.lint);if(r){var s=n.getOption("gutters"),o=!1;for(var l=0;l<s.length;++l)s[l]==t&&(o=!0);var c=n.state.lint=new u(n,a(n,r),o);n.on("change",m),c.options.tooltips!=0&&e.on(n.getWrapperElement(),"mouseover",c.onMouseOver),d(n)}})});