!function(e){"object"==typeof exports&&"object"==typeof module?e(require("../../lib/codemirror")):"function"==typeof define&&define.amd?define(["../../lib/codemirror"],e):e(CodeMirror)}(function(e){"use strict";e.defineMode("smarty",function(t,r){function i(e,t){return d=t,e}function n(e,t,r){return t.tokenize=r,r(e,t)}function a(e,t){return null==t&&(t=e.pos),3===p&&"{"==c&&(t==e.string.length||/\s/.test(e.string.charAt(t)))}function o(e,t){if(e.match(c,!0)){if(e.eat("*"))return n(e,t,l("comment","*"+s));if(!a(e))return t.depth++,t.tokenize=u,d="startTag","tag"}var r=h.token(e,t.base),i=e.current(),o=i.indexOf(c);return o>-1&&!a(e,e.start+o+1)&&e.backUp(i.length-o),r}function u(e,t){if(e.match(s,!0))return 3===p?(t.depth--,t.depth<=0&&(t.tokenize=o)):t.tokenize=o,i("tag",null);if(e.match(c,!0))return t.depth++,i("tag","startTag");var r=e.next();if("$"==r)return e.eatWhile(k.validIdentifier),i("variable-2","variable");if("|"==r)return i("operator","pipe");if("."==r)return i("operator","property");if(k.stringChar.test(r))return t.tokenize=f(r),i("string","string");if(k.operatorChars.test(r))return e.eatWhile(k.operatorChars),i("operator","operator");if("["==r||"]"==r)return i("bracket","bracket");if("("==r||")"==r)return i("bracket","operator");if(/\d/.test(r))return e.eatWhile(/\d/),i("number","number");if("variable"==t.last){if("@"==r)return e.eatWhile(k.validIdentifier),i("property","property");if("|"==r)return e.eatWhile(k.validIdentifier),i("qualifier","modifier")}else{if("pipe"==t.last)return e.eatWhile(k.validIdentifier),i("qualifier","modifier");if("whitespace"==t.last)return e.eatWhile(k.validIdentifier),i("attribute","modifier")}if("property"==t.last)return e.eatWhile(k.validIdentifier),i("property",null);if(/\s/.test(r))return d="whitespace",null;var n="";"/"!=r&&(n+=r);for(var a=null;a=e.eat(k.validIdentifier);)n+=a;for(var u=0,l=b.length;l>u;u++)if(b[u]==n)return i("keyword","keyword");return/\s/.test(r)?null:i("tag","tag")}function f(e){return function(t,r){for(var i=null,n=null;!t.eol();){if(n=t.peek(),t.next()==e&&"\\"!==i){r.tokenize=u;break}i=n}return"string"}}function l(e,t){return function(r,i){for(;!r.eol();){if(r.match(t)){i.tokenize=o;break}r.next()}return e}}var d,s=r.rightDelimiter||"}",c=r.leftDelimiter||"{",p=r.version||2,h=e.getMode(t,r.baseMode||"null"),b=["debug","extends","function","include","literal"],k={operatorChars:/[+\-*&%=<>!?]/,validIdentifier:/[a-zA-Z0-9_]/,stringChar:/['"]/};return{startState:function(){return{base:e.startState(h),tokenize:o,last:null,depth:0}},copyState:function(t){return{base:e.copyState(h,t.base),tokenize:t.tokenize,last:t.last,depth:t.depth}},innerMode:function(e){return e.tokenize==o?{mode:h,state:e.base}:void 0},token:function(e,t){var r=t.tokenize(e,t);return t.last=d,r},blockCommentStart:c+"*",blockCommentEnd:"*"+s}}),e.defineMIME("text/x-smarty","smarty")});