CodeMirror.defineMode("tiddlywiki",function(e){function t(e,t,n){return t.tokenize=n,n(e,t)}function n(e,t,n){return d=e,p=n,t}function i(e,i){var d,p=e.sol();if(i.block=!1,d=e.peek(),p&&/[<\/\*{}\-]/.test(d)){if(e.match(T))return i.block=!0,t(e,i,o);if(e.match(y))return n("quote","quote");if(e.match(b)||e.match(v))return n("code","comment");if(e.match(k)||e.match(_)||e.match(E)||e.match(C))return n("code","comment");if(e.match(f))return n("hr","hr")}if(d=e.next(),p&&/[\/\*!#;:>|]/.test(d)){if("!"==d)return e.skipToEnd(),n("header","header");if("*"==d)return e.eatWhile("*"),n("list","comment");if("#"==d)return e.eatWhile("#"),n("list","comment");if(";"==d)return e.eatWhile(";"),n("list","comment");if(":"==d)return e.eatWhile(":"),n("list","comment");if(">"==d)return e.eatWhile(">"),n("quote","quote");if("|"==d)return n("table","header")}if("{"==d&&e.match(/\{\{/))return t(e,i,o);if(/[hf]/i.test(d)&&/[ti]/i.test(e.peek())&&e.match(/\b(ttps?|tp|ile):\/\/[\-A-Z0-9+&@#\/%?=~_|$!:,.;]*[A-Z0-9+&@#\/%=~_|$]/i))return n("link","link");if('"'==d)return n("string","string");if("~"==d)return n("text","brace");if(/[\[\]]/.test(d)&&e.peek()==d)return e.next(),n("brace","brace");if("@"==d)return e.eatWhile(g),n("link","link");if(/\d/.test(d))return e.eatWhile(/\d/),n("number","number");if("/"==d){if(e.eat("%"))return t(e,i,r);if(e.eat("/"))return t(e,i,s)}if("_"==d&&e.eat("_"))return t(e,i,l);if("-"==d&&e.eat("-")){if(" "!=e.peek())return t(e,i,c);if(" "==e.peek())return n("text","brace")}if("'"==d&&e.eat("'"))return t(e,i,a);if("<"!=d)return n(d);if(e.eat("<"))return t(e,i,u);e.eatWhile(/[\w\$_]/);var h=e.current(),w=m.propertyIsEnumerable(h)&&m[h];return w?n(w.type,w.style,h):n("text",null,h)}function r(e,t){for(var r,a=!1;r=e.next();){if("/"==r&&a){t.tokenize=i;break}a="%"==r}return n("comment","comment")}function a(e,t){for(var r,a=!1;r=e.next();){if("'"==r&&a){t.tokenize=i;break}a="'"==r}return n("text","strong")}function o(e,t){var r,a=t.block;return a&&e.current()?n("code","comment"):!a&&e.match(x)?(t.tokenize=i,n("code","comment")):a&&e.sol()&&e.match(w)?(t.tokenize=i,n("code","comment")):(r=e.next(),a?n("code","comment"):n("code","comment"))}function s(e,t){for(var r,a=!1;r=e.next();){if("/"==r&&a){t.tokenize=i;break}a="/"==r}return n("text","em")}function l(e,t){for(var r,a=!1;r=e.next();){if("_"==r&&a){t.tokenize=i;break}a="_"==r}return n("text","underlined")}function c(e,t){for(var r,a=!1;r=e.next();){if("-"==r&&a){t.tokenize=i;break}a="-"==r}return n("text","strikethrough")}function u(e,t){var r,a,o;return"<<"==e.current()?n("brace","macro"):(r=e.next())?">"==r&&">"==e.peek()?(e.next(),t.tokenize=i,n("brace","macro")):(e.eatWhile(/[\w\$_]/),a=e.current(),o=h.propertyIsEnumerable(a)&&h[a],o?n(o.type,o.style,a):n("macro",null,a)):(t.tokenize=i,n(r))}e.indentUnit;var d,p,m=function(){return{}}(),h=function(){function e(e){return{type:e,style:"macro"}}return{allTags:e("allTags"),closeAll:e("closeAll"),list:e("list"),newJournal:e("newJournal"),newTiddler:e("newTiddler"),permaview:e("permaview"),saveChanges:e("saveChanges"),search:e("search"),slider:e("slider"),tabs:e("tabs"),tag:e("tag"),tagging:e("tagging"),tags:e("tags"),tiddler:e("tiddler"),timeline:e("timeline"),today:e("today"),version:e("version"),option:e("option"),"with":e("with"),filter:e("filter")}}(),g=/[\w_\-]/i,f=/^\-\-\-\-+$/,b=/^\/\*\*\*$/,v=/^\*\*\*\/$/,y=/^<<<$/,k=/^\/\/\{\{\{$/,_=/^\/\/\}\}\}$/,E=/^<!--\{\{\{-->$/,C=/^<!--\}\}\}-->$/,T=/^\{\{\{$/,w=/^\}\}\}$/,x=/.*?\}\}\}/;return{startState:function(){return{tokenize:i,indented:0,level:0}},token:function(e,t){if(e.eatSpace())return null;var n=t.tokenize(e,t);return n},electricChars:""}}),CodeMirror.defineMIME("text/x-tiddlywiki","tiddlywiki");