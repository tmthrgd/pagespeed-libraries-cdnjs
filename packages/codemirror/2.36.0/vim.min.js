(function(){function e(e,t){return t>=0&&e.lineCount()>t}function t(){L=""}function n(e){L+=e}function i(e){return function(){F=10*F+e}}function r(){var e=F;return e||1}function a(){F=0}function o(e){for(var t=0,n=r();n>t;++t)e(t,t==n-1);a()}function s(e){return"string"==typeof e&&(e=CodeMirror.commands[e]),function(t){o(function(n,i){e(t,n,i)})}}function l(e,t){for(var n in e)e.hasOwnProperty(n)&&t(n,e[n])}function c(e,t){for(var n=0;e.length>n;++n)t(e[n])}function u(e){return"Shift-"==e.slice(0,6)?e.slice(0,1):"Space"==e?" ":3==e.length&&"'"==e[0]&&"'"==e[2]?e[1]:e.toLowerCase()}function d(e){if(" "==e)return"Space";var t=B.indexOf(e);return-1!=t?"'"+e+"'":e.toLowerCase()==e?e.toUpperCase():"Shift-"+e.toUpperCase()}function p(t,n,i,r,a){for(var o=t.getLine(n);;){for(var s=r>0?o.length:-1,l=s,c=s;i!=s;i+=r)for(var u=0;a.length>u;++u)if(a[u].test(o.charAt(i))){for(l=i;i!=s&&a[u].test(o.charAt(i));i+=r);return c=r>0?i:i+1,{from:Math.min(l,c),to:Math.max(l,c),line:n}}if(n+=r,!e(t,n))return null;o=t.getLine(n),i=r>0?0:o.length}}function m(t,n,i,r,a,o){var s=t.getCursor();o&&(a="start");for(var l=0;r>l;l++)for(var c,u=s.ch,d=s.line;;){if(c=p(t,s.line,s.ch,i,n),!c){for(;e(t,s.line+i);s.line+=i);s.ch=i>0?t.getLine(s.line).length:0;break}if(o&&1==r&&1==i&&s.line!=c.line){s.ch=t.getLine(s.line).length;break}if(s.line=c.line,i>0&&"end"==a){if(u!=c.to-1||d!=c.line){s.ch=c.to-1;break}s.ch=c.to}else if(i>0&&"start"==a){if(u!=c.from||d!=c.line){s.ch=c.from;break}s.ch=c.to}else if(0>i&&"end"==a){if(u!=c.to||d!=c.line){s.ch=c.to;break}s.ch=c.from-1}else if(0>i&&"start"==a){if(u!=c.from||d!=c.line){s.ch=c.from;break}s.ch=c.from-1}}return"end"==a&&o&&s.ch++,s}function h(e){var t=e.getCursor();t.ch,e.getLine(t.line),CodeMirror.commands.goLineEnd(e),t.line!=e.lineCount()&&(CodeMirror.commands.goLineEnd(e),e.replaceSelection(" ","end"),CodeMirror.commands.delCharRight(e))}function g(e,t){var i=N[t];if(void 0!==i){var r=e.getCursor().line,a=i>r?r:i,o=i>r?i:r;e.setCursor(a);for(var s=a;o>=s;s++)n("\n"+e.getLine(a)),e.removeLine(a)}}function f(e,t){var i=N[t];if(void 0!==i){for(var r=e.getCursor().line,a=i>r?r:i,o=i>r?i:r,s=a;o>=s;s++)n("\n"+e.getLine(s));e.setCursor(a)}}function b(e){var t=e.getCursor(),n=e.getLine(t.line).search(/\S/);e.setCursor(t.line,-1==n?line.length:n,!0)}function v(e,t,n){var i,r=e.getCursor(),a=e.getLine(r.line),o=u(t),s=n;return s.forward?(i=a.indexOf(o,r.ch+1),-1!=i&&s.inclusive&&(i+=1)):(i=a.lastIndexOf(o,r.ch),-1==i||s.inclusive||(i+=1)),i}function y(e,t,n){var i=v(e,t,n),r=e.getCursor();-1!=i&&e.setCursor({line:r.line,ch:i})}function k(e,t,n){var i=v(e,t,n),r=e.getCursor();-1!==i&&(n.forward?e.replaceRange("",{line:r.line,ch:r.ch},{line:r.line,ch:i}):e.replaceRange("",{line:r.line,ch:i},{line:r.line,ch:r.ch}))}function _(e){a(),e.setOption("keyMap","vim-insert")}function C(e,t,n,i){e.openDialog?e.openDialog(t,i):i(prompt(n,""))}function E(e,t){var n=t.replace(/[<&]/,function(e){return"<"==e?"&lt;":"&amp;"});e.openDialog?e.openDialog(n+" <button type=button>OK</button>"):alert(t)}function T(e){CodeMirror.keyMap["vim-prefix-m"][e]=function(t){N[e]=t.getCursor().line},CodeMirror.keyMap["vim-prefix-d'"][e]=function(t){g(t,e)},CodeMirror.keyMap["vim-prefix-y'"][e]=function(t){f(t,e)},CodeMirror.keyMap["vim-prefix-r"][e]=function(t){var n=t.getCursor();t.replaceRange(u(e),{line:n.line,ch:n.ch},{line:n.line,ch:n.ch+1}),CodeMirror.commands.goColumnLeft(t)},l(K,function(t,n){CodeMirror.keyMap["vim-prefix-"+t][e]=function(t){y(t,e,n)},CodeMirror.keyMap["vim-prefix-d"+t][e]=function(t){k(t,e,n)},CodeMirror.keyMap["vim-prefix-c"+t][e]=function(t){k(t,e,n),_(t)}})}function w(e,t,n){var i=t.line,n=n?n:e.getLine(i)[t.ch],r=-1!=["(","[","{"].indexOf(n),a=function(e){switch(e){case"(":return")";case"[":return"]";case"{":return"}";case")":return"(";case"]":return"[";case"}":return"{";default:return null}}(n);if(null==a)return t;for(var o=r?0:1;;){if(i==t.line)var s=r?e.getLine(i).substr(t.ch).split(""):e.getLine(i).substr(0,t.ch).split("").reverse();else var s=r?e.getLine(i).split(""):e.getLine(i).split("").reverse();for(var l=0;s.length>l;l++)if(s[l]==n?o++:s[l]==a&&o--,0==o)return r&&t.line==i?{line:i,ch:l+t.ch}:r?{line:i,ch:l}:{line:i,ch:s.length-l-1};r?i++:i--}}function x(e,t,n){var i=e.getCursor(),r=w(e,i,t),a=w(e,r);return a.ch+=n?1:0,r.ch+=n?0:1,{start:a,end:r}}function S(e,t,n){var i=e.getCursor(),r=e.getLine(i.line),a=r.split(""),o=void 0,s=void 0,l=a.indexOf(t);if(l>i.ch?(i.ch=l,e.setCursor(i.line,l+1)):i.ch>l&&a[i.ch]==t&&(s=i.ch,--i.ch),a[i.ch]==t&&null==s)o=i.ch+1;else for(var c=i.ch;c>-1&&null==o;c--)a[c]==t&&(o=c+1);if(null!=o&&null==s)for(var c=o,u=a.length;u>c&&null==s;c++)a[c]==t&&(s=c);return null==o||null==s?{start:i,end:i}:(n&&(--o,++s),{start:{line:i.line,ch:o},end:{line:i.line,ch:s}})}function A(e,t,n){var i=e.getCursor();return{line:i.line+t,ch:i.ch+n}}function R(e){keyMap=CodeMirror.keyMap[e],keyMap["0"]=function(e){F>0?i(0)(e):CodeMirror.commands.goLineStart(e)};for(var t=1;10>t;++t)keyMap[t]=i(t)}function I(e,t,n){for(var i=null==n?e.length:n;i>=0;--i)if(t.test(e.charAt(i)))return i;return-1}function D(e,t,i,r,a){var o=W[t](e,a),s=o.start,l=o.end;if(s.line>l.line||s.line==l.line&&s.ch>l.ch)var c=!0;n(e.getRange(c?l:s,c?s:l)),i&&e.replaceRange("",c?l:s,c?s:l),r&&e.setOption("keyMap","vim-insert")}var O="f",L="",N={},F=0,B="~`!@#$%^&*()_-+=[{}]\\|/?.,<>:;\"'1234567890",P=[/\w/,/[^\w\s]/],M=[/\S/],z=CodeMirror.keyMap.vim={"'|'":function(e){e.setCursor(e.getCursor().line,r()-1,!0),a()},A:function(e){e.setCursor(e.getCursor().line,e.getCursor().ch+1,!0),_(e)},"Shift-A":function(e){CodeMirror.commands.goLineEnd(e),_(e)},I:function(e){_(e)},"Shift-I":function(e){b(e),_(e)},O:function(e){CodeMirror.commands.goLineEnd(e),CodeMirror.commands.newlineAndIndent(e),_(e)},"Shift-O":function(e){CodeMirror.commands.goLineStart(e),e.replaceSelection("\n","start"),e.indentLine(e.getCursor().line),_(e)},G:function(e){e.setOption("keyMap","vim-prefix-g")},"Shift-D":function(e){var i=e.getCursor(),r=i.line,a=e.getLine(r);e.setLine(r,a.slice(0,i.ch)),t(),n(a.slice(i.ch)),F>1&&(--F,++r,o(function(){n(e.getLine(r)),e.removeLine(r)}))},S:function(e){s(function(e){CodeMirror.commands.delCharRight(e)})(e),_(e)},M:function(e){e.setOption("keyMap","vim-prefix-m"),N={}},Y:function(e){e.setOption("keyMap","vim-prefix-y"),t()},"Shift-Y":function(e){t(),o(function(t){n("\n"+e.getLine(e.getCursor().line+t))})},"/":function(e){var t=CodeMirror.commands.find;t&&t(e),O="f"},"'?'":function(e){var t=CodeMirror.commands.find;t&&(t(e),CodeMirror.commands.findPrev(e),O="r")},N:function(e){var t=CodeMirror.commands.findNext;t&&("r"!=O?t(e):CodeMirror.commands.findPrev(e))},"Shift-N":function(e){var t=CodeMirror.commands.findNext;t&&("r"!=O?CodeMirror.commands.findPrev(e):t.findNext(e))},"Shift-G":function(e){0==F?e.setCursor(e.lineCount()):e.setCursor(F-1),a(),CodeMirror.commands.goLineStart(e)},"':'":function(e){var t=': <input type="text" style="width: 90%"/>';C(e,t,":",function(t){t.match(/^\d+$/)?e.setCursor(t-1,e.getCursor().ch):E(e,"Bad command: "+t)})},nofallthrough:!0,style:"fat-cursor"};c(["d","t","T","f","F","c","r"],function(e){CodeMirror.keyMap.vim[d(e)]=function(n){n.setOption("keyMap","vim-prefix-"+e),t()}}),l({X:function(e){CodeMirror.commands.delCharRight(e)},P:function(e){e.getCursor().line,""!=L&&("\n"==L[0]&&CodeMirror.commands.goLineEnd(e),e.replaceRange(L,e.getCursor()))},"Shift-X":function(e){CodeMirror.commands.delCharLeft(e)},"Shift-J":function(e){h(e)},"Shift-P":function(e){var t=e.getCursor().line;""!=L&&(CodeMirror.commands.goLineUp(e),CodeMirror.commands.goLineEnd(e),e.replaceSelection(L,"end")),e.setCursor(t+1)},"'~'":function(e){var t=e.getCursor(),n=e.getRange({line:t.line,ch:t.ch},{line:t.line,ch:t.ch+1});n=n!=n.toLowerCase()?n.toLowerCase():n.toUpperCase(),e.replaceRange(n,{line:t.line,ch:t.ch},{line:t.line,ch:t.ch+1}),e.setCursor(t.line,t.ch+1)},"Ctrl-B":function(e){CodeMirror.commands.goPageUp(e)},"Ctrl-F":function(e){CodeMirror.commands.goPageDown(e)},"Ctrl-P":"goLineUp","Ctrl-N":"goLineDown",U:"undo","Ctrl-R":"redo"},function(e,t){z[e]=s(t)}),c(["vim-prefix-d'","vim-prefix-y'","vim-prefix-df","vim-prefix-dF","vim-prefix-dt","vim-prefix-dT","vim-prefix-c","vim-prefix-cf","vim-prefix-cF","vim-prefix-ct","vim-prefix-cT","vim-prefix-","vim-prefix-f","vim-prefix-F","vim-prefix-t","vim-prefix-T","vim-prefix-r","vim-prefix-m"],function(e){CodeMirror.keyMap[e]={auto:"vim",nofallthrough:!0,style:"fat-cursor"}}),CodeMirror.keyMap["vim-prefix-g"]={E:s(function(e){e.setCursor(m(e,P,-1,1,"end"))}),"Shift-E":s(function(e){e.setCursor(m(e,M,-1,1,"end"))}),G:function(e){e.setCursor({line:F-1,ch:e.getCursor().ch}),a()},auto:"vim",nofallthrough:!0,style:"fat-cursor"},CodeMirror.keyMap["vim-prefix-d"]={D:s(function(e){n("\n"+e.getLine(e.getCursor().line)),e.removeLine(e.getCursor().line),e.setOption("keyMap","vim")}),"'":function(e){e.setOption("keyMap","vim-prefix-d'"),t()},B:function(e){var t=e.getCursor(),i=e.getLine(t.line),r=i.lastIndexOf(" ",t.ch);n(i.substring(r,t.ch)),e.replaceRange("",{line:t.line,ch:r},t),e.setOption("keyMap","vim")},nofallthrough:!0,style:"fat-cursor"},CodeMirror.keyMap["vim-prefix-c"]={B:function(e){s("delWordLeft")(e),_(e)},C:function(e){o(function(t,n){CodeMirror.commands.deleteLine(e),t&&(CodeMirror.commands.delCharRight(e),n&&CodeMirror.commands.deleteLine(e))}),_(e)},nofallthrough:!0,style:"fat-cursor"},c(["vim-prefix-d","vim-prefix-c","vim-prefix-"],function(e){c(["f","F","T","t"],function(n){CodeMirror.keyMap[e][d(n)]=function(i){i.setOption("keyMap",e+n),t()}})});for(var K={t:{inclusive:!1,forward:!0},f:{inclusive:!0,forward:!0},T:{inclusive:!1,forward:!1},F:{inclusive:!0,forward:!1}},$=65;91>$;$++){var j=String.fromCharCode($);T(d(j)),T(d(j.toLowerCase()))}for(var $=0;B.length>$;++$)T(d(B.charAt($)));T("Space"),CodeMirror.keyMap["vim-prefix-y"]={Y:s(function(e,t){n("\n"+e.getLine(e.getCursor().line+t)),e.setOption("keyMap","vim")}),"'":function(e){e.setOption("keyMap","vim-prefix-y'"),t()},nofallthrough:!0,style:"fat-cursor"},CodeMirror.keyMap["vim-insert"]={Esc:function(e){e.setCursor(e.getCursor().line,e.getCursor().ch-1,!0),e.setOption("keyMap","vim")},"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",fallthrough:["default"]};var H={J:function(e,t){return A(e,t,0)},Down:function(e,t){return A(e,t,0)},K:function(e,t){return A(e,-t,0)},Up:function(e,t){return A(e,-t,0)},L:function(e,t){return A(e,0,t)},Right:function(e,t){return A(e,0,t)},Space:function(e,t){return A(e,0,t)},H:function(e,t){return A(e,0,-t)},Left:function(e,t){return A(e,0,-t)},Backspace:function(e,t){return A(e,0,-t)},B:function(e,t,n){return m(e,P,-1,t,"start",n)},"Shift-B":function(e,t,n){return m(e,M,-1,t,"start",n)},E:function(e,t,n){return m(e,P,1,t,"end",n)},"Shift-E":function(e,t,n){return m(e,M,1,t,"end",n)},W:function(e,t,n){return m(e,P,1,t,"start",n)},"Shift-W":function(e,t,n){return m(e,M,1,t,"start",n)},"'^'":function(e){for(var t=e.getCursor(),n=e.getLine(t.line).split(""),i=0;n.length>i;i++)if(n[i].match(/[^\s]/))return{line:t.line,ch:index};return t},"'$'":function(e){var t=e.getCursor(),n=e.getLine(t.line).length;return{line:t.line,ch:n}},"'%'":function(e){return w(e,e.getCursor())},Esc:function(e){return e.setOption("keyMap","vim"),F=0,e.getCursor()}};l(H,function(e,t){CodeMirror.keyMap["vim-prefix-d"][e]=function(e){var i=e.getCursor(),r=t(e,F?F:1,!0);if(i.line>r.line||i.line==r.line&&i.ch>r.ch)var a=!0;n(e.getRange(a?r:i,a?i:r)),e.replaceRange("",a?r:i,a?i:r),F=0,e.setOption("keyMap","vim")},CodeMirror.keyMap["vim-prefix-c"][e]=function(e){var i=e.getCursor(),r=t(e,F?F:1,!0);if(i.line>r.line||i.line==r.line&&i.ch>r.ch)var a=!0;n(e.getRange(a?r:i,a?i:r)),e.replaceRange("",a?r:i,a?i:r),F=0,e.setOption("keyMap","vim-insert")},CodeMirror.keyMap["vim-prefix-y"][e]=function(e){var i=e.getCursor(),r=t(e,F?F:1,!0);if(i.line>r.line||i.line==r.line&&i.ch>r.ch)var a=!0;n(e.getRange(a?r:i,a?i:r)),F=0,e.setOption("keyMap","vim")},CodeMirror.keyMap.vim[e]=function(e){var n=t(e,F?F:1);e.setCursor(n.line,n.ch),F=0}}),R("vim"),R("vim-prefix-d"),R("vim-prefix-y"),R("vim-prefix-c");var U=["d","y","c"];c(U,function(e){CodeMirror.keyMap["vim-prefix-"+e+"a"]={auto:"vim",nofallthrough:!0,style:"fat-cursor"},CodeMirror.keyMap["vim-prefix-"+e+"i"]={auto:"vim",nofallthrough:!0,style:"fat-cursor"},CodeMirror.keyMap["vim-prefix-"+e].A=function(t){F=0,t.setOption("keyMap","vim-prefix-"+e+"a")},CodeMirror.keyMap["vim-prefix-"+e].I=function(t){F=0,t.setOption("keyMap","vim-prefix-"+e+"i")}});for(var q=["W","Shift-[","Shift-9","[","'","Shift-'"],W={W:function(e,t){var n=e.getCursor(),i=e.getLine(n.line),r=new String(i.substring(0,n.ch)),a=I(r,/[^a-zA-Z0-9]/)+1,o=H.E(e,1);return o.ch+=t?1:0,{start:{line:n.line,ch:a},end:o}},"Shift-[":function(e,t){return x(e,"}",t)},"Shift-9":function(e,t){return x(e,")",t)},"[":function(e,t){return x(e,"]",t)},"'":function(e,t){return S(e,"'",t)},"Shift-'":function(e,t){return S(e,'"',t)}},$=0;q.length>$;++$){var V=q[$];(function(e){CodeMirror.keyMap["vim-prefix-di"][e]=function(t){D(t,e,!0,!1,!1)},CodeMirror.keyMap["vim-prefix-da"][e]=function(t){D(t,e,!0,!1,!0)},CodeMirror.keyMap["vim-prefix-yi"][e]=function(t){D(t,e,!1,!1,!1)},CodeMirror.keyMap["vim-prefix-ya"][e]=function(t){D(t,e,!1,!1,!0)},CodeMirror.keyMap["vim-prefix-ci"][e]=function(t){D(t,e,!0,!0,!1)},CodeMirror.keyMap["vim-prefix-ca"][e]=function(t){D(t,e,!0,!0,!0)}})(V)}})();