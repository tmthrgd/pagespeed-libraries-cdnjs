(function(){function e(e,t,n,i){if(this.atOccurrence=!1,this.cm=e,null==i&&"string"==typeof t&&(i=!1),n=n?e.clipPos(n):{line:0,ch:0},this.pos={from:n,to:n},"string"!=typeof t)t.global||(t=RegExp(t.source,t.ignoreCase?"ig":"g")),this.matches=function(n,i){if(n){t.lastIndex=0;for(var r=e.getLine(i.line).slice(0,i.ch),a=t.exec(r),o=0;a;){o+=a.index+1,r=r.slice(o),t.lastIndex=0;var s=t.exec(r);if(!s)break;a=s}o--}else{t.lastIndex=i.ch;var r=e.getLine(i.line),a=t.exec(r),o=a&&a.index}return a?{from:{line:i.line,ch:o},to:{line:i.line,ch:o+a[0].length},match:a}:void 0};else{i&&(t=t.toLowerCase());var r=i?function(e){return e.toLowerCase()}:function(e){return e},a=t.split("\n");this.matches=1==a.length?function(n,i){var a,o=r(e.getLine(i.line)),s=t.length;return(n?i.ch>=s&&-1!=(a=o.lastIndexOf(t,i.ch-s)):-1!=(a=o.indexOf(t,i.ch)))?{from:{line:i.line,ch:a},to:{line:i.line,ch:a+s}}:void 0}:function(t,n){var i=n.line,o=t?a.length-1:0,s=a[o],l=r(e.getLine(i)),c=t?l.indexOf(s)+s.length:l.lastIndexOf(s);if(!(t?c>=n.ch||c!=s.length:n.ch>=c||c!=l.length-s.length))for(;;){if(t?!i:i==e.lineCount()-1)return;if(l=r(e.getLine(i+=t?-1:1)),s=a[t?--o:++o],!(o>0&&a.length-1>o)){var u=t?l.lastIndexOf(s):l.indexOf(s)+s.length;if(t?u!=l.length-s.length:u!=s.length)return;var d={line:n.line,ch:c},p={line:i,ch:u};return{from:t?p:d,to:t?d:p}}if(l!=s)return}}}}e.prototype={findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(e){function t(e){var t={line:e,ch:0};return n.pos={from:t,to:t},n.atOccurrence=!1,!1}for(var n=this,i=this.cm.clipPos(e?this.pos.from:this.pos.to);;){if(this.pos=this.matches(e,i))return this.atOccurrence=!0,this.pos.match||!0;if(e){if(!i.line)return t(0);i={line:i.line-1,ch:this.cm.getLine(i.line-1).length}}else{var r=this.cm.lineCount();if(i.line==r-1)return t(r);i={line:i.line+1,ch:0}}}},from:function(){return this.atOccurrence?this.pos.from:void 0},to:function(){return this.atOccurrence?this.pos.to:void 0},replace:function(e){var t=this;this.atOccurrence&&(t.pos.to=this.cm.replaceRange(e,t.pos.from,t.pos.to))}},CodeMirror.defineExtension("getSearchCursor",function(t,n,i){return new e(this,t,n,i)})})();