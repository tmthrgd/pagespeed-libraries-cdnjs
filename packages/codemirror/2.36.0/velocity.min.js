CodeMirror.defineMode("velocity",function(e){function t(e){for(var t={},n=e.split(" "),i=0;n.length>i;++i)t[n[i]]=!0;return t}function n(e,t,n){return t.tokenize=n,n(e,t)}function i(e,t){var i=t.beforeParams;t.beforeParams=!1;var d=e.next();if('"'!=d&&"'"!=d||!t.inParams){if(/[\[\]{}\(\),;\.]/.test(d))return"("==d&&i?t.inParams=!0:")"==d&&(t.inParams=!1),null;if(/\d/.test(d))return e.eatWhile(/[\w\.]/),"number";if("#"==d&&e.eat("*"))return n(e,t,a);if("#"==d&&e.match(/ *\[ *\[/))return n(e,t,o);if("#"==d&&e.eat("#"))return e.skipToEnd(),"comment";if("$"==d)return e.eatWhile(/[\w\d\$_\.{}]/),c&&c.propertyIsEnumerable(e.current().toLowerCase())?"keyword":(t.beforeParams=!0,"builtin");if(u.test(d))return e.eatWhile(u),"operator";e.eatWhile(/[\w\$_{}]/);var p=e.current().toLowerCase();return s&&s.propertyIsEnumerable(p)?"keyword":l&&l.propertyIsEnumerable(p)||e.current().match(/^#[a-z0-9_]+ *$/i)&&"("==e.peek()?(t.beforeParams=!0,"keyword"):null}return n(e,t,r(d))}function r(e){return function(t,n){for(var r,a=!1,o=!1;null!=(r=t.next());){if(r==e&&!a){o=!0;break}a=!a&&"\\"==r}return o&&(n.tokenize=i),"string"}}function a(e,t){for(var n,r=!1;n=e.next();){if("#"==n&&r){t.tokenize=i;break}r="*"==n}return"comment"}function o(e,t){for(var n,r=0;n=e.next();){if("#"==n&&2==r){t.tokenize=i;break}"]"==n?r++:" "!=n&&(r=0)}return"meta"}e.indentUnit;var s=t("#end #else #break #stop #[[ #]] #{end} #{else} #{break} #{stop}"),l=t("#if #elseif #foreach #set #include #parse #macro #define #evaluate #{if} #{elseif} #{foreach} #{set} #{include} #{parse} #{macro} #{define} #{evaluate}"),c=t("$foreach.count $foreach.hasNext $foreach.first $foreach.last $foreach.topmost $foreach.parent $velocityCount"),u=/[+\-*&%=<>!?:\/|]/;return{startState:function(){return{tokenize:i,beforeParams:!1,inParams:!1}},token:function(e,t){return e.eatSpace()?null:t.tokenize(e,t)}}}),CodeMirror.defineMIME("text/velocity","velocity");