CodeMirror.defineMode("tiki",function(e){function t(e,t,n){return function(r,a){for(;!r.eol();){if(r.match(t)){a.tokenize=i;break}r.next()}return n&&(a.tokenize=n),e}}function n(e){return function(t,n){for(;!t.eol();)t.next();return n.tokenize=i,e}}function i(e,a){function o(t){return a.tokenize=t,t(e,a)}var s=e.sol(),l=e.next();switch(l){case"{":e.eat("/")?"closeTag":"openTag",e.eatSpace();for(var c,u="";c=e.eat(/[^\s\u00a0=\"\'\/?(}]/);)u+=c;return a.tokenize=r,"tag";case"_":if(e.eat("_"))return o(t("strong","__",i));break;case"'":if(e.eat("'"))return o(t("em","''",i));break;case"(":if(e.eat("("))return o(t("variable-2","))",i));break;case"[":return o(t("variable-3","]",i));case"|":if(e.eat("|"))return o(t("comment","||"));break;case"-":if(e.eat("="))return o(t("header string","=-",i));if(e.eat("-"))return o(t("error tw-deleted","--",i));break;case"=":if(e.match("=="))return o(t("tw-underline","===",i));break;case":":if(e.eat(":"))return o(t("comment","::"));break;case"^":return o(t("tw-box","^"));case"~":if(e.match("np~"))return o(t("meta","~/np~"))}if(s)switch(l){case"!":return e.match("!!!!!")?o(n("header string")):e.match("!!!!")?o(n("header string")):e.match("!!!")?o(n("header string")):e.match("!!")?o(n("header string")):o(n("header string"));case"*":case"#":case"+":return o(n("tw-listitem bracket"))}return null}function r(e,t){var n=e.next(),r=e.peek();return"}"==n?(t.tokenize=i,"tag"):"("==n||")"==n?"bracket":"="==n?(v="equals",">"==r&&(n=e.next(),r=e.peek()),/[\'\"]/.test(r)||(t.tokenize=o()),"operator"):/[\'\"]/.test(n)?(t.tokenize=a(n),t.tokenize(e,t)):(e.eatWhile(/[^\s\u00a0=\"\'\/?]/),"keyword")}function a(e){return function(t,n){for(;!t.eol();)if(t.next()==e){n.tokenize=r;break}return"string"}}function o(){return function(e,t){for(;!e.eol();){var n=e.next(),i=e.peek();if(" "==n||","==n||/[ )}]/.test(i)){t.tokenize=r;break}}return"string"}}function s(){for(var e=arguments.length-1;e>=0;e--)y.cc.push(arguments[e])}function l(){return s.apply(null,arguments),!0}function c(e,t){var n=y.context&&y.context.noIndent;y.context={prev:y.context,pluginName:e,indent:y.indented,startOfLine:t,noIndent:n}}function u(){y.context&&(y.context=y.context.prev)}function d(e){if("openPlugin"==e)return y.pluginName=b,l(h,p(y.startOfLine));if("closePlugin"==e){var t=!1;return y.context?(t=y.context.pluginName!=b,u()):t=!0,t&&(k="error"),l(m(t))}return"string"==e?(y.context&&"!cdata"==y.context.name||c("!cdata"),y.tokenize==i&&u(),l()):l()}function p(e){return function(t){return"selfclosePlugin"==t||"endPlugin"==t?l():"endPlugin"==t?(c(y.pluginName,e),l()):l()}}function m(e){return function(t){return e&&(k="error"),"endPlugin"==t?l():s()}}function h(e){return"keyword"==e?(k="attribute",l(h)):"equals"==e?l(g,h):s()}function g(e){return"keyword"==e?(k="string",l()):"string"==e?l(f):s()}function f(e){return"string"==e?l(f):s()}var b,v,y,k,_=e.indentUnit;return{startState:function(){return{tokenize:i,cc:[],indented:0,startOfLine:!0,pluginName:null,context:null}},token:function(e,t){if(e.sol()&&(t.startOfLine=!0,t.indented=e.indentation()),e.eatSpace())return null;k=v=b=null;var n=t.tokenize(e,t);if((n||v)&&"comment"!=n)for(y=t;;){var i=t.cc.pop()||d;if(i(v||n))break}return t.startOfLine=!1,k||n},indent:function(e,t){var n=e.context;if(n&&n.noIndent)return 0;for(n&&/^{\//.test(t)&&(n=n.prev);n&&!n.startOfLine;)n=n.prev;return n?n.indent+_:0},electricChars:"/"}}),CodeMirror.defineMIME("text/tiki","tiki");