(function(){var n,t,r,e,u,i,o,s,c,a,f,l,h,p,y,g,m,d,v,b,w,E,M,S,_,A,I,W,x,k,T,O,B,C,H,V,D,P,q,L,z,N,U,j,F,R,Q,Z,$,K,X,G,J,Y,nt,tt,rt,et,ut,it,ot,st,ct,at,ft,lt,ht,pt=[].slice,yt={}.hasOwnProperty,gt=function(n,t){function r(){this.constructor=n}for(var e in t)yt.call(t,e)&&(n[e]=t[e]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},mt=function(n,t){return function(){return n.apply(t,arguments)}};n={toString:function(){return"Bacon"}},n.version="0.7.17",n.fromBinder=function(t,r){return null==r&&(r=lt.id),new l(B(n,"fromBinder",t,r),function(e){var u,i,o;return o=!1,u=function(){return"undefined"!=typeof i&&null!==i?(o||i(),o=!0):void 0},i=t(function(){var t,o,s,c,a,l;for(t=1<=arguments.length?pt.call(arguments,0):[],c=r.apply(null,t),z(c)&&lt.last(c)instanceof f||(c=[c]),s=n.more,a=0,l=c.length;l>a;a++)if(o=c[a],s=e(o=ut(o)),s===n.noMore||o.isEnd())return null!=i?u():n.scheduler.setTimeout(u,0),s;return s}),u})},n.$={asEventStream:function(t,r,e){var u;return U(r)&&(u=[r,null],e=u[0],r=u[1]),at(this.selector||this,"asEventStream",t,n.fromBinder(function(n){return function(e){return n.on(t,r,e),function(){return n.off(t,r,e)}}}(this),e))}},null!=(ht="undefined"!=typeof jQuery&&null!==jQuery?jQuery:"undefined"!=typeof Zepto&&null!==Zepto?Zepto:null)&&(ht.fn.asEventStream=n.$.asEventStream),n.fromEventTarget=function(t,r,e){var u,i,o,s,c,a;return u=null!=(o=t.addEventListener)?o:null!=(s=t.addListener)?s:t.bind,i=null!=(c=t.removeEventListener)?c:null!=(a=t.removeListener)?a:t.unbind,at(n,"fromEventTarget",t,r,n.fromBinder(function(n){return u.call(t,r,n),function(){return i.call(t,r,n)}},e))},n.fromPromise=function(t,r){return at(n,"fromPromise",t,n.fromBinder(function(n){return t.then(n,function(t){return n(new a(t))}),function(){return r&&"function"==typeof t.abort?t.abort():void 0}},function(n){return[n,C()]}))},n.noMore=["<no-more>"],n.more=["<more>"],n.later=function(t,r){return at(n,"later",t,r,n.sequentially(t,[r]))},n.sequentially=function(t,r){var e;return e=0,at(n,"sequentially",t,r,n.fromPoll(t,function(){var n;return n=r[e++],e<r.length?n:e===r.length?[n,C()]:C()}))},n.repeatedly=function(t,r){var e;return e=0,at(n,"repeatedly",t,r,n.fromPoll(t,function(){return r[e++%r.length]}))},n.spy=function(n){return rt.push(n)},rt=[],tt=function(n){var t,r,e,u;if(rt.length&&!tt.running)try{for(tt.running=!0,u=[],r=0,e=rt.length;e>r;r++)t=rt[r],u.push(t(n));return u}finally{delete tt.running}},ft=function(n){return function(){var t,r,e,u;return e=arguments[0],t=2<=arguments.length?pt.call(arguments,1):[],"object"==typeof e&&t.length&&(r=e,u=t[0],e=function(){return r[u].apply(r,arguments)},t=t.slice(1)),n.apply(null,[e].concat(pt.call(t)))}},R=function(t,r){return ft(function(){var e,u,i;return u=arguments[0],e=2<=arguments.length?pt.call(arguments,1):[],i=Y(r,[function(n,t){return u.apply(null,pt.call(n).concat([t]))}]),at.apply(null,[n,t,u].concat(pt.call(e),[n.combineAsArray(e).flatMap(i)]))})},n.fromCallback=R("fromCallback",function(){var t,r;return r=arguments[0],t=2<=arguments.length?pt.call(arguments,1):[],n.fromBinder(function(n){return Q(r,t)(n),J},function(n){return[n,C()]})}),n.fromNodeCallback=R("fromNodeCallback",function(){var t,r;return r=arguments[0],t=2<=arguments.length?pt.call(arguments,1):[],n.fromBinder(function(n){return Q(r,t)(n),J},function(n,t){return n?[new a(n),C()]:[t,C()]})}),n.fromPoll=function(t,r){return at(n,"fromPoll",t,r,n.fromBinder(function(r){var e;return e=n.scheduler.setInterval(r,t),function(){return n.scheduler.clearInterval(e)}},r))},n.interval=function(t,r){return null==r&&(r={}),at(n,"interval",t,r,n.fromPoll(t,function(){return G(r)}))},n.constant=function(t){return new m(B(n,"constant",t),function(n){return n(L(t)),n(C()),J})},n.never=function(){return at(n,"never",n.fromArray([]))},n.once=function(t){return at(n,"once",t,n.fromArray([t]))},n.fromArray=function(t){return S(t),t=x(t),new l(B(n,"fromArray",t),function(r){var e,u,i;for(u=!1,e=n.more;e!==n.noMore&&!u;)lt.empty(t)?(r(C()),e=n.noMore):(i=t.splice(0,1)[0],e=r(ut(i)));return function(){return u=!0}})},n.mergeAll=function(){var t;return t=1<=arguments.length?pt.call(arguments,0):[],z(t[0])&&(t=t[0]),t.length?new l(B.apply(null,[n,"mergeAll"].concat(pt.call(t))),function(r){var e,u,i;return e=0,i=function(u){return function(i){return u.subscribeInternal(function(u){var o;return u.isEnd()?(e++,e===t.length?r(C()):n.more):(o=r(u),o===n.noMore&&i(),o)})}},u=lt.map(i,t),k.apply(null,u)}):n.never()},n.zipAsArray=function(){var t;return t=1<=arguments.length?pt.call(arguments,0):[],z(t[0])&&(t=t[0]),at.apply(null,[n,"zipAsArray"].concat(pt.call(t),[n.zipWith(t,function(){var n;return n=1<=arguments.length?pt.call(arguments,0):[]})]))},n.zipWith=function(){var t,r,e;return t=arguments[0],r=2<=arguments.length?pt.call(arguments,1):[],U(t)||(e=[t,r[0]],r=e[0],t=e[1]),r=lt.map(function(n){return n.toEventStream()},r),at.apply(null,[n,"zipWith",t].concat(pt.call(r),[n.when(r,t)]))},n.groupSimultaneous=function(){var r,e,u;return u=1<=arguments.length?pt.call(arguments,0):[],1===u.length&&z(u[0])&&(u=u[0]),e=function(){var n,e,i;for(i=[],n=0,e=u.length;e>n;n++)r=u[n],i.push(new t(r));return i}(),at.apply(null,[n,"groupSimultaneous"].concat(pt.call(u),[n.when(e,function(){var n;return n=1<=arguments.length?pt.call(arguments,0):[]})]))},n.combineAsArray=function(){var t,r,e,u,i,o,s;for(i=1<=arguments.length?pt.call(arguments,0):[],1===i.length&&z(i[0])&&(i=i[0]),t=o=0,s=i.length;s>o;t=++o)u=i[t],j(u)||(i[t]=n.constant(u));return i.length?(e=function(){var n,t,e;for(e=[],n=0,t=i.length;t>n;n++)r=i[n],e.push(new b(r,!0,r.subscribeInternal));return e}(),at.apply(null,[n,"combineAsArray"].concat(pt.call(i),[n.when(e,function(){var n;return n=1<=arguments.length?pt.call(arguments,0):[]}).toProperty()]))):n.constant([])},n.onValues=function(){var t,r,e;return r=2<=arguments.length?pt.call(arguments,0,e=arguments.length-1):(e=0,[]),t=arguments[e++],n.combineAsArray(r).onValues(t)},n.combineWith=function(){var t,r;return t=arguments[0],r=2<=arguments.length?pt.call(arguments,1):[],at.apply(null,[n,"combineWith",t].concat(pt.call(r),[n.combineAsArray(r).map(function(n){return t.apply(null,n)})]))},n.combineTemplate=function(t){var r,e,u,i,o,s,c,a,f,l;return c=[],l=[],s=function(n){return n[n.length-1]},f=function(n,t,r){return s(n)[t]=r},r=function(n,t){return function(r,e){return f(r,n,e[t])}},o=function(n,t){return function(r){return f(r,n,t)}},a=function(n){return z(n)?[]:{}},u=function(n,t){var e,u;return j(t)?(l.push(t),c.push(r(n,l.length-1))):t!==Object(t)||"function"==typeof t||t instanceof RegExp||t instanceof Date?c.push(o(n,t)):(u=function(n){return function(r){var e;return e=a(t),f(r,n,e),r.push(e)}},e=function(n){return n.pop()},c.push(u(n)),i(t),c.push(e))},i=function(n){return lt.each(n,u)},i(t),e=function(n){var r,e,u,i,o;for(u=a(t),r=[u],i=0,o=c.length;o>i;i++)(e=c[i])(r,n);return u},at(n,"combineTemplate",t,n.combineAsArray(l).map(e))},n.retry=function(t){var r,e,u,i,o,s;if(!U(t.source))throw"'source' option has to be a function";return s=t.source,i=t.retries||0,u=t.maxRetries||i,r=t.delay||function(){return 0},e=t.isRetryable||function(){return!0},o=function(t){var o,c;return c={source:s,retries:i-1,maxRetries:u,delay:r,isRetryable:e},o=function(){return n.retry(c)},n.later(r(t)).filter(!1).concat(n.once().flatMap(o))},at(n,"retry",t,s().flatMapError(function(t){return e(t)&&i>0?o({error:t,retriesDone:u-i}):n.once(new n.Error(t))}))},H=0,f=function(){function n(){this.id=++H}return n.prototype.isEvent=function(){return!0},n.prototype.isEnd=function(){return!1},n.prototype.isInitial=function(){return!1},n.prototype.isNext=function(){return!1},n.prototype.isError=function(){return!1},n.prototype.hasValue=function(){return!1},n.prototype.filter=function(){return!0},n.prototype.inspect=function(){return this.toString()},n.prototype.log=function(){return this.toString()},n}(),p=function(n){function t(n){t.__super__.constructor.call(this),this.value=U(n)?lt.cached(n):lt.always(n)}return gt(t,n),t.prototype.isNext=function(){return!0},t.prototype.hasValue=function(){return!0},t.prototype.fmap=function(n){var t;return t=this.value,this.apply(function(){return n(t())})},t.prototype.apply=function(n){return new t(n)},t.prototype.filter=function(n){return n(this.value())},t.prototype.toString=function(){return lt.toString(this.value())},t.prototype.log=function(){return this.value()},t}(f),h=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,n),t.prototype.isInitial=function(){return!0},t.prototype.isNext=function(){return!1},t.prototype.apply=function(n){return new t(n)},t.prototype.toNext=function(){return new p(this.value)},t}(p),c=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,n),t.prototype.isEnd=function(){return!0},t.prototype.fmap=function(){return this},t.prototype.apply=function(){return this},t.prototype.toString=function(){return"<end>"},t}(f),a=function(n){function t(n){this.error=n}return gt(t,n),t.prototype.isError=function(){return!0},t.prototype.fmap=function(){return this},t.prototype.apply=function(){return this},t.prototype.toString=function(){return"<error> "+lt.toString(this.error)},t}(f),q=0,g=function(){function t(n){this.flatMapError=mt(this.flatMapError,this),this.id=++q,at(n,this)}return t.prototype.onValue=function(){var n;return n=Z(arguments),this.subscribe(function(t){return t.hasValue()?n(t.value()):void 0})},t.prototype.onValues=function(n){return this.onValue(function(t){return n.apply(null,t)})},t.prototype.onError=function(){var n;return n=Z(arguments),this.subscribe(function(t){return t.isError()?n(t.error):void 0})},t.prototype.onEnd=function(){var n;return n=Z(arguments),this.subscribe(function(t){return t.isEnd()?n():void 0})},t.prototype.errors=function(){return at(this,"errors",this.filter(function(){return!1}))},t.prototype.filter=function(){var t,r;return r=arguments[0],t=2<=arguments.length?pt.call(arguments,1):[],O(this,r,t,function(t){return at(this,"filter",t,this.withHandler(function(r){return r.filter(t)?this.push(r):n.more}))})},t.prototype.takeWhile=function(){var t,r;return r=arguments[0],t=2<=arguments.length?pt.call(arguments,1):[],O(this,r,t,function(t){return at(this,"takeWhile",t,this.withHandler(function(r){return r.filter(t)?this.push(r):(this.push(C()),n.noMore)}))})},t.prototype.endOnError=function(){var n,t;return t=arguments[0],n=2<=arguments.length?pt.call(arguments,1):[],null==t&&(t=!0),O(this,t,n,function(n){return at(this,"endOnError",this.withHandler(function(t){return t.isError()&&n(t.error)?(this.push(t),this.push(C())):this.push(t)}))})},t.prototype.take=function(t){return 0>=t?n.never():at(this,"take",t,this.withHandler(function(r){return r.hasValue()?(t--,t>0?this.push(r):(0===t&&this.push(r),this.push(C()),n.noMore)):this.push(r)}))},t.prototype.map=function(){var n,t;return t=arguments[0],n=2<=arguments.length?pt.call(arguments,1):[],t instanceof m?t.sampledBy(this,P):O(this,t,n,function(n){return at(this,"map",n,this.withHandler(function(t){return this.push(t.fmap(n))}))})},t.prototype.mapError=function(){var n;return n=Z(arguments),at(this,"mapError",n,this.withHandler(function(t){return this.push(t.isError()?G(n(t.error)):t)}))},t.prototype.mapEnd=function(){var t;return t=Z(arguments),at(this,"mapEnd",t,this.withHandler(function(r){return r.isEnd()?(this.push(G(t(r))),this.push(C()),n.noMore):this.push(r)}))},t.prototype.doAction=function(){var n;return n=Z(arguments),at(this,"doAction",n,this.withHandler(function(t){return t.hasValue()&&n(t.value()),this.push(t)}))},t.prototype.skip=function(t){return at(this,"skip",t,this.withHandler(function(r){return r.hasValue()&&t>0?(t--,n.more):this.push(r)}))},t.prototype.skipDuplicates=function(n){return null==n&&(n=function(n,t){return n===t}),at(this,"skipDuplicates",this.withStateMachine(y,function(t,r){return r.hasValue()?r.isInitial()||t===y||!n(t.get(),r.value())?[new v(r.value()),[r]]:[t,[]]:[t,[r]]}))},t.prototype.skipErrors=function(){return at(this,"skipErrors",this.withHandler(function(t){return t.isError()?n.more:this.push(t)}))},t.prototype.withStateMachine=function(t,r){var e;return e=t,at(this,"withStateMachine",t,r,this.withHandler(function(t){var u,i,o,s,c,a,f;for(u=r(e,t),i=u[0],s=u[1],e=i,c=n.more,a=0,f=s.length;f>a;a++)if(o=s[a],c=this.push(o),c===n.noMore)return c;return c}))},t.prototype.scan=function(t,r,e){var u,i,o,s;return null==e&&(e={}),i=et(r),r=e.lazyF?i:function(n,t){return i(n(),t())},u=st(t).map(function(n){return lt.always(n)}),s=function(t){return function(i){var s,c,a,f;return s=!1,f=J,c=n.more,a=function(){return s?void 0:u.forEach(function(t){return s=!0,c=i(new h(t)),c===n.noMore?(f(),f=J):void 0})},f=t.subscribeInternal(function(t){var o,f;return t.hasValue()?s&&t.isInitial()?n.more:(t.isInitial()||a(),s=!0,f=u.getOrElse(function(){return void 0}),o=lt.cached(function(){return r(f,t.value)}),u=new v(o),e.eager&&o(),i(t.apply(o))):(t.isEnd()&&(c=a()),c!==n.noMore?i(t):void 0)}),w.whenDoneWith(o,a),f}}(this),o=new m(B(this,"scan",t,r),s)},t.prototype.fold=function(n,t,r){return at(this,"fold",n,t,this.scan(n,t,r).sampledBy(this.filter(!1).mapEnd().toProperty()))},t.prototype.zip=function(t,r){return null==r&&(r=Array),at(this,"zip",t,n.zipWith([this,t],r))},t.prototype.diff=function(n,t){return t=et(t),at(this,"diff",n,t,this.scan([n],function(n,r){return[r,t(n[0],r)]}).filter(function(n){return 2===n.length}).map(function(n){return n[1]}))},t.prototype.flatMap=function(){return D(this,X(arguments))},t.prototype.flatMapFirst=function(){return D(this,X(arguments),!0)},t.prototype.flatMapWithConcurrencyLimit=function(){var n,t;return t=arguments[0],n=2<=arguments.length?pt.call(arguments,1):[],at.apply(null,[this,"flatMapWithConcurrencyLimit",t].concat(pt.call(n),[D(this,X(n),!1,t)]))},t.prototype.flatMapLatest=function(){var n,t;return n=X(arguments),t=this.toEventStream(),at(this,"flatMapLatest",n,t.flatMap(function(r){return K(n(r)).takeUntil(t)}))},t.prototype.flatMapError=function(t){return at(this,"flatMapError",t,this.mapError(function(t){return new n.Error(t)}).flatMap(function(r){return r instanceof n.Error?t(r.error):n.once(r)}))},t.prototype.flatMapConcat=function(){return at.apply(null,[this,"flatMapConcat"].concat(pt.call(arguments),[this.flatMapWithConcurrencyLimit.apply(this,[1].concat(pt.call(arguments)))]))},t.prototype.bufferingThrottle=function(t){return at(this,"bufferingThrottle",t,this.flatMapConcat(function(r){return n.once(r).concat(n.later(t).filter(!1))}))},t.prototype.not=function(){return at(this,"not",this.map(function(n){return!n}))},t.prototype.log=function(){var n;return n=1<=arguments.length?pt.call(arguments,0):[],this.subscribe(function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log.apply(console,pt.call(n).concat([t.log()])):void 0}),this},t.prototype.slidingWindow=function(n,t){return null==t&&(t=0),at(this,"slidingWindow",n,t,this.scan([],function(t,r){return t.concat([r]).slice(-n)}).filter(function(n){return n.length>=t}))},t.prototype.combine=function(t,r){var e;return e=et(r),at(this,"combine",t,r,n.combineAsArray(this,t).map(function(n){return e(n[0],n[1])}))},t.prototype.decode=function(t){return at(this,"decode",t,this.combine(n.combineTemplate(t),function(n,t){return t[n]}))},t.prototype.awaiting=function(t){return at(this,"awaiting",t,n.groupSimultaneous(this,t).map(function(n){var t,r;return t=n[0],r=n[1],0===r.length}).toProperty(!1).skipDuplicates())},t.prototype.name=function(n){return this.toString=function(){return n},this},t.prototype.withDescription=function(){return B.apply(null,arguments).apply(this)},t}(),g.prototype.reduce=g.prototype.fold,g.prototype.assign=g.prototype.onValue,D=function(t,r,u,o){var s,c;return s=[t],c=new l(B(t,"flatMap"+(u?"First":""),r),function(c){var a,f,l,p,y;return l=new e,p=[],y=function(t){var e;return e=K(r(t.value())),s.push(e),i.invalidate(),l.add(function(t,r){return e.subscribeInternal(function(u){var o;return u.isEnd()?(lt.remove(e,s),i.invalidate(),f(),a(r),n.noMore):(u instanceof h&&(u=u.toNext()),o=c(u),o===n.noMore&&t(),o)})})},f=function(){var n;return n=p.splice(0,1)[0],n?y(n):void 0},a=function(n){return n(),l.empty()?c(C()):void 0},l.add(function(r,e){return t.subscribeInternal(function(t){return t.isEnd()?a(e):t.isError()?c(t):u&&l.count()>1?n.more:l.unsubscribed?n.noMore:o&&l.count()>o?p.push(t):y(t)})}),l.unsubscribe}),c.internalDeps=function(){return s},c},l=function(t){function r(n,t){var e;U(n)&&(t=n,n=[]),r.__super__.constructor.call(this,n),A(t),e=new s(t),this.subscribeInternal=e.subscribe,this.subscribe=w.wrappedSubscribe(this),this.hasSubscribers=e.hasSubscribers,tt(this)}return gt(r,t),r.prototype.delay=function(t){return at(this,"delay",t,this.flatMap(function(r){return n.later(t,r)}))},r.prototype.debounce=function(t){return at(this,"debounce",t,this.flatMapLatest(function(r){return n.later(t,r)}))},r.prototype.debounceImmediate=function(t){return at(this,"debounceImmediate",t,this.flatMapFirst(function(r){return n.once(r).concat(n.later(t).filter(!1))}))},r.prototype.throttle=function(n){return at(this,"throttle",n,this.bufferWithTime(n).map(function(n){return n[n.length-1]}))},r.prototype.bufferWithTime=function(n){return at(this,"bufferWithTime",n,this.bufferWithTimeOrCount(n,Number.MAX_VALUE))},r.prototype.bufferWithCount=function(n){return at(this,"bufferWithCount",n,this.bufferWithTimeOrCount(void 0,n))},r.prototype.bufferWithTimeOrCount=function(n,t){var r;return r=function(r){return r.values.length===t?r.flush():void 0!==n?r.schedule():void 0},at(this,"bufferWithTimeOrCount",n,t,this.buffer(n,r,r))},r.prototype.buffer=function(t,r,e){var u,i,o;return null==r&&(r=function(){}),null==e&&(e=function(){}),u={scheduled:!1,end:null,values:[],flush:function(){var t;if(this.scheduled=!1,this.values.length>0){if(t=this.push(G(this.values)),this.values=[],null!=this.end)return this.push(this.end);if(t!==n.noMore)return e(this)}else if(null!=this.end)return this.push(this.end)},schedule:function(){return this.scheduled?void 0:(this.scheduled=!0,t(function(n){return function(){return n.flush()}}(this)))}},o=n.more,U(t)||(i=t,t=function(t){return n.scheduler.setTimeout(t,i)}),at(this,"buffer",this.withHandler(function(n){return u.push=this.push,n.isError()?o=this.push(n):n.isEnd()?(u.end=n,u.scheduled||u.flush()):(u.values.push(n.value()),r(u)),o}))},r.prototype.merge=function(t){var r;return _(t),r=this,at(r,"merge",t,n.mergeAll(this,t))},r.prototype.toProperty=function(n){return 0===arguments.length&&(n=y),at(this,"toProperty",n,this.scan(n,F,{lazyF:!0}))},r.prototype.toEventStream=function(){return this},r.prototype.sampledBy=function(n,t){return at(this,"sampledBy",n,t,this.toProperty().sampledBy(n,t))},r.prototype.concat=function(n){var t;return t=this,new r(B(t,"concat",n),function(r){var e,u;return u=J,e=t.subscribeInternal(function(t){return t.isEnd()?u=n.subscribeInternal(r):r(t)}),function(){return e(),u()}})},r.prototype.takeUntil=function(t){var r;return r={},at(this,"takeUntil",t,n.groupSimultaneous(this.mapEnd(r),t.skipErrors()).withHandler(function(e){var u,i,o,s,c,a;if(e.hasValue()){if(a=e.value(),u=a[0],t=a[1],t.length)return this.push(C());for(i=n.more,s=0,c=u.length;c>s;s++)o=u[s],i=this.push(o===r?C():G(o));return i}return this.push(e)}))},r.prototype.skipUntil=function(n){var t;return t=n.take(1).map(!0).toProperty(!1),at(this,"skipUntil",n,this.filter(t))},r.prototype.skipWhile=function(){var t,r,e;return r=arguments[0],t=2<=arguments.length?pt.call(arguments,1):[],e=!1,O(this,r,t,function(t){return at(this,"skipWhile",t,this.withHandler(function(r){return!e&&r.hasValue()&&t(r.value())?n.more:(r.hasValue()&&(e=!0),this.push(r))}))})},r.prototype.holdWhen=function(t){var r,e,u;return u=t.startWith(!1),e=u.filter(function(n){return!n}),r=u.filter(lt.id),at(this,"holdWhen",t,this.filter(!1).merge(u.flatMapConcat(function(t){return function(u){return u?t.scan([],function(n,t){return n.concat(t)},{eager:!0}).sampledBy(e).take(1).flatMap(n.fromArray):t.takeUntil(r)}}(this))))},r.prototype.startWith=function(t){return at(this,"startWith",t,n.once(t).concat(this))},r.prototype.withHandler=function(n){var t;return t=new s(this.subscribeInternal,n),new r(B(this,"withHandler",n),t.subscribe)},r}(g),m=function(t){function r(n,t,e){U(n)&&(e=t,t=n,n=[]),r.__super__.constructor.call(this,n),A(t),this.subscribeInternal=e===!0?t:new d(this,t,e).subscribe,this.subscribe=w.wrappedSubscribe(this),tt(this)}return gt(r,t),r.prototype.sampledBy=function(t,e){var u,i,o,s,c;return null!=e?e=et(e):(u=!0,e=function(n){return n()}),c=new b(this,!1,this.subscribeInternal,u),o=new b(t,!0,t.subscribeInternal,u),s=n.when([c,o],e),i=t instanceof r?s.toProperty():s,at(this,"sampledBy",t,e,i)},r.prototype.sample=function(t){return at(this,"sample",t,this.sampledBy(n.interval(t,{})))},r.prototype.changes=function(){return new l(B(this,"changes"),function(n){return function(t){return n.subscribeInternal(function(n){return n.isInitial()?void 0:t(n)})}}(this))},r.prototype.withHandler=function(n){return new r(B(this,"withHandler",n),this.subscribeInternal,n)},r.prototype.toProperty=function(){return I(arguments),this},r.prototype.toEventStream=function(){return new l(B(this,"toEventStream"),function(n){return function(t){return n.subscribeInternal(function(n){return n.isInitial()&&(n=n.toNext()),t(n)})}}(this))},r.prototype.and=function(n){return at(this,"and",n,this.combine(n,function(n,t){return n&&t}))},r.prototype.or=function(n){return at(this,"or",n,this.combine(n,function(n,t){return n||t}))},r.prototype.delay=function(n){return this.delayChanges("delay",n,function(t){return t.delay(n)})},r.prototype.debounce=function(n){return this.delayChanges("debounce",n,function(t){return t.debounce(n)})},r.prototype.throttle=function(n){return this.delayChanges("throttle",n,function(t){return t.throttle(n)})},r.prototype.delayChanges=function(){var n,t,r;return n=2<=arguments.length?pt.call(arguments,0,r=arguments.length-1):(r=0,[]),t=arguments[r++],at.apply(null,[this].concat(pt.call(n),[E(this,t(this.changes()))]))},r.prototype.takeUntil=function(n){var t;return t=this.changes().takeUntil(n),at(this,"takeUntil",n,E(this,t))},r.prototype.startWith=function(n){return at(this,"startWith",n,this.scan(n,function(n,t){return t}))},r.prototype.bufferingThrottle=function(){var n;return(n=r.__super__.bufferingThrottle.apply(this,arguments)).bufferingThrottle.apply(n,arguments).toProperty()},r}(g),O=function(n,t,r,e){var u;return t instanceof m?(u=t.sampledBy(n,function(n,t){return[n,t]}),e.apply(u,[function(n){var t,r;return t=n[0],r=n[1],t}]).map(function(n){var t,r;return t=n[0],r=n[1]})):(t=Q(t,r),e.apply(n,[t]))},E=function(t,r){var e;return e=new l(B(t,"justInitValue"),function(r){var u,i;return i=null,u=t.subscribeInternal(function(t){return t.hasValue()&&(i=t),n.noMore}),w.whenDoneWith(e,function(){return null!=i&&r(i),r(C())}),u}),e.concat(r).toProperty()},s=function(){function t(t,r){var e,u,i,o,s,c,a,f,l,h;null==t&&(t=function(){return J}),f=[],c=[],s=!1,u=!1,this.hasSubscribers=function(){return f.length>0},i=null,l=J,a=function(n){return f=lt.without(n,f)},h=null,e=function(){var n,t,r,e,u;if(null!=h){for(t=h,h=null,u=[],r=0,e=t.length;e>r;r++)n=t[r],u.push(n());return u}},o=function(t){var r,u,o,h,p,y;if(s)return c.push(t),n.more;if(t!==i){t.isError()&&(i=t),o=!1;try{for(s=!0,h=f,p=0,y=h.length;y>p;p++)u=h[p],r=u.sink(t),(r===n.noMore||t.isEnd())&&a(u);o=!0}finally{s=!1,o||(c=[])}for(o=!0;c.length;)t=c.shift(),this.push(t);return e(t),this.hasSubscribers()?n.more:(l(),n.noMore)}},this.push=function(n){return function(t){return w.inTransaction(t,n,o,[t])}}(this),null==r&&(r=function(n){return this.push(n)}),this.handleEvent=function(n){return function(t){return t.isEnd()&&(u=!0),r.apply(n,[t])}}(this),this.subscribe=function(n){return function(r){var e,i;return u?(r(C()),J):(A(r),e={sink:r},f.push(e),1===f.length&&(i=t(n.handleEvent),l=function(){return i(),l=J}),A(l),function(){return a(e),n.hasSubscribers()?void 0:l()})}}(this)}return t}(),d=function(t){function r(t,e,u){var i,o,s,c;r.__super__.constructor.call(this,e,u),i=y,o=void 0,c=this.push,e=this.subscribe,s=!1,this.push=function(n){return function(t){return t.isEnd()&&(s=!0),t.hasValue()&&(i=new v(t),o=w.currentEventId()),c.apply(n,[t])}}(this),this.subscribe=function(r){return function(u){var c,a,f,l,h;return a=!1,l=n.more,f=function(){return l===n.noMore?J:s?(u(C()),J):e.apply(this,[u])},i.isDefined&&(r.hasSubscribers()||s)?(c=w.currentEventId(),h=o,!s&&h&&c&&c!==h?(w.whenDoneWith(t,function(){return o===h?u(L(i.get().value())):void 0}),f()):(w.inTransaction(void 0,r,function(){return l=u(L(i.get().value()))},[]),f())):f()}}(this)}return gt(r,t),r}(s),r=function(t){function r(){var t,e,u,i,o,s,c,f;u=void 0,s=[],t=!1,e=function(){return function(t){return function(r){return r.isEnd()?(f(t),n.noMore):u(r)}}}(this),c=function(){var n,t,r,e;for(e=[],t=0,r=s.length;r>t;t++)n=s[t],e.push("function"==typeof n.unsub?n.unsub():void 0);return e},o=function(n){return n.unsub=n.input.subscribeInternal(e(n.input))},f=function(n){var t,r,e,u;for(t=e=0,u=s.length;u>e;t=++e)if(r=s[t],r.input===n)return"function"==typeof r.unsub&&r.unsub(),void s.splice(t,1)},i=function(){return function(n){var t,r,e,i;for(u=n,i=x(s),r=0,e=i.length;e>r;r++)t=i[r],o(t);return c}}(this),r.__super__.constructor.call(this,B(n,"Bus"),i),this.plug=function(){return function(n){var r;if(!t)return r={input:n},s.push(r),null!=u&&o(r),function(){return f(n)}}}(this),this.push=function(){return function(n){return"function"==typeof u?u(G(n)):void 0}}(this),this.error=function(){return function(n){return"function"==typeof u?u(new a(n)):void 0}}(this),this.end=function(){return function(){return t=!0,c(),"function"==typeof u?u(C()):void 0}}(this)}return gt(r,t),r}(l),b=function(){function n(n,t,r,e){this.obs=n,this.sync=t,this.subscribe=r,this.lazy=null!=e?e:!1,this.queue=[],null==this.subscribe&&(this.subscribe=this.obs.subscribeInternal),this.toString=this.obs.toString}return n.prototype.markEnded=function(){return this.ended=!0},n.prototype.consume=function(){return this.lazy?lt.always(this.queue[0]):this.queue[0]},n.prototype.push=function(n){return this.queue=[n]},n.prototype.mayHave=function(){return!0},n.prototype.hasAtLeast=function(){return this.queue.length},n.prototype.flatten=!0,n}(),u=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return gt(t,n),t.prototype.consume=function(){return this.queue.shift()},t.prototype.push=function(n){return this.queue.push(n)},t.prototype.mayHave=function(n){return!this.ended||this.queue.length>=n},t.prototype.hasAtLeast=function(n){return this.queue.length>=n},t.prototype.flatten=!1,t}(b),t=function(n){function t(n){this.obs=n,t.__super__.constructor.call(this,this.obs,!0,this.obs.subscribeInternal)}return gt(t,n),t.prototype.consume=function(){var n;return n=this.queue,this.queue=[],function(){return n}},t.prototype.push=function(n){return this.queue.push(n())},t.prototype.hasAtLeast=function(){return!0},t}(b),b.isTrigger=function(n){return n instanceof b?n.sync:n instanceof l},b.fromObservable=function(n){return n instanceof b?n:n instanceof m?new b(n,!1):new u(n,!0)},B=function(){var n,t,r;return t=arguments[0],r=arguments[1],n=3<=arguments.length?pt.call(arguments,2):[],(t||r)instanceof o?t||r:new o(t,r,n)},V=function(n){return z(n)?lt.flatMap(V,n):j(n)?[n]:n instanceof b?[n.obs]:[]},o=function(){function n(n,t,r){this.context=n,this.method=t,this.args=r}return n.prototype.apply=function(n){var t,r;return r=this,t=lt.cached(function(){return V([r.context].concat(r.args))}),n.internalDeps=n.internalDeps||t,n.dependsOn=i.dependsOn,n.deps=t,n.toString=function(){return lt.toString(r.context)+"."+lt.toString(r.method)+"("+lt.map(lt.toString,r.args)+")"},n.inspect=function(){return n.toString()},n.desc=function(){return{context:r.context,method:r.method,args:r.args}},n},n}(),at=function(){var n,t,r;return n=2<=arguments.length?pt.call(arguments,0,r=arguments.length-1):(r=0,[]),t=arguments[r++],B.apply(null,n).apply(t)},n.when=function(){var t,r,e,u,i,o,s,c,a,f,h,p,y,g,m,d,v,E,S,_;if(f=1<=arguments.length?pt.call(arguments,0):[],0===f.length)return n.never();for(i=f.length,m="when: expecting arguments in the form (Observable+,function)+",M(m,i%2===0),y=[],a=[],r=0;i>r;){for(c=lt.toArray(f[r]),t=f[r+1],s={f:U(t)?t:function(){return t},ixs:[]},g=!1,d=0,E=c.length;E>d;d++){for(p=c[d],e=lt.indexOf(y,p),g||(g=b.isTrigger(p)),0>e&&(y.push(p),e=y.length-1),_=s.ixs,v=0,S=_.length;S>v;v++)u=_[v],u.index===e&&u.count++;s.ixs.push({index:e,count:1})}M("At least one EventStream required",g||!c.length),c.length>0&&a.push(s),r+=2}return y.length?(y=lt.map(b.fromObservable,y),o=lt.any(y,function(n){return n.flatten})&&T(lt.map(function(n){return n.obs},y)),h=new l(B.apply(null,[n,"when"].concat(pt.call(f))),function(t){var e,u,i,s,c,f,l;return l=[],i=!1,s=function(n){var t,e,u;for(u=n.ixs,t=0,e=u.length;e>t;t++)if(r=u[t],!y[r.index].hasAtLeast(r.count))return!1;return!0},u=function(n){return!n.sync||n.ended},e=function(n){var t,e,u;for(u=n.ixs,t=0,e=u.length;e>t;t++)if(r=u[t],!y[r.index].mayHave(r.count))return!0},c=function(n){return!n.source.flatten},f=function(f){return function(p){var g,m,d;return m=function(){return w.whenDoneWith(h,g)},d=function(){var e,u,i,f,h,p;if(!(l.length>0))return n.more;for(i=n.more,f=l.pop(),h=0,p=a.length;p>h;h++)if(u=a[h],s(u))return e=function(){var n,t,e,i;for(e=u.ixs,i=[],n=0,t=e.length;t>n;n++)r=e[n],i.push(y[r.index].consume());return i}(),i=t(f.e.apply(function(){var n,t;return t=function(){var t,r,u;for(u=[],t=0,r=e.length;r>t;t++)n=e[t],u.push(n());return u}(),u.f.apply(u,t)})),l.length&&o&&(l=lt.filter(c,l)),i===n.noMore?i:d()},g=function(){var r;return r=d(),i&&(i=!1,(lt.all(y,u)||lt.all(a,e))&&(r=n.noMore,t(C()))),r===n.noMore&&p(),r},f.subscribe(function(r){var e;return r.isEnd()?(i=!0,f.markEnded(),m()):r.isError()?e=t(r):(f.push(r.value),f.sync&&(l.push({source:f,e:r}),o||w.hasWaiters()?m():g())),e===n.noMore&&p(),e||n.more})}},k.apply(null,function(){var n,t,r;for(r=[],n=0,t=y.length;t>n;n++)p=y[n],r.push(f(p));return r}())})):n.never()},T=function(t,r){var e;return null==r&&(r=[]),e=function(t){var u;return n._.contains(r,t)?!0:(u=t.internalDeps(),u.length?(r.push(t),n._.any(u,e)):(r.push(t),!1))},n._.any(t,e)},n.update=function(){var t,r,e,u;for(r=arguments[0],u=2<=arguments.length?pt.call(arguments,1):[],e=function(n){return function(){var t;return t=1<=arguments.length?pt.call(arguments,0):[],function(r){return n.apply(null,[r].concat(t))}}},t=u.length-1;t>0;)u[t]instanceof Function||(u[t]=function(n){return function(){return n}}(u[t])),u[t]=e(u[t]),t-=2;return at.apply(null,[n,"update",r].concat(pt.call(u),[n.when.apply(n,u).scan(r,function(n,t){return t(n)})]))},k=function(){var n;return n=1<=arguments.length?pt.call(arguments,0):[],new e(n).unsubscribe},e=function(){function n(n){var t,r,e;for(null==n&&(n=[]),this.unsubscribe=mt(this.unsubscribe,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[],r=0,e=n.length;e>r;r++)t=n[r],this.add(t)}return n.prototype.add=function(n){var t,r,e;if(!this.unsubscribed)return t=!1,r=J,this.starting.push(n),e=function(e){return function(){return e.unsubscribed?void 0:(t=!0,e.remove(r),lt.remove(n,e.starting))}}(this),r=n(this.unsubscribe,e),this.unsubscribed||t||this.subscriptions.push(r),lt.remove(n,this.starting),r},n.prototype.remove=function(n){return this.unsubscribed?void 0:void 0!==lt.remove(n,this.subscriptions)?n():void 0},n.prototype.unsubscribe=function(){var n,t,r,e;if(!this.unsubscribed){for(this.unsubscribed=!0,e=this.subscriptions,t=0,r=e.length;r>t;t++)(n=e[t])();return this.subscriptions=[],this.starting=[]}},n.prototype.count=function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length
},n.prototype.empty=function(){return 0===this.count()},n}(),n.CompositeUnsubscribe=e,v=function(){function n(n){this.value=n}return n.prototype.getOrElse=function(){return this.value},n.prototype.get=function(){return this.value},n.prototype.filter=function(t){return t(this.value)?new n(this.value):y},n.prototype.map=function(t){return new n(t(this.value))},n.prototype.forEach=function(n){return n(this.value)},n.prototype.isDefined=!0,n.prototype.toArray=function(){return[this.value]},n.prototype.inspect=function(){return"Some("+this.value+")"},n.prototype.toString=function(){return this.inspect()},n}(),y={getOrElse:function(n){return n},filter:function(){return y},map:function(){return y},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}},i=function(){var n,t,r,e;return r={},t=function(t){var e;return e=r[this.id],e||(e=r[this.id]={},n(this,this)),e[t.id]},n=function(t,e){var u,i,o,s,c;for(s=e.internalDeps(),c=[],i=0,o=s.length;o>i;i++)u=s[i],r[t.id][u.id]=!0,c.push(n(t,u));return c},e=function(){return r={}},{invalidate:e,dependsOn:t}}(),w=function(){var t,r,e,u,o,s,c,a,f,l,h,p,y;return l=void 0,h=[],r=[],t=function(n){return l?r.push(n):n()},a=function(n){return!lt.any(h,function(t){return n.obs.dependsOn(t.obs)})},p=function(n,t){return l?h.push({obs:n,f:t}):t()},u=function(){for(;!a(h[0]);)h.push(h.splice(0,1)[0]);return h.splice(0,1)[0]},o=function(){var n;for(n=[];h.length;)n.push(u().f());return n},f=i.invalidate,c=function(n,t,e,u){var i;if(l)return e.apply(t,u);l=n;try{i=e.apply(t,u),o()}finally{for(l=void 0;r.length;)(e=r.splice(0,1)[0])();f()}return i},e=function(){return l?l.id:void 0},y=function(r){return function(e){var u,i,o;return o=!1,u=function(){},i=function(){return o=!0,u()},u=r.subscribeInternal(function(r){return t(function(){var t;return o||(t=e(r),t!==n.noMore)?void 0:i()})}),i}},s=function(){return h.length>0},{whenDoneWith:p,hasWaiters:s,inTransaction:c,currentEventId:e,wrappedSubscribe:y}}(),n.EventStream=l,n.Property=m,n.Observable=g,n.Bus=r,n.Initial=h,n.Next=p,n.End=c,n.Error=a,J=function(){},F=function(n,t){return t()},P=function(n){return n},L=function(n){return new h(lt.always(n))},G=function(n){return new p(lt.always(n))},C=function(){return new c},ut=function(n){return n instanceof f?n:G(n)},x=function(n){return n.slice(0)},M=function(n,t){if(!t)throw n},_=function(n){if(!(n instanceof l))throw"not an EventStream : "+n},A=function(n){return M("not a function : "+n,U(n))},U=function(n){return"function"==typeof n},z=function(n){return n instanceof Array},j=function(n){return n instanceof g},S=function(n){if(!z(n))throw"not an array : "+n},I=function(n){return M("no arguments supported",0===n.length)},W=function(n){if("string"!=typeof n)throw"not a string : "+n},Y=function(n,t){return function(){var r;return r=1<=arguments.length?pt.call(arguments,0):[],n.apply(null,t.concat(r))}},X=function(n){return 1===n.length&&j(n[0])?lt.always(n[0]):Z(n)},Z=function(n){return n=Array.prototype.slice.call(n),$.apply(null,n)},$=ft(function(){var n,t;return t=arguments[0],n=2<=arguments.length?pt.call(arguments,1):[],U(t)?n.length?Y(t,n):t:N(t)?it(t,n):lt.always(t)}),Q=function(n,t){return $.apply(null,[n].concat(pt.call(t)))},K=function(t){return j(t)?t:n.once(t)},N=function(n){return"string"==typeof n&&n.length>1&&"."===n.charAt(0)},n.isFieldKey=N,it=function(n,t){var r,e;return e=n.slice(1).split("."),r=lt.map(ct(t),e),function(t){var e,u;for(e=0,u=r.length;u>e;e++)n=r[e],t=n(t);return t}},ct=function(n){return function(t){return function(r){var e;return null==r?void 0:(e=r[t],U(e)?e.apply(r,n):e)}}},ot=function(n){return n.slice(1)},et=function(n){var t;return U(n)?n:N(n)?(t=ot(n),function(n,r){return n[t](r)}):M("not a function or a field key: "+n,!1)},st=function(n){return n instanceof v||n===y?n:new v(n)},lt={indexOf:Array.prototype.indexOf?function(n,t){return n.indexOf(t)}:function(n,t){var r,e,u,i;for(r=u=0,i=n.length;i>u;r=++u)if(e=n[r],t===e)return r;return-1},indexWhere:function(n,t){var r,e,u,i;for(r=u=0,i=n.length;i>u;r=++u)if(e=n[r],t(e))return r;return-1},head:function(n){return n[0]},always:function(n){return function(){return n}},negate:function(n){return function(t){return!n(t)}},empty:function(n){return 0===n.length},tail:function(n){return n.slice(1,n.length)},filter:function(n,t){var r,e,u,i;for(r=[],u=0,i=t.length;i>u;u++)e=t[u],n(e)&&r.push(e);return r},map:function(n,t){var r,e,u,i;for(i=[],e=0,u=t.length;u>e;e++)r=t[e],i.push(n(r));return i},each:function(n,t){var r,e,u;u=[];for(r in n)e=n[r],u.push(t(r,e));return u},toArray:function(n){return z(n)?n:[n]},contains:function(n,t){return-1!==lt.indexOf(n,t)},id:function(n){return n},last:function(n){return n[n.length-1]},all:function(n,t){var r,e,u;for(null==t&&(t=lt.id),e=0,u=n.length;u>e;e++)if(r=n[e],!t(r))return!1;return!0},any:function(n,t){var r,e,u;for(null==t&&(t=lt.id),e=0,u=n.length;u>e;e++)if(r=n[e],t(r))return!0;return!1},without:function(n,t){return lt.filter(function(t){return t!==n},t)},remove:function(n,t){var r;return r=lt.indexOf(t,n),r>=0?t.splice(r,1):void 0},fold:function(n,t,r){var e,u,i;for(u=0,i=n.length;i>u;u++)e=n[u],t=r(t,e);return t},flatMap:function(n,t){return lt.fold(t,[],function(t,r){return t.concat(n(r))})},cached:function(n){var t;return t=y,function(){return t===y&&(t=n(),n=null),t}},toString:function(n){var t,r,e,u;try{return nt++,null==n?"undefined":U(n)?"function":z(n)?nt>5?"[..]":"["+lt.map(lt.toString,n).toString()+"]":null!=(null!=n?n.toString:void 0)&&n.toString!==Object.prototype.toString?n.toString():"object"==typeof n?nt>5?"{..}":(r=function(){var r;r=[];for(e in n)yt.call(n,e)&&(u=function(){try{return n[e]}catch(r){return t=r}}(),r.push(lt.toString(e)+":"+lt.toString(u)));return r}(),"{"+r+"}"):n}finally{nt--}}},nt=0,n._=lt,n.scheduler={setTimeout:function(n,t){return setTimeout(n,t)},setInterval:function(n,t){return setInterval(n,t)},clearInterval:function(n){return clearInterval(n)},now:function(){return(new Date).getTime()}},"undefined"!=typeof define&&null!==define&&null!=define.amd?(define([],function(){return n}),this.Bacon=n):"undefined"!=typeof module&&null!==module?(module.exports=n,n.Bacon=n):this.Bacon=n}).call(this);