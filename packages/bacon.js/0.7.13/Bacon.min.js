(function(){var n,t,r,e,u,i,o,s,c,a,f,l,p,h,y,g,m,d,v,b,w,E,S,M,_,A,I,W,k,x,T,H,B,O,C,V,P,D,q,L,z,N,U,j,F,R,Q,Z,$,K,X,G,J,Y,nt,tt,rt,et,ut,it,ot,st,ct,at,ft,lt=[].slice,pt={}.hasOwnProperty,ht=function(n,t){function r(){this.constructor=n}for(var e in t)pt.call(t,e)&&(n[e]=t[e]);return r.prototype=t.prototype,n.prototype=new r,n.__super__=t.prototype,n},yt=function(n,t){return function(){return n.apply(t,arguments)}};n={toString:function(){return"Bacon"}},n.version="0.7.13",n.fromBinder=function(t,r){return null==r&&(r=at.id),new f(H(n,"fromBinder",t,r),function(e){var u;return u=t(function(){var t,i,o,s,c,f;for(t=1<=arguments.length?lt.call(arguments,0):[],s=r.apply(null,t),q(s)&&at.last(s)instanceof a||(s=[s]),o=n.more,c=0,f=s.length;f>c;c++)if(i=s[c],o=e(i=rt(i)),o===n.noMore||i.isEnd())return null!=u?u():n.scheduler.setTimeout(function(){return u()},0),o;return o})})},n.$={asEventStream:function(t,r,e){var u;return z(r)&&(u=[r,null],e=u[0],r=u[1]),st(this.selector||this,"asEventStream",t,n.fromBinder(function(n){return function(e){return n.on(t,r,e),function(){return n.off(t,r,e)}}}(this),e))}},null!=(ft="undefined"!=typeof jQuery&&null!==jQuery?jQuery:"undefined"!=typeof Zepto&&null!==Zepto?Zepto:null)&&(ft.fn.asEventStream=n.$.asEventStream),n.fromEventTarget=function(t,r,e){var u,i,o,s,c,a;return u=null!=(o=t.addEventListener)?o:null!=(s=t.addListener)?s:t.bind,i=null!=(c=t.removeEventListener)?c:null!=(a=t.removeListener)?a:t.unbind,st(n,"fromEventTarget",t,r,n.fromBinder(function(n){return u.call(t,r,n),function(){return i.call(t,r,n)}},e))},n.fromPromise=function(t,r){return st(n,"fromPromise",t,n.fromBinder(function(n){return t.then(n,function(t){return n(new c(t))}),function(){return r&&"function"==typeof t.abort?t.abort():void 0}},function(n){return[n,B()]}))},n.noMore=["<no-more>"],n.more=["<more>"],n.later=function(t,r){return st(n,"later",t,r,n.sequentially(t,[r]))},n.sequentially=function(t,r){var e;return e=0,st(n,"sequentially",t,r,n.fromPoll(t,function(){var n;return n=r[e++],e<r.length?n:e===r.length?[n,B()]:B()}))},n.repeatedly=function(t,r){var e;return e=0,st(n,"repeatedly",t,r,n.fromPoll(t,function(){return r[e++%r.length]}))},n.spy=function(n){return nt.push(n)},nt=[],Y=function(n){var t,r,e,u;if(nt.length&&!Y.running)try{for(Y.running=!0,u=[],r=0,e=nt.length;e>r;r++)t=nt[r],u.push(t(n));return u}finally{delete Y.running}},ct=function(n){return function(){var t,r,e,u;return e=arguments[0],t=2<=arguments.length?lt.call(arguments,1):[],"object"==typeof e&&t.length&&(r=e,u=t[0],e=function(){return r[u].apply(r,arguments)},t=t.slice(1)),n.apply(null,[e].concat(lt.call(t)))}},j=function(t,r){return ct(function(){var e,u,i;return u=arguments[0],e=2<=arguments.length?lt.call(arguments,1):[],i=G(r,[function(n,t){return u.apply(null,lt.call(n).concat([t]))}]),st.apply(null,[n,t,u].concat(lt.call(e),[n.combineAsArray(e).flatMap(i)]))})},n.fromCallback=j("fromCallback",function(){var t,r;return r=arguments[0],t=2<=arguments.length?lt.call(arguments,1):[],n.fromBinder(function(n){return F(r,t)(n),X},function(n){return[n,B()]})}),n.fromNodeCallback=j("fromNodeCallback",function(){var t,r;return r=arguments[0],t=2<=arguments.length?lt.call(arguments,1):[],n.fromBinder(function(n){return F(r,t)(n),X},function(n,t){return n?[new c(n),B()]:[t,B()]})}),n.fromPoll=function(t,r){return st(n,"fromPoll",t,r,n.fromBinder(function(r){var e;return e=n.scheduler.setInterval(r,t),function(){return n.scheduler.clearInterval(e)}},r))},n.interval=function(t,r){return null==r&&(r={}),st(n,"interval",t,r,n.fromPoll(t,function(){return K(r)}))},n.constant=function(t){return new g(H(n,"constant",t),function(n){return n(D(t)),n(B()),X})},n.never=function(){return st(n,"never",n.fromArray([]))},n.once=function(t){return st(n,"once",t,n.fromArray([t]))},n.fromArray=function(t){return S(t),t=W(t),new f(H(n,"fromArray",t),function(r){var e,u,i;for(u=!1,e=n.more;e!==n.noMore&&!u;)at.empty(t)?(r(B()),e=n.noMore):(i=at.popHead(t),e=r(rt(i)));return function(){return u=!0}})},n.mergeAll=function(){var t;return t=1<=arguments.length?lt.call(arguments,0):[],q(t[0])&&(t=t[0]),t.length?new f(H.apply(null,[n,"mergeAll"].concat(lt.call(t))),function(r){var e,u,i;return e=0,i=function(u){return function(i){return u.subscribeInternal(function(u){var o;return u.isEnd()?(e++,e===t.length?r(B()):n.more):(o=r(u),o===n.noMore&&i(),o)})}},u=at.map(i,t),k.apply(null,u)}):n.never()},n.zipAsArray=function(){var t;return t=1<=arguments.length?lt.call(arguments,0):[],q(t[0])&&(t=t[0]),st.apply(null,[n,"zipAsArray"].concat(lt.call(t),[n.zipWith(t,function(){var n;return n=1<=arguments.length?lt.call(arguments,0):[]})]))},n.zipWith=function(){var t,r,e;return t=arguments[0],r=2<=arguments.length?lt.call(arguments,1):[],z(t)||(e=[t,r[0]],r=e[0],t=e[1]),r=at.map(function(n){return n.toEventStream()},r),st.apply(null,[n,"zipWith",t].concat(lt.call(r),[n.when(r,t)]))},n.groupSimultaneous=function(){var r,e,u;return u=1<=arguments.length?lt.call(arguments,0):[],1===u.length&&q(u[0])&&(u=u[0]),e=function(){var n,e,i;for(i=[],n=0,e=u.length;e>n;n++)r=u[n],i.push(new t(r));return i}(),st.apply(null,[n,"groupSimultaneous"].concat(lt.call(u),[n.when(e,function(){var n;return n=1<=arguments.length?lt.call(arguments,0):[]})]))},n.combineAsArray=function(){var t,r,e,u,i,o,s;for(i=1<=arguments.length?lt.call(arguments,0):[],1===i.length&&q(i[0])&&(i=i[0]),t=o=0,s=i.length;s>o;t=++o)u=i[t],N(u)||(i[t]=n.constant(u));return i.length?(e=function(){var n,t,e;for(e=[],n=0,t=i.length;t>n;n++)r=i[n],e.push(new v(r,!0,r.subscribeInternal));return e}(),st.apply(null,[n,"combineAsArray"].concat(lt.call(i),[n.when(e,function(){var n;return n=1<=arguments.length?lt.call(arguments,0):[]}).toProperty()]))):n.constant([])},n.onValues=function(){var t,r,e;return r=2<=arguments.length?lt.call(arguments,0,e=arguments.length-1):(e=0,[]),t=arguments[e++],n.combineAsArray(r).onValues(t)},n.combineWith=function(){var t,r;return t=arguments[0],r=2<=arguments.length?lt.call(arguments,1):[],st.apply(null,[n,"combineWith",t].concat(lt.call(r),[n.combineAsArray(r).map(function(n){return t.apply(null,n)})]))},n.combineTemplate=function(t){var r,e,u,i,o,s,c,a,f,l;return c=[],l=[],s=function(n){return n[n.length-1]},f=function(n,t,r){return s(n)[t]=r},r=function(n,t){return function(r,e){return f(r,n,e[t])}},o=function(n,t){return function(r){return f(r,n,t)}},a=function(n){return q(n)?[]:{}},u=function(n,t){var e,u;return N(t)?(l.push(t),c.push(r(n,l.length-1))):t!==Object(t)||"function"==typeof t||t instanceof RegExp||t instanceof Date?c.push(o(n,t)):(u=function(n){return function(r){var e;return e=a(t),f(r,n,e),r.push(e)}},e=function(n){return n.pop()},c.push(u(n)),i(t),c.push(e))},i=function(n){return at.each(n,u)},i(t),e=function(n){var r,e,u,i,o;for(u=a(t),r=[u],i=0,o=c.length;o>i;i++)(e=c[i])(r,n);return u},st(n,"combineTemplate",t,n.combineAsArray(l).map(e))},n.retry=function(t){var r,e,u,i,o,s;if(!z(t.source))throw"'source' option has to be a function";return s=t.source,i=t.retries||0,u=t.maxRetries||i,r=t.interval||function(){return 0},e=t.isRetryable||function(){return!0},o=function(t){var o;return o={source:s,retries:i-1,maxRetries:u,interval:r,isRetryable:e},n.later(r(t)).filter(!1).concat(n.retry(o))},st(n,"retry",t,s().flatMapError(function(t){return e(t)&&i>0?o({error:t,retriesDone:u-i}):n.once(new n.Error(t))}))},O=0,a=function(){function n(){this.id=++O}return n.prototype.isEvent=function(){return!0},n.prototype.isEnd=function(){return!1},n.prototype.isInitial=function(){return!1},n.prototype.isNext=function(){return!1},n.prototype.isError=function(){return!1},n.prototype.hasValue=function(){return!1},n.prototype.filter=function(){return!0},n.prototype.inspect=function(){return this.toString()},n.prototype.log=function(){return this.toString()},n}(),p=function(n){function t(n){t.__super__.constructor.call(this),this.value=z(n)?at.cached(n):at.always(n)}return ht(t,n),t.prototype.isNext=function(){return!0},t.prototype.hasValue=function(){return!0},t.prototype.fmap=function(n){var t;return t=this.value,this.apply(function(){return n(t())})},t.prototype.apply=function(n){return new t(n)},t.prototype.filter=function(n){return n(this.value())},t.prototype.toString=function(){return at.toString(this.value())},t.prototype.log=function(){return this.value()},t}(a),l=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return ht(t,n),t.prototype.isInitial=function(){return!0},t.prototype.isNext=function(){return!1},t.prototype.apply=function(n){return new t(n)},t.prototype.toNext=function(){return new p(this.value)},t}(p),s=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return ht(t,n),t.prototype.isEnd=function(){return!0},t.prototype.fmap=function(){return this},t.prototype.apply=function(){return this},t.prototype.toString=function(){return"<end>"},t}(a),c=function(n){function t(n){this.error=n}return ht(t,n),t.prototype.isError=function(){return!0},t.prototype.fmap=function(){return this},t.prototype.apply=function(){return this},t.prototype.toString=function(){return"<error> "+at.toString(this.error)},t}(a),P=0,y=function(){function t(n){this.flatMapError=yt(this.flatMapError,this),this.id=++P,st(n,this)}return t.prototype.onValue=function(){var n;return n=R(arguments),this.subscribe(function(t){return t.hasValue()?n(t.value()):void 0})},t.prototype.onValues=function(n){return this.onValue(function(t){return n.apply(null,t)})},t.prototype.onError=function(){var n;return n=R(arguments),this.subscribe(function(t){return t.isError()?n(t.error):void 0})},t.prototype.onEnd=function(){var n;return n=R(arguments),this.subscribe(function(t){return t.isEnd()?n():void 0})},t.prototype.errors=function(){return st(this,"errors",this.filter(function(){return!1}))},t.prototype.filter=function(){var t,r;return r=arguments[0],t=2<=arguments.length?lt.call(arguments,1):[],T(this,r,t,function(t){return st(this,"filter",t,this.withHandler(function(r){return r.filter(t)?this.push(r):n.more}))})},t.prototype.takeWhile=function(){var t,r;return r=arguments[0],t=2<=arguments.length?lt.call(arguments,1):[],T(this,r,t,function(t){return st(this,"takeWhile",t,this.withHandler(function(r){return r.filter(t)?this.push(r):(this.push(B()),n.noMore)}))})},t.prototype.endOnError=function(){var n,t;return t=arguments[0],n=2<=arguments.length?lt.call(arguments,1):[],null==t&&(t=!0),T(this,t,n,function(n){return st(this,"endOnError",this.withHandler(function(t){return t.isError()&&n(t.error)?(this.push(t),this.push(B())):this.push(t)}))})},t.prototype.take=function(t){return 0>=t?n.never():st(this,"take",t,this.withHandler(function(r){return r.hasValue()?(t--,t>0?this.push(r):(0===t&&this.push(r),this.push(B()),n.noMore)):this.push(r)}))},t.prototype.map=function(){var n,t;return t=arguments[0],n=2<=arguments.length?lt.call(arguments,1):[],t instanceof g?t.sampledBy(this,V):T(this,t,n,function(n){return st(this,"map",n,this.withHandler(function(t){return this.push(t.fmap(n))}))})},t.prototype.mapError=function(){var n;return n=R(arguments),st(this,"mapError",n,this.withHandler(function(t){return this.push(t.isError()?K(n(t.error)):t)}))},t.prototype.mapEnd=function(){var t;return t=R(arguments),st(this,"mapEnd",t,this.withHandler(function(r){return r.isEnd()?(this.push(K(t(r))),this.push(B()),n.noMore):this.push(r)}))},t.prototype.doAction=function(){var n;return n=R(arguments),st(this,"doAction",n,this.withHandler(function(t){return t.hasValue()&&n(t.value()),this.push(t)}))},t.prototype.skip=function(t){return st(this,"skip",t,this.withHandler(function(r){return r.hasValue()&&t>0?(t--,n.more):this.push(r)}))},t.prototype.skipDuplicates=function(n){return null==n&&(n=function(n,t){return n===t}),st(this,"skipDuplicates",this.withStateMachine(h,function(t,r){return r.hasValue()?r.isInitial()||t===h||!n(t.get(),r.value())?[new d(r.value()),[r]]:[t,[]]:[t,[r]]}))},t.prototype.skipErrors=function(){return st(this,"skipErrors",this.withHandler(function(t){return t.isError()?n.more:this.push(t)}))},t.prototype.withStateMachine=function(t,r){var e;return e=t,st(this,"withStateMachine",t,r,this.withHandler(function(t){var u,i,o,s,c,a,f;for(u=r(e,t),i=u[0],s=u[1],e=i,c=n.more,a=0,f=s.length;f>a;a++)if(o=s[a],c=this.push(o),c===n.noMore)return c;return c}))},t.prototype.scan=function(t,r,e){var u,i,o,s;return null==e&&(e={}),i=tt(r),r=e.lazyF?i:function(n,t){return i(n(),t())},u=it(t).map(function(n){return at.always(n)}),s=function(t){return function(i){var s,c,a,f;return s=!1,f=X,c=n.more,a=function(){return s?void 0:u.forEach(function(t){return s=!0,c=i(new l(t)),c===n.noMore?(f(),f=X):void 0})},f=t.subscribeInternal(function(t){var o,f;return t.hasValue()?s&&t.isInitial()?n.more:(t.isInitial()||a(),s=!0,f=u.getOrElse(function(){return void 0}),o=at.cached(function(){return r(f,t.value)}),u=new d(o),e.eager&&o(),i(t.apply(o))):(t.isEnd()&&(c=a()),c!==n.noMore?i(t):void 0)}),b.whenDoneWith(o,a),f}}(this),o=new g(H(this,"scan",t,r),s)},t.prototype.fold=function(n,t,r){return st(this,"fold",n,t,this.scan(n,t,r).sampledBy(this.filter(!1).mapEnd().toProperty()))},t.prototype.zip=function(t,r){return null==r&&(r=Array),st(this,"zip",t,n.zipWith([this,t],r))},t.prototype.diff=function(n,t){return t=tt(t),st(this,"diff",n,t,this.scan([n],function(n,r){return[r,t(n[0],r)]}).filter(function(n){return 2===n.length}).map(function(n){return n[1]}))},t.prototype.flatMap=function(){return C(this,$(arguments))},t.prototype.flatMapFirst=function(){return C(this,$(arguments),!0)},t.prototype.flatMapWithConcurrencyLimit=function(){var n,t;return t=arguments[0],n=2<=arguments.length?lt.call(arguments,1):[],st.apply(null,[this,"flatMapWithConcurrencyLimit",t].concat(lt.call(n),[C(this,$(n),!1,t)]))},t.prototype.flatMapLatest=function(){var n,t;return n=$(arguments),t=this.toEventStream(),st(this,"flatMapLatest",n,t.flatMap(function(r){return Z(n(r)).takeUntil(t)}))},t.prototype.flatMapError=function(t){return st(this,"flatMapError",t,this.mapError(function(t){return new n.Error(t)}).flatMap(function(r){return r instanceof n.Error?t(r.error):n.once(r)}))},t.prototype.flatMapConcat=function(){return st.apply(null,[this,"flatMapConcat"].concat(lt.call(arguments),[this.flatMapWithConcurrencyLimit.apply(this,[1].concat(lt.call(arguments)))]))},t.prototype.bufferingThrottle=function(t){return st(this,"bufferingThrottle",t,this.flatMapConcat(function(r){return n.once(r).concat(n.later(t).filter(!1))}))},t.prototype.not=function(){return st(this,"not",this.map(function(n){return!n}))},t.prototype.log=function(){var n;return n=1<=arguments.length?lt.call(arguments,0):[],this.subscribe(function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log?console.log.apply(console,lt.call(n).concat([t.log()])):void 0}),this},t.prototype.slidingWindow=function(n,t){return null==t&&(t=0),st(this,"slidingWindow",n,t,this.scan([],function(t,r){return t.concat([r]).slice(-n)}).filter(function(n){return n.length>=t}))},t.prototype.combine=function(t,r){var e;return e=tt(r),st(this,"combine",t,r,n.combineAsArray(this,t).map(function(n){return e(n[0],n[1])}))},t.prototype.decode=function(t){return st(this,"decode",t,this.combine(n.combineTemplate(t),function(n,t){return t[n]}))},t.prototype.awaiting=function(t){return st(this,"awaiting",t,n.groupSimultaneous(this,t).map(function(n){var t,r;return t=n[0],r=n[1],0===r.length}).toProperty(!1).skipDuplicates())},t.prototype.name=function(n){return this.toString=function(){return n},this},t.prototype.withDescription=function(){return H.apply(null,arguments).apply(this)},t}(),y.prototype.reduce=y.prototype.fold,y.prototype.assign=y.prototype.onValue,C=function(t,r,u,i){return new f(H(t,"flatMap"+(u?"First":""),r),function(o){var s,c,a,f,p;return a=new e,f=[],p=function(t){var e;return e=Z(r(t.value())),a.add(function(t,r){return e.subscribeInternal(function(e){var u;return e.isEnd()?(c(),s(r),n.noMore):(e instanceof l&&(e=e.toNext()),u=o(e),u===n.noMore&&t(),u)})})},c=function(){var n;return n=at.popHead(f),n?p(n):void 0},s=function(n){return n(),a.empty()?o(B()):void 0},a.add(function(r,e){return t.subscribeInternal(function(t){return t.isEnd()?s(e):t.isError()?o(t):u&&a.count()>1?n.more:a.unsubscribed?n.noMore:i&&a.count()>i?f.push(t):p(t)})}),a.unsubscribe})},f=function(t){function r(n,t){var e;z(n)&&(t=n,n=[]),r.__super__.constructor.call(this,n),_(t),e=new o(t),this.subscribeInternal=e.subscribe,this.subscribe=b.wrappedSubscribe(this),this.hasSubscribers=e.hasSubscribers,Y(this)}return ht(r,t),r.prototype.delay=function(t){return st(this,"delay",t,this.flatMap(function(r){return n.later(t,r)}))},r.prototype.debounce=function(t){return st(this,"debounce",t,this.flatMapLatest(function(r){return n.later(t,r)}))},r.prototype.debounceImmediate=function(t){return st(this,"debounceImmediate",t,this.flatMapFirst(function(r){return n.once(r).concat(n.later(t).filter(!1))}))},r.prototype.throttle=function(n){return st(this,"throttle",n,this.bufferWithTime(n).map(function(n){return n[n.length-1]}))},r.prototype.bufferWithTime=function(n){return st(this,"bufferWithTime",n,this.bufferWithTimeOrCount(n,Number.MAX_VALUE))},r.prototype.bufferWithCount=function(n){return st(this,"bufferWithCount",n,this.bufferWithTimeOrCount(void 0,n))},r.prototype.bufferWithTimeOrCount=function(n,t){var r;return r=function(r){return r.values.length===t?r.flush():void 0!==n?r.schedule():void 0},st(this,"bufferWithTimeOrCount",n,t,this.buffer(n,r,r))},r.prototype.buffer=function(t,r,e){var u,i,o;return null==r&&(r=function(){}),null==e&&(e=function(){}),u={scheduled:!1,end:null,values:[],flush:function(){var t;if(this.scheduled=!1,this.values.length>0){if(t=this.push(K(this.values)),this.values=[],null!=this.end)return this.push(this.end);if(t!==n.noMore)return e(this)}else if(null!=this.end)return this.push(this.end)},schedule:function(){return this.scheduled?void 0:(this.scheduled=!0,t(function(n){return function(){return n.flush()}}(this)))}},o=n.more,z(t)||(i=t,t=function(t){return n.scheduler.setTimeout(t,i)}),st(this,"buffer",this.withHandler(function(n){return u.push=this.push,n.isError()?o=this.push(n):n.isEnd()?(u.end=n,u.scheduled||u.flush()):(u.values.push(n.value()),r(u)),o}))},r.prototype.merge=function(t){var r;return M(t),r=this,st(r,"merge",t,n.mergeAll(this,t))},r.prototype.toProperty=function(n){return 0===arguments.length&&(n=h),st(this,"toProperty",n,this.scan(n,U,{lazyF:!0}))},r.prototype.toEventStream=function(){return this},r.prototype.sampledBy=function(n,t){return st(this,"sampledBy",n,t,this.toProperty().sampledBy(n,t))},r.prototype.concat=function(n){var t;return t=this,new r(H(t,"concat",n),function(r){var e,u;return u=X,e=t.subscribeInternal(function(t){return t.isEnd()?u=n.subscribeInternal(r):r(t)}),function(){return e(),u()}})},r.prototype.takeUntil=function(t){var r;return r={},st(this,"takeUntil",t,n.groupSimultaneous(this.mapEnd(r),t.skipErrors()).withHandler(function(e){var u,i,o,s,c,a;if(e.hasValue()){if(a=e.value(),u=a[0],t=a[1],t.length)return this.push(B());for(i=n.more,s=0,c=u.length;c>s;s++)o=u[s],i=this.push(o===r?B():K(o));return i}return this.push(e)}))},r.prototype.skipUntil=function(n){var t;return t=n.take(1).map(!0).toProperty(!1),st(this,"skipUntil",n,this.filter(t))},r.prototype.skipWhile=function(){var t,r,e;return r=arguments[0],t=2<=arguments.length?lt.call(arguments,1):[],e=!1,T(this,r,t,function(t){return st(this,"skipWhile",t,this.withHandler(function(r){return!e&&r.hasValue()&&t(r.value())?n.more:(r.hasValue()&&(e=!0),this.push(r))}))})},r.prototype.holdWhen=function(t){var r,e,u;return u=t.startWith(!1),e=u.filter(function(n){return!n}),r=u.filter(at.id),st(this,"holdWhen",t,this.filter(!1).merge(u.flatMapConcat(function(t){return function(u){return u?t.scan([],function(n,t){return n.concat(t)},{eager:!0}).sampledBy(e).take(1).flatMap(n.fromArray):t.takeUntil(r)}}(this))))},r.prototype.startWith=function(t){return st(this,"startWith",t,n.once(t).concat(this))},r.prototype.withHandler=function(n){var t;return t=new o(this.subscribeInternal,n),new r(H(this,"withHandler",n),t.subscribe)},r}(y),g=function(t){function r(n,t,e){z(n)&&(e=t,t=n,n=[]),r.__super__.constructor.call(this,n),_(t),this.subscribeInternal=e===!0?t:new m(this,t,e).subscribe,this.subscribe=b.wrappedSubscribe(this),Y(this)}return ht(r,t),r.prototype.sampledBy=function(t,e){var u,i,o,s,c;return null!=e?e=tt(e):(u=!0,e=function(n){return n()}),c=new v(this,!1,this.subscribeInternal,u),o=new v(t,!0,t.subscribeInternal,u),s=n.when([c,o],e),i=t instanceof r?s.toProperty():s,st(this,"sampledBy",t,e,i)},r.prototype.sample=function(t){return st(this,"sample",t,this.sampledBy(n.interval(t,{})))},r.prototype.changes=function(){return new f(H(this,"changes"),function(n){return function(t){return n.subscribeInternal(function(n){return n.isInitial()?void 0:t(n)})}}(this))},r.prototype.withHandler=function(n){return new r(H(this,"withHandler",n),this.subscribeInternal,n)},r.prototype.toProperty=function(){return A(arguments),this},r.prototype.toEventStream=function(){return new f(H(this,"toEventStream"),function(n){return function(t){return n.subscribeInternal(function(n){return n.isInitial()&&(n=n.toNext()),t(n)})}}(this))},r.prototype.and=function(n){return st(this,"and",n,this.combine(n,function(n,t){return n&&t}))},r.prototype.or=function(n){return st(this,"or",n,this.combine(n,function(n,t){return n||t}))},r.prototype.delay=function(n){return this.delayChanges("delay",n,function(t){return t.delay(n)})},r.prototype.debounce=function(n){return this.delayChanges("debounce",n,function(t){return t.debounce(n)})},r.prototype.throttle=function(n){return this.delayChanges("throttle",n,function(t){return t.throttle(n)})},r.prototype.delayChanges=function(){var n,t,r;return n=2<=arguments.length?lt.call(arguments,0,r=arguments.length-1):(r=0,[]),t=arguments[r++],st.apply(null,[this].concat(lt.call(n),[w(this,t(this.changes()))]))},r.prototype.takeUntil=function(n){var t;return t=this.changes().takeUntil(n),st(this,"takeUntil",n,w(this,t))},r.prototype.startWith=function(n){return st(this,"startWith",n,this.scan(n,function(n,t){return t}))},r.prototype.bufferingThrottle=function(){var n;return(n=r.__super__.bufferingThrottle.apply(this,arguments)).bufferingThrottle.apply(n,arguments).toProperty()},r}(y),T=function(n,t,r,e){var u;return t instanceof g?(u=t.sampledBy(n,function(n,t){return[n,t]}),e.apply(u,[function(n){var t,r;return t=n[0],r=n[1],t}]).map(function(n){var t,r;return t=n[0],r=n[1]})):(t=F(t,r),e.apply(n,[t]))},w=function(t,r){var e;return e=new f(H(t,"justInitValue"),function(r){var u,i;return i=null,u=t.subscribeInternal(function(t){return t.hasValue()&&(i=t),n.noMore}),b.whenDoneWith(e,function(){return null!=i&&r(i),r(B())}),u}),e.concat(r).toProperty()},o=function(){function t(t,r){var e,u,i,o,s,c,a,f,l,p;null==t&&(t=function(){return X}),f=[],c=[],s=!1,u=!1,this.hasSubscribers=function(){return f.length>0},i=null,l=X,a=function(n){return f=at.without(n,f)},p=null,e=function(){var n,t,r,e,u;if(null!=p){for(t=p,p=null,u=[],r=0,e=t.length;e>r;r++)n=t[r],u.push(n());return u}},o=function(t){var r,u,o,p,h,y;if(s)return c.push(t),n.more;if(t!==i){t.isError()&&(i=t),o=!1;try{for(s=!0,p=f,h=0,y=p.length;y>h;h++)u=p[h],r=u.sink(t),(r===n.noMore||t.isEnd())&&a(u);o=!0}finally{s=!1,o||(c=[])}for(o=!0;c.length;)t=c.shift(),this.push(t);return e(t),this.hasSubscribers()?n.more:(l(),n.noMore)}},this.push=function(n){return function(t){return b.inTransaction(t,n,o,[t])}}(this),null==r&&(r=function(n){return this.push(n)}),this.handleEvent=function(n){return function(t){return t.isEnd()&&(u=!0),r.apply(n,[t])}}(this),this.subscribe=function(n){return function(r){var e,i;return u?(r(B()),X):(_(r),e={sink:r},f.push(e),1===f.length&&(i=t(n.handleEvent),l=function(){return i(),l=X}),_(l),function(){return a(e),n.hasSubscribers()?void 0:l()})}}(this)}return t}(),m=function(t){function r(t,e,u){var i,o,s,c;r.__super__.constructor.call(this,e,u),i=h,o=void 0,c=this.push,e=this.subscribe,s=!1,this.push=function(n){return function(t){return t.isEnd()&&(s=!0),t.hasValue()&&(i=new d(t),o=b.currentEventId()),c.apply(n,[t])}}(this),this.subscribe=function(r){return function(u){var c,a,f,l,p;return a=!1,l=n.more,f=function(){return l===n.noMore?X:s?(u(B()),X):e.apply(this,[u])},i.isDefined&&(r.hasSubscribers()||s)?(c=b.currentEventId(),p=o,!s&&p&&c&&c!==p?(b.whenDoneWith(t,function(){return o===p?u(D(i.get().value())):void 0}),f()):(b.inTransaction(void 0,r,function(){return l=u(D(i.get().value()))},[]),f())):f()}}(this)}return ht(r,t),r}(o),r=function(t){function r(){var t,e,u,i,o,s,a,f;u=void 0,s=[],t=!1,e=function(){return function(t){return function(r){return r.isEnd()?(f(t),n.noMore):u(r)}}}(this),a=function(){var n,t,r,e;for(e=[],t=0,r=s.length;r>t;t++)n=s[t],e.push("function"==typeof n.unsub?n.unsub():void 0);return e},o=function(n){return n.unsub=n.input.subscribeInternal(e(n.input))},f=function(n){var t,r,e,u;for(t=e=0,u=s.length;u>e;t=++e)if(r=s[t],r.input===n)return"function"==typeof r.unsub&&r.unsub(),void s.splice(t,1)},i=function(){return function(n){var t,r,e,i;for(u=n,i=W(s),r=0,e=i.length;e>r;r++)t=i[r],o(t);return a}}(this),r.__super__.constructor.call(this,H(n,"Bus"),i),this.plug=function(){return function(n){var r;if(!t)return r={input:n},s.push(r),null!=u&&o(r),function(){return f(n)}}}(this),this.push=function(){return function(n){return"function"==typeof u?u(K(n)):void 0}}(this),this.error=function(){return function(n){return"function"==typeof u?u(new c(n)):void 0}}(this),this.end=function(){return function(){return t=!0,a(),"function"==typeof u?u(B()):void 0}}(this)}return ht(r,t),r}(f),v=function(){function n(n,t,r,e){this.obs=n,this.sync=t,this.subscribe=r,this.lazy=null!=e?e:!1,this.queue=[],null==this.subscribe&&(this.subscribe=this.obs.subscribeInternal),this.toString=this.obs.toString}return n.prototype.markEnded=function(){return this.ended=!0},n.prototype.consume=function(){return this.lazy?at.always(this.queue[0]):this.queue[0]},n.prototype.push=function(n){return this.queue=[n]},n.prototype.mayHave=function(){return!0},n.prototype.hasAtLeast=function(){return this.queue.length},n.prototype.flatten=!0,n}(),u=function(n){function t(){return t.__super__.constructor.apply(this,arguments)}return ht(t,n),t.prototype.consume=function(){return this.queue.shift()},t.prototype.push=function(n){return this.queue.push(n)},t.prototype.mayHave=function(n){return!this.ended||this.queue.length>=n},t.prototype.hasAtLeast=function(n){return this.queue.length>=n},t.prototype.flatten=!1,t}(v),t=function(n){function t(n){this.obs=n,t.__super__.constructor.call(this,this.obs,!0,this.obs.subscribeInternal)}return ht(t,n),t.prototype.consume=function(){var n;return n=this.queue,this.queue=[],function(){return n}},t.prototype.push=function(n){return this.queue.push(n())},t.prototype.hasAtLeast=function(){return!0},t}(v),v.isTrigger=function(n){return n instanceof v?n.sync:n instanceof f},v.fromObservable=function(n){return n instanceof v?n:n instanceof g?new v(n,!1):new u(n,!0)},H=function(){var n,t,r;return t=arguments[0],r=arguments[1],n=3<=arguments.length?lt.call(arguments,2):[],(t||r)instanceof i?t||r:new i(t,r,n)},i=function(){function n(n,t,r){var e,u,i,o;i=function(n){return q(n)?at.flatMap(i,n):N(n)?[n]:n instanceof v?[n.obs]:[]},o=null,e=function(n){var t,r,u,i,s;for(r=n.internalDeps(),s=[],u=0,i=r.length;i>u;u++)t=r[u],o[t.id]=!0,s.push(e(t));return s},u=function(n){return null==o&&(o={},e(this)),o[n.id]},this.apply=function(e){var o;return o=at.cached(function(){return i([n].concat(r))}),e.internalDeps=e.internalDeps||o,e.dependsOn=u,e.deps=o,e.toString=function(){return at.toString(n)+"."+at.toString(t)+"("+at.map(at.toString,r)+")"},e.inspect=function(){return e.toString()},e.desc=function(){return{context:n,method:t,args:r}},e}}return n}(),st=function(){var n,t,r;return n=2<=arguments.length?lt.call(arguments,0,r=arguments.length-1):(r=0,[]),t=arguments[r++],H.apply(null,n).apply(t)},n.when=function(){var t,r,e,u,i,o,s,c,a,l,p,h,y,g,m,d,w,S,M,_;if(l=1<=arguments.length?lt.call(arguments,0):[],0===l.length)return n.never();for(i=l.length,m="when: expecting arguments in the form (Observable+,function)+",E(m,i%2===0),y=[],a=[],r=0;i>r;){for(c=at.toArray(l[r]),t=l[r+1],s={f:z(t)?t:function(){return t},ixs:[]},g=!1,d=0,S=c.length;S>d;d++){for(h=c[d],e=at.indexOf(y,h),g||(g=v.isTrigger(h)),0>e&&(y.push(h),e=y.length-1),_=s.ixs,w=0,M=_.length;M>w;w++)u=_[w],u.index===e&&u.count++;s.ixs.push({index:e,count:1})}E("At least one EventStream required",g||!c.length),c.length>0&&a.push(s),r+=2}return y.length?(y=at.map(v.fromObservable,y),o=at.any(y,function(n){return n.flatten})&&x(at.map(function(n){return n.obs},y)),p=new f(H.apply(null,[n,"when"].concat(lt.call(l))),function(t){var e,u,i,s,c,f,l;return l=[],i=!1,s=function(n){var t,e,u;for(u=n.ixs,t=0,e=u.length;e>t;t++)if(r=u[t],!y[r.index].hasAtLeast(r.count))return!1;return!0},u=function(n){return!n.sync||n.ended},e=function(n){var t,e,u;for(u=n.ixs,t=0,e=u.length;e>t;t++)if(r=u[t],!y[r.index].mayHave(r.count))return!0},c=function(n){return!n.source.flatten},f=function(f){return function(h){var g,m,d;return m=function(){return b.whenDoneWith(p,g)},d=function(){var e,u,i,f,p,h;if(!(l.length>0))return n.more;for(i=n.more,f=l.pop(),p=0,h=a.length;h>p;p++)if(u=a[p],s(u))return e=function(){var n,t,e,i;for(e=u.ixs,i=[],n=0,t=e.length;t>n;n++)r=e[n],i.push(y[r.index].consume());return i}(),i=t(f.e.apply(function(){var n,t;return t=function(){var t,r,u;for(u=[],t=0,r=e.length;r>t;t++)n=e[t],u.push(n());return u}(),u.f.apply(u,t)})),l.length&&o&&(l=at.filter(c,l)),i===n.noMore?i:d()},g=function(){var r;return r=d(),i&&(i=!1,(at.all(y,u)||at.all(a,e))&&(r=n.noMore,t(B()))),r===n.noMore&&h(),r},f.subscribe(function(r){var e;return r.isEnd()?(i=!0,f.markEnded(),m()):r.isError()?e=t(r):(f.push(r.value),f.sync&&(l.push({source:f,e:r}),o?m():g())),e===n.noMore&&h(),e||n.more})}},k.apply(null,function(){var n,t,r;for(r=[],n=0,t=y.length;t>n;n++)h=y[n],r.push(f(h));return r}())})):n.never()},x=function(t,r){var e;return null==r&&(r=[]),e=function(t){var u;return n._.contains(r,t)?!0:(u=t.internalDeps(),u.length?(r.push(t),n._.any(u,e)):(r.push(t),!1))},n._.any(t,e)},n.update=function(){var t,r,e,u;for(r=arguments[0],u=2<=arguments.length?lt.call(arguments,1):[],e=function(n){return function(){var t;return t=1<=arguments.length?lt.call(arguments,0):[],function(r){return n.apply(null,[r].concat(t))}}},t=u.length-1;t>0;)u[t]instanceof Function||(u[t]=function(n){return function(){return n}}(u[t])),u[t]=e(u[t]),t-=2;return st.apply(null,[n,"update",r].concat(lt.call(u),[n.when.apply(n,u).scan(r,function(n,t){return t(n)})]))},k=function(){var n;return n=1<=arguments.length?lt.call(arguments,0):[],new e(n).unsubscribe},e=function(){function n(n){var t,r,e;for(null==n&&(n=[]),this.unsubscribe=yt(this.unsubscribe,this),this.unsubscribed=!1,this.subscriptions=[],this.starting=[],r=0,e=n.length;e>r;r++)t=n[r],this.add(t)}return n.prototype.add=function(n){var t,r,e;if(!this.unsubscribed)return t=!1,r=X,this.starting.push(n),e=function(e){return function(){return e.unsubscribed?void 0:(t=!0,e.remove(r),at.remove(n,e.starting))}}(this),r=n(this.unsubscribe,e),this.unsubscribed||t||this.subscriptions.push(r),at.remove(n,this.starting),r},n.prototype.remove=function(n){return this.unsubscribed?void 0:void 0!==at.remove(n,this.subscriptions)?n():void 0},n.prototype.unsubscribe=function(){var n,t,r,e;if(!this.unsubscribed){for(this.unsubscribed=!0,e=this.subscriptions,t=0,r=e.length;r>t;t++)(n=e[t])();return this.subscriptions=[],this.starting=[]}},n.prototype.count=function(){return this.unsubscribed?0:this.subscriptions.length+this.starting.length},n.prototype.empty=function(){return 0===this.count()},n}(),n.CompositeUnsubscribe=e,d=function(){function n(n){this.value=n}return n.prototype.getOrElse=function(){return this.value
},n.prototype.get=function(){return this.value},n.prototype.filter=function(t){return t(this.value)?new n(this.value):h},n.prototype.map=function(t){return new n(t(this.value))},n.prototype.forEach=function(n){return n(this.value)},n.prototype.isDefined=!0,n.prototype.toArray=function(){return[this.value]},n.prototype.inspect=function(){return"Some("+this.value+")"},n.prototype.toString=function(){return this.inspect()},n}(),h={getOrElse:function(n){return n},filter:function(){return h},map:function(){return h},forEach:function(){},isDefined:!1,toArray:function(){return[]},inspect:function(){return"None"},toString:function(){return this.inspect()}},b=function(){var t,r,e,u,i,o,s,c,a,f,l;return c=void 0,a=[],r=[],t=function(n){return c?r.push(n):n()},s=function(n){return!at.any(a,function(t){return n.obs.dependsOn(t.obs)})},f=function(n,t){return c?a.push({obs:n,f:t}):t()},u=function(){for(;!s(a[0]);)a.push(at.popHead(a));return at.popHead(a)},i=function(){var n;for(n=[];a.length;)n.push(u().f());return n},o=function(n,t,e,u){var o;if(c)return e.apply(t,u);c=n;try{o=e.apply(t,u),i()}finally{for(c=void 0;r.length;)(e=r.splice(0,1)[0])()}return o},e=function(){return c?c.id:void 0},l=function(r){return function(e){var u,i,o;return o=!1,u=function(){},i=function(){return o=!0,u()},o||(u=r.subscribeInternal(function(r){return t(function(){var t;return o||(t=e(r),t!==n.noMore)?void 0:i()})})),i}},{whenDoneWith:f,inTransaction:o,currentEventId:e,wrappedSubscribe:l}}(),n.EventStream=f,n.Property=g,n.Observable=y,n.Bus=r,n.Initial=l,n.Next=p,n.End=s,n.Error=c,X=function(){},U=function(n,t){return t()},V=function(n){return n},D=function(n){return new l(at.always(n))},K=function(n){return new p(at.always(n))},B=function(){return new s},rt=function(n){return n instanceof a?n:K(n)},W=function(n){return n.slice(0)},E=function(n,t){if(!t)throw n},M=function(n){if(!(n instanceof f))throw"not an EventStream : "+n},_=function(n){return E("not a function : "+n,z(n))},z=function(n){return"function"==typeof n},q=function(n){return n instanceof Array},N=function(n){return n instanceof y},S=function(n){if(!q(n))throw"not an array : "+n},A=function(n){return E("no arguments supported",0===n.length)},I=function(n){if("string"!=typeof n)throw"not a string : "+n},G=function(n,t){return function(){var r;return r=1<=arguments.length?lt.call(arguments,0):[],n.apply(null,t.concat(r))}},$=function(n){return 1===n.length&&N(n[0])?at.always(n[0]):R(n)},R=function(n){return n=Array.prototype.slice.call(n),Q.apply(null,n)},Q=ct(function(){var n,t;return t=arguments[0],n=2<=arguments.length?lt.call(arguments,1):[],z(t)?n.length?G(t,n):t:L(t)?et(t,n):at.always(t)}),F=function(n,t){return Q.apply(null,[n].concat(lt.call(t)))},Z=function(t){return N(t)?t:n.once(t)},L=function(n){return"string"==typeof n&&n.length>1&&"."===n.charAt(0)},n.isFieldKey=L,et=function(n,t){var r,e;return e=n.slice(1).split("."),r=at.map(ot(t),e),function(t){var e,u;for(e=0,u=r.length;u>e;e++)n=r[e],t=n(t);return t}},ot=function(n){return function(t){return function(r){var e;return null==r?void 0:(e=r[t],z(e)?e.apply(r,n):e)}}},ut=function(n){return n.slice(1)},tt=function(n){var t;return z(n)?n:L(n)?(t=ut(n),function(n,r){return n[t](r)}):E("not a function or a field key: "+n,!1)},it=function(n){return n instanceof d||n===h?n:new d(n)},at={indexOf:Array.prototype.indexOf?function(n,t){return n.indexOf(t)}:function(n,t){var r,e,u,i;for(r=u=0,i=n.length;i>u;r=++u)if(e=n[r],t===e)return r;return-1},indexWhere:function(n,t){var r,e,u,i;for(r=u=0,i=n.length;i>u;r=++u)if(e=n[r],t(e))return r;return-1},head:function(n){return n[0]},always:function(n){return function(){return n}},negate:function(n){return function(t){return!n(t)}},empty:function(n){return 0===n.length},tail:function(n){return n.slice(1,n.length)},filter:function(n,t){var r,e,u,i;for(r=[],u=0,i=t.length;i>u;u++)e=t[u],n(e)&&r.push(e);return r},map:function(n,t){var r,e,u,i;for(i=[],e=0,u=t.length;u>e;e++)r=t[e],i.push(n(r));return i},each:function(n,t){var r,e,u;u=[];for(r in n)e=n[r],u.push(t(r,e));return u},toArray:function(n){return q(n)?n:[n]},contains:function(n,t){return-1!==at.indexOf(n,t)},id:function(n){return n},last:function(n){return n[n.length-1]},all:function(n,t){var r,e,u;for(null==t&&(t=at.id),e=0,u=n.length;u>e;e++)if(r=n[e],!t(r))return!1;return!0},any:function(n,t){var r,e,u;for(null==t&&(t=at.id),e=0,u=n.length;u>e;e++)if(r=n[e],t(r))return!0;return!1},without:function(n,t){return at.filter(function(t){return t!==n},t)},remove:function(n,t){var r;return r=at.indexOf(t,n),r>=0?t.splice(r,1):void 0},popHead:function(n){return n.splice(0,1)[0]},fold:function(n,t,r){var e,u,i;for(u=0,i=n.length;i>u;u++)e=n[u],t=r(t,e);return t},flatMap:function(n,t){return at.fold(t,[],function(t,r){return t.concat(n(r))})},cached:function(n){var t;return t=h,function(){return t===h&&(t=n(),n=null),t}},toString:function(n){var t,r,e,u;try{return J++,null==n?"undefined":z(n)?"function":q(n)?J>5?"[..]":"["+at.map(at.toString,n).toString()+"]":null!=(null!=n?n.toString:void 0)&&n.toString!==Object.prototype.toString?n.toString():"object"==typeof n?J>5?"{..}":(r=function(){var r;r=[];for(e in n)pt.call(n,e)&&(u=function(){try{return n[e]}catch(r){return t=r}}(),r.push(at.toString(e)+":"+at.toString(u)));return r}(),"{"+r+"}"):n}finally{J--}}},J=0,n._=at,n.scheduler={setTimeout:function(n,t){return setTimeout(n,t)},setInterval:function(n,t){return setInterval(n,t)},clearInterval:function(n){return clearInterval(n)},now:function(){return(new Date).getTime()}},"undefined"!=typeof define&&null!==define&&null!=define.amd?(define([],function(){return n}),this.Bacon=n):"undefined"!=typeof module&&null!==module?(module.exports=n,n.Bacon=n):this.Bacon=n}).call(this);