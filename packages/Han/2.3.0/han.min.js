/*! 
 * 漢字標準格式 v2.3
 * Hanzi-optimised CSS Mode
 *
 * Lisence: MIT Lisence
 * Last-Modified: 2014/2/7
 */
(function(window,$){var version="2.3",tests=[],rubies,unicode=[],rendered="han-js-rendered",classes=[rendered],fontfaces=[],han=function(){$(document).on("ready",function(){classes.push((test_for_unicoderange()?"":"no-")+"unicoderange");fontfaces.songti=test_for_fontface("Han Songti");fontfaces.kaiti=test_for_fontface("Han Kaiti");fontfaces.fangsong=test_for_fontface("Han Fangsong");for(var font in fontfaces){classes.push((fontfaces[font]?"":"no-")+"fontface-"+font)}$("html").addClass(classes.join(" "));init()})},init=function(range){if(!range&&$("html").hasClass("no-han-init")){return}var range=range||"body";if(range!=="body"&&!$(range).hasClass(rendered)){$(range).addClass(rendered)}else{if(range==="body"&&!$("html").hasClass(rendered)){$("html").addClass(rendered)}}var _ruby=$(range).find("ruby, rtc");_ruby.filter(".pinyin").addClass("romanization");_ruby.filter(".mps").addClass("zhuyin");_ruby.filter(".romanization").addClass("annotation");$(range).find("ruby").each(function(){var html=$(this).html(),that=$(this),hruby=document.createElement("hruby");if(!tests.ruby()&&!that.hasClass("complex")&&!that.hasClass("zhuyin")&&!that.hasClass("rightangle")){that.find("rt").each(function(){var anno=$(this).html(),prev=this.previousSibling,text=prev.nodeValue;prev.nodeValue="";$(prev).before($("<rb/>").html(text).attr("annotation",anno).replaceWith(_copy));$(this).replaceWith(_copy().html(anno))});that.replaceWith($(hruby).html($(this).html()))}else{var attr={};if(that.hasClass("zhuyin")){that.find("rt").each(function(){_apply_zhuyin(this)})}else{if(that.hasClass("complex")){attr.complex="complex";_apply_annotation(this)}else{if(that.hasClass("rightangle")){attr.rightangle="rightangle";that.find("rtc.zhuyin").hide().each(function(){var t=$(this).prevAll("rbc"),c,len,data;$(this).find("rt").each(function(i){var rb=t.find("rb:not([annotation])").eq(i);if($(this).html()){_apply_zhuyin(this,rb)}});$(this).nextAll("rt").each(function(i){var rb=t.find("rb:not([annotation])").eq(i);if($(this).html()){_apply_zhuyin(this,rb)}})});_apply_annotation(this)}}}that.filter(function(){return $(this).hasClass("zhuyin")||$(this).hasClass("complex")||$(this).hasClass("rightangle")}).replaceWith($(hruby).html($(this).html().replace(/(.*<\/rbc>).*/,"$1")).attr("generic",_get_zhuyin_font(this)).attr(attr))}});if($("html").hasClass("han-la")){$(range).each(function(){var hanzi=unicode_set("hanzi"),latin=unicode_set("latin")+"|"+unicode.punc[0],punc=unicode.punc;patterns=["/("+hanzi+")("+latin+"|"+punc[1]+")/ig","/("+latin+"|"+punc[2]+")("+hanzi+")/ig"];patterns.forEach(function(exp){findAndReplaceDOMText(this,{find:eval(exp),replace:"$1<hanla>$2"})},this);findAndReplaceDOMText(this,{find:"<hanla>",replace:function(){return document.createElement("hanla")}});this.normalize();$("* > hanla:first-child").parent().each(function(){if(this.firstChild.nodeType==1){$(this).before($("<hanla/>"));$(this).find("hanla:first-child").remove()}})})}if($("html").hasClass("han-lab-underline")){$(range).find("u").charize({bitouwei:false},true,true)}$(range).find("u, ins").each(function(){var next=this.nextSibling;while(next!=null&&(next.nodeName==="WBR"||next.nodeType==8)){next=next.nextSibling}$(next).filter("u, ins").addClass("adjacent")});$(range).find("em").charize({latin:(tests.textemphasis())?"none":"individual"})},unicode_set=function(set){var join=(set.match(/[hanzi|latin]/))?true:false,result=(join)?unicode[set].join("|"):unicode[set];return result},_span=function(className){var span=document.createElement("span");span.className=className;return span},_copy=function(){return $(document.createElement("copy"))},_apply_annotation=function(node){$(node).find("rbc").find("rb").each(function(i){$(this).attr("index",i)});$(node).find("rtc:not(.zhuyin)").hide().each(function(t){var c=0,rtc=$(this),rbc=$(this).prevAll("rbc"),len=$(this).find("rt").length||$(this).nextAll("rt").length,data=[];$(this).find("rt").each(function(h){var anno=$(this).html(),rbspan=$(this).attr("rbspan")||1,i=c;c+=Number(rbspan);data[h]={annotation:anno,order:(t==0)?"1":"2"};for(var j=i;j<c;j++){rbc.find("rb[index]").eq(j).attr({set:h})}});$(this).nextAll("rt").each(function(h){var anno=$(this).html(),rbspan=$(this).attr("rbspan")||1,i=c;c+=Number(rbspan);data[h]={annotation:anno,order:(t==0)?"1":"2"};for(var j=i;j<c;j++){rbc.find("rb[index]").eq(j).attr({set:h})}});rbc.find("rb[annotation]").each(function(){var rb=$(this).find("rb[index]"),first=rb.filter(":first-child").attr("set"),last=rb.filter(":last-child").attr("set");if(first===last){rb.removeAttr("set");$(this).attr("set",first)}});for(var k=0;k<len;k++){rbc.find("rb[set="+k+"]").wrapAll($("<rb/>").attr(data[k]))}}).remove();$(node).find("rb").removeAttr("set index").filter("rb[annotation]").each(function(){var t=$(this).attr("annotation");$(this).after(_copy().html(t))})},_get_zhuyin_font=function(node){var reg=/(sans-serif|monospace)$/,generic=$(node).css("font-family"),font=generic.match(reg)?"sans":"serif";return font},_apply_zhuyin=function(node,rb){var sm=unicode.zhuyin["shengmu"],jy=unicode.zhuyin["jieyin"],ym=unicode.zhuyin["yunmu"],yj=unicode.zhuyin["yunjiao"],tone=unicode.zhuyin["diao"],prev,text,zi,zy=$(node).html(),yin,diao,form,length,data;form=(zy.match(eval("/("+sm+")/")))?"shengmu":"";form+=(zy.match(eval("/("+jy+")/")))?((form!=="")?"-":"")+"jieyin":"";form+=(zy.match(eval("/("+ym+")/")))?((form!=="")?"-":"")+"yunmu":"";yin=zy.replace(eval("/("+tone+")/g"),"").replace(eval("/("+yj+"[\u0358\u030d]?)/g"),"");length=(yin)?yin.length:0;diao=(zy.match(/(\u02D9)/))?"\u02D9":(zy.match(/(\u02CA)/))?"\u02CA":(zy.match(/([\u02C5\u02C7])/))?"\u02C7":(zy.match(/(\u02CB)/))?"\u02CB":(zy.match(/(\u02EA)/))?"\u02EA":(zy.match(/(\u02EB)/))?"\u02EB":(zy.match(/(\u31B4[\u0358\u030d])/))?"\u31B4\u0358":(zy.match(/(\u31B5[\u0358\u030d])/))?"\u31B5\u0358":(zy.match(/(\u31B6[\u0358\u030d])/))?"\u31B6\u0358":(zy.match(/(\u31B7[\u0358\u030d])/))?"\u31B7\u0358":(zy.match(/(\u31B4)/))?"\u31B4":(zy.match(/(\u31B5)/))?"\u31B5":(zy.match(/(\u31B6)/))?"\u31B6":(zy.match(/(\u31B7)/))?"\u31B7":"";data={zhuyin:zy,yin:yin,diao:diao,length:length,form:form};if(rb){rb.attr(data).append(_copy().html(zy))}else{prev=node.previousSibling;text=prev.nodeValue.split("");zi=text.pop();prev.nodeValue=text.join("");$(node).before($("<rb/>").attr(data).text(zi)).replaceWith(_copy().html(zy))}},findAndReplaceDOMText=function(a,b){var b=b;b.filterElements=function(el){var name=el.nodeName.toLowerCase(),classes=(el.nodeType==1)?el.getAttribute("class"):"",charized=(classes&&classes.match(/han-js-charized/)!=null)?true:false;return name!=="style"&&name!=="script"&&!charized};return window.findAndReplaceDOMText(a,b)},inject_element_with_styles=function(rule,callback,nodes,testnames){var style,ret,node,docOverflow,docElement=document.documentElement,div=document.createElement("div"),body=document.body,fakeBody=body||document.createElement("body");style=['<style id="han-support">',rule,"</style>"].join("");(body?div:fakeBody).innerHTML+=style;fakeBody.appendChild(div);if(!body){fakeBody.style.background="";fakeBody.style.overflow="hidden";docOverflow=docElement.style.overflow;docElement.style.overflow="hidden";docElement.appendChild(fakeBody)}ret=callback(div,rule);if(!body){fakeBody.parentNode.removeChild(fakeBody);docElement.style.overflow=docOverflow}else{div.parentNode.removeChild(div)}return !!ret},write_on_canvas=function(text,font){var canvasNode=document.createElement("canvas");canvasNode.width="50";canvasNode.height="20";canvasNode.style.display="none";canvasNode.className="han_support_tests";document.body.appendChild(canvasNode);var ctx=canvasNode.getContext("2d");ctx.textBaseline="top";ctx.font="15px "+font+", sans-serif";ctx.fillStyle="black";ctx.strokeStyle="black";ctx.fillText(text,0,0);return ctx},test_for_fontface=function(test,compare,zi){if(!tests.fontface()){return false}var test=test,compare=compare||"sans-serif",zi=zi||"辭Q";try{var sans=write_on_canvas(zi,compare),test=write_on_canvas(zi,test),support;for(var j=1;j<=20;j++){for(var i=1;i<=50;i++){var sansData=sans.getImageData(i,j,1,1).data,testData=test.getImageData(i,j,1,1).data,alpha=[];alpha.sans=sansData[3];alpha.test=testData[3];if(support!=="undefined"&&alpha.test!=alpha.sans){support=true}else{if(support){break}}if(i==20&&j==20&&!support){support=false}}}$("canvas.han_support_tests").remove();return support}catch(err){return false}};test_for_unicoderange=function(){return !test_for_fontface("han-unicode-range",'Arial, "Droid Sans"',"a")};unicode.latin=["[A-Za-z0-9\u00C0-\u00FF\u0100-\u017F\u0180-\u024F\u1E00-\u1EFF]"];unicode.punc=["[@&=_,.?!$%^*-+/]","[(\\['\"<‘“]","[)\\]'\">”’]"];unicode.hanzi=["[\u4E00-\u9FFF]","[\u3400-\u4DB5\u9FA6-\u9FBB\uFA70-\uFAD9\u9FBC-\u9FC3\u3007\u3040-\u309E\u30A1-\u30FA\u30FD\u30FE\uFA0E-\uFA0F\uFA11\uFA13-\uFA14\uFA1F\uFA21\uFA23-\uFA24\uFA27-\uFA29]","[\uD840-\uD868][\uDC00-\uDFFF]|\uD869[\uDC00-\uDEDF]","\uD86D[\uDC00-\uDF3F]|[\uD86A-\uD86C][\uDC00-\uDFFF]|\uD869[\uDF00-\uDFFF]","\uD86D[\uDF40-\uDFFF]|\uD86E[\uDC00-\uDC1F]","[\u31C0-\u31E3]"];unicode.biaodian=["[·・︰、，。：；？！—ー⋯…．·／]","[「『（〔【《〈“‘]","[」』）〕】》〉’”]"];unicode.zhuyin=[];unicode.zhuyin[0]="[\u3105-\u312D\u31A0-\u31BA]";unicode.zhuyin["shengmu"]="[\u3105-\u3119\u312A-\u312C\u31A0-\u31A3]";unicode.zhuyin["jieyin"]="[\u3127-\u3129]";unicode.zhuyin["yunmu"]="[\u311A-\u3126\u312D\u31A4-\u31B3\u31B8-\u31BA]";unicode.zhuyin["yunjiao"]="[\u31B4-\u31B7]";unicode.zhuyin["diao"]="[\u02D9\u02CA\u02C5\u02C7\u02CB\u02EA\u02EB]";tests.columnwidth=function(){var cw=$('<div style="display: none; column-width: 200px; -webkit-column-width: 200px">tester</div>'),bool=(/^200px$/.test(cw.css("-webkit-column-width"))||/^200px$/.test(cw.css("-moz-column-width"))||/^200px$/.test(cw.css("-ms-column-width"))||/^200px$/.test(cw.css("column-width")))?true:false;return bool};tests.fontface=function(){var bool;inject_element_with_styles('@font-face {font-family:"font"; src:url("https://")}',function(node,rule){var style=document.getElementById("han-support"),sheet=style.sheet||style.styleSheet,cssText=sheet?(sheet.cssRules&&sheet.cssRules[0]?sheet.cssRules[0].cssText:sheet.cssText||""):"";bool=/src/i.test(cssText)&&cssText.indexOf(rule.split(" ")[0])===0});return bool};tests.ruby=function(){if(rubies!=null){return rubies}var ruby=document.createElement("ruby"),rt=document.createElement("rt"),rp=document.createElement("rp"),docElement=document.documentElement,displayStyleProperty="display";ruby.appendChild(rp);ruby.appendChild(rt);docElement.appendChild(ruby);rubies=(getStyle(rp,displayStyleProperty)=="none"||getStyle(ruby,displayStyleProperty)=="ruby"&&getStyle(rt,displayStyleProperty)=="ruby-text")?true:false;docElement.removeChild(ruby);ruby=null;rt=null;rp=null;return rubies;function getStyle(element,styleProperty){var result;if(window.getComputedStyle){result=document.defaultView.getComputedStyle(element,null).getPropertyValue(styleProperty)}else{if(element.currentStyle){result=element.currentStyle[styleProperty]}}return result}};tests.textemphasis=function(){var em=$('<span style="display: none; text-emphasis: dot; -moz-text-emphasis: dot; -ms-text-emphasis: dot; -webkit-text-emphasis: dot">tester</span>'),bool=(/^dot$/.test(em.css("-webkit-text-emphasis-style"))||/^dot$/.test(em.css("text-emphasis-style"))||/^dot$/.test(em.css("-moz-text-emphasis-style"))||/^dot$/.test(em.css("-ms-text-emphasis-style")))?true:false;return bool};tests.writingmode=function(){var wm=$('<div style="display: none; writing-mode: tb-rl; -moz-writing-mode: tb-rl; -ms-writing-mode: tb-rl; -webkit-writing-mode: vertical-rl">tester</div>'),bool=(/^tb-rl$/.test(wm.css("writing-mode"))||/^vertical-rl$/.test(wm.css("-webkit-writing-mode"))||/^tb-rl$/.test(wm.css("-moz-writing-mode"))||/^tb-rl$/.test(wm.css("-ms-writing-mode")))?true:false;return bool};$.fn.extend({hanInit:function(){return init(this)},bitouwei:function(){return this.each(function(){$(this).addClass("han-js-bitouwei-rendered");var tou=unicode.biaodian[0]+unicode.biaodian[2],wei=unicode.biaodian[1],start=unicode.punc[0]+unicode.punc[2],end=unicode.punc[1];tou=tou.replace(/\]\[/g,"");start=start.replace(/\]\[/g,"");findAndReplaceDOMText(this,{find:eval("/("+wei+")("+unicode_set("hanzi")+")("+tou+")/ig"),wrap:_span("bitouwei bitouweidian")});findAndReplaceDOMText(this,{find:eval("/("+unicode_set("hanzi")+")("+tou+")/ig"),wrap:_span("bitouwei bitoudian")});findAndReplaceDOMText(this,{find:eval("/("+wei+")("+unicode_set("hanzi")+")/ig"),wrap:_span("bitouwei biweidian")});findAndReplaceDOMText(this,{find:eval("/("+end+")("+unicode_set("latin")+"+)("+start+")/ig"),wrap:_span("bitouwei bitouweidian")});findAndReplaceDOMText(this,{find:eval("/("+unicode_set("latin")+"+)("+start+")/ig"),wrap:_span("bitouwei bitoudian")});findAndReplaceDOMText(this,{find:eval("/("+end+")("+unicode_set("latin")+"+)/ig"),wrap:_span("bitouwei biweidian")})})},charize:function(glyph,charClass,innerSpan){var glyph=glyph||{},charClass=(charClass==true)?true:false;glyph={cjk:glyph.cjk||"individual",bitouwei:(glyph.bitouwei==false)?false:true,latin:glyph.latin||"group"};return this.each(function(){if(glyph.bitouwei){$(this).bitouwei()}if(glyph.cjk==="individual"){findAndReplaceDOMText(this,{find:eval("/("+unicode_set("hanzi")+")/ig"),wrap:_span("char cjk")})}if(glyph.cjk==="individual"||glyph.cjk==="biaodian"){findAndReplaceDOMText(this,{find:eval("/("+unicode_set("biaodian")+")/ig"),wrap:_span("char cjk biaodian")})}if(glyph.cjk==="group"){findAndReplaceDOMText(this,{find:eval("/("+unicode_set("hanzi")+"+|"+unicode_set("biaodian")+"+)/ig"),wrap:_span("char cjk")})}var latin_regex=(glyph.latin==="group")?"/("+unicode_set("latin")+"+)/ig":"/("+unicode_set("latin")+")/ig";findAndReplaceDOMText(this,{find:eval(latin_regex),wrap:_span("char latin")});findAndReplaceDOMText(this,{find:eval("/("+unicode_set("punc")+"+)/ig"),wrap:_span("char latin punc")});findAndReplaceDOMText(this,{find:/([\s]+)/ig,wrap:_span("char space")});if(innerSpan){$(this).find(".char").each(function(){$(this).html($("<span>").text($(this).text()))})}if(charClass){$(this).addClass("han-js-charized")}})}});for(var feature in tests){classes.push((tests[feature]()?"":"no-")+feature);if(!tester){var tester=""}tester+="    "+feature+": tests['"+feature+"'](),\n"}!function(window){eval("tester = ({\n"+tester.replace(/\n$/ig,"\nunicoderange: test_for_unicoderange, \nfont: test_for_fontface\n}")+")")}();han();window.han={unicode:unicode_set,support:tester}})(window,window.jQuery,undefined);window.findAndReplaceDOMText=(function(){var j="retain";var b="first";var i=document;var d={}.toString;function h(k){return d.call(k)=="[object Array]"}function f(k){return String(k).replace(/([.*+?^=!:${}()|[\]\/\\])/g,"\\$1")}function g(){return e.apply(null,arguments)||a.apply(null,arguments)}function e(q,p,n,l,o){if((p&&!p.nodeType)&&arguments.length<=2){return false}var m=typeof n=="function";if(m){n=(function(r){return function(t,s){return r(t.text,s.startIndex)}}(n))}var k=a(p,{find:q,wrap:m?null:n,replace:m?n:"$"+(l||"&"),prepMatch:function(r,s){if(!r[0]){throw"findAndReplaceDOMText cannot handle zero-length matches"}if(l>0){var t=r[l];r.index+=r[0].indexOf(t);r[0]=t}r.endIndex=r.index+r[0].length;r.startIndex=r.index;r.index=s;return r},filterElements:o});g.revert=function(){return k.revert()};return true}function a(l,k){return new c(l,k)}g.Finder=c;function c(l,k){k.portionMode=k.portionMode||j;this.node=l;this.options=k;this.prepMatch=k.prepMatch||this.prepMatch;this.reverts=[];this.matches=this.search();if(this.matches.length){this.processMatches()}}c.prototype={search:function(){var l;var k=0;var m=this.options.find;var o=this.getAggregateText();var n=[];m=typeof m==="string"?RegExp(f(m),"g"):m;if(m.global){while(l=m.exec(o)){n.push(this.prepMatch(l,k++))}}else{if(l=o.match(m)){n.push(this.prepMatch(l,0))}}return n},prepMatch:function(l,k){if(!l[0]){throw new Error("findAndReplaceDOMText cannot handle zero-length matches")}l.endIndex=l.index+l[0].length;l.startIndex=l.index;l.index=k;return l},getAggregateText:function(){var l=this.options.filterElements;return k(this.node);function k(n){if(n.nodeType===3){return n.data}if(l&&!l(n)){return""}var m="";if(n=n.firstChild){do{m+=k(n)}while(n=n.nextSibling)}return m}},processMatches:function(){var o=this.matches;var l=this.node;var v=this.options.filterElements;var n,t,k=[],m=l,p=o.shift(),q=0,u=0,r=0,s;out:while(true){if(m.nodeType===3){if(!t&&m.length+q>=p.endIndex){t={node:m,index:r++,text:m.data.substring(p.startIndex-q,p.endIndex-q),indexInMatch:q-p.startIndex,indexInNode:p.startIndex-q,endIndexInNode:p.endIndex-q,isEnd:true}}else{if(n){k.push({node:m,index:r++,text:m.data,indexInMatch:q-p.startIndex,indexInNode:0})}}if(!n&&m.length+q>p.startIndex){n={node:m,index:r++,indexInMatch:0,indexInNode:p.startIndex-q,endIndexInNode:p.endIndex-q,text:m.data.substring(p.startIndex-q,p.endIndex-q)}}q+=m.data.length}s=m.nodeType===1&&v&&!v(m);if(n&&t){m=this.replaceMatch(p,n,k,t);q-=(t.node.data.length-t.endIndexInNode);n=null;t=null;k=[];p=o.shift();r=0;u++;if(!p){break}}else{if(!s&&(m.firstChild||m.nextSibling)){m=m.firstChild||m.nextSibling;continue}}while(true){if(m.nextSibling){m=m.nextSibling;break}else{if(m.parentNode!==l){m=m.parentNode}else{break out}}}}},revert:function(){for(var k=this.reverts.length;k--;){this.reverts[k]()}this.reverts=[]},prepareReplacementString:function(n,m,l,k){var o=this.options.portionMode;if(o===b&&m.indexInMatch>0){return""}n=n.replace(/\$(\d+|&|`|')/g,function(p,q){var r;switch(q){case"&":r=l[0];break;case"`":r=l.input.substring(0,l.startIndex);break;case"'":r=l.input.substring(l.endIndex);break;default:r=l[+q]}return r});if(o===b){return n}if(m.isEnd){return n.substring(m.indexInMatch)}return n.substring(m.indexInMatch,m.indexInMatch+m.text.length)},getPortionReplacementNode:function(m,l,k){var o=this.options.replace||"$&";var q=this.options.wrap;if(q&&q.nodeType){var p=i.createElement("div");p.innerHTML=q.outerHTML||new XMLSerializer().serializeToString(q);q=p.firstChild}if(typeof o=="function"){o=o(m,l,k);if(o&&o.nodeType){return o}return i.createTextNode(String(o))}var n=typeof q=="string"?i.createElement(q):q;o=i.createTextNode(this.prepareReplacementString(o,m,l,k));if(!n){return o}n.appendChild(o);return n},replaceMatch:function(v,u,n,x){var o=u.node;var z=x.node;var p;var r;if(o===z){var q=o;if(u.indexInNode>0){p=i.createTextNode(q.data.substring(0,u.indexInNode));q.parentNode.insertBefore(p,q)}var y=this.getPortionReplacementNode(x,v);q.parentNode.insertBefore(y,q);if(x.endIndexInNode<q.length){r=i.createTextNode(q.data.substring(x.endIndexInNode));q.parentNode.insertBefore(r,q)}q.parentNode.removeChild(q);this.reverts.push(function(){if(p===y.previousSibling){p.parentNode.removeChild(p)}if(r===y.nextSibling){r.parentNode.removeChild(r)}y.parentNode.replaceChild(q,y)});return y}else{p=i.createTextNode(o.data.substring(0,u.indexInNode));r=i.createTextNode(z.data.substring(x.endIndexInNode));var k=this.getPortionReplacementNode(u,v);var w=[];for(var t=0,s=n.length;t<s;++t){var B=n[t];var A=this.getPortionReplacementNode(B,v);B.node.parentNode.replaceChild(A,B.node);this.reverts.push((function(l,C){return function(){C.parentNode.replaceChild(l.node,C)}}(B,A)));w.push(A)}var m=this.getPortionReplacementNode(x,v);o.parentNode.insertBefore(p,o);o.parentNode.insertBefore(k,o);o.parentNode.removeChild(o);z.parentNode.insertBefore(m,z);z.parentNode.insertBefore(r,z);z.parentNode.removeChild(z);this.reverts.push(function(){p.parentNode.removeChild(p);k.parentNode.replaceChild(o,k);r.parentNode.removeChild(r);m.parentNode.replaceChild(z,m)});return m}}};return g}());