(function(z){function s(){function n(a){if(!(k<a)&&p>=a-1){do{var b;b=a;if(d[b])if(d[b].length){for(var f=void 0;f=d[b][0];)d[b].shift(),"function"===typeof f?f.call(q):l(f);b=null!==f}else b=!0;else b=!1;if(!b)break}while(a++<c);a=Math.max(0,a-1);p=Math.max(p,a)}}function l(a,b){var f=a.d,c=[];b||w.set(f);for(var e=0;e<g.length;e++)g[e].d===f&&(b||g[e].s===a.s&&c.push(g[e].func),g.splice(e,1),e--);for(e=0;e<c.length;e++)c[e].apply(f,a.args)}function m(a,b,f){a.done(function(){d[b].pop();b<=k&&d[b].unshift({d:this,
s:"resolved",args:h.call(arguments)});n(b)});a.fail(function(){if(!f){var a=b;k=Math.min(k,a);for(var e=0,g=t.length;e<g;e++)t[e].call(q);for(t=[];a++<c;){e=a;for(g=void 0;g=d[e][0];)d[e].shift(),"function"!==typeof g&&l(g,!0);d[e]=[]}}d[b].pop();b<=k&&d[b].unshift({d:this,s:"rejected",args:h.call(arguments)});n(b)})}function u(a,b){for(var f=0,g=a.length,e;f<g;f++)a[f]!==x&&(e=a[f],c===p&&p--,d[c].push(null),m(e,c,b))}var c=0,p=0,d={0:[]},g=[],k=A,t=[],w=new y,r=[],q=this;this.push=this.next=function(){c++;
d[c]=[];u(h.call(arguments));n(c);return this};this.add=function(){0===c&&(c=1,d[c]=[]);u(h.call(arguments));return this};this.pushIgnoreFail=this.nextIgnoreFail=function(){c++;d[c]=[];u(h.call(arguments),!0);n(c);return this};this.addIgnoreFail=function(){0===c&&(c=1,d[c]=[]);u(h.call(arguments),!0);n(c);return this};var v=function(a,b,c){return function(){var d;d=c===x?function(){a.apply(b,h.call(arguments))}:function(){a.apply(b,c.concat(h.call(arguments)));c.length=0};this===q||w.has(this)?d():
g.push({d:this,func:d,s:this.state()})}};this.bind=function(a,b){return 3>arguments.length?v(a,b):v(a,b,h.call(arguments,2))};this.applyArgs=function(a,b){if(3>arguments.length)return v(a,b,r);var c=h.call(arguments,2);return function(){var d=r.concat(c).concat(h.call(arguments));r.length=0;v(a,b,d).call(this)}};this.storeArgs=function(){var a=h.call(arguments),b=function(){r.push.apply(r,a)};if(this===q)return b;w.has(this)?b():g.push({d:this,func:b,s:this.state()})};this.done=this.after=function(a,
b){var f=c,g;b||(c++,d[c]=[]);g=c;if(k>f||b&&k===f)p<f?d[c].unshift(a):(a.call(q),b||n(g));return this};this.fail=function(a){k<A?a.call(q):t.push(a);return this};this.always=function(a){return this.fail(a).done(a)};this.fork=function(){return(new s).push(this)}}var y=z.WeakMap,A=Infinity,h=[].slice,x;y===x&&(y=function(){var h=[];this.has=function(l){var m=-1;for(null!=l&&(m=h.length-1);0<=m&&h[m]!==l;)m--;return-1<m};this.set=function(l){h.push(l)}});"undefined"!==typeof module?module.exports=s:
(z.ChainLoading=s,"function"==typeof define&&"object"==typeof define.amd&&define.amd&&define("ChainLoading",function(){return s}))})(this);
