/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.1.3 - 2014-01-08
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["ngTouch"]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-click="$parent.index=$index" ng-class="{active: $index==$parent.index}">‚óè</span></div>'}}]),function(){"use strict";angular.module("angular-carousel").directive("rnCarousel",["$swipe","$window","$document","$parse","$compile",function(a,b,c,d,e){var f=0,g=75,h=.05,i=3;return{restrict:"A",scope:!0,compile:function(j,k){var l,m,n=j.children()[0].attributes,o=!1,p=!1,q=0,r=!1;if(j.addClass("rn-carousel-slides"),j.children().addClass("rn-carousel-slide"),["ng-repeat","data-ng-repeat","x-ng-repeat"].every(function(a){var b=n[a];if(angular.isDefined(b)){var c=b.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),d=c[3];if(l=c[1],m=c[2],l)return angular.isDefined(k.rnCarouselBuffered)&&(p=!0,b.value=l+" in "+m+"|carouselSlice:carouselBufferIndex:carouselBufferSize",d&&(b.value+=" track by "+d)),o=!0,!1}return!0}),!o){{j.children()}q=j.children().length}return function(j,k,l){function n(){for(var a=[],b=0;q>b;b++)a[b]=b;j.carouselIndicatorArray=a}function s(){var a=O.children();return G=0===a.length?O[0].getBoundingClientRect().width:a[0].getBoundingClientRect().width,Math.floor(G)}function t(){P.css("width","100%"),P.css("width",s()+"px")}function u(a){isNaN(a)&&(a=j.carouselIndex*G),N=a;var b=-Math.round(N);b+=j.carouselBufferIndex*G,O[0].style[H]="translate3d("+b+"px, 0, 0)"}function v(){var a,b;K&&(a=Date.now()-M,b=K*Math.exp(-a/g),b>i||-i>b?(u(L-b),requestAnimationFrame(v)):y(L/G))}function w(a){return a>=q?q:0>=a?0:a}function x(){var a=0,b=(j.carouselBufferSize-1)/2;p&&(a=j.carouselIndex<=b?0:j.carouselIndex>q-j.carouselBufferSize?q-j.carouselBufferSize:j.carouselIndex-b),j.carouselBufferIndex=a}function y(a,b){return isNaN(a)&&(a=j.carouselIndex),b?(N=a*G,E(null,null,!0),void 0):(j.carouselIndex=w(a),x(),"$apply"!==j.$$phase&&"$digest"!==j.$$phase&&(r?j.$apply():j.$digest()),u(),void 0)}function z(){return h*G}function A(a){E({x:a.clientX,y:a.clientY},a)}function B(a){var b=a;return 0===j.carouselIndex?b=Math.max(-z(),b):j.carouselIndex===q-1&&(b=Math.min((q-1)*G+z(),b)),b}function C(a,b){return c.bind("mouseup",A),I=!0,J=a.x,K=0,M=Date.now(),b.preventDefault(),b.stopPropagation(),!1}function D(a,b){var c,d;return I&&(c=a.x,d=J-c,(d>2||-2>d)&&(J=c,requestAnimationFrame(function(){u(B(N+d))}))),b.preventDefault(),b.stopPropagation(),!1}function E(a,b,d){c.unbind("mouseup",A),I=!1,L=N;var e=z(),f=j.carouselIndex*G,g=f-L,h=-Math[g>=0?"ceil":"floor"](g/G),i=Math.abs(g)>e;h+j.carouselIndex>=q&&(h=q-1-j.carouselIndex),h+j.carouselIndex<0&&(h=-j.carouselIndex);var k=i?h:0;return L=(k+j.carouselIndex)*G,K=L-N,M=Date.now(),d&&(K=N-f),requestAnimationFrame(v),b&&(b.preventDefault(),b.stopPropagation()),!1}function F(){t(),y()}f++;var G,H,I,J,K,L,M,N=0,O=k.wrap("<div id='carousel-"+f+"' class='rn-carousel-container'></div>"),P=O.parent();if(angular.isDefined(l.rnCarouselIndicator)){n(),j.$watch("carouselIndex",function(a){j.indicatorIndex=a}),j.$watch("indicatorIndex",function(a){y(a,!0)});var Q=e("<div id='carousel-"+f+"-indicator' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-indicators class='rn-carousel-indicator'></div>")(j);P.append(Q)}if(j.carouselBufferIndex=0,j.carouselBufferSize=5,j.carouselIndex=0,l.rnCarouselIndex){var R=d(l.rnCarouselIndex);angular.isFunction(R.assign)?(j.$watch("carouselIndex",function(a){R.assign(j.$parent,a)}),j.carouselIndex=R(j),j.$parent.$watch(R,function(a){void 0!==a&&y(a,!0)}),r=!0):isNaN(l.rnCarouselIndex)||(j.carouselIndex=parseInt(l.rnCarouselIndex,10))}o?j.$watchCollection(m,function(a){q=0,angular.isArray(a)?q=a.length:angular.isObject(a)&&(q=Object.keys(a).length),n(),G||t(),y(j.carouselIndex)}):t(),a.bind(O,{start:C,move:D,end:E,cancel:function(a){E({},a)}}),r||y(j.carouselIndex),H="transform",["webkit","Moz","O","ms"].every(function(a){var b=a+"Transform";return"undefined"!=typeof document.body.style[b]?(H=b,!1):!0});var S=angular.element(b);S.bind("orientationchange",F),S.bind("resize",F),j.$on("$destroy",function(){c.unbind("mouseup",A),S.unbind("orientationchange",F),S.unbind("resize",F)})}}}}])}(),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(a,b,c){return angular.isArray(a)?a.slice(b,b+c):angular.isObject(a)?a:void 0}})}();