/**
 * Angular Carousel - Mobile friendly touch carousel for AngularJS
 * @version v0.2.1 - 2014-03-20
 * @link http://revolunet.github.com/angular-carousel
 * @author Julien Bouquillon <julien@revolunet.com>
 * @license MIT License, http://www.opensource.org/licenses/MIT
 */
angular.module("angular-carousel",["ngTouch"]),angular.module("angular-carousel").directive("rnCarouselControls",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},link:function(a){a.prev=function(){a.index--},a.next=function(){a.index++}},template:'<div class="rn-carousel-controls"><span class="rn-carousel-control rn-carousel-control-prev" ng-click="prev()" ng-if="index > 0"></span><span class="rn-carousel-control rn-carousel-control-next" ng-click="next()" ng-if="index < items.length - 1"></span></div>'}}]),angular.module("angular-carousel").directive("rnCarouselIndicators",[function(){return{restrict:"A",replace:!0,scope:{items:"=",index:"="},template:'<div class="rn-carousel-indicator"><span ng-repeat="item in items" ng-click="$parent.index=$index" ng-class="{active: $index==$parent.index}"></span></div>'}}]),function(){"use strict";angular.module("angular-carousel").directive("rnCarousel",["$swipe","$window","$document","$parse","$compile","$rootScope",function(a,b,c,d,e,f){var g=0,h=75,i=.05,j=3;return{restrict:"A",scope:!0,compile:function(k,l){var m,n,o=k.children()[0].attributes,p=!1,q=!1,r=!1;return k.addClass("rn-carousel-slides"),k.children().addClass("rn-carousel-slide"),["ng-repeat","data-ng-repeat","x-ng-repeat"].every(function(a){var b=o[a];if(angular.isDefined(b)){var c=b.value.match(/^\s*([\s\S]+?)\s+in\s+([\s\S]+?)(?:\s+track\s+by\s+([\s\S]+?))?\s*$/),d=c[3];if(m=c[1],n=c[2],m)return angular.isDefined(l.rnCarouselBuffered)&&(q=!0,b.value=m+" in "+n+"|carouselSlice:carouselBufferIndex:carouselBufferSize",d&&(b.value+=" track by "+d)),p=!0,!1}return!0}),function(k,l,m){function o(){for(var a=[],b=0;P>b;b++)a[b]=b;k.carouselIndicatorArray=a}function s(){var a=R.children();return H=0===a.length?R[0].getBoundingClientRect().width:a[0].getBoundingClientRect().width,Math.floor(H)}function t(){S.css("width","100%"),S.css("width",s()+"px")}function u(a){isNaN(a)&&(a=k.carouselIndex*H),O=a;var b=-Math.round(O);b+=k.carouselBufferIndex*H,R[0].style[I]=X?"translate3d("+b+"px, 0, 0)":"translate("+b+"px, 0)"}function v(){var a,b;L&&(a=Date.now()-N,b=L*Math.exp(-a/h),b>j||-j>b?(u(M-b),requestAnimationFrame(v)):y(M/H))}function w(a){return a>=P?P:0>=a?0:a}function x(){var a=0,b=(k.carouselBufferSize-1)/2;q&&(a=k.carouselIndex<=b?0:P<k.carouselBufferSize?0:k.carouselIndex>P-k.carouselBufferSize?P-k.carouselBufferSize:k.carouselIndex-b),k.carouselBufferIndex=a}function y(a,b){return isNaN(a)&&(a=k.carouselIndex),b?(O=a*H,E(null,null,!0),void 0):(k.carouselIndex=w(a),x(),"$apply"!==f.$$phase&&"$digest"!==f.$$phase&&(r?k.$apply():k.$digest()),u(),void 0)}function z(){return i*H}function A(a){Q=!0,E({x:a.clientX,y:a.clientY},a)}function B(a){var b=a;return 0===k.carouselIndex?b=Math.max(-z(),b):k.carouselIndex===P-1&&(b=Math.min((P-1)*H+z(),b)),b}function C(a){return c.bind("mouseup",A),J=!0,K=a.x,L=0,N=Date.now(),!1}function D(a){var b,c;return J&&(b=a.x,c=K-b,(c>2||-2>c)&&(Q=!0,K=b,requestAnimationFrame(function(){u(B(O+c))}))),!1}function E(a,b,d){if(!b||Q){c.unbind("mouseup",A),J=!1,Q=!1,M=O;var e=z(),f=k.carouselIndex*H,g=f-M,h=-Math[g>=0?"ceil":"floor"](g/H),i=Math.abs(g)>e;h+k.carouselIndex>=P&&(h=P-1-k.carouselIndex),h+k.carouselIndex<0&&(h=-k.carouselIndex);var j=i?h:0;return M=(j+k.carouselIndex)*H,L=M-O,N=Date.now(),d&&(L=O-f),requestAnimationFrame(v),!1}}function F(){var a,b=document.createElement("p"),c={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};document.body.insertBefore(b,null);for(var d in c)void 0!==b.style[d]&&(b.style[d]="translate3d(1px,1px,1px)",a=window.getComputedStyle(b).getPropertyValue(c[d]));return document.body.removeChild(b),void 0!==a&&a.length>0&&"none"!==a}function G(){t(),y()}g++;var H,I,J,K,L,M,N,O=0,P=0,Q=!1,R=l.wrap("<div id='carousel-"+g+"' class='rn-carousel-container'></div>"),S=R.parent();if((angular.isDefined(m.rnCarouselIndicator)||angular.isDefined(m.rnCarouselControl))&&(o(),k.$watch("carouselIndex",function(a){k.indicatorIndex=a}),k.$watch("indicatorIndex",function(a){y(a,!0)})),angular.isDefined(m.rnCarouselIndicator)){var T=e("<div id='carousel-"+g+"-indicator' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-indicators class='rn-carousel-indicator'></div>")(k);S.append(T)}if(angular.isDefined(m.rnCarouselControl)){var U=e("<div id='carousel-"+g+"-controls' index='indicatorIndex' items='carouselIndicatorArray' rn-carousel-controls class='rn-carousel-controls'></div>")(k);S.append(U)}if(k.carouselBufferIndex=0,k.carouselBufferSize=5,k.carouselIndex=0,m.rnCarouselIndex){var V=function(a){W.assign(k.$parent,a)},W=d(m.rnCarouselIndex);angular.isFunction(W.assign)?(k.$watch("carouselIndex",function(a){V(a)}),k.carouselIndex=W(k),k.$parent.$watch(W,function(a){void 0!==a&&(a>=P?(a=P-1,V(a)):0>a&&(a=0,V(a)),y(a,!0))}),r=!0):isNaN(m.rnCarouselIndex)||(k.carouselIndex=parseInt(m.rnCarouselIndex,10))}p?k.$watchCollection(n,function(a){P=0,angular.isArray(a)?P=a.length:angular.isObject(a)&&(P=Object.keys(a).length),o(),H||t(),y(k.carouselIndex)}):(P=l.children().length,o(),t()),m.$observe("rnCarouselSwipe",function(b){"false"!==b&&"off"!==b?a.bind(R,{start:C,move:D,end:E,cancel:function(a){E({},a)}}):R.unbind()}),r||y(k.carouselIndex),I="transform",["webkit","Moz","O","ms"].every(function(a){var b=a+"Transform";return"undefined"!=typeof document.body.style[b]?(I=b,!1):!0});var X=F(),Y=angular.element(b);Y.bind("orientationchange",G),Y.bind("resize",G),k.$on("$destroy",function(){c.unbind("mouseup",A),Y.unbind("orientationchange",G),Y.unbind("resize",G)})}}}}])}(),function(){"use strict";angular.module("angular-carousel").filter("carouselSlice",function(){return function(a,b,c){return angular.isArray(a)?a.slice(b,b+c):angular.isObject(a)?a:void 0}})}();