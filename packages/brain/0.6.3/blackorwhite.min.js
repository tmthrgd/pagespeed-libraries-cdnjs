$(document).ready(function(){trainer.changeColor();$("#progress-box").hide();$("#testing-box").hide();$("#code-box").hide();$("#wcag-swatch-box").hide();$("#test-box").hide()});var utils={randomColor:function(){return{r:Math.round(Math.random()*255),g:Math.round(Math.random()*255),b:Math.round(Math.random()*255)}},toRgb:function(a){return"rgb("+a.r+","+a.g+","+a.b+")"},normalize:function(a){return{r:a.r/255,g:a.g/255,b:a.b/255}}};var trainer={currentColor:utils.randomColor(),data:[],pickSwatch:function(b){var a={input:utils.normalize(this.currentColor),output:{black:b=="black"?1:0}};this.data.push(a);this.changeColor();if(this.data.length==5){$("#test-box").show()}},changeColor:function(){this.currentColor=utils.randomColor();var a=utils.toRgb(this.currentColor);$(".swatch").css("backgroundColor",a)},trainNetwork:function(){$("#training-box").hide();$("#progress-box").show();if(window.Worker){var b=new Worker("training-worker.js");b.onmessage=this.onMessage;b.onerror=this.onError;b.postMessage(JSON.stringify(this.data))}else{var a=new brain.NeuralNetwork();a.train(this.data,{iterations:9000});tester.show(a)}},onMessage:function(a){var b=JSON.parse(a.data);if(b.type=="progress"){trainer.showProgress(b)}else{if(b.type=="result"){var c=new brain.NeuralNetwork().fromJSON(b.net);tester.show(c)}}},onError:function(a){$("#training-message").text("error training network: "+a.message)},showProgress:function(a){var b=a.iterations/trainer.iterations*100;$("#progress-completed").css("width",b+"%")}};var tester={show:function(a){$("#progress-box").hide();runNetwork=a.toFunction();runNetwork.name="runNetwork";this.testRandom();$("#testing-box").show()},testRandom:function(){this.testColor(utils.randomColor())},testColor:function(a){var b=utils.toRgb(a);$(".swatch").css("backgroundColor",b);var a=utils.normalize(a);$("#nn-swatch").css("color",nnColor(a));$("#wcag-swatch").css("color",wcagColor(a));$("#yiq-swatch").css("color",yiqColor(a))},viewCode:function(a){if(a=="nn"&&!$("#nn-swatch-box").hasClass("selected")){$("#code-header").text("neural network code:");var b="var textColor = "+nnColor.toString()+"\n\nvar runNetwork = "+runNetwork.toString();$("#code").text(b);$(".swatch-box").removeClass("selected");$("#nn-swatch-box").addClass("selected");$("#code-box").show()}else{if(a=="wcag"&&!$("#wcag-swatch-box").hasClass("selected")){$("#code-header").text("luminosity algorithm code:");var b="var textColor = "+wcagColor.toString()+"\n\nvar contrast = "+contrast.toString()+"\n\nvar luminosity = "+luminosity.toString();$("#code").text(b);$(".swatch-box").removeClass("selected");$("#wcag-swatch-box").addClass("selected");$("#code-box").show()}else{if(a=="yiq"&&!$("#yiq-swatch-box").hasClass("selected")){$("#code-header").text("YIQ formula code:");var b="var textColor = "+yiqColor.toString();$("#code").text(b);$(".swatch-box").removeClass("selected");$("#yiq-swatch-box").addClass("selected");$("#code-box").show()}else{$("#code-box").hide();$(".swatch-box").removeClass("selected")}}}}};var nnColor=function(b){var a=runNetwork(b);if(a.black>0.5){return"black"}return"white"};var wcagColor=function(a){if(contrast(a,{r:1,g:1,b:1})>contrast(a,{r:0,g:0,b:0})){return"white"}return"black"};var luminosity=function(d){var f=d.r,e=d.g,c=d.b;var i=(f<=0.03928)?f/12.92:Math.pow(((f+0.055)/1.055),2.4);var h=(e<=0.03928)?e/12.92:Math.pow(((e+0.055)/1.055),2.4);var a=(c<=0.03928)?c/12.92:Math.pow(((c+0.055)/1.055),2.4);return 0.2126*i+0.7152*h+0.0722*a};var contrast=function(b,a){var d=luminosity(b);var c=luminosity(a);if(d>c){return(d+0.05)/(c+0.05)}return(c+0.05)/(d+0.05)};var yiqColor=function(e){var d=e.r*255,c=e.g*255,a=e.b*255;var f=(d*299+c*587+a*114)/1000;return(f>=128)?"black":"white"};