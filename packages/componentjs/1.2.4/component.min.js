!function(GLOBAL,EXPORTS,DEFINE){var _cs=function(){},$cs=function(){return _cs.hook("ComponentJS:lookup","pass",_cs.lookup.apply(GLOBAL,arguments))};$cs.pattern={},$cs.symbol=function(){var a;a=void 0;var b=null;return function(c){return null!==b&&(GLOBAL[b]=a),"undefined"==typeof c||""===c?b=null:(b=c,a=GLOBAL[b],GLOBAL[b]=$cs),$cs}}(),$cs.ns=function(a,b){if("string"!=typeof a||""===a)throw"invalid namespace path";var c=a.split("."),d=c.length;"undefined"!=typeof b&&d--;for(var e=0,f=GLOBAL;d>e;)"undefined"==typeof f[c[e]]&&(f[c[e]]={}),f=f[c[e++]];return"undefined"!=typeof b&&(f[c[e]]=b,f=b),f},$cs.version={major:1,minor:2,micro:4,date:20150221},_cs.exception=function(a,b){var c;return $cs.debug()>0&&"object"==typeof GLOBAL.console&&("function"==typeof GLOBAL.console.trace?GLOBAL.console.trace():"undefined"!=typeof GLOBAL.printStackTrace&&"function"==typeof GLOBAL.console.log&&(c=GLOBAL.printStackTrace(),GLOBAL.console.log(c.join("\n")))),new Error("[ComponentJS]: ERROR: "+a+": "+b)},_cs.log=function(a){_cs.hook("ComponentJS:log","or",a)||("undefined"!=typeof GLOBAL.console&&"undefined"!=typeof GLOBAL.console.log?GLOBAL.console.log("[ComponentJS]: "+a):"undefined"!=typeof GLOBAL.Titanium&&"undefined"!=typeof GLOBAL.Titanium.API&&"function"==typeof GLOBAL.Titanium.API.log&&GLOBAL.Titanium.API.log("[ComponentJS]: "+a))},$cs.debug=function(){var a=0;return function(b,c){if(0===arguments.length)return a;if(1===arguments.length)a=b;else if(a>=b){for(var d="",e=1;b>e;e++)d+="    ";_cs.log("DEBUG["+b+"]: "+d+c)}}}(),_cs.nop=function(){},_cs.annotation=function(a,b,c){var d=null,e="__ComponentJS_"+b+"__";return"undefined"!=typeof a&&null!==a&&("undefined"!=typeof a[e]&&(d=a[e]),"undefined"!=typeof c&&(null!==c?a[e]=c:delete a[e])),d},_cs.isdefined=function(a){return"undefined"!=typeof a},_cs.isown=function(a,b){var c=Object.hasOwnProperty.call(a,b);return("constructor"===b||"prototype"===b)&&(c=c&&Object.propertyIsEnumerable.call(a,b),-1!==a[b].toString().indexOf("[native code]")&&(c=!1)),c},_cs.istypeof=function(a){var b=typeof a;return"object"===b?null===a?b="null":"[object String]"===Object.prototype.toString.call(a)?b="string":"[object Number]"===Object.prototype.toString.call(a)?b="number":"[object Boolean]"===Object.prototype.toString.call(a)?b="boolean":"[object Function]"===Object.prototype.toString.call(a)?b="function":"[object Array]"===Object.prototype.toString.call(a)?b="array":null!==_cs.annotation(a,"type")&&(b=_cs.annotation(a,"type")):"function"===b&&null!==_cs.annotation(a,"type")&&(b=_cs.annotation(a,"type")),b},_cs.keysof=function(a){var b=[];for(var c in a)_cs.isown(a,c)&&b.push(c);return b},_cs.json=function(){var a=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,b={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},c=function(c){return a.lastIndex=0,a.test(c)?'"'+c.replace(a,function(a){var c=b[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+c+'"'},d=function(a,b){if("boolean"!=typeof a&&"number"!=typeof a&&"string"!=typeof a){if("undefined"!=typeof b[a])return"null /* CYCLE! */";b[a]=!0}switch(typeof a){case"boolean":a=String(a);break;case"number":a=isFinite(a)?String(a):"NaN";break;case"string":a=c(a);break;case"function":a=null!==_cs.annotation(a,"type")?"<"+_cs.annotation(a,"type")+">":"<function>";break;case"object":var d=[];if(null===a)a="null";else if(null!==_cs.annotation(a,"type"))a="<"+_cs.annotation(a,"type")+">";else if("[object Function]"===Object.prototype.toString.call(a))a="<function>";else if("[object Array]"===Object.prototype.toString.call(a)||a instanceof Array){for(var e=0;e<a.length;e++)d[e]=arguments.callee(a[e],b);a=0===d.length?"[]":"["+d.join(",")+"]"}else{for(var f in a)if(Object.hasOwnProperty.call(a,f)){var g=arguments.callee(a[f],b);d.push(c(f)+":"+g)}a=0===d.length?"{}":"{"+d.join(",")+"}"}break;default:a="<unknown>"}return a};return function(a){return d(a,{})}}(),_cs.clone=function(a,b){if("undefined"==typeof b)b=function(){return!0};else if("string"==typeof b){var c=b;b=function(a){return a.match(c)}}var d,e=arguments.callee,f=function(a,b){var c=function(){return a.apply(this,arguments)};c.prototype=a.prototype;for(var d in a)_cs.isown(a,d)&&(c[d]=b(d,a)?e(a[d],b):a[d]);return _cs.annotation(c,"clone",!0),c};if(d=void 0,"function"==typeof a)d=f(a,b);else if("object"==typeof a)if(null===a)d=null;else if("[object String]"===Object.prototype.toString.call(a))d=""+a.valueOf();else if("[object Number]"===Object.prototype.toString.call(a))d=0+a.valueOf();else if("[object Boolean]"===Object.prototype.toString.call(a))d=!!a.valueOf();else if("[object Function]"===Object.prototype.toString.call(a))d=f(a,b);else if("[object Date]"===Object.prototype.toString.call(a))d=new Date(a.getTime());else if("[object RegExp]"===Object.prototype.toString.call(a))d=new RegExp(a.source);else if("[object Array]"===Object.prototype.toString.call(a)){var g=a.length;d=[];for(var h=0;g>h;h++)d.push(e(a[h],b))}else{d={};for(var i in a)"constructor"!==i&&_cs.isown(a,i)&&(d[i]=b(i,a)?e(a[i],b):a[i]);"function"==typeof a.constructor&&(d.constructor=a.constructor),"object"==typeof a.prototype&&(d.prototype=a.prototype)}else d=a;return d},_cs.extend=function(a,b,c){if("undefined"==typeof c)c=function(){return!0};else if("string"==typeof c){var d=c;c=function(a){return a.match(d)}}for(var e in b)_cs.isown(b,e)&&c(e,b[e])&&(a[e]=b[e]);return a},_cs.mixin=function(a,b,c){if("undefined"==typeof c)c=function(){return!0};else if("string"==typeof c){var d=c;c=function(a){return a.match(d)}}for(var e in b)if(_cs.isown(b,e)&&c(e,b[e]))if("function"===_cs.istypeof(b[e])){var f=_cs.clone(b[e],c);_cs.annotation(f,"name",e),"function"===_cs.istypeof(a[e])&&_cs.isown(a,e)&&_cs.annotation(f,"base",a[e]),a[e]=f}else a[e]=b[e];return a},_cs.concat=function(){for(var a=[],b=0;b<arguments.length;b++)for(var c=arguments[b],d=0;d<c.length;d++)a.push(c[d]);return a},_cs.slice=function(a,b,c){var d=[];"undefined"==typeof c&&(c=a.length);for(var e=b;c>e;e++)d.push(a[e]);return d},_cs.map=function(a,b){for(var c=[],d=0;d<a.length;d++)c.push(b(a[d],d));return c},_cs.filter=function(a,b){for(var c=[],d=0;d<a.length;d++)b(a[d],d)&&c.push(a[d]);return c},_cs.foreach=function(a,b){for(var c=0;c<a.length;c++)b(a[c],c)},_cs.token=function(){this.name="",this.text="",this.tokens=[],this.pos=0,this.len=0},_cs.token.prototype={setName:function(a){this.name=a},setText:function(a){this.text=a},addToken:function(a,b,c,d,e){this.tokens.push({b1:a,b2:b,e2:c,e1:d,symbol:e}),this.len++},peek:function(a){if("undefined"==typeof a&&(a=0),a>=this.len)throw _cs.exception(this.name,"parse error: not enough tokens");return this.tokens[this.pos+a].symbol},skip:function(a){if("undefined"==typeof a&&(a=1),a>this.len)throw _cs.exception(this.name,"parse error: not enough tokens available to skip: "+this.ctx());this.pos+=a,this.len-=a},consume:function(a){if(this.len<=0)throw _cs.exception(this.name,"parse error: no more tokens available to consume: "+this.ctx());if(this.tokens[this.pos].symbol!==a)throw _cs.exception(this.name,'parse error: expected token symbol "'+a+'": '+this.ctx());this.pos++,this.len--},ctx:function(a){"undefined"==typeof a&&(a=78);var b=this.tokens[this.pos],c="<"+this.text.substr(b.b2,b.e2-b.b2+1)+">";c=this.text.substr(b.b1,b.b2-b.b1)+c,c+=this.text.substr(b.e2+1,b.e1-b.e2);var d=a-c.length;if(d>0){d=Math.floor(d/2);var e,f;if(this.pos>0){var g=0;for(e=this.pos-1;e>=0&&(b=this.tokens[e],f=this.text.substr(b.b1,b.e1-b.b1+1),g+=f.length,!(g>d));e--)c=f+c;e>0&&(c="[...]"+c)}if(this.len>1){var h=0;for(e=this.pos+1;e<this.pos+this.len&&(b=this.tokens[e],f=this.text.substr(b.b1,b.e1-b.b1+1),h+=f.length,!(h>d));e++)c+=f;e<this.pos+this.len&&(c+="[...]")}}return c=c.replace(/\r/,"\\r").replace(/\n/,"\\n").replace(/\t/,"\\t")}},$cs.validate=function(a,b){if("object"==typeof b&&b instanceof RegExp)return b.test(a.toString());if("function"==typeof b)return b(a);if("string"==typeof b)return _cs.validate_at(a,b);throw _cs.exception("validate",'invalid specification argument: "'+b+'"')},_cs.validate_at=function(a,b,c){var d=_cs.validate_cache[b];if("undefined"==typeof d&&(d=_cs.validate_compile(b),_cs.validate_cache[b]=d),"undefined"!=typeof c){var e="string"==typeof c?_cs.select_parse(c):c;d=_cs.validate_subset(d,e)}return _cs.validate_executor.exec_spec(a,d)},_cs.validate_cache={},_cs.validate_compile=function(a){var b=_cs.validate_tokenize(a);return _cs.validate_parser.parse_spec(b)},_cs.validate_tokenize=function(a){var b=new _cs.token;b.setName("validate"),b.setText(a);for(var c,d=0;""!==a;){if(c=a.match(/^(\s*)([^{}\[\]:,?*+()!|\s]+|[{}\[\]:,?*+()!|])(\s*)/),null===c)throw _cs.exception("validate",'parse error: cannot further canonicalize: "'+a+'"');b.addToken(d,d+c[1].length,d+c[1].length+c[2].length-1,d+c[0].length-1,c[2]),a=a.substr(c[0].length),d+=c[0].length}return b},_cs.validate_parser={parse_spec:function(a){if(a.len<=0)return null;var b,c=a.peek();if("!"===c)b=this.parse_not(a);else if("("===c)b=this.parse_group(a);else if("{"===c)b=this.parse_hash(a);else if("["===c)b=this.parse_array(a);else if(c.match(/^(?:null|undefined|boolean|number|string|function|object)$/))b=this.parse_primary(a);else if(c.match(/^(?:clazz|trait|component)$/))b=this.parse_special(a);else if("any"===c)b=this.parse_any(a);else{if(!c.match(/^[A-Z][_a-zA-Z$0-9]*$/))throw _cs.exception("validate",'parse error: invalid token symbol: "'+a.ctx()+'"');b=this.parse_class(a)}return b},parse_not:function(a){a.consume("!");var b=this.parse_spec(a);return b={type:"not",op:b}},parse_group:function(a){a.consume("(");for(var b=this.parse_spec(a);"|"===a.peek();){a.consume("|");var c=this.parse_spec(a);b={type:"or",op1:b,op2:c}}return a.consume(")"),b},parse_hash:function(a){a.consume("{");for(var b=[];"}"!==a.peek();){var c=this.parse_key(a),d=this.parse_arity(a,"?");a.consume(":");var e=this.parse_spec(a);if(b.push({type:"element",key:c,arity:d,element:e}),","!==a.peek())break;a.skip()}var f={type:"hash",elements:b};return a.consume("}"),f},parse_array:function(a){a.consume("[");for(var b=[];"]"!==a.peek();){var c=this.parse_spec(a),d=this.parse_arity(a,"?*+");if(b.push({type:"element",element:c,arity:d}),","!==a.peek())break;a.skip()}var e={type:"array",elements:b};return a.consume("]"),e},parse_primary:function(a){var b=a.peek();if(!b.match(/^(?:null|undefined|boolean|number|string|function|object)$/))throw _cs.exception("validate",'parse error: invalid primary type "'+b+'"');return a.skip(),{type:"primary",name:b}},parse_special:function(a){var b=a.peek();if(!b.match(/^(?:clazz|trait|component)$/))throw _cs.exception("validate",'parse error: invalid special type "'+b+'"');return a.skip(),{type:"special",name:b}},parse_any:function(a){var b=a.peek();if("any"!==b)throw _cs.exception("validate",'parse error: invalid any type "'+b+'"');return a.skip(),{type:"any"}},parse_class:function(a){var b=a.peek();if(!b.match(/^[A-Z][_a-zA-Z$0-9]*$/))throw _cs.exception("validate",'parse error: invalid class type "'+b+'"');return a.skip(),{type:"class",name:b}},parse_arity:function(a,b){var c=[1,1];if(a.len>=5&&"{"===a.peek(0)&&a.peek(1).match(/^[0-9]+$/)&&","===a.peek(2)&&a.peek(3).match(/^(?:[0-9]+|oo)$/)&&"}"===a.peek(4))c=[parseInt(a.peek(1),10),"oo"===a.peek(3)?Number.MAX_VALUE:parseInt(a.peek(3),10)],a.skip(5);else if(a.len>=1&&1===a.peek().length&&b.indexOf(a.peek())>=0){var d=a.peek();switch(d){case"?":c=[0,1];break;case"*":c=[0,Number.MAX_VALUE];break;case"+":c=[1,Number.MAX_VALUE]}a.skip()}return c},parse_key:function(a){var b=a.peek();if(!b.match(/^(?:[_a-zA-Z$][_a-zA-Z$0-9]*|@)$/))throw _cs.exception("validate",'parse error: invalid key "'+b+'"');return a.skip(),b}},_cs.validate_subset=function(a,b){var c,d,e,f;for(c=0,d=b.length;d>c;c++)if("hash"===a.type){var g=!1;for(e=0,f=a.elements.length;f>e;e++){if(a.elements[e].key===b[c]){a=a.elements[e].element,g=!0;break}"@"===a.elements[e].key&&(a=a.elements[e].element,g=!0)}if(!g)throw _cs.exception("validate",'dereference error: hash key "'+b[c]+'" not found')}else{if("array"!==a.type)throw _cs.exception("validate",'dereference error: no more hash or array to be dereferenced by "'+b[c]+'"');if(e=parseInt(b[c],10),e>=a.elements.length)throw _cs.exception("validate","dereference error: array index #"+e+' ("'+b[c]+'") not found');a=a.elements[e].element}return a},_cs.validate_executor={exec_spec:function(a,b){var c=!1;if(null!==b)switch(b.type){case"not":c=this.exec_not(a,b);break;case"or":c=this.exec_or(a,b);break;case"hash":c=this.exec_hash(a,b);break;case"array":c=this.exec_array(a,b);break;case"primary":c=this.exec_primary(a,b);break;case"special":c=this.exec_special(a,b);break;case"class":c=this.exec_class(a,b);break;case"any":c=!0;break;default:throw _cs.exception("validate",'invalid validation AST: node has unknown type "'+b.type+'"')}return c},exec_not:function(a,b){return!this.exec_spec(a,b.op)},exec_or:function(a,b){return this.exec_spec(a,b.op1)||this.exec_spec(a,b.op2)},exec_hash:function(a,b){var c,d,e="object"==typeof a,f={};if(e)for(c=0;c<b.elements.length;c++)if(d=b.elements[c],f[d.key]=d.element,d.arity[0]>0&&("@"===d.key&&0===_cs.keysof(a).length||"@"!==d.key&&"undefined"==typeof a[d.key])){e=!1;break}if(e)for(var g in a)if(Object.hasOwnProperty.call(a,g)&&Object.propertyIsEnumerable.call(a,g)&&"constructor"!==g&&"prototype"!==g&&!("undefined"!=typeof f[g]&&this.exec_spec(a[g],f[g])||"undefined"!=typeof f["@"]&&this.exec_spec(a[g],f["@"]))){e=!1;break}return e},exec_array:function(a,b){var c,d,e="object"==typeof a&&a instanceof Array;if(e){var f=0;for(c=0;c<b.elements.length;c++){d=b.elements[c];for(var g=0;g<d.arity[1]&&f<a.length&&this.exec_spec(a[f],d.element);)g++,f++;if(g<d.arity[0]){e=!1;break}}f<a.length&&(e=!1)}return e},exec_primary:function(a,b){return"null"===b.name&&null===a||typeof a===b.name},exec_class:function(value,node){return"object"==typeof value&&Object.prototype.toString.call(value)==="[object "+node.name+"]"||eval("value instanceof "+node.name)},exec_special:function(a,b){var c=!1;return typeof a==("component"===b.name?"object":"function")&&(c=_cs.annotation(a,"type")===b.name),c}},$cs.params=function(a,b,c){_cs.hook("ComponentJS:params:"+a+":enter","none",{args:b,spec:c});var d,e={},f=0,g=0,h={};for(d in c)if(_cs.isown(c,d)&&("undefined"!=typeof c[d].pos&&(h[c[d].pos]=d,"number"==typeof c[d].pos&&f++,"undefined"!=typeof c[d].req&&c[d].req&&g++),"undefined"!=typeof c[d].def)){if("undefined"!=typeof c[d].valid&&!$cs.validate(c[d].def,c[d].valid))throw _cs.exception(a,'parameter "'+d+'" has default value '+_cs.json(c[d].def)+', which does not validate against validation specification "'+c[d].valid+'"');e[d]=c[d].def}var i=!1;if(1===b.length&&"object"===_cs.istypeof(b[0])){i=!0;for(d in b[0])_cs.isown(b[0],d)&&"undefined"==typeof c[d]&&(i=!1)}var j,k,l=function(a,b,c,d){if("undefined"!=typeof d&&!$cs.validate(c,d))throw _cs.exception(a,'parameter "'+b+'" has value '+_cs.json(c)+', which does not validate against "'+d+'"')};if(i){k=b[0];for(d in k)if(_cs.isown(k,d)){if("undefined"==typeof c[d])throw _cs.exception(a,'unknown parameter "'+d+'"');l(a,d,k[d],c[d].valid),e[d]=k[d]}for(d in c)if(_cs.isown(c,d)&&"undefined"!=typeof c[d].req&&c[d].req&&"undefined"==typeof k[d])throw _cs.exception(a,'required parameter "'+d+'" missing')}else{if(b.length<g)throw _cs.exception(a,"invalid number of arguments (at least "+g+" required)");for(j=0;f>j&&j<b.length;j++)l(a,h[j],b[j],c[h[j]].valid),e[h[j]]=b[j];if(j<b.length){if("undefined"==typeof h["..."])throw _cs.exception(a,"too many arguments provided");for(k=[];j<b.length;j++)k.push(b[j]);l(a,h["..."],k,c[h["..."]].valid),e[h["..."]]=k}}return _cs.hook("ComponentJS:params:"+a+":leave","none",{args:b,spec:c,params:e}),e},_cs.base16_number=function(a,b,c){var d="";"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=!1);for(var e=c?"0123456789ABCDEF":"0123456789abcdef";a>0||b>0;)d=e.charAt(Math.floor(a%16))+d,a=Math.floor(a/16),b>0&&b--;return d},_cs.cid=function(){var a=[0,0,0,0],b=4294967296;return function(){a[3]++;for(var c=0,d=3;d>=0;d--)c+=a[d],a[d]=Math.floor(c%b),c=Math.floor(c/b);return _cs.base16_number(a[0],8,!0)+_cs.base16_number(a[1],8,!0)+_cs.base16_number(a[2],8,!0)+_cs.base16_number(a[3],8,!0)}}(),_cs.proxy=function(a,b,c){"string"===_cs.istypeof(b)&&"object"===_cs.istypeof(a)&&"function"===_cs.istypeof(a[b])&&(b=a[b]),_cs.isdefined(c)||(c=!1);var d=function(){var e=function(){return"object"===_cs.istypeof(arguments.callee.__ctx__)&&(arguments.callee.__ctx__.__this__=this),b.apply(arguments.callee.__ctx__,arguments)};return e.__ctx__=c?_cs.clone(_cs.isdefined(this.__ctx__)?this.__ctx__:a):a,c&&(e.clone=d),e.guid=b.guid=b.guid||e.guid||_cs.cid(),e};return d.call({})},_cs.memoize=function(a){var b=function(){var b,c=_cs.json(_cs.slice(arguments,0));return b=void 0,"undefined"!=typeof arguments.callee.cache[c]?b=arguments.callee.cache[c]:(b=a.apply(this,arguments),arguments.callee.cache[c]=b),b};return b.cache={},b},_cs.curry=function(a){var b=_cs.slice(arguments,1);return function(){var c=_cs.slice(arguments,0),d=_cs.concat(b,c);return a.apply(this,d)}},$cs.attribute=function(){var a=$cs.params("attribute",arguments,{name:{pos:0,req:!0,valid:"string"},def:{pos:1,req:!0,valid:"any"},valid:{pos:2,def:void 0,valid:"(function|RegExp|string)"}});return _cs.proxy({value:a.def},function(b){var c=this.value;if(arguments.length>0){if("undefined"!=typeof a.valid&&!$cs.validate(b,a.valid))throw _cs.exception("attribute",'invalid value "'+b+'" for attribute "'+a.name+'"');this.value=b;var d=this.__this__;"undefined"!=typeof d&&"function"==typeof d.notify&&d.notify.call(d,"attribute:set:"+a.name,b,c,a.name)}return c},!0)},_cs.hooks={},_cs.hook_proc={none:{init:void 0,step:function(){}},pass:{init:function(a){return a[0]},step:function(a,b){return b}},or:{init:!1,step:function(a,b){return a||b}},and:{init:!0,step:function(a,b){return a&&b}},mult:{init:1,step:function(a,b){return a*b}},add:{init:0,step:function(a,b){return a+b}},append:{init:"",step:function(a,b){return a+b}},push:{init:[],step:function(a,b){return a.push(b),a}},concat:{init:[],step:function(a,b){return _cs.concat(a,b)}},insert:{init:{},step:function(a,b){return a[b]=!0,a}},extend:{init:{},step:function(a,b){return _cs.extend(a,b)}}},_cs.latch=function(a,b){if(arguments.length<2)throw _cs.exception("latch(internal)","missing arguments");"undefined"==typeof _cs.hooks[a]&&(_cs.hooks[a]=[]);var c=_cs.slice(arguments,2),d=_cs.cid();return _cs.hooks[a].push({id:d,cb:b,args:c}),d},_cs.unlatch=function(a,b){if(2!==arguments.length)throw _cs.exception("unlatch(internal)","invalid number of arguments");if("undefined"==typeof _cs.hooks[a])throw _cs.exception("unlatch(internal)","no such hook");for(var c=-1,d=0;d<_cs.hooks[a].length;d++)if(_cs.hooks[a][d].id===b){c=d;break}if(-1===c)throw _cs.exception("unlatch(internal)","no such latched callback");_cs.hooks[a]=_cs.hooks[a].splice(c,1)},_cs.hook=function(a,b){if(arguments.length<2)throw _cs.exception("hook(internal)","missing argument");if("undefined"==typeof _cs.hook_proc[b])throw _cs.exception("hook(internal)","no such result processing defined");var c=_cs.hook_proc[b].init,d=null;return"function"==typeof c&&(d=_cs.slice(arguments,2),c=c.call(null,d)),"undefined"!=typeof _cs.hooks[a]&&(null===d&&(d=_cs.slice(arguments,2)),_cs.foreach(_cs.hooks[a],function(e){var f=e.cb.apply({args:e.args,result:c,hooks:_cs.hooks[a].length,_cs:_cs,$cs:$cs},d);c=_cs.hook_proc[b].step.call(null,c,f)})),c},$cs.select=function(a,b,c){var d="string"==typeof b?_cs.select_parse(b):b;return 2===arguments.length?_cs.select_path(a,d):_cs.select_path(a,d,c)},_cs.select_cache={},_cs.select_parse=function(a){var b=_cs.select_cache[a];if("undefined"==typeof b){b=[];for(var c,d=0,e=a;""!==e;){if(null!==(c=e.match(/^\s*(?:\.)?\s*([a-zA-Z$0-9_][a-zA-Z$0-9_:-]*)/)))b.push(c[1]);else if(null!==(c=e.match(/^\s*\[\s*(\d+|\*{1,2})\s*\]/)))b.push(c[1]);else if(null!==(c=e.match(/^\s*\[\s*"((?:\\"|.)*?)"\s*\]/)))b.push(c[1].replace(/\\"/g,'"'));else{if(null===(c=e.match(/^\s*\[\s*'((?:\\'|.)*?)'\s*\]/))){if(null!==(c=e.match(/^\s+$/)))break;throw _cs.exception("select","parse error: invalid character at: "+a.substr(0,d)+"<"+e.substr(0,1)+">"+e.substr(1))}b.push(c[1].replace(/\\'/g,"'"))}d+=c[0].length,e=e.substr(c[0].length)}_cs.select_cache[a]=b}return b},_cs.select_path=function(a,b){if(0===b.length){if(3===arguments.length)throw _cs.exception("select","cannot set value on empty path");return a}for(var c=0;c<b.length-1;){if("object"!=typeof a)throw _cs.exception("select","cannot further dereference: no more intermediate objects in path");a=a[b[c++]]}if("object"!=typeof a)throw _cs.exception("select","cannot further dereference: no object at end of path");var d=a[b[c]];if(3===arguments.length){var e=arguments[2];void 0===e?a instanceof Array?a.splice(parseInt(b[c],10),1):delete a[b[c]]:a[b[c]]=e}return d},_cs.clazz_or_trait=function(a,b){var c=function(){var a=this,b=arguments.callee,c=arguments;if(!(a instanceof b))return new b;var d=function(a,b,c,d){var e=_cs.annotation(b,"extend");null!==e&&arguments.callee(a,e,c,!1);var f=_cs.annotation(b,"mixin");if(null!==f)for(var g=0;g<f.length;g++)arguments.callee(a,f[g],c,!0);var h=_cs.annotation(b,"dynamics");if(null!==h)for(var i in h)_cs.isown(h,i)&&(a[i]="null"!==_cs.istypeof(h[i])&&"function"===_cs.istypeof(h[i].clone)?h[i].clone():_cs.clone(h[i]));if(d){var j=_cs.annotation(b,"cons");null!==j&&("clazz"===_cs.istypeof(b)?j.apply(a,c):j.call(a))}};return d(a,b,c,!0),a},d=function(a){return!a.match("^(?:base|__ComponentJS_[A-Za-z]+__)$")};if(_cs.isdefined(a.extend)){_cs.extend(c,a.extend,d);var e=function(){this.constructor=c};e.prototype=a.extend.prototype,c.prototype=new e,_cs.annotation(c,"extend",a.extend)}if(_cs.isdefined(a.statics)&&_cs.extend(c,a.statics),_cs.isdefined(a.protos)&&_cs.mixin(c.prototype,a.protos),_cs.isdefined(a.mixin)){for(var f=0;f<a.mixin.length;f++){_cs.extend(c,a.mixin[f],d);for(var g in a.mixin[f].prototype)if(_cs.isown(a.mixin[f].prototype,g)&&("function"!==_cs.istypeof(c.prototype[g])||!_cs.isown(c.prototype,g))){var h=_cs.nop;_cs.isdefined(a.extend)&&"function"===_cs.istypeof(a.extend[g])&&(h=function(){this.base()},_cs.annotation(h,"name",g)),c.prototype[g]=h}_cs.mixin(c.prototype,a.mixin[f].prototype,d)}_cs.annotation(c,"mixin",a.mixin)}var i=_cs.nop;_cs.isdefined(a.cons)?i=a.cons:_cs.isdefined(a.extend)&&(i=function(){this.base()}),_cs.annotation(c,"cons",i),_cs.annotation(i,"name","cons"),_cs.isdefined(a.extend)&&_cs.annotation(i,"base",_cs.annotation(a.extend,"cons")),_cs.isdefined(a.setup)&&_cs.annotation(c,"setup",a.setup),_cs.isdefined(a.dynamics)&&_cs.annotation(c,"dynamics",a.dynamics);var j=function(a,b){for(var c=_cs.annotation(a,b);null===c&&_cs.annotation(a.caller,"clone")===!0;)c=_cs.annotation(a.caller,b),a=a.caller;return c},k=function(a,b,c){var d=_cs.annotation(b,"extend");if(null===d)return null;var e=!1;if("function"===_cs.istypeof(b.prototype[a])&&_cs.isown(b.prototype,a))for(var f=b.prototype[a];"function"===_cs.istypeof(f);){if(f===c){e=!0;break}f=j(f,"base")}return e?d:k(a,d,c)},l=function(a){if(null===_cs.annotation(a,"clone"))for(;_cs.annotation(a.caller,"clone")===!0;)a=a.caller;return a};if(c.prototype.base=function(){var a=j(arguments.callee.caller,"name"),b=j(arguments.callee.caller,"base"),c=k(a,this.constructor,l(arguments.callee.caller));if("function"===_cs.istypeof(b))return b.apply(this,arguments);if("string"===_cs.istypeof(a)&&"clazz"===_cs.istypeof(c)&&"function"===_cs.istypeof(c[a]))return c[a].apply(this,arguments);if("string"===_cs.istypeof(a)&&"clazz"===_cs.istypeof(c)&&"object"===_cs.istypeof(c.prototype)&&"function"===_cs.istypeof(c.prototype[a]))return c.prototype[a].apply(this,arguments);throw _cs.exception("base",'no base method found for method "'+a+'" in inheritance/mixin chain')},b){var m=function(a,b){if("array"===_cs.istypeof(_cs.annotation(b,"mixin")))for(var c=_cs.annotation(b,"mixin"),d=0;d<c.length;d++)arguments.callee(a,c[d]);"function"===_cs.istypeof(_cs.annotation(b,"setup"))&&_cs.annotation(b,"setup").call(a)};m(c,c)}return"string"==typeof a.name&&$cs.ns(a.name,c),c},$cs.clazz=function(){var a=$cs.params("clazz",arguments,{name:{def:void 0,valid:"string"},extend:{def:void 0,valid:"clazz"},mixin:{def:void 0,valid:"[ trait* ]"},cons:{def:void 0,valid:"function"},statics:{def:void 0,valid:"object"},dynamics:{def:void 0,valid:"object"},protos:{def:void 0,valid:"{ @?: function }"}}),b=_cs.clazz_or_trait(a,!0);return _cs.annotation(b,"type","clazz"),b},$cs.trait=function(){var a=$cs.params("trait",arguments,{name:{def:void 0,valid:"string"},mixin:{def:void 0,valid:"[ trait* ]"},cons:{def:void 0,valid:"function"},setup:{def:void 0,valid:"function"},statics:{def:void 0,valid:"object"},dynamics:{def:void 0,valid:"object"},protos:{def:void 0,valid:"{ @?: function }"}}),b=_cs.clazz_or_trait(a,!1);return _cs.annotation(b,"type","trait"),b},$cs.pattern.id=$cs.trait({dynamics:{id:$cs.attribute("id",null)}}),$cs.pattern.name=$cs.trait({dynamics:{name:$cs.attribute("name","")}}),$cs.pattern.tree=$cs.trait({mixin:[$cs.pattern.name],dynamics:{parent:$cs.attribute("parent",null),children:$cs.attribute("children",[])},protos:{path:function(a){var b,c;if("undefined"==typeof a)for(b=[],c=this;null!==c;c=c.parent())b.push(c);else if(b="",null===this.parent())b=a;else for(c=this;null!==c.parent();c=c.parent())b=a+c.name()+b;return b},attach:function(a){null!==this.parent()&&this.detach();var b=a.children();b.push(this),a.children(b),this.parent(a)},detach:function(){if(null!==this.parent()){var a=this;this.parent().children(_cs.filter(this.parent().children(),function(b){return b!==a})),this.parent(null)}},walk_up:function(a,b){var c,d;for(c=0,d=this;null!==d;d=d.parent(),c++)b=a(c,d,b);return b},walk_down:function(a,b){var c=function(b,d,e){"function"==typeof a&&(e=a(b,d,e,!1));for(var f=d.children(),g=0;g<f.length;g++)e=c(b+1,f[g],e);return"function"==typeof a&&(e=a(b,d,e,!0)),e};return b=c(0,this,b)},_tree_dump:function(a){return this.walk_down(function(b,c,d,e){if(!e){for(var f=0;b>f;f++)d+="    ";d+='"'+c.name()+'"',"function"==typeof a&&(d+=": "+a(c)),d+="\n"}return d},"")}}}),$cs.pattern.config=$cs.trait({dynamics:{__config:{}},protos:{cfg:function(a,b){var c;if(0===arguments.length){c=[];for(var d in this.__config)_cs.isown(this.__config,d)&&c.push(d)}else if(1===arguments.length&&"string"==typeof a)c=this.__config[a];else if(2===arguments.length&&null!==b)c=this.__config[a],this.__config[a]=b;else{if(2!==arguments.length)throw _cs.exception("cfg","invalid arguments");c=this.__config[a],delete this.__config[a]}return c}}}),$cs.pattern.spool=$cs.trait({dynamics:{__spool:{}},protos:{spool:function(){var a=$cs.params("spool",arguments,{name:{pos:0,req:!0},ctx:{pos:1,req:!0},func:{pos:2,req:!0},args:{pos:"...",def:[]}});if(!_cs.istypeof(a.func).match(/^(string|function)$/))throw _cs.exception("spool","invalid function parameter (neither function object nor method name)");if("string"===_cs.istypeof(a.func)){if("function"!==_cs.istypeof(a.ctx[a.func]))throw _cs.exception("spool",'invalid method name: "'+a.func+'"');a.func=a.ctx[a.func]}_cs.isdefined(this.__spool[a.name])||(this.__spool[a.name]=[]),this.__spool[a.name].push(a)},spooled:function(){var a=$cs.params("spooled",arguments,{name:{pos:0,req:!0}});return _cs.isdefined(this.__spool[a.name])?this.__spool[a.name].length:0},unspool:function(){var a=$cs.params("unspool",arguments,{name:{pos:0,req:!0}}),b=this.__spool[a.name];if(!_cs.isdefined(b))throw _cs.exception("unspool",'no such spool: "'+a.name+'"');for(var c=b.length-1;c>=0;c--)b[c].func.apply(b[c].ctx,b[c].args);delete this.__spool[a.name]}}}),_cs.spool_spec_parse=function(a,b){var c={};c.comp=a,c.name=b;var d=c.name.match(/^([^:]+):(.+)$/);return null!==d&&(c.comp=$cs(a,d[1]),c.name=d[2]),c},$cs.pattern.property=$cs.trait({mixin:[$cs.pattern.tree,$cs.pattern.config],protos:{property:function(){var a=$cs.params("property",arguments,{name:{pos:0,req:!0},value:{pos:1,def:void 0},def:{def:void 0},scope:{def:void 0},bubbling:{def:!0},targeting:{def:!0},returnowner:{def:!1}});if(!a.targeting&&!a.bubbling)throw _cs.exception("property","disabling both targeting and bubbling makes no sense");var b;b=a.def;for(var c,d=[],e=this;null!==e;d.unshift(e.name()),e=e.parent())if(0!==d.length||a.targeting){if(d.length>0){for(var f=d.length-1;f>=0;f--){var g=d.slice(0,f+1).join("/");if(c=e.cfg("ComponentJS:property:"+a.name+"@"+g),"undefined"!=typeof c)break}if("undefined"!=typeof c){b=a.returnowner?e:c;break}}if(c=e.cfg("ComponentJS:property:"+a.name),"undefined"!=typeof c){b=a.returnowner?e:c;break}if(!a.bubbling)break}return"undefined"!=typeof a.value&&("undefined"!=typeof a.scope?this.cfg("ComponentJS:property:"+a.name+"@"+a.scope,a.value):this.cfg("ComponentJS:property:"+a.name,a.value)),b}}}),$cs.pattern.spec=$cs.trait({mixin:[$cs.pattern.name],dynamics:{__spec:{}},protos:{spec:function(){var a=this.__spec;if(0===arguments.length)return a;if(1===arguments.length&&"string"==typeof arguments[0])return a[arguments[0]];for(var b=0;b<arguments.length;b++)if("string"==typeof arguments[b])a[arguments[b]]=arguments[b+1],b++;else if("object"==typeof arguments[b])for(var c in arguments[b])_cs.isown(arguments[b],c)&&(a[c]=arguments[b][c]);return void 0},matches:function(a,b){if("string"==typeof a){if(this.name()!==a)return!1}else{if(!("object"==typeof a&&a instanceof RegExp))throw _cs.exception("matches","invalid name pattern");if(!this.name().match(a))return!1}var c=this.__spec;for(var d in b)if(_cs.isown(b,d)){if(!_cs.isdefined(c[d]))return!1;var e=b[d];switch(typeof c[d]){case"number":case"boolean":if(c[d]!==e)return!1;break;case"string":if(!("string"==typeof e&&c[d]===e||"object"==typeof e&&e instanceof RegExp&&!c[d].match(e)))return!1}}return!0}}}),$cs.pattern.observable=$cs.trait({dynamics:{__listener:{}},protos:{listen:function(){var a=$cs.params("listen",arguments,{name:{pos:0,req:!0},ctx:{def:this},func:{pos:1,req:!0},args:{pos:"...",def:[]},spec:{def:null}}),b=_cs.cid();return this.__listener[b]=a,b},listening:function(){var a=$cs.params("listening",arguments,{id:{pos:0,req:!0}});return"undefined"!=typeof this.__listener[a.id]},unlisten:function(){var a=$cs.params("unlisten",arguments,{id:{pos:0,req:!0}});if("undefined"==typeof this.__listener[a.id])throw _cs.exception("unlisten","listener not found");var b=this.__listener[a.id];return delete this.__listener[a.id],b},notify:function(){var a=$cs.params("notify",arguments,{name:{pos:0,req:!0},args:{pos:"...",def:[]},matches:{def:function(a,b){return a.name===b.name}}});for(var b in this.__listener)if(_cs.isown(this.__listener,b)){var c=this.__listener[b];if(a.matches(a,c)){var d=_cs.concat(c.args,a.args);c.func.apply(c.ctx,d)}}}}}),$cs.pattern.event=$cs.clazz({mixin:[$cs.pattern.spec],dynamics:{target:$cs.attribute("target",null),propagation:$cs.attribute("propagation",!0),processing:$cs.attribute("processing",!0),dispatched:$cs.attribute("dispatched",!1),decline:$cs.attribute("decline",!1),state:$cs.attribute("state","targeting"),result:$cs.attribute("result",void 0),async:$cs.attribute("async",!1)}}),$cs.event=function(){var a=$cs.params("event",arguments,{name:{pos:0,req:!0},spec:{def:{}},target:{pos:1,req:!0},propagation:{pos:2,def:!0},processing:{pos:3,def:!0},dispatched:{pos:4,def:!1},decline:{pos:5,def:!1},state:{pos:6,def:"targeting"},result:{pos:7,def:void 0},async:{pos:8,def:!1}}),b=new $cs.pattern.event;return b.name(a.name),b.target(a.target),b.propagation(a.propagation),b.processing(a.processing),b.dispatched(a.dispatched),b.decline(a.decline),b.state(a.state),b.result(a.result),b.spec(a.spec),b.async(a.async),b},$cs.pattern.eventing=$cs.trait({dynamics:{__subscription:{}},protos:{subscribe:function(){var a=$cs.params("subscribe",arguments,{name:{pos:0,req:!0},spec:{def:{}},ctx:{def:this},func:{pos:1,req:!0},args:{pos:"...",def:[]},capturing:{def:!1},spreading:{def:!1},bubbling:{def:!0},noevent:{def:!1},exclusive:{def:!1},spool:{def:null}}),b=this._subscriptions(a.name.toString(),a.spec);
if(1===b.length&&b[0].exclusive)throw _cs.exception("subscribe","existing exclusive subscription prevents additional one");if(a.exclusive&&b.length>0)throw _cs.exception("subscribe","non-exclusive subscription(s) prevent exclusive one");var c=_cs.cid();if(this.__subscription[c]=a,null!==a.spool){var d=_cs.spool_spec_parse(this,a.spool);d.comp.spool(d.name,this,"unsubscribe",c)}return c},unsubscribe:function(){var a=$cs.params("unsubscribe",arguments,{id:{pos:0,req:!0}});if("undefined"==typeof this.__subscription[a.id])throw _cs.exception("unsubscribe","subscription not found");delete this.__subscription[a.id]},_subscription:function(){var a=$cs.params("_subscription",arguments,{id:{pos:0,req:!0},details:{pos:1,def:!1}}),b="undefined"!=typeof this.__subscription[a.id];return a.details&&(b=b?this.__subscription[a.id]:void 0),b},_subscriptions:function(){var a=$cs.params("_subscriptions",arguments,{name:{pos:0,req:!0},spec:{pos:1,def:{}}}),b=$cs.event({name:a.name,spec:a.spec,target:_cs.nop}),c=[];for(var d in this.__subscription)if(_cs.isown(this.__subscription,d)){var e=this.__subscription[d];b.matches(e.name,e.spec)&&c.push(e)}return c},publish:function(){var a,b=this,c=$cs.params("publish",arguments,{name:{pos:0,req:!0},spec:{def:{}},async:{def:!1},capturing:{def:!0},spreading:{def:!1},bubbling:{def:!0},completed:{def:_cs.nop},resultinit:{def:void 0},resultstep:{def:function(a,b){return b}},directresult:{def:!1},noresult:{def:!1},firstonly:{def:!1},silent:{def:!1},args:{pos:"...",def:[]}}),d=!1;if(!c.capturing&&!c.spreading&&!c.bubbling){var e=!1;for(var f in this.__subscription)if(_cs.isown(this.__subscription,f)){e=!0;break}if(!e){if(c.noresult)return void 0;if(c.directresult)return c.resultinit;d=!0}}var g=$cs.event({name:c.name,spec:c.spec,async:c.async,result:c.resultinit,target:b,propagation:!0,processing:!0,dispatched:!1});if(d)return g;c.silent||$cs.debug(1,"event: "+g.target().path("/")+": publish: name="+g.name()+" async="+g.async()+" capturing="+c.capturing+" spreading="+c.spreading+" bubbling="+c.bubbling+" directresult="+c.directresult+" noresult="+c.noresult+" firstonly="+c.firstonly);var h=function(a,b,c,d){for(var e in b.__subscription)if(_cs.isown(b.__subscription,e)){var f=b.__subscription[e];if(("capturing"===d&&f.capturing||"targeting"===d||"spreading"===d&&f.spreading||"bubbling"===d&&f.bubbling)&&a.matches(f.name,f.spec)){c.silent||$cs.debug(1,"event: "+b.path("/")+": dispatch on "+d),a.state(d),a.decline(!1);var g=_cs.concat(f.noevent?[]:[a],f.args,c.args),h=f.func.apply(f.ctx,g);f.noevent&&_cs.isdefined(h)&&a.result(c.resultstep(a.result(),h)),a.decline()||(a.dispatched(!0),c.firstonly&&a.propagation(!1))}}},i=function(b,c,d){var e;if((d.capturing||d.bubbling)&&(e=c.path()),d.capturing)for(a=e.length-1;a>=1&&(h(b,e[a],d,"capturing"),b.propagation());a--);if(b.propagation()&&h(b,c,d,"targeting"),d.spreading&&b.propagation()){var f=function(a,c){var e=!0;if(c||(h(b,a,d,"spreading"),b.propagation()||(b.propagation(!0),e=!1)),e)for(var g=a.children(),i=0;i<g.length;i++)f(g[i],!1)};f(c,!0)}if(d.bubbling&&b.propagation())for(a=1;a<e.length&&(h(b,e[a],d,"bubbling"),b.propagation());a++);d.completed.call(c,b)};return g.async()?setTimeout(_cs.hook("ComponentJS:settimeout:func","pass",function(){i(g,b,c)}),0):i(g,b,c),c.noresult?void 0:c.directresult?g.result():g}}}),$cs.pattern.command=$cs.clazz({mixin:[$cs.pattern.observable],dynamics:{ctx:$cs.attribute("ctx",null),func:$cs.attribute("func",_cs.nop),args:$cs.attribute("args",[]),async:$cs.attribute("async",!1),enabled:$cs.attribute("enabled",!0,"boolean")},protos:{execute:function(a,b){if(!this.enabled())return void 0;var c=[];return this.async()&&c.push(function(a){"function"==typeof b&&b(a)}),c=_cs.concat(c,this.args(),a),this.func().apply(this.ctx(),c)}}}),$cs.command=function(){var a=$cs.params("command",arguments,{ctx:{def:null},func:{pos:0,req:!0},args:{pos:"...",def:[]},async:{def:!1},enabled:{def:!0},wrap:{def:!1}}),b=new $cs.pattern.command;b.ctx(a.ctx),b.func(a.func),b.args(a.args),b.async(a.async),b.enabled(a.enabled);var c=b;return a.wrap&&(c=function(){var a=_cs.concat(arguments),b=null;return arguments.callee.command.async()&&(b=a.pop()),arguments.callee.command.execute.call(arguments.callee.command,a,b)},c.command=b),c},_cs.states=[{enter:null,leave:null,state:"dead",color:"#000000"}],_cs.states_clear=function(){_cs.states=_cs.slice(_cs.states,0,1)},_cs.states_add=function(a,b,c,d,e){for(var f={enter:b,leave:c,state:a,color:d},g=1;g<_cs.states.length&&(null===e||_cs.states[g].state!==e);)g++;_cs.states.splice(g,0,f)},_cs.state_name2idx=function(a){var b,c=-1;for(b=0;b<_cs.states.length;b++)if(_cs.states[b].state===a){c=b;break}return c},_cs.state_method_call=function(a,b,c){var d=!0,e=b.obj();if(null!==e&&"function"==typeof e[c]){var f={type:a,comp:b,method:c,ctx:e,func:e[c]};_cs.hook("ComponentJS:state-method-call","none",f),d=f.func.call(f.ctx)}return d},_cs.state_requests={},_cs.state_progression=function(){setTimeout(_cs.hook("ComponentJS:settimeout:func","pass",function(){var a=[];for(var b in _cs.state_requests)if(_cs.isown(_cs.state_requests,b)){var c=_cs.state_requests[b];_cs.state_progression_single(c)&&a.push(b)}_cs.foreach(a,function(a){delete _cs.state_requests[a]}),_cs.hook("ComponentJS:state-change","none")}),0)},_cs.state_progression_single=function(a){var b=!1;return _cs.state_progression_run(a.comp,a.state),_cs.states[a.comp.__state].state===a.state&&("function"==typeof a.callback&&a.callback.call(a.comp,a.state),b=!0),b},_cs.state_progression_run=function(a,b,c){var d,e,f,g,h,i;"undefined"==typeof c&&(c="upward-and-downward");var j=_cs.state_name2idx(b);if(-1===j)throw _cs.exception("state",'invalid argument "'+b+'"');if(a.__state<j)for(;a.__state<j;){if(f=_cs.states[a.__state+1].state,g=_cs.states[a.__state+1].enter,null!==a.parent()&&a.parent().state_compare(f)<0&&(_cs.state_progression_run(a.parent(),f,"upward"),a.parent().state_compare(f)<0))return void $cs.debug(1,"state: "+a.path("/")+": transition (increase) REJECTED BY PARENT COMPONENT ("+a.parent().path("/")+"): @"+_cs.states[a.__state].state+" --("+g+")--> @"+_cs.states[a.__state+1].state+": SUSPENDING CURRENT TRANSITION RUN");if(_cs.isdefined(a.__state_guards[g]))return void $cs.debug(1,"state: "+a.path("/")+": transition (increase) REJECTED BY ENTER GUARD: @"+_cs.states[a.__state].state+" --("+g+")--> @"+_cs.states[a.__state+1].state+": SUSPENDING CURRENT TRANSITION RUN");if(a.__state++,$cs.debug(1,"state: "+a.path("/")+": transition (increase): @"+_cs.states[a.__state-1].state+" --("+g+")--> @"+_cs.states[a.__state].state),_cs.hook("ComponentJS:state-invalidate","none","states"),_cs.hook("ComponentJS:state-change","none"),_cs.state_method_call("enter",a,g)===!1)return $cs.debug(1,"state: "+a.path("/")+": transition (increase) REJECTED BY ENTER METHOD: @"+_cs.states[a.__state-1].state+" --("+g+")--> @"+_cs.states[a.__state].state+": SUSPENDING CURRENT TRANSITION RUN"),void a.__state--;if(a.publish({name:"ComponentJS:state:"+_cs.states[a.__state].state+":enter",noresult:!0,capturing:!1,spreading:!1,bubbling:!1,async:!0,silent:!0}),_cs.hook("ComponentJS:state-enter","none",a,_cs.states[a.__state].state),"upward-and-downward"===c||"downward"===c)for(e=a.children(),d=0;d<e.length;d++)e[d].state_compare(f)<0&&(e[d].state_auto_increase()||e[d].property("ComponentJS:state-auto-increase")===!0)&&(_cs.state_progression_run(e[d],f,"downward"),e[d].state_compare(f)<0&&(_cs.state_requests[e[d].id()]={comp:e[d],state:f},_cs.hook("ComponentJS:state-invalidate","none","requests"),_cs.hook("ComponentJS:state-change","none")))}else if(a.__state>j)for(;a.__state>j;){f=_cs.states[a.__state].state,h=_cs.states[a.__state].leave;var k=_cs.states[a.__state-1].state;for(e=a.children(),d=0;d<e.length;d++)if(e[d].state_compare(k)>0&&(_cs.state_progression_run(e[d],k,"downward"),e[d].state_compare(k)>0))return void $cs.debug(1,"state: "+a.path("/")+": transition (decrease) REJECTED BY CHILD COMPONENT ("+e[d].path("/")+"): @"+_cs.states[a.__state-1].state+" <--("+h+")-- @"+_cs.states[a.__state].state+": SUSPENDING CURRENT TRANSITION RUN");if(_cs.isdefined(a.__state_guards[h]))return void $cs.debug(1,"state: "+a.path("/")+": transition (decrease) REJECTED BY LEAVE GUARD: @"+_cs.states[a.__state-1].state+" <--("+h+")-- @"+_cs.states[a.__state].state+": SUSPENDING CURRENT TRANSITION RUN");if(a.__state--,$cs.debug(1,"state: "+a.path("/")+": transition (decrease): @"+_cs.states[a.__state].state+" <--("+h+")-- @"+_cs.states[a.__state+1].state),_cs.hook("ComponentJS:state-invalidate","none","states"),_cs.hook("ComponentJS:state-change","none"),_cs.state_method_call("leave",a,h)===!1)return $cs.debug(1,"state: "+a.path("/")+": transition (decrease) REJECTED BY LEAVE METHOD: @"+_cs.states[a.__state].state+" <--("+h+")-- @"+_cs.states[a.__state+1].state+": SUSPENDING CURRENT TRANSITION RUN"),void a.__state++;i=a.spooled(f),i>0&&($cs.debug(1,"state: "+a.path("/")+": auto-unspooling "+i+" operation(s)"),a.unspool(f)),a.publish({name:"ComponentJS:state:"+_cs.states[a.__state+1].state+":leave",noresult:!0,capturing:!1,spreading:!1,bubbling:!1,async:!0,silent:!0}),_cs.hook("ComponentJS:state-leave","none",a,_cs.states[a.__state+1].state),("upward-and-downward"===c||"upward"===c)&&null!==a.parent()&&a.parent().state_compare(k)>0&&(a.parent().state_auto_decrease()||a.parent().property("ComponentJS:state-auto-decrease")===!0)&&(_cs.state_progression_run(a.parent(),k,"upward"),a.parent().state_compare(k)>0&&(_cs.state_requests[a.parent().id()]={comp:a.parent(),state:k},_cs.hook("ComponentJS:state-invalidate","none","requests"),_cs.hook("ComponentJS:state-change","none")))}},$cs.pattern.state=$cs.trait({mixin:[$cs.pattern.tree],dynamics:{__state:0,__state_guards:{},state_auto_increase:$cs.attribute("state_auto_increase",!1),state_auto_decrease:$cs.attribute("state_auto_decrease",!1)},protos:{state:function(){var a=_cs.states[this.__state].state;if(0===arguments.length)return a;var b=$cs.params("state",arguments,{state:{pos:0,req:!0,valid:function(a){return-1!==_cs.state_name2idx(a)}},func:{pos:1,def:void 0},min:{def:void 0},max:{def:void 0},sync:{def:!1}}),c=this.__state,d=_cs.state_name2idx(b.state);if(b.min===!0&&!b.max&&d>c||!b.min&&b.max===!0&&c>d||b.min===!0&&b.max===!0&&d!==c||!b.min&&!b.max&&d!==c){var e=!0,f={comp:this,state:b.state,callback:b.func};b.sync&&_cs.state_progression_single(f)&&(e=!1),e&&(_cs.state_requests[this.id()]=f,_cs.hook("ComponentJS:state-invalidate","none","requests"),_cs.state_progression())}else"function"==typeof b.func&&b.func.call(this,b.state);return a},state_compare:function(){var a=$cs.params("state",arguments,{state:{pos:0,req:!0,valid:function(a){return-1!==_cs.state_name2idx(a)}}}),b=_cs.state_name2idx(a.state);return this.__state-b},guard:function(){var a,b=$cs.params("guard",arguments,{method:{pos:0,valid:"string",req:!0},level:{pos:1,valid:"number",req:!0}}),c=!1;for(a=0;a<_cs.states.length;a++)if(_cs.states[a].enter===b.method||_cs.states[a].leave===b.method){c=!0;break}if(!c)throw _cs.exception("guard",'no such declared enter/leave method: "'+b.method+'"');_cs.isdefined(this.__state_guards[b.method])||(this.__state_guards[b.method]=0);var d=!1;if(b.level>0)this.__state_guards[b.method]+=b.level;else if(b.level<0){if(this.__state_guards[b.method]<-b.level)throw _cs.exception("guard","guard level decrease request too large");this.__state_guards[b.method]+=b.level,0===this.__state_guards[b.method]&&(d=!0)}else this.__state_guards[b.method]=0,d=!0;d&&(delete this.__state_guards[b.method],_cs.state_progression())}}}),$cs.pattern.service=$cs.trait({mixin:[$cs.pattern.eventing],protos:{register:function(){var a=$cs.params("register",arguments,{name:{pos:0,req:!0},ctx:{def:this},func:{pos:1,req:!0},args:{pos:"...",def:[]},spool:{def:null},capturing:{def:!1},spreading:{def:!1},bubbling:{def:!0}}),b=$cs.command({ctx:a.ctx,func:a.func,args:a.args,wrap:!0});b.command.listen({name:"attribute:set:enabled",args:[this,a.name],func:function(a,b,c,d){a.publish({name:"ComponentJS:service:"+b+":callable",args:[c,d],capturing:!1,spreading:!1,bubbling:!1,async:!0,noresult:!0})}});var c=this.subscribe({name:"ComponentJS:service:"+a.name,ctx:a.ctx,func:b,noevent:!0,capturing:a.capturing,spreading:a.spreading,bubbling:a.bubbling,exclusive:!0});if(null!==a.spool){var d=_cs.spool_spec_parse(this,a.spool);d.comp.spool(d.name,this,"unregister",c)}return c},unregister:function(){var a=$cs.params("unregister",arguments,{id:{pos:0,req:!0}});this.unsubscribe(a.id)},callable:function(){var a=$cs.params("callable",arguments,{name:{pos:0,req:!0},value:{pos:1,def:void 0}}),b=this._subscriptions(a.name);if(1!==b.length)return void 0;var c=b[0].func().command;return c.enabled(a.value)},call:function(){var a=$cs.params("call",arguments,{name:{pos:0,req:!0},args:{pos:"...",def:[]},capturing:{def:!1},spreading:{def:!1},bubbling:{def:!0}}),b=this.publish({name:"ComponentJS:service:"+a.name,args:a.args,capturing:a.capturing,spreading:a.spreading,bubbling:a.bubbling,firstonly:!0,async:!1});if(!b.dispatched())throw _cs.exception("call",'no such registered service found: "'+a.name+'"');return b.result()}}}),$cs.pattern.backing=$cs.trait({dynamics:{__obj:null},protos:{obj:function(a){if("undefined"==typeof a)return this.__obj;if("object"!=typeof a)throw _cs.exception("obj","invalid argument");return null!==a?(_cs.annotation(a,"comp",this),this.__obj=a):(null!==this.__obj&&_cs.annotation(this.__obj,"comp",null),this.__obj=null),this},access:function(a,b){if("undefined"==typeof a)throw _cs.exception("access","no attribute name given");var c=this.obj();if(null===c)throw _cs.exception("access","still no object attached");if("undefined"==typeof c[a])throw _cs.exception("access",'invalid attribute "'+a+'"');var d=c[a];return"undefined"!=typeof b&&(c[a]=b),d},invoke:function(a){if("undefined"==typeof a)throw _cs.exception("invoke","no method name given");var b=this.obj();if(null===b)throw _cs.exception("invoke","still no object attached");if("undefined"==typeof b[a])throw _cs.exception("invoke",'invalid method "'+a+'"');if("function"!==_cs.istypeof(b[a]))throw _cs.exception("invoke",'anything named "'+a+'" existing, but not a function');var c=_cs.slice(arguments,1);return b[a].apply(b,c)}}}),$cs.pattern.socket=$cs.trait({mixin:[$cs.pattern.tree,$cs.pattern.property],dynamics:{__sockets:{},__plugs:{}},protos:{socket:function(){var a=$cs.params("socket",arguments,{name:{def:"default"},scope:{def:null},ctx:{pos:0,req:!0},plug:{pos:1,req:!0},unplug:{pos:2,req:!0},spool:{def:null}});if("string"===_cs.istypeof(a.plug)&&"function"!==_cs.istypeof(a.ctx[a.plug]))throw _cs.exception("socket",'no plug method named "'+a.plug+'" found on context object');if("string"!==_cs.istypeof(a.plug)&&"function"!==_cs.istypeof(a.plug))throw _cs.exception("socket","plug operation neither method name nor function");if("string"===_cs.istypeof(a.unplug)&&"function"!==_cs.istypeof(a.ctx[a.unplug]))throw _cs.exception("socket",'no unplug method named "'+a.unplug+'" found on context object');if("string"!==_cs.istypeof(a.unplug)&&"function"!==_cs.istypeof(a.unplug))throw _cs.exception("socket","unplug operation neither method name nor function");var b="ComponentJS:socket:"+a.name;null!==a.scope&&(b+="@"+a.scope),$cs(this).property(b,a);var c=_cs.cid();if(this.__sockets[c]=b,null!==a.spool){var d=_cs.spool_spec_parse(this,a.spool);d.comp.spool(d.name,this,"unsocket",c)}return c},unsocket:function(){var a=$cs.params("unsocket",arguments,{id:{pos:0,req:!0}});if("undefined"==typeof this.__sockets[a.id])throw _cs.exception("unsocket","socket not found");var b=this.__sockets[a.id];$cs(this).property(b,null),delete this.__sockets[a.id]},link:function(){var a=$cs.params("link",arguments,{name:{def:"default"},scope:{def:null},target:{pos:0,req:!0},socket:{pos:1,req:!0},spool:{def:null}});return this.socket({name:a.name,scope:a.scope,spool:a.spool,ctx:{},plug:function(b){var c=_cs.annotation(b,"link");if(null!==c)throw _cs.exception("link:plug: cannot plug, you have to unplug first");c=$cs(a.target).plug({name:a.socket,object:b,targeting:!0}),_cs.annotation(b,"link",c)},unplug:function(b){var c=_cs.annotation(b,"link");if(null===c)throw _cs.exception("link:unplug: cannot unplug, you have to plug first");$cs(a.target).unplug({id:c,targeting:!0}),_cs.annotation(b,"link",null)}})},unlink:function(){var a=$cs.params("unlink",arguments,{id:{pos:0,req:!0}});return this.unsocket(a.id)},plug:function(){var a=$cs.params("plug",arguments,{name:{def:"default"},object:{pos:0,req:!0},spool:{def:null},targeting:{def:!1}}),b=_cs.cid();if(this.__plugs[b]=a,_cs.plugger("plug",this,a.name,a.object,a.targeting),null!==a.spool){var c=_cs.spool_spec_parse(this,a.spool);c.comp.spool(c.name,this,"unplug",b)}return b},unplug:function(){var a=$cs.params("unplug",arguments,{id:{pos:0,req:!0},targeting:{def:!1}});if("undefined"==typeof this.__plugs[a.id])throw _cs.exception("unplug","plugging not found");var b=this.__plugs[a.id].name,c=this.__plugs[a.id].object;_cs.plugger("unplug",this,b,c,a.targeting),delete this.__plugs[a.id]}}}),_cs.plugger=function(a,b,c,d,e){var f="ComponentJS:socket:"+c,g=b.property({name:f,targeting:e});if(!_cs.isdefined(g))throw _cs.exception(a,"no socket found on parent component(s)");var h=b.property({name:f,targeting:e,returnowner:!0});if($cs.debug(1,"socket: "+h.path("/")+": "+c+" <--("+a+")-- "+b.path("/")),"string"===_cs.istypeof(g[a]))g.ctx[g[a]].call(g.ctx,d,b);else{if("function"!==_cs.istypeof(g[a]))throw _cs.exception(a,'failed to perform "'+a+'" operation');g[a].call(g.ctx,d,b)}},$cs.mark=function(a,b){var c=_cs.annotation(a,"marker");null===c&&(c={}),c[b]=!0,_cs.annotation(a,"marker",c)},$cs.marked=function(a,b){var c=_cs.annotation(a,"marker");return null===c&&(c={}),c[b]===!0},$cs.pattern.marker=$cs.trait({protos:{mark:function(a){$cs.mark(this.obj(),a)},marked:function(a){return $cs.marked(this.obj(),a)}}}),$cs.marker={service:$cs.trait({cons:function(){$cs.mark(this,"service")}}),controller:$cs.trait({cons:function(){$cs.mark(this,"controller")}}),model:$cs.trait({cons:function(){$cs.mark(this,"model")}}),view:$cs.trait({cons:function(){$cs.mark(this,"view")}})},_cs.store_load=function(a){null===a.__store&&(_cs.hook("ComponentJS:store-load","none",a),(null===a.__store||"object"!=typeof a.__store)&&(a.__store={}))},_cs.store_save=function(a){null!==a.__store&&_cs.hook("ComponentJS:store-save","none",a)},$cs.pattern.store=$cs.trait({dynamics:{__store:null},protos:{store:function(){var a,b;if(0===arguments.length){_cs.store_load(this);var c=[];for(a in this.__store)c.push(a);return c}if(1===arguments.length&&null===arguments[0])return this.__store={},_cs.store_save(this),null;if(1===arguments.length&&"string"==typeof arguments[0])return _cs.store_load(this),a=arguments[0],"undefined"==typeof this.__store[a]?null:this.__store[a];if(2===arguments.length&&null===arguments[1])return _cs.store_load(this),a=arguments[0],delete this.__store[a],_cs.store_save(this),null;if(2===arguments.length)return _cs.store_load(this),a=arguments[0],b=arguments[1],this.__store[a]=b,_cs.store_save(this),b;throw _cs.exception("store","invalid argument(s)")}}}),$cs.pattern.model=$cs.trait({protos:{model:function(){var a=$cs.params("model",arguments,{spec:{pos:0,req:!0,valid:"{ @: { value?: any, valid?: (string|function|RegExp), autoreset?: boolean, store?: boolean} }"}}),b={spec:a.spec,data:{}};_cs.foreach(_cs.keysof(b.spec),function(a){var c=b.spec[a];if("undefined"==typeof c.value&&(c.value=""),"undefined"==typeof c.valid&&(c.valid="string"),"undefined"==typeof c.autoreset&&(c.autoreset=!1),"undefined"==typeof c.store&&(c.store=!1),!$cs.validate(c.value,c.valid))throw _cs.exception("model",'model field "'+a+'" has default value '+_cs.json(c.value)+', which does not validate against validation specification "'+c.valid+'"');b.data[a]=c.value});var c=this.store("model");null!==c&&_cs.foreach(_cs.keysof(b.spec),function(a){b.spec[a].store&&_cs.isdefined(c[a])&&(b.data[a]=c[a])});var d=this.property({name:"ComponentJS:model",bubbling:!1});if(_cs.isdefined(d)){var e={spec:{},data:{}};_cs.extend(e.spec,d.spec),_cs.extend(e.data,d.data),_cs.extend(e.spec,b.spec),_cs.extend(e.data,b.data),b=e}c={};var f=!1;_cs.foreach(_cs.keysof(b.spec),function(a){b.spec[a].store&&(c[a]=b.data[a],f=!0)}),f&&this.store("model",c),this.property("ComponentJS:model",b)},value:function(){var a=$cs.params("value",arguments,{name:{pos:0,req:!0,valid:"string"},value:{pos:1,def:void 0,valid:"any"},force:{pos:2,def:!1,valid:"boolean"},injected:{def:!1,valid:"boolean"},op:{def:[],valid:"(string|[string?]|[string,number,number])"},returnowner:{def:!1,valid:"boolean"}});if("string"==typeof a.op&&(a.op=[a.op]),0===a.op.length)a.op=_cs.isdefined(a.value)?["set"]:["get"];else if(!a.op[0].match(/^(?:get|set|splice|delete|push|pop|shift|unshift)$/))throw _cs.exception("value",'invalid operation "'+a.op[0]+'"');if("splice"===a.op[0]&&(3!==a.op.length||"number"!=typeof a.op[1]||"number"!=typeof a.op[2]))throw _cs.exception("value",'invalid arguments for operation "splice"');for(var b=_cs.select_parse(a.name),c=b.join("."),d=null,e=null,f=this;null!==f;){if(d=f.property({name:"ComponentJS:model",returnowner:!0}),!_cs.isdefined(d))throw _cs.exception("value",'no model found containing value "'+b[0]+'"');if(e=d.property("ComponentJS:model"),_cs.isdefined(e.spec[b[0]]))break;f=d.parent()}if(null===f)throw _cs.exception("value",'no model found containing value "'+b[0]+'"');var g,h=a.value;switch(a.op[0]){case"unshift":a.op=["splice",0,0];break;case"shift":a.op=["splice",0,1],h=void 0;break;case"push":g=$cs.select(e.data,b),a.op=["splice",g.length,0];break;case"pop":g=$cs.select(e.data,b),a.op=["splice",g.length-1,1],h=void 0}var i,j,k=$cs.select(e.data,b);if("splice"===a.op[0]?k=a.op[2]>0?$cs.select(k,""+a.op[1]):void 0:"get"===a.op[0]&&d.property({name:"ComponentJS:model:subscribers:get",def:0,bubbling:!1})>0&&(i=d.publish({name:"ComponentJS:model:"+c+":"+a.op[0],args:[k,k,a.op,c],capturing:!1,spreading:!1,bubbling:!1,async:!1}),i.processing()&&(j=i.result(),"undefined"!=typeof j&&(k=j))),"set"===a.op[0]&&(a.force||k!==h)||"delete"===a.op[0]||"splice"===a.op[0]){if("set"===a.op[0]||"splice"===a.op[0]&&void 0!==h){var l="splice"===a.op[0]?b.slice(1).concat(["0"]):b.slice(1);if(!_cs.validate_at(h,e.spec[b[0]].valid,l))throw _cs.exception("value",'model field "'+a.name+'" receives new value '+_cs.json(h)+', which does not validate against "'+e.spec[b[0]].valid+'"'+(l.length>0?' at sub-path "'+l.join(".")+'"':""))}var m=!0;if(d.property({name:"ComponentJS:model:subscribers:"+a.op[0],def:0,bubbling:!1})>0)if(i=d.publish({name:"ComponentJS:model:"+c+":"+a.op[0],args:[h,k,a.op,c],capturing:!1,spreading:!1,bubbling:!1,async:!1}),i.processing())j=i.result(),"undefined"!=typeof j&&(h=j);else{if(a.injected)throw _cs.exception("value",'model field "'+a.name+'" receives (again) value '+_cs.json(h)+", which is rejected by observers, but the value was indicated to be already injected by third-parties (so it technically no longer can be rejected)");m=!1}if(m&&!e.spec[b[0]].autoreset){if("set"===a.op[0])$cs.select(e.data,b,h);else if("splice"===a.op[0]){if(g=$cs.select(e.data,b),!(g instanceof Array))throw new _cs.exception("value","cannot splice: target object is not of Array type");"undefined"!=typeof h?g.splice(a.op[1],a.op[2],h):g.splice(a.op[1],a.op[2])}else if("delete"===a.op[0]){if(b.length<2)throw new _cs.exception("value","cannot delete model root or top-level model entry");g=$cs.select(e.data,b.slice(0,b.length-1));var n=b[b.length-1];if(g instanceof Array)g.splice(parseInt(n,10),1);else{if("object"!=typeof g)throw new _cs.exception("value","cannot delete: target object is neither Array nor Object type");delete g[n]}}if(e.spec[b[0]].store){var o=d.store("model");o[b[0]]=e.data[b[0]],d.store("model",o)}d.property({name:"ComponentJS:model:subscribers:changed",def:0,bubbling:!1})>0&&d.publish({name:"ComponentJS:model:"+c+":changed",args:[h,k,a.op,c],noresult:!0,capturing:!1,spreading:!1,bubbling:!1,async:!0})}}return a.returnowner?d:k},touch:function(){var a=$cs.params("touch",arguments,{name:{pos:0,req:!0,valid:"string"}});this.value({name:a.name,value:this.value(a.name),injected:!0,force:!0})},observe:function(){for(var a=$cs.params("observe",arguments,{name:{pos:0,req:!0,valid:"string"},func:{pos:1,req:!0,valid:"function"},touch:{def:!1,valid:"boolean"},boot:{def:!1,valid:"boolean"},op:{def:"set",valid:/^(?:get|set|changed|splice|delete|)$/},spool:{def:null,valid:"(null|string)"},noevent:{def:!1,valid:"boolean"}}),b=_cs.select_parse(a.name),c=null,d=null,e=this;null!==e;){if(c=e.property({name:"ComponentJS:model",returnowner:!0}),!_cs.isdefined(c))throw _cs.exception("observe",'no model found containing value "'+b[0]+'"');if(d=c.property("ComponentJS:model"),_cs.isdefined(d.spec[b[0]]))break;e=c.parent()}if(null===e)throw _cs.exception("observe",'no model found containing value "'+b[0]+'"');var f=b.join(".").replace(/\./g,"\\.").replace(/\*\*/g,".+?").replace(/\*/g,"[^.]+");f+="(?:\\.[^.]+)*";var g=c.subscribe({name:new RegExp("ComponentJS:model:"+f+":"+a.op),capturing:!1,spreading:!1,bubbling:!1,noevent:a.noevent,func:a.func}),h="ComponentJS:model:subscribers:"+a.op,i=c.property({name:h,def:0});if(i+=1,c.property({name:h,value:i}),null!==a.spool){var j=_cs.spool_spec_parse(this,a.spool);j.comp.spool(j.name,this,"unobserve",g)}if(a.touch)this.touch(a.name);else if(a.boot){var k=this.value(a.name),l=[k,k,a.op,b.join(".")];a.noevent||l.unshift($cs.event({name:a.name,spec:{},async:!1,result:void 0,target:this,propagation:!0,processing:!0,dispatched:!1})),a.func.apply(this,l)}return g},unobserve:function(){for(var a,b=$cs.params("unobserve",arguments,{id:{pos:0,req:!0,valid:"string"}}),c=null,d=this;null!==d;){if(c=d.property({name:"ComponentJS:model",returnowner:!0}),!_cs.isdefined(c))throw _cs.exception("unobserve","no model subscription found");if(void 0!==(a=c._subscription(b.id,!0)))break;d=c.parent()}if(null===d)throw _cs.exception("unobserve","no model subscription found");c.unsubscribe(b.id);var e="ComponentJS:model:subscribers:"+a.op,f=c.property({name:e,def:0});f=f>0?f-1:null,c.property({name:e,value:f})}}}),_cs.comp=null,_cs.none=null,_cs.root=null,_cs.comp_mixins=[$cs.pattern.id,$cs.pattern.name,$cs.pattern.tree,$cs.pattern.config,$cs.pattern.spool,$cs.pattern.state,$cs.pattern.service,$cs.pattern.eventing,$cs.pattern.property,$cs.pattern.backing,$cs.pattern.socket,$cs.pattern.model,$cs.pattern.store,$cs.pattern.marker],_cs.comp_cons=function(a,b,c){_cs.annotation(this,"type","component"),"string"!==_cs.istypeof(a)&&(a="<unknown>"),this.name(a),this.parent("object"===_cs.istypeof(b)?b:null),this.children("array"===_cs.istypeof(c)?c:[])},_cs.comp_protos={create:function(){return $cs.create.apply(this,_cs.concat([this],arguments))},destroy:function(){return $cs.destroy.apply(this,_cs.concat([this],arguments))},exists:function(){return"<none>"!==this.name()}},_cs.bootstrapped=!1,$cs.bootstrap=function(){if(_cs.bootstrapped)throw _cs.exception("bootstrap","library already bootstrapped");_cs.hook("ComponentJS:bootstrap:comp:mixin","none",_cs.comp_mixins),_cs.hook("ComponentJS:bootstrap:comp:protos","none",_cs.comp_protos),_cs.comp=$cs.clazz({mixin:_cs.comp_mixins,cons:_cs.comp_cons,protos:_cs.comp_protos}),_cs.root=new _cs.comp("<root>",null,[]),_cs.none=new _cs.comp("<none>",null,[]);var a=["call","callable","create","destroy","guard","hook","invoke","latch","link","model","observe","plug","property","publish","register","registration","socket","spool","spooled","state","state_compare","store","subscribe","subscription","touch","unlatch","unobserve","unplug","unregister","unspool","unsubscribe","value"];_cs.foreach(a,function(a){_cs.none[a]=function(){throw _cs.exception(a,'no such component (you are calling method "'+a+'" on component "<none>")')}}),_cs.hook("ComponentJS:bootstrap","none"),_cs.bootstrapped=!0},$cs.shutdown=function(){if(!_cs.bootstrapped)throw _cs.exception("shutdown","library still not bootstrapped");_cs.hook("ComponentJS:shutdown","none"),_cs.foreach(_cs.root.children(),function(a){a.destroy()}),_cs.root.state({state:"dead",sync:!0}),_cs.none=null,_cs.root=null,_cs.comp=null,_cs.bootstrapped=!1},_cs.lookup=function(a,b){if(1===arguments.length&&("string"===_cs.istypeof(arguments[0])?(b=a,a=_cs.root):b=""),"string"!=typeof b)return _cs.none;if("<root>"===b)return _cs.root;if("<none>"===b)return _cs.none;var c;if("/"===b.substr(0,1))c=_cs.root,b=b.substring(1);else{var d=_cs.istypeof(a),e=_cs.annotation(a,"comp");if("component"!==d&&null!==e)c=e;else{if("component"!==d)throw _cs.exception("lookup",'invalid base component (type is "'+d+'")');c=a}}if(""!==b){var f=[];if(_cs.lookup_step(f,c,b.split("/"),0),0===f.length)c=_cs.none;else if(1===f.length)c=f[0];else{var g={};if(f=_cs.filter(f,function(a){var b=a.id(),c="undefined"==typeof g[b];return g[b]=!0,c}),1!==f.length){for(var h="",i=0;i<f.length;i++)h+=" "+f[i].path("/");throw _cs.exception("lookup",'ambiguous component path "'+b+'" at '+c.path("/")+": expected only 1 component, but found "+f.length+" components:"+h)}c=f[0]}}return c},_cs.lookup_step=function(a,b,c,d){var e,f,g;if(d>=c.length)a.push(b);else if("."===c[d])_cs.lookup_step(a,b,c,d+1);else if(".."===c[d])null!==b.parent()&&_cs.lookup_step(a,b.parent(),c,d+1);else if("*"===c[d])for(f=b.children(),e=0;e<f.length;e++)_cs.lookup_step(a,f[e],c,d+1);else if(""===c[d])for(g=b.walk_down(function(a,b,c,d){return d||c.push(b),c},[]),e=0;e<g.length;e++)_cs.lookup_step(a,g[e],c,d+1);else for(f=b.children(),e=0;e<f.length;e++)if(f[e].name()===c[d]){_cs.lookup_step(a,f[e],c,d+1);break}},$cs.create=function(){if(!_cs.bootstrapped){var a='ComponentJS: WARNING: component system still not bootstrapped (please call "bootstrap" method before first "create" method call!)';"function"==typeof alert?alert(a):"undefined"!=typeof console&&"function"==typeof console.log&&console.log(a),$cs.bootstrap()}if(arguments.length<2)throw _cs.exception("create","invalid number of arguments");var b=0,c=null,d=null,e=[];if("string"===_cs.istypeof(arguments[b])){if("/"!==arguments[b].substr(0,1))throw _cs.exception("create",'either base component has to be given or the tree specification has to start with the root component ("/")');c=_cs.root}else if(d=arguments[b++],"component"!==_cs.istypeof(d)&&(d=_cs.annotation(d,"comp"),null===d))throw _cs.exception("create","invalid base argument (not an object attached to a component)");for(var f,g=[],h=arguments[b++];""!==h&&(f=h.match(/^\s*([^\/{},]+|[\/{},])/),null!==f);)g.push(f[1]),h=h.substr(f[1].length);for(var i=function(a,b){for(var c="",d=0;b>d&&d<a.length;d++)c+=a[d];if(d<a.length)for(c+="<",c+=a[d++],c+=">";d<a.length;d++)c+=a[d];return c},j=0;j<g.length;j++)if("/"===g[j]){if(null===c)throw _cs.exception("create","no parent component for step-down at "+i(g,j));d=c}else if("{"===g[j])e.push(d);else if(","===g[j]){if(0===e.length)throw _cs.exception("create","no open brace section for parallelism at "+i(g,j));d=e[e.length-1]}else if("}"===g[j]){if(0===e.length)throw _cs.exception("create","no more open brace section for closing at "+i(g,j));d=e.pop(),c=null}else{if(null===d)throw _cs.exception("create","no base component at "+i(g,j));c=_cs.create_single(d,g[j],arguments[b++])}if(e.length>0)throw _cs.exception("create","still open brace sections at end of tree specification");return c},_cs.create_single=function(a,b,c){if("string"!=typeof b)throw _cs.exception("create","invalid path argument (not a string)");var d=b.match(/^(.*?)\/?([^\/]+)$/);if(!d[0])throw _cs.exception("create",'invalid path "'+b+'"');var e=d[1],f=d[2],g=_cs.cid();f=f.replace(/\{id\}/g,g);var h=_cs.lookup(a,e);if(h===_cs.none)throw _cs.exception("create",'parent component path "'+e+'" not already existing (please create first)');var i=_cs.lookup(h,f);if(i!==_cs.none)throw _cs.exception("create",'leaf component path "'+f+'" already existing (please destroy first)');var j=null;
switch(_cs.istypeof(c)){case"clazz":case"trait":case"function":j=new c;break;case"object":j=c;break;case"null":break;default:throw _cs.exception("create","invalid class argument")}if(i=new _cs.comp(f),i.id(g),i.attach(h),i.obj(j),$cs.debug(1,"component: "+i.path("/")+": created component ["+i.id()+"]"),_cs.hook("ComponentJS:comp-created","none",i),_cs.states.length<=1)throw _cs.exception("create","no user-defined component states");return i.state({state:_cs.states[1].state,sync:!0}),_cs.hook("ComponentJS:state-invalidate","none","components"),_cs.hook("ComponentJS:state-change","none"),i},$cs.destroy=function(){if(1!==arguments.length&&2!==arguments.length)throw _cs.exception("destroy","invalid number of arguments");var a=_cs.lookup.apply(this,arguments);if(a===_cs.none)throw _cs.exception("destroy","no such component found to destroy");if(a===_cs.root)throw _cs.exception("destroy","root component cannot be destroyed");var b=a.path("/"),c=a.id();a.state({state:"dead",sync:!0}),_cs.hook("ComponentJS:comp-destroyed","none",a),a.detach(),a.obj(null),$cs.debug(1,"component: "+b+": destroyed component ["+c+"]"),_cs.hook("ComponentJS:state-invalidate","none","components"),_cs.hook("ComponentJS:state-change","none")},$cs.transition=function(){if(1===arguments.length&&null===arguments[0])return void _cs.states_clear();var a=$cs.params("transition",arguments,{target:{pos:0,req:!0},enter:{pos:1,req:!0},leave:{pos:2,req:!0},color:{pos:3,def:"#000000"},source:{def:null}});_cs.states_add(a.target,a.enter,a.leave,a.color,a.source)},$cs.transition("created","create","destroy","#cc3333"),$cs.transition("configured","setup","teardown","#eabc43"),$cs.transition("prepared","prepare","cleanup","#f2ec00"),$cs.transition("materialized","render","release","#6699cc"),$cs.transition("visible","show","hide","#669933"),$cs.transition("enabled","enable","disable","#336600"),"object"==typeof EXPORTS&&"undefined"==typeof GLOBAL.ComponentJS_export||"undefined"!=typeof GLOBAL.ComponentJS_export&&"CommonJS"===GLOBAL.ComponentJS_export?EXPORTS.ComponentJS=$cs:"function"==typeof DEFINE&&"object"==typeof DEFINE.amd&&"undefined"==typeof GLOBAL.ComponentJS_export||"undefined"!=typeof GLOBAL.ComponentJS_export&&"AMD"===GLOBAL.ComponentJS_export?DEFINE("ComponentJS",function(){return $cs}):$cs.symbol("ComponentJS"),_cs.plugins={},$cs.plugin=function(a,b){if(0===arguments.length){var c=[];for(a in _cs.plugins)_cs.isown(_cs.plugins,a)&&c.push(a);return c}if(1===arguments.length){if("string"!=typeof a)throw _cs.exception("plugin","invalid plugin name parameter");return"undefined"!=typeof _cs.plugins[a]}if(2!==arguments.length)throw _cs.exception("plugin","invalid number of parameters");if("string"!=typeof a)throw _cs.exception("plugin","invalid plugin name parameter");if("undefined"!=typeof _cs.plugins[a])throw _cs.exception("plugin",'plugin named "'+a+'" already registered');b.call(this,_cs,$cs,GLOBAL),_cs.plugins[a]=!0}}("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof this?this:{},"object"==typeof exports?exports:void 0,"function"==typeof define?define:void 0);