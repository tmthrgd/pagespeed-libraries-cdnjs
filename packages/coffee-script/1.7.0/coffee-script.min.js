(function(){var e,r,n,t,o,i,a,u,l,s,c,f,p,m={}.hasOwnProperty,h=[].indexOf||function(e){for(var r=0,n=this.length;n>r;r++)if(r in this&&this[r]===e)return r;return-1};o=require("fs"),f=require("vm"),s=require("path"),e=require("./lexer").Lexer,l=require("./parser").parser,a=require("./helpers"),r=require("./sourcemap"),exports.VERSION="1.7.0",exports.FILE_EXTENSIONS=[".coffee",".litcoffee",".coffee.md"],exports.helpers=a,p=function(e){return function(r,n){var t;null==n&&(n={});try{return e.call(this,r,n)}catch(o){throw t=o,a.updateSyntaxError(t,r,n.filename)}}},exports.compile=n=p(function(e,n){var t,o,i,s,c,f,p,m,h,d,x,g,v;for(d=a.merge,s=a.extend,n=s({},n),n.sourceMap&&(h=new r),f=l.parse(u.tokenize(e,n)).compileToFragments(n),i=0,n.header&&(i+=1),n.shiftLine&&(i+=1),o=0,m="",g=0,v=f.length;v>g;g++)c=f[g],n.sourceMap&&(c.locationData&&h.add([c.locationData.first_line,c.locationData.first_column],[i,o],{noReplace:!0}),x=a.count(c.code,"\n"),i+=x,x?o=c.code.length-(c.code.lastIndexOf("\n")+1):o+=c.code.length),m+=c.code;return n.header&&(p="Generated by CoffeeScript "+this.VERSION,m="// "+p+"\n"+m),n.sourceMap?(t={js:m},t.sourceMap=h,t.v3SourceMap=h.generate(n,e),t):m}),exports.tokens=p(function(e,r){return u.tokenize(e,r)}),exports.nodes=p(function(e,r){return l.parse("string"==typeof e?u.tokenize(e,r):e)}),exports.run=function(e,r){var t,i,u,l;return null==r&&(r={}),u=require.main,u.filename=process.argv[1]=r.filename?o.realpathSync(r.filename):".",u.moduleCache&&(u.moduleCache={}),i=r.fileName?s.dirname(o.realpathSync(r.filename)):o.realpathSync("."),u.paths=require("module")._nodeModulePaths(i),(!a.isCoffee(u.filename)||require.extensions)&&(t=n(e,r),e=null!=(l=t.js)?l:t),u._compile(e,u.filename)},exports.eval=function(e,r){var t,o,i,a,u,l,c,p,h,d,x,g,v,y;if(null==r&&(r={}),e=e.trim()){if(o=f.Script){if(null!=r.sandbox){if(r.sandbox instanceof o.createContext().constructor)c=r.sandbox;else{c=o.createContext(),g=r.sandbox;for(a in g)m.call(g,a)&&(p=g[a],c[a]=p)}c.global=c.root=c.GLOBAL=c}else c=global;if(c.__filename=r.filename||"eval",c.__dirname=s.dirname(c.__filename),c===global&&!c.module&&!c.require){for(t=require("module"),c.module=x=new t(r.modulename||"eval"),c.require=y=function(e){return t._load(e,x,!0)},x.filename=c.__filename,v=Object.getOwnPropertyNames(require),h=0,d=v.length;d>h;h++)l=v[h],"paths"!==l&&(y[l]=require[l]);y.paths=x.paths=t._nodeModulePaths(process.cwd()),y.resolve=function(e){return t._resolveFilename(e,x)}}}u={};for(a in r)m.call(r,a)&&(p=r[a],u[a]=p);return u.bare=!0,i=n(e,u),c===global?f.runInThisContext(i):f.runInContext(i,c)}},exports.register=function(){return require("./register")},exports._compileFile=function(e,r){var t,i,u,l;null==r&&(r=!1),u=o.readFileSync(e,"utf8"),l=65279===u.charCodeAt(0)?u.substring(1):u;try{t=n(l,{filename:e,sourceMap:r,literate:a.isLiterate(e)})}catch(s){throw i=s,a.updateSyntaxError(i,l,e)}return t},u=new e,l.lexer={lex:function(){var e,r;return r=this.tokens[this.pos++],r?(e=r[0],this.yytext=r[1],this.yylloc=r[2],this.errorToken=r.origin||r,this.yylineno=this.yylloc.first_line):e="",e},setInput:function(e){return this.tokens=e,this.pos=0},upcomingInput:function(){return""}},l.yy=require("./nodes"),l.yy.parseError=function(e,r){var n,t,o,i,u,s,c;return u=r.token,c=l.lexer,i=c.errorToken,s=c.tokens,t=i[0],o=i[1],n=i[2],o=i===s[s.length-1]?"end of input":"INDENT"===t||"OUTDENT"===t?"indentation":a.nameWhitespaceCharacter(o),a.throwSyntaxError("unexpected "+o,n)},t=function(e,r){var n,t,o,i,a,u,l,s,c,f,p,m;return i=void 0,o="",e.isNative()?o="native":(e.isEval()?(i=e.getScriptNameOrSourceURL(),i||(o=""+e.getEvalOrigin()+", ")):i=e.getFileName(),i||(i="<anonymous>"),s=e.getLineNumber(),t=e.getColumnNumber(),f=r(i,s,t),o=f?""+i+":"+f[0]+":"+f[1]:""+i+":"+s+":"+t),a=e.getFunctionName(),u=e.isConstructor(),l=!(e.isToplevel()||u),l?(c=e.getMethodName(),m=e.getTypeName(),a?(p=n="",m&&a.indexOf(m)&&(p=""+m+"."),c&&a.indexOf("."+c)!==a.length-c.length-1&&(n=" [as "+c+"]"),""+p+a+n+" ("+o+")"):""+m+"."+(c||"<anonymous>")+" ("+o+")"):u?"new "+(a||"<anonymous>")+" ("+o+")":a?""+a+" ("+o+")":o},c={},i=function(e){var r,n;if(c[e])return c[e];if(n=null!=s?s.extname(e):void 0,!(h.call(exports.FILE_EXTENSIONS,n)<0))return r=exports._compileFile(e,!0),c[e]=r.sourceMap},Error.prepareStackTrace=function(e,r){var n,o,a,u;return a=function(e,r,n){var t,o;return o=i(e),o&&(t=o.sourceLocation([r-1,n-1])),t?[t[0]+1,t[1]+1]:null},o=function(){var e,o,i;for(i=[],e=0,o=r.length;o>e&&(n=r[e],n.getFunction()!==exports.run);e++)i.push("  at "+t(n,a));return i}(),""+e.name+": "+(null!=(u=e.message)?u:"")+"\n"+o.join("\n")+"\n"}}).call(this);