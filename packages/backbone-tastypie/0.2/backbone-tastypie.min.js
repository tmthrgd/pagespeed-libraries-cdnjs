!function(){"use strict";var b,c;"undefined"==typeof window?(b=require("underscore"),c=require("backbone")):(b=window._,c=window.Backbone),c.Tastypie={doGetOnEmptyPostResponse:!0,doGetOnEmptyPutResponse:!1,apiKey:{username:"",key:""},csrfToken:""},c.oldSync=c.sync,c.sync=function(a,d,e){var f={};if(c.Tastypie.apiKey&&c.Tastypie.apiKey.username&&(f.Authorization="ApiKey "+c.Tastypie.apiKey.username+":"+c.Tastypie.apiKey.key),c.Tastypie.csrfToken&&(f["X-CSRFToken"]=c.Tastypie.csrfToken),f=b.extend(f,e.headers),e.headers=f,"create"===a&&c.Tastypie.doGetOnEmptyPostResponse||"update"===a&&c.Tastypie.doGetOnEmptyPutResponse){var g=new $.Deferred,h=e.success;g.done(function(a){b.isFunction(h)&&h(a)}),e.success=function(a,b,h){if(a||201!==h.status&&202!==h.status&&204!==h.status)return g.resolveWith(e.context||e,[a,b,h]);var i=h.getResponseHeader("Location")||d.url();return c.ajax({url:i,headers:f,success:g.resolve,error:g.reject})};var i=e.error;return g.fail(function(a){b.isFunction(i)&&i(a.responseText)}),e.error=function(a,b){g.rejectWith(e.context||e,[a,b,a.responseText])},g.request=c.oldSync(a,d,e),g}return c.oldSync(a,d,e)},c.Model.prototype.idAttribute="resource_uri",c.Model.prototype.url=function(){var a=this.get("resource_uri");return a||(a=b.isFunction(this.urlRoot)?this.urlRoot():this.urlRoot,a=a||this.collection&&(b.isFunction(this.collection.url)?this.collection.url():this.collection.url),a&&this.has("id")&&(a=d(a)+this.get("id"))),a=a&&d(a),a||null},c.Model.prototype.parse=function(a){return a&&a.objects&&(b.isArray(a.objects)?a.objects[0]:a.objects)||a},c.Collection.prototype.parse=function(a){return a&&a.meta&&(this.meta=a.meta),a&&a.objects||a},c.Collection.prototype.url=function(a){var c=b.isFunction(this.urlRoot)?this.urlRoot():this.urlRoot;if(!c){var e=a&&a.length&&a[0];c=e&&(b.isFunction(e.urlRoot)?e.urlRoot():e.urlRoot)}if(c=c&&d(c),a&&a.length){var f=b.map(a,function(a){var c=b.compact(a.url().split("/"));return c[c.length-1]});c+="set/"+f.join(";")+"/"}return c||null};var d=function(a){return a+(a.length>0&&"/"===a.charAt(a.length-1)?"":"/")}}();
