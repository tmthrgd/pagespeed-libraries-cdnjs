(function(){var a={}.hasOwnProperty;angular.module("knalli.angular-vertxbus",["ng"]),angular.module("knalli.angular-vertxbus").provider("vertxEventBus",function(){var a,b,c;a={MODULE:"angular-vertxbus",COMPONENT:"wrapper"},b={enabled:!0,debugEnabled:!1,prefix:"vertx-eventbus.",urlServer:""+location.protocol+"//"+location.hostname+":"+(location.port||80),urlPath:"/eventbus",reconnectEnabled:!0,sockjsStateInterval:1e4,sockjsReconnectInterval:1e4,sockjsOptions:{},messageBuffer:0},c=angular.extend({},b),this.enable=function(a){return null==a&&(a=b.enabled),c.enabled=a===!0,this},this.enable.displayName=""+a.MODULE+"/"+a.COMPONENT+": provider.enable",this.useDebug=function(a){return null==a&&(a=b.debugEnabled),c.debugEnabled=a===!0,this},this.useDebug.displayName=""+a.MODULE+"/"+a.COMPONENT+": provider.useDebug",this.usePrefix=function(a){return null==a&&(a=b.prefix),c.prefix=a,this},this.usePrefix.displayName=""+a.MODULE+"/"+a.COMPONENT+": provider.usePrefix",this.useUrlServer=function(a){return null==a&&(a=b.urlServer),c.urlServer=a,this},this.useUrlServer.displayName=""+a.MODULE+"/"+a.COMPONENT+": provider.useUrlServer",this.useUrlPath=function(a){return null==a&&(a=b.urlPath),c.urlPath=a,this},this.useUrlPath.displayName=""+a.MODULE+"/"+a.COMPONENT+": provider.useUrlPath",this.useReconnect=function(a){return null==a&&(a=b.reconnectEnabled),c.reconnectEnabled=a,this},this.useReconnect.displayName=""+a.MODULE+"/"+a.COMPONENT+": provider.useReconnect",this.useSockJsStateInterval=function(a){return null==a&&(a=b.sockjsStateInterval),c.sockjsStateInterval=a,this},this.useSockJsStateInterval.displayName=""+a.MODULE+"/"+a.COMPONENT+": provider.useSockJsStateInterval",this.useSockJsReconnectInterval=function(a){return null==a&&(a=b.sockjsReconnectInterval),c.sockjsReconnectInterval=a,this},this.useSockJsReconnectInterval.displayName=""+a.MODULE+"/"+a.COMPONENT+": provider.useSockJsReconnectInterval",this.useSockJsOptions=function(a){return null==a&&(a=b.sockjsOptions),c.sockjsOptions=a,this},this.useSockJsOptions.displayName=""+a.MODULE+"/"+a.COMPONENT+": provider.useSockJsOptions",this.useMessageBuffer=function(a){return null==a&&(a=b.messageBuffer),c.messageBuffer=a,this},this.useMessageBuffer.displayName=""+a.MODULE+"/"+a.COMPONENT+": provider.useMessageBuffer",this.$get=["$timeout",function(d){var e,f,g,h,i,j,k,l,m,n,o,p,q,r,s;return s=angular.extend({},b,c),i=s.enabled,h=s.debugEnabled,k=s.prefix,r=s.urlServer,q=s.urlPath,l=s.reconnectEnabled,o=s.sockjsStateInterval,n=s.sockjsReconnectInterval,m=s.sockjsOptions,f=null,e="undefined"!=typeof vertx&&null!==vertx?vertx.EventBus:void 0,i&&e?(p=""+r+q,h&&console.debug("[Vert.x EB Stub] Enabled: connecting '"+p+"'"),j=null,g=function(){j=new e(p,void 0,m),j.onopen=function(){h&&console.debug("[Vert.x EB Stub] Connected"),"function"==typeof f.onopen&&f.onopen()},j.onclose=function(){h&&console.debug("[Vert.x EB Stub] Reconnect in "+n+"ms"),"function"==typeof f.onclose&&f.onclose(),l&&d(g,n)}},g(),f={reconnect:function(){return j.close()},close:function(){return j.close()},login:function(a,b,c){return j.login(a,b,c)},send:function(a,b,c){return j.send(a,b,c)},publish:function(a,b){return j.publish(a,b)},registerHandler:function(b,c){var d;return j.registerHandler(b,c),d=function(){f.unregisterHandler(b,c)},d.displayName=""+a.MODULE+"/"+a.COMPONENT+": EventBusStub.registerHandler (deconstructor)",d},unregisterHandler:function(a,b){return j.unregisterHandler(a,b)},readyState:function(){return j.readyState()},EventBus:e,getOptions:function(){return angular.extend({},c)}},f.reconnect.displayName=""+a.MODULE+"/"+a.COMPONENT+": EventBusStub.reconnect",f.close.displayName=""+a.MODULE+"/"+a.COMPONENT+": EventBusStub.close",f.login.displayName=""+a.MODULE+"/"+a.COMPONENT+": EventBusStub.login",f.send.displayName=""+a.MODULE+"/"+a.COMPONENT+": EventBusStub.send",f.publish.displayName=""+a.MODULE+"/"+a.COMPONENT+": EventBusStub.publish",f.registerHandler.displayName=""+a.MODULE+"/"+a.COMPONENT+": EventBusStub.registerHandler",f.unregisterHandler.displayName=""+a.MODULE+"/"+a.COMPONENT+": EventBusStub.unregisterHandler",f.readyState.displayName=""+a.MODULE+"/"+a.COMPONENT+": EventBusStub.readyState",f.getOptions.displayName=""+a.MODULE+"/"+a.COMPONENT+": EventBusStub.getOptions"):h&&console.debug("[Vert.x EB Stub] Disabled"),f}],this.$get.displayName=""+a.MODULE+"/"+a.COMPONENT+": Factory.get"}),angular.module("knalli.angular-vertxbus").provider("vertxEventBusService",function(){var b,c,d,e,f;b={MODULE:"angular-vertxbus",COMPONENT:"service"},c={loginRequired:!1,loginBlockForSession:!1,skipUnauthorizeds:!0},d=function(){function a(a){this.maxSize=null!=a?a:10,this.items=[]}return a.prototype.push=function(a){return this.items.push(a),this.recalibrateBufferSize()},a.prototype.recalibrateBufferSize=function(){for(;this.items.length>this.maxSize;)this.first();return this},a.prototype.last=function(){return this.items.pop()},a.prototype.first=function(){return this.items.shift(0)},a.prototype.size=function(){return this.items.length},a}(),e=function(){function a(){this.keys=[],this.values=[]}return a.prototype.keys=null,a.prototype.values=null,a.prototype.put=function(a,b){var c;return c=this._indexForKey(a),c>-1?this.values[c]=b:(this.keys.push(a),this.values.push(b)),this},a.prototype.get=function(a){var b;return b=this._indexForKey(a),b>-1?this.values[b]:void 0},a.prototype.containsKey=function(a){var b;return b=this._indexForKey(a),b>-1},a.prototype.containsValue=function(a){var b;return b=this._indexForValue(a),b>-1},a.prototype.remove=function(a){var b;b=this._indexForKey(a),b>-1&&(this.keys[b]=void 0,this.values[b]=void 0)},a.prototype.clear=function(){return this.keys=[],this.values=[],this},a.prototype._indexForKey=function(a){var b,c,d,e,f;for(f=this.keys,b=d=0,e=f.length;e>d;b=++d)if(c=f[b],a===c)return b;return-1},a.prototype._indexForValue=function(a){var b,c,d,e,f;for(f=this.values,b=d=0,e=f.length;e>d;b=++d)if(c=f[b],a===c)return b;return-1},a}(),f=angular.extend({},c),this.requireLogin=function(a){return null==a&&(a=f.loginRequired),f.loginRequired=a,this},this.requireLogin.displayName=""+b.MODULE+"/"+b.COMPONENT+": provider.requireLogin",this.blockForSession=function(a){return null==a&&(a=f.loginBlockForSession),f.loginBlockForSession=a,this},this.blockForSession.displayName=""+b.MODULE+"/"+b.COMPONENT+": provider.blockForSession",this.skipUnauthorizeds=function(a){return null==a&&(a=f.skipUnauthorizeds),f.skipUnauthorizeds=a,this},this.skipUnauthorizeds.displayName=""+b.MODULE+"/"+b.COMPONENT+": provider.skipUnauthorizeds",this.$get=["$rootScope","$q","$interval","$timeout","vertxEventBus",function(c,g,h,i,j){var k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F;return E=(null!=j?j.getOptions():void 0)||{},o=E.enabled,m=E.debugEnabled,u=E.prefix,A=E.urlServer,z=E.urlPath,v=E.reconnectEnabled,y=E.sockjsStateInterval,x=E.sockjsReconnectInterval,w=E.sockjsOptions,s=E.messageBuffer,l=null!=j&&null!=(F=j.EventBus)?F.CLOSED:void 0,C=!1,r=null,t=new d(s),n=new e,o&&j&&(j.onopen=function(){var b,d,e,f,g,h,i;D.getConnectionState(!0),c.$broadcast(""+u+"system.connected"),i=D.handlers;for(b in i)if(a.call(i,b))for(e=i[b],g=0,h=e.length;h>g;g++)d=e[g],B.registerHandler(b,d);if(c.$digest(),s&&t.size()){for(;t.size();)f=t.first(),"function"==typeof f&&f();c.$digest()}},j.onclose=function(){return D.getConnectionState(!0),c.$broadcast(""+u+"system.disconnected")},j.onclose.displayName=""+b.MODULE+"/"+b.COMPONENT+": 'onclose' handler"),q=function(a){return D.getConnectionState()===j.EventBus.OPEN?(a(),!0):s?(t.push(a),!0):!1},q.displayName=""+b.MODULE+"/"+b.COMPONENT+": ensureOpenConnection",p=function(a){var c;return f.loginRequired?(c=function(){return C?(a(),!0):(m&&console.debug("[Vert.x EB Service] Message was not sent because login is required"),!1)},c.displayName=""+b.MODULE+"/"+b.COMPONENT+": ensureOpenAuthConnection function wrapper",q(c)):q(a)},p.displayName=""+b.MODULE+"/"+b.COMPONENT+": ensureOpenAuthConnection",B={registerHandler:function(a,d){var e;if("function"==typeof d)return m&&console.debug("[Vert.x EB Service] Register handler for "+a),n.containsKey(d)?n.get(d):(e=function(a,b){d(a,b),c.$digest()},e.displayName=""+b.MODULE+"/"+b.COMPONENT+": util.registerHandler (deconstructor)",n.put(d,e),j.registerHandler(a,n.get(d)))},unregisterHandler:function(a,b){"function"==typeof b&&(m&&console.debug("[Vert.x EB Service] Unregister handler for "+a),j.unregisterHandler(a,n.get(b)),n.remove(b))},send:function(a,c,d){var e,f,h;return null==d&&(d=1e4),e=g.defer(),h=function(){return j.send(a,c,function(a){return e?e.resolve(a):void 0}),e?i(function(){return e.reject()},d):void 0},h.displayName=""+b.MODULE+"/"+b.COMPONENT+": util.send (ensureOpenAuthConnection callback)",f=p(h),e&&!f&&e.reject(),null!=e?e.promise:void 0},publish:function(a,c){var d,e;return e=function(){return j.publish(a,c)},e.displayName=""+b.MODULE+"/"+b.COMPONENT+": util.publish (ensureOpenAuthConnection callback)",d=p(e)},login:function(a,d,e){var f,h;return null==e&&(e=5e3),f=g.defer(),h=function(a){return"ok"===(null!=a?a.status:void 0)?(f.resolve(a),c.$broadcast(""+u+"system.login.succeeded",{status:null!=a?a.status:void 0})):(f.reject(a),c.$broadcast(""+u+"system.login.failed",{status:null!=a?a.status:void 0}))},h.displayName=""+b.MODULE+"/"+b.COMPONENT+": util.login (callback)",j.login(a,d,h),i(function(){return f.reject()},e),f.promise}},B.registerHandler.displayName=""+b.MODULE+"/"+b.COMPONENT+": util.registerHandler",B.unregisterHandler.displayName=""+b.MODULE+"/"+b.COMPONENT+": util.unregisterHandler",B.send.displayName=""+b.MODULE+"/"+b.COMPONENT+": util.send",B.publish.displayName=""+b.MODULE+"/"+b.COMPONENT+": util.publish",B.login.displayName=""+b.MODULE+"/"+b.COMPONENT+": util.login",D={handlers:{},registerHandler:function(a,c){var d,e;return D.handlers[a]||(D.handlers[a]=[]),D.handlers[a].push(c),e=null,l===j.EventBus.OPEN&&(e=B.registerHandler(a,c)),d=function(){var b;e&&e(),D.handlers[a]&&(b=D.handlers[a].indexOf(c),b>-1&&D.handlers[a].splice(b,1))},d.displayName=""+b.MODULE+"/"+b.COMPONENT+": wrapped.registerHandler (deconstructor)",d},unregisterHandler:function(a,b){var c;return D.handlers[a]&&(c=D.handlers[a].indexOf(b),c>-1&&D.handlers[a].splice(c,1)),l===j.EventBus.OPEN?B.unregisterHandler(a,b):void 0},send:function(a,b,c){return null==c&&(c=1e4),B.send(a,b,c)},publish:function(a,b){return B.publish(a,b)},getConnectionState:function(a){return(null!=j?j.EventBus:void 0)?o?a&&(l=j.readyState()):l=j.EventBus.CLOSED:l=3,l},isValidSession:function(){return C},login:function(a,b){return B.login(a,b).then(function(a){return C=!0,a})["catch"](function(a){return C=!1,a})}},D.registerHandler.displayName=""+b.MODULE+"/"+b.COMPONENT+": wrapped.registerHandler",D.unregisterHandler.displayName=""+b.MODULE+"/"+b.COMPONENT+": wrapped.unregisterHandler",D.send.displayName=""+b.MODULE+"/"+b.COMPONENT+": wrapped.send",D.publish.displayName=""+b.MODULE+"/"+b.COMPONENT+": wrapped.publish",D.getConnectionState.displayName=""+b.MODULE+"/"+b.COMPONENT+": wrapped.getConnectionState",D.isValidSession.displayName=""+b.MODULE+"/"+b.COMPONENT+": wrapped.isValidSession",D.login.displayName=""+b.MODULE+"/"+b.COMPONENT+": wrapped.login",k=function(){return D.getConnectionState(!0)},k.displayName=""+b.MODULE+"/"+b.COMPONENT+": periodic connection check",h(k,y),{on:D.registerHandler,addListener:D.registerHandler,un:D.unregisterHandler,removeListener:D.unregisterHandler,send:D.send,publish:D.publish,emit:D.publish,readyState:D.getConnectionState,isEnabled:function(){return o},getBufferCount:function(){return t.size()},isValidSession:function(){return C},login:D.login}}],this.$get.displayName=""+b.MODULE+"/"+b.COMPONENT+": Factory.get"})}).call(this);