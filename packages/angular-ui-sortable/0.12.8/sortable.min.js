/*
 jQuery UI Sortable plugin wrapper

 @param [ui-sortable] {object} Options to pass to $.fn.sortable() merged onto ui.config
 */
angular.module("ui.sortable",[]).value("uiSortableConfig",{}).directive("uiSortable",["uiSortableConfig","$timeout","$log",function(e,t,n){return{require:"?ngModel",link:function(r,i,s,o){function a(e,t){if(t&&typeof t==="function"){return function(n,r){e(n,r);t(n,r)}}return e}function f(e,t){var n=e.sortable("option","helper");return n==="clone"||typeof n==="function"&&t.item.sortable.isCustomHelperUsed()}var u;var l={};var c={receive:null,remove:null,start:null,stop:null,update:null};var h={helper:null};angular.extend(l,e,r.$eval(s.uiSortable));if(!angular.element.fn||!angular.element.fn.jquery){n.error("ui.sortable: jQuery should be included before AngularJS!");return}if(o){r.$watch(s.ngModel+".length",function(){t(function(){if(!!i.data("ui-sortable")){i.sortable("refresh")}})});c.start=function(e,t){t.item.sortable={index:t.item.index(),cancel:function(){t.item.sortable._isCanceled=true},isCanceled:function(){return t.item.sortable._isCanceled},isCustomHelperUsed:function(){return!!t.item.sortable._isCustomHelperUsed},_isCanceled:false,_isCustomHelperUsed:t.item.sortable._isCustomHelperUsed}};c.activate=function(){u=i.contents();var e=i.sortable("option","placeholder");if(e&&e.element&&typeof e.element==="function"){var t=e.element();t=angular.element(t);var n=i.find('[class="'+t.attr("class")+'"]');u=u.not(n)}};c.update=function(e,t){if(!t.item.sortable.received){t.item.sortable.dropindex=t.item.index();t.item.sortable.droptarget=t.item.parent();i.sortable("cancel")}if(f(i,t)&&!t.item.sortable.received){u=u.not(u.last())}u.appendTo(i);if(t.item.sortable.received&&!t.item.sortable.isCanceled()){r.$apply(function(){o.$modelValue.splice(t.item.sortable.dropindex,0,t.item.sortable.moved)})}};c.stop=function(e,t){if(!t.item.sortable.received&&"dropindex"in t.item.sortable&&!t.item.sortable.isCanceled()){r.$apply(function(){o.$modelValue.splice(t.item.sortable.dropindex,0,o.$modelValue.splice(t.item.sortable.index,1)[0])})}else{if((!("dropindex"in t.item.sortable)||t.item.sortable.isCanceled())&&!f(i,t)){u.appendTo(i)}}};c.receive=function(e,t){t.item.sortable.received=true};c.remove=function(e,t){if(!("dropindex"in t.item.sortable)){i.sortable("cancel");t.item.sortable.cancel()}if(!t.item.sortable.isCanceled()){r.$apply(function(){t.item.sortable.moved=o.$modelValue.splice(t.item.sortable.index,1)[0]})}};h.helper=function(e){if(e&&typeof e==="function"){return function(t,n){var r=e(t,n);n.sortable._isCustomHelperUsed=n!==r;return r}}return e};r.$watch(s.uiSortable,function(e){if(!!i.data("ui-sortable")){angular.forEach(e,function(e,t){if(c[t]){if(t==="stop"){e=a(e,function(){r.$apply()})}e=a(c[t],e)}else if(h[t]){e=h[t](e)}i.sortable("option",t,e)})}},true);angular.forEach(c,function(e,t){l[t]=a(e,l[t])})}else{n.info("ui.sortable: ngModel not provided!",i)}i.sortable(l)}}}])