!function(a){if("function"==typeof bootstrap)bootstrap("backboneprojections",a);else if("object"==typeof exports)module.exports=a();else if("function"==typeof define&&define.amd)define(a);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeBackboneProjections=a}else"undefined"!=typeof window?window.BackboneProjections=a():global.BackboneProjections=a()}(function(){return function(a,b,c){function d(c,f){if(!b[c]){if(!a[c]){var g="function"==typeof require&&require;if(!f&&g)return g(c,!0);if(e)return e(c,!0);throw new Error("Cannot find module '"+c+"'")}var h=b[c]={exports:{}};a[c][0].call(h.exports,function(b){var e=a[c][1][b];return d(e?e:b)},h,h.exports)}return b[c].exports}for(var e="function"==typeof require&&require,f=0;f<c.length;f++)d(c[f]);return d}({"lib/index.js":[function(a,b){var d;d=(("undefined"!=typeof window&&null!==window?window._:void 0)||a("underscore")).extend,b.exports=d({},a("./capped"),a("./filtered"),a("./sorted"))},{"./capped":"lib/capped.js","./filtered":"lib/filtered.js","./sorted":"lib/sorted.js",underscore:"underscore"}],"lib/capped.js":[function(a,b,c){var d,e,f,g,h,i={}.hasOwnProperty,j=function(a,b){function d(){this.constructor=a}for(var c in b)i.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};d=(("undefined"!=typeof window&&null!==window?window.Backbone:void 0)||a("backbone")).Collection,h=("undefined"!=typeof window&&null!==window?window._:void 0)||a("underscore"),g=h.toArray,e=h.extend,f=function(a){var b;return b=function(b){return a.indexOf(b)},b.induced=!0,b},c.Capped=function(a){function b(a,c){var d=this;null==c&&(c={}),this.underlying=a,this.model=a.model,this.comparator=c.comparator||f(a),this.options=e({cap:5},a.options,c),b.__super__.constructor.call(this,this._capped(this.underlying.models),c),this.listenTo(this.underlying,{reset:function(){return d.reset(d._capped(d.underlying.models))},remove:function(a){var b;return d.contains(a)?(d.remove(a),b=d._capped(d.underlying.models),d.add(b[d.options.cap-1])):void 0},add:function(a){return d.length<d.options.cap?d.add(a):d.comparator(a)<d.comparator(d.last())?(d.add(a),d.remove(d.at(d.options.cap))):void 0},sort:function(){return d.comparator.induced?d.reset(d._capped(d.underlying.models)):void 0}})}return j(b,a),b.prototype._capped=function(a){var b=this;return a=g(a),a.sort(function(a,c){return a=b.comparator(a),c=b.comparator(c),a>c?1:c>a?-1:0}),a.slice(0,this.options.cap)},b.prototype.resize=function(a){var b,c,d,e,f;if(this.options.cap>a)for(this.options.cap=a,f=this.models,c=e=f.length-1;e>=0&&(d=f[c],!(a>c));c=e+=-1)this.remove(d);else this.options.cap<a&&(this.options.cap=a,b=this._capped(this.underlying.models),this.add(b.slice(this.length,this.options.cap)));return this.trigger("resize")},b}(d),c.CappedCollection=c.Capped},{backbone:"backbone",underscore:"underscore"}],"lib/filtered.js":[function(a,b,c){var d,e,f,g={}.hasOwnProperty,h=function(a,b){function d(){this.constructor=a}for(var c in b)g.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};d=(("undefined"!=typeof window&&null!==window?window.Backbone:void 0)||a("backbone")).Collection,e=(("undefined"!=typeof window&&null!==window?window._:void 0)||a("underscore")).extend,f=function(a){var b;return b=function(b){return a.indexOf(b)},b.induced=!0,b},c.Filtered=function(a){function b(a,c){var d=this;null==c&&(c={}),this.underlying=a,this.model=a.model,this.comparator=c.comparator||f(a),this.options=e({},a.options,c),b.__super__.constructor.call(this,this.underlying.models.filter(this.options.filter),c),this.listenTo(this.underlying,{reset:function(){return d.reset(d.underlying.models.filter(d.options.filter))},remove:function(a){return d.contains(a)?d.remove(a):void 0},add:function(a){return d.options.filter(a)?d.add(a):void 0},change:function(a){return d.decideOn(a)},sort:function(){return d.comparator.induced?d.sort():void 0}})}return h(b,a),b.prototype.update=function(){var a,b,c,d,e;for(d=this.underlying.models,e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.decideOn(a));return e},b.prototype.decideOn=function(a){if(this.contains(a)){if(!this.options.filter(a))return this.remove(a)}else if(this.options.filter(a))return this.add(a)},b}(d),c.FilteredCollection=c.Filtered},{backbone:"backbone",underscore:"underscore"}],"lib/sorted.js":[function(a,b,c){var d,e,f={}.hasOwnProperty,g=function(a,b){function d(){this.constructor=a}for(var c in b)f.call(b,c)&&(a[c]=b[c]);return d.prototype=b.prototype,a.prototype=new d,a.__super__=b.prototype,a};d=(("undefined"!=typeof window&&null!==window?window.Backbone:void 0)||a("backbone")).Collection,e=(("undefined"!=typeof window&&null!==window?window._:void 0)||a("underscore")).extend,c.Sorted=function(a){function b(a,c){var d=this;if(null==c&&(c={}),!c.comparator)throw new Error("provide a comparator");this.underlying=a,this.model=a.model,this.comparator=c.comparator,this.options=e({},a.options,c),b.__super__.constructor.call(this,this.underlying.models,c),this.listenTo(this.underlying,{reset:function(){return d.reset(d.underlying.models)},remove:function(a){return d.remove(a)},add:function(a){return d.add(a)}})}return g(b,a),b}(d),c.Reversed=function(a){function b(a,c){null==c&&(c={}),c.comparator=function(b){return-a.indexOf(b)},b.__super__.constructor.call(this,a,c),this.listenTo(this.underlying,{sort:this.sort})}return g(b,a),b}(c.Sorted),c.SortedCollection=c.Sorted,c.ReversedCollection=c.Reversed},{backbone:"backbone",underscore:"underscore"}]},{},["lib/index.js"])("lib/index.js")});