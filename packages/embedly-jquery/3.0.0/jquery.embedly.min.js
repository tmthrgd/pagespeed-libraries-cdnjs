/*! Embedly jQuery - v3.0.0 - 2013-01-22
* https://github.com/embedly/embedly-jquery
* Copyright (c) 2013 Sean Creeley; Licensed BSD */
(function(e){function r(e){return e===null||e===undefined}function i(t,n){var r=[],s=[];return e.each(t,function(e,t){s.push(t),i.length===n&&(r.push(s),s=[])}),s.length!==0&&r.push(s),r}function s(t){return r(t)?[]:e.isArray(t)?t:[t]}function o(e){return e[0].map(function(t,n){return e.map(function(e){return e[n]})})}var t={key:null,endpoint:"oembed",secure:null,query:{},method:"replace",addImageStyles:!0,wrapElement:"div",className:"embed",batch:20},n=/(http|https):\/\/(\w+:{0,1}\w*@)?(\S+)(:[0-9]+)?(\/|\/([\w#!:.?+=&%@!\-\/]))?/,u=function(e,t,n){this.init(e,t,n)};u.prototype={init:function(t){this.urls=t,this.count=0,this.results={},this._deferred=e.Deferred()},notify:function(e){this.results[e.original_url]=e,this.count++,this._deferred.notify.apply(this._deferred,[e]);if(this.count===this.urls.length){var t=this,n=this.urls.map(function(e){return t.results[e]});this._deferred.resolve(n)}return this},state:function(){return this._deferred.state.apply(this._deferred,arguments)}},window.Keeper=u;var a=function(){};a.prototype={defaults:{},log:function(e,t){!r(window.console)&&!r(window.console[e])&&window.console[e].apply(window.console,[t])},build:function(t,n,i){i=r(i)?{}:i;var s=i.secure;r(s)&&(s=window.location.protocol==="https:"?!0:!1);var o=(s?"https":"http")+"://api.embed.ly/"+(t==="objectify"?"2/":"1/")+t,u=r(i.query)?{}:i.query;return u.key=i.key,o+="?"+e.param(u),o+="&urls="+n.map(encodeURIComponent).join(","),o},ajax:function(a,f,l){l=e.extend({},t,e.embedly.defaults,typeof l=="object"&&l);if(r(l.key))return this.log("error","Embedly jQuery requires an API Key. Please sign up for one at http://embed.ly"),null;f=s(f);var c=new u(f),h=[],p=[];e.each(f,function(e,t){n.test(t)?h.push(t):p.push({url:t,original_url:t,error:!0,invalid:!0,error_message:'Invalid url "'+t+'"'})});var d=i(h,l.batch),v=this;return e.each(d,function(t,n){e.ajax({url:v.build(a,n,l),dataType:"jsonp",success:function(t){e.each(o([n,t]),function(e,t){var n=t[1];n.original_url=t[0],n.invalid=!1,c.notify(n)})}})}),p.length&&setTimeout(function(){e.each(p,function(e,t){c.notify(t)})},1),c._deferred},oembed:function(e,t){return this.ajax("oembed",e,t)},preview:function(e,t){return this.ajax("preview",e,t)},objectify:function(e,t){return this.ajax("objectify",e,t)}};var f=function(e,t,n){this.init(e,t,n)};f.prototype={init:function(t,n,r){this.elem=t,this.$elem=e(t),this.original_url=n,this.options=r,this.loaded=e.Deferred();var i=this;this.loaded.done(function(){i.$elem.trigger("loaded",[i])}),this.$elem.trigger("initialized",[this])},progress:function(t){e.extend(this,t),this.options.display?this.options.display.apply(this.elem,[this,this.elem]):this.options.endpoint==="oembed"&&this.display(),this.loaded.resolve(this)},imageStyle:function(){var e=[],t;return this.options.addImageStyles&&(this.options.query.maxwidth&&(t=isNaN(parseInt(this.options.query.maxwidth,10))?"":"px",e.push("max-width: "+this.options.query.maxwidth+t)),this.options.query.maxheight&&(t=isNaN(parseInt(this.options.query.maxheight,10))?"":"px",e.push("max-height: "+this.options.query.maxheight+t))),e.join(";")},display:function(){this.style=this.imageStyle();var e;this.type==="photo"?(e="<a href='"+this.original_url+"' target='_blank'>",e+="<img style='"+this.style+"' src='"+this.url+"' alt='"+this.title+"' /></a>"):this.type==="video"||this.type==="rich"?e=this.html:(this.title=this.title||this.url,e=this.thumbnail_url?"<img src='"+this.thumbnail_url+"' class='thumb' style='"+this.style+"'/>":"",e+="<a href='"+this.original_url+"'>"+this.title+"</a>",e+=this.provider_name?"<a href='"+this.provider_url+"' class='provider'>"+this.provider_name+"</a>":"",e+=this.description?'<div class="description">'+this.description+"</div>":""),this.options.wrapElement&&(e="<"+this.options.wrapElement+' class="'+this.options.className+'">'+e+"</"+this.options.wrapElement+">"),this.code=e,this.options.method==="replace"?this.$elem.replaceWith(this.code):this.options.method==="after"?this.$elem.after(this.code):this.options.method==="afterParent"?this.$elem.parent().after(this.code):this.options.method==="replaceParent"&&this.$elem.parent().replaceWith(this.code),this.$elem.trigger("displayed",[this])}},e.embedly=new a,e.fn.embedly=function(n){if(n===undefined||typeof n=="object"){n=e.extend({},t,e.embedly.defaults,typeof n=="object"&&n);if(r(n.key))return e.embedly.log("error","Embedly jQuery requires an API Key. Please sign up for one at http://embed.ly"),this.each(e.noop);var i={},s=function(t){if(!e.data(e(t),"embedly")){var r=e(t).attr("href"),s=new f(t,r,n);e.data(t,"embedly",s),i.hasOwnProperty(r)?i[r].push(s):i[r]=[s]}},o=this.each(function(){r(e(this).attr("href"))?e(this).find("a").each(function(){r(e(this).attr("href"))||s(this)}):s(this)}),u=e.embedly.ajax(n.endpoint,e.map(i,function(e,t){return t}),n).progress(function(t){e.each(i[t.original_url],function(e,n){n.progress(t)})});return n.progress&&u.progress(n.progress),n.done&&u.done(n.done),o}},e.expr[":"].embedly=function(t){return!r(e(t).data("embedly"))}})(jQuery);