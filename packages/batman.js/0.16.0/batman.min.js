!function(){var t,e=[].slice;t=function(){var n;return n=1<=arguments.length?e.call(arguments,0):[],function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(t.Object,n,function(){})},t.version="0.16.0",t.config={pathToApp:"/",usePushState:!0,pathToHTML:"html",fetchRemoteHTML:!0,cacheViews:!1,minificationErrors:!0,protectFromCSRF:!1},(t.container=function(){return this}()).Batman=t,"function"==typeof define&&define("batman",[],function(){return t}),t.exportHelpers=function(e){var n,r,o,i;for(i=["mixin","extend","unmixin","redirect","typeOf","redirect","setImmediate","clearImmediate"],r=0,o=i.length;o>r;r++)n=i[r],e["$"+n]=t[n];return e},t.exportGlobals=function(){return t.exportHelpers(t.container)}}.call(this),function(){var t;Batman._Batman=t=function(){function t(t){this.object=t}return t.prototype.check=function(t){return t!==this.object?(t._batman=new Batman._Batman(t),!1):!0},t.prototype.get=function(t){var e,n;switch(n=this.getAll(t),n.length){case 0:return void 0;case 1:return n[0];default:return e=null!=n[0].concat?function(t,e){return t.concat(e)}:null!=n[0].merge?function(t,e){return t.merge(e)}:n.every(function(t){return"object"==typeof t})?(n.unshift({}),function(t,e){return Batman.extend(t,e)}):void 0,e?n.reduceRight(e):n}},t.prototype.getFirst=function(t){var e;return e=this.getAll(t),e[0]},t.prototype.getAll=function(t){var e,n,r;return e="function"==typeof t?t:function(e){var n;return null!=(n=e._batman)?n[t]:void 0},n=this.ancestors(e),(r=e(this.object))&&n.unshift(r),n},t.prototype.ancestors=function(t){var e,n,r,o,i,a;if(this._allAncestors||(this._allAncestors=this.allAncestors()),t){for(n=[],a=this._allAncestors,o=0,i=a.length;i>o;o++)e=a[o],r=t(e),null!=r&&n.push(r);return n}return this._allAncestors},t.prototype.allAncestors=function(){var t,e,n,r,o,i;return r=[],t=!!this.object.prototype,e=t?null!=(o=this.object.__super__)?o.constructor:void 0:(n=Object.getPrototypeOf(this.object))===this.object?this.object.constructor.__super__:n,null!=e&&(null!=(i=e._batman)&&i.check(e),r.push(e),null!=e._batman&&(r=r.concat(e._batman.allAncestors()))),r},t.prototype.set=function(t,e){return this[t]=e},t}()}.call(this),function(){var t,e,n,r,o,i,a,s,u=[].slice,c={}.hasOwnProperty,l=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.typeOf=function(t){return"undefined"==typeof t?"Undefined":i.call(t).slice(8,-1)},i=Object.prototype.toString,Batman.extend=function(){var t,e,n,r,o,i,a;for(r=arguments[0],n=2<=arguments.length?u.call(arguments,1):[],i=0,a=n.length;a>i;i++){e=n[i];for(t in e)o=e[t],r[t]=o}return r},Batman.mixin=function(){var t,e,n,r,o,i,a,s;for(o=arguments[0],r=2<=arguments.length?u.call(arguments,1):[],t="function"==typeof o.set,a=0,s=r.length;s>a;a++)if(n=r[a],"Object"===Batman.typeOf(n)){for(e in n)c.call(n,e)&&(i=n[e],"initialize"!==e&&"uninitialize"!==e&&"prototype"!==e&&(t?o.set(e,i):null!=o.nodeName?Batman.data(o,e,i):o[e]=i));"function"==typeof n.initialize&&n.initialize.call(o)}return o},Batman.unmixin=function(){var t,e,n,r,o,i;for(t=arguments[0],r=2<=arguments.length?u.call(arguments,1):[],o=0,i=r.length;i>o;o++){n=r[o];for(e in n)"initialize"!==e&&"uninitialize"!==e&&delete t[e];"function"==typeof n.uninitialize&&n.uninitialize.call(t)}return t},Batman._functionName=Batman.functionName=function(t){var e;return t.__name__?t.__name__:t.name?t.name:null!=(e=t.toString().match(/\W*function\s+([\w\$]+)\(/))?e[1]:void 0},Batman._isChildOf=Batman.isChildOf=function(t,e){var n;for(n=e.parentNode;n;){if(n===t)return!0;n=n.parentNode}return!1},o=function(t){var e,n,r,o,i,a,s;return e=function(){var e,n;return t.postMessage?(e=!0,n=t.onmessage,t.onmessage=function(){return e=!1},t.postMessage("","*"),t.onmessage=n,e):!1},s=new Batman.SimpleHash,n=0,o=function(){return"go"+ ++n},t.setImmediate&&t.clearImmediate?(Batman.setImmediate=function(){return t.setImmediate.apply(t,arguments)},Batman.clearImmediate=function(){return t.clearImmediate.apply(t,arguments)}):e()?(a="com.batman.",i=function(t){var e,n;if("string"==typeof t.data&&~t.data.search(a))return e=t.data.substring(a.length),"function"==typeof(n=s.unset(e))?n():void 0},t.addEventListener?t.addEventListener("message",i,!1):t.attachEvent("onmessage",i),Batman.setImmediate=function(e){var n;return s.set(n=o(),e),t.postMessage(a+n,"*"),n},Batman.clearImmediate=function(t){return s.unset(t)}):"undefined"!=typeof document&&l.call(document.createElement("script"),"onreadystatechange")>=0?(Batman.setImmediate=function(){var t,e;return t=o(),e=document.createElement("script"),e.onreadystatechange=function(){var n;return"function"==typeof(n=s.get(t))&&n(),e.onreadystatechange=null,e.parentNode.removeChild(e),e=null},document.documentElement.appendChild(e),t},Batman.clearImmediate=function(t){return s.unset(t)}):("undefined"!=typeof process&&null!==process?process.nextTick:void 0)?(r={},Batman.setImmediate=function(t){var e;return e=o(),r[e]=t,process.nextTick(function(){return"function"==typeof r[e]&&r[e](),delete r[e]}),e},Batman.clearImmediate=function(t){return delete r[t]}):(Batman.setImmediate=function(t){return setTimeout(t,0)},Batman.clearImmediate=function(t){return clearTimeout(t)})},Batman.setImmediate=function(){return o(Batman.container),Batman.setImmediate.apply(this,arguments)},Batman.clearImmediate=function(){return o(Batman.container),Batman.clearImmediate.apply(this,arguments)},Batman.forEach=function(t,e,n){var r,o,i,a,s,u;if(t.forEach)t.forEach(e,n);else if(t.indexOf)for(o=s=0,u=t.length;u>s;o=++s)r=t[o],e.call(n,r,o,t);else for(i in t)a=t[i],e.call(n,i,a,t)},Batman.objectHasKey=function(t,e){return"function"==typeof t.hasKey?t.hasKey(e):e in t},Batman.contains=function(t,e){return t.indexOf?l.call(t,e)>=0:"function"==typeof t.has?t.has(e):Batman.objectHasKey(t,e)},Batman.get=function(t,e){return"function"==typeof t.get?t.get(e):Batman.Property.forBaseAndKey(t,e).getValue()},Batman.getPath=function(t,e){var n,r,o;for(r=0,o=e.length;o>r;r++){if(n=e[r],null==t)return;if(t=Batman.get(t,n),null==t)return t}return t},r={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&#34;","/":"&#47;","'":"&#39;"},a=[],e=[];for(t in r)a.push(t),e.push(r[t]);s=new RegExp("["+a.join("")+"]","g"),n=new RegExp("("+e.join("|")+")","g"),Batman.escapeHTML=function(){return function(t){return(""+t).replace(s,function(t){return r[t]})}}(),Batman.unescapeHTML=function(){return function(t){var e;if(null!=t)return e=Batman._unescapeHTMLNode||(Batman._unescapeHTMLNode=document.createElement("DIV")),e.innerHTML=t,Batman.DOM.textContent(e)}}(),Batman.translate=function(t,e){return null==e&&(e={}),Batman.helpers.interpolate(Batman.get(Batman.translate.messages,t),e)},Batman.translate.messages={},Batman.t=function(){return Batman.translate.apply(Batman,arguments)},Batman.redirect=function(t,e){var n;return null==e&&(e=!1),null!=(n=Batman.navigator)?n.redirect(t,e):void 0},Batman.initializeObject=function(t){return null!=t._batman?t._batman.check(t):t._batman=new Batman._Batman(t)}}.call(this),function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.Inflector=function(){function n(){this._plural=[],this._singular=[],this._uncountable=[],this._human=[]}return n.prototype.plural=function(t,e){return this._plural.unshift([t,e])},n.prototype.singular=function(t,e){return this._singular.unshift([t,e])},n.prototype.human=function(t,e){return this._human.unshift([t,e])},n.prototype.uncountable=function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],this._uncountable=this._uncountable.concat(e.map(function(t){return new RegExp(""+t+"$","i")}))},n.prototype.irregular=function(t,e){return t.charAt(0)===e.charAt(0)?(this.plural(new RegExp("("+t.charAt(0)+")"+t.slice(1)+"$","i"),"$1"+e.slice(1)),this.plural(new RegExp("("+t.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+e.slice(1)),this.singular(new RegExp("("+e.charAt(0)+")"+e.slice(1)+"$","i"),"$1"+t.slice(1))):(this.plural(new RegExp(""+t+"$","i"),e),this.plural(new RegExp(""+e+"$","i"),e),this.singular(new RegExp(""+e+"$","i"),t))},n.prototype.ordinalize=function(t,n){var r,o;if(null==n&&(n=10),t=parseInt(t,n),r=Math.abs(t),o=r%100,e.call([11,12,13],o)>=0)return t+"th";switch(r%10){case 1:return t+"st";case 2:return t+"nd";case 3:return t+"rd";default:return t+"th"}},n.prototype.pluralize=function(t){var e,n,r,o,i,a,s,u,c,l;for(u=this._uncountable,o=0,a=u.length;a>o;o++)if(r=u[o],r.test(t))return t;for(c=this._plural,i=0,s=c.length;s>i;i++)if(l=c[i],e=l[0],n=l[1],e.test(t))return t.replace(e,n);return t},n.prototype.singularize=function(t){var e,n,r,o,i,a,s,u,c,l;for(u=this._uncountable,o=0,a=u.length;a>o;o++)if(r=u[o],r.test(t))return t;for(c=this._singular,i=0,s=c.length;s>i;i++)if(l=c[i],e=l[0],n=l[1],e.test(t))return t.replace(e,n);return t},n.prototype.humanize=function(t){var e,n,r,o,i,a;for(i=this._human,r=0,o=i.length;o>r;r++)if(a=i[r],e=a[0],n=a[1],e.test(t))return t.replace(e,n);return t},n}()}.call(this),function(){var t,e,n,r,o,i,a,s;e=/(?:^|_|\-)(.)/g,i=/(^|\s)([a-z])/g,a=/([A-Z]+)([A-Z][a-z])/g,s=/([a-z\d])([A-Z])/g,n=/_id$/,r=/_|-|\./g,o=/^\w/g,Batman.helpers={ordinalize:function(){return Batman.helpers.inflector.ordinalize.apply(Batman.helpers.inflector,arguments)},singularize:function(){return Batman.helpers.inflector.singularize.apply(Batman.helpers.inflector,arguments)},pluralize:function(t,e,n,r){var o;return null==r&&(r=!0),arguments.length<2?Batman.helpers.inflector.pluralize(t):(o=1===+t?e:n||Batman.helpers.inflector.pluralize(e),r&&(o=""+(t||0)+" "+o),o)},camelize:function(t,n){return t=t.replace(e,function(t,e){return e.toUpperCase()}),n?t.substr(0,1).toLowerCase()+t.substr(1):t},underscore:function(t){return t.replace(a,"$1_$2").replace(s,"$1_$2").replace("-","_").toLowerCase()},titleize:function(t){return t.replace(i,function(t,e,n){return e+n.toUpperCase()})},capitalize:function(t){return Batman.developer.deprecated("capitalize","Renamed to titleize."),Batman.helpers.titleize(t)},trim:function(t){return t?t.trim():""},interpolate:function(t,e){var n,r,o;"object"==typeof t?(r=t[e.count],r||(r=t.other)):r=t;for(n in e)o=e[n],r=r.replace(new RegExp("%\\{"+n+"\\}","g"),o);return r},humanize:function(t){return t=Batman.helpers.underscore(t),t=Batman.helpers.inflector.humanize(t),t.replace(n,"").replace(r," ").replace(o,function(t){return t.toUpperCase()})},toSentence:function(t){var e,n;return t.length<3?t.join(" and "):(n=t.pop(),e=t.join(", "),e+=", and "+n)}},t=new Batman.Inflector,Batman.helpers.inflector=t,t.plural(/$/,"s"),t.plural(/s$/i,"s"),t.plural(/(ax|test)is$/i,"$1es"),t.plural(/(octop|vir)us$/i,"$1i"),t.plural(/(octop|vir)i$/i,"$1i"),t.plural(/(alias|status)$/i,"$1es"),t.plural(/(bu)s$/i,"$1ses"),t.plural(/(buffal|tomat)o$/i,"$1oes"),t.plural(/([ti])um$/i,"$1a"),t.plural(/([ti])a$/i,"$1a"),t.plural(/sis$/i,"ses"),t.plural(/(?:([^f])fe|([lr])f)$/i,"$1$2ves"),t.plural(/(hive)$/i,"$1s"),t.plural(/([^aeiouy]|qu)y$/i,"$1ies"),t.plural(/(x|ch|ss|sh)$/i,"$1es"),t.plural(/(matr|vert|ind)(?:ix|ex)$/i,"$1ices"),t.plural(/([m|l])ouse$/i,"$1ice"),t.plural(/([m|l])ice$/i,"$1ice"),t.plural(/^(ox)$/i,"$1en"),t.plural(/^(oxen)$/i,"$1"),t.plural(/(quiz)$/i,"$1zes"),t.singular(/s$/i,""),t.singular(/(n)ews$/i,"$1ews"),t.singular(/([ti])a$/i,"$1um"),t.singular(/((a)naly|(b)a|(d)iagno|(p)arenthe|(p)rogno|(s)ynop|(t)he)ses$/i,"$1$2sis"),t.singular(/(^analy)ses$/i,"$1sis"),t.singular(/([^f])ves$/i,"$1fe"),t.singular(/(hive)s$/i,"$1"),t.singular(/(tive)s$/i,"$1"),t.singular(/([lr])ves$/i,"$1f"),t.singular(/([^aeiouy]|qu)ies$/i,"$1y"),t.singular(/(s)eries$/i,"$1eries"),t.singular(/(m)ovies$/i,"$1ovie"),t.singular(/(x|ch|ss|sh)es$/i,"$1"),t.singular(/([m|l])ice$/i,"$1ouse"),t.singular(/(bus)es$/i,"$1"),t.singular(/(o)es$/i,"$1"),t.singular(/(shoe)s$/i,"$1"),t.singular(/(cris|ax|test)es$/i,"$1is"),t.singular(/(octop|vir)i$/i,"$1us"),t.singular(/(alias|status)es$/i,"$1"),t.singular(/^(ox)en/i,"$1"),t.singular(/(vert|ind)ices$/i,"$1ex"),t.singular(/(matr)ices$/i,"$1ix"),t.singular(/(quiz)zes$/i,"$1"),t.singular(/(database)s$/i,"$1"),t.irregular("person","people"),t.irregular("man","men"),t.irregular("child","children"),t.irregular("sex","sexes"),t.irregular("move","moves"),t.irregular("cow","kine"),t.irregular("zombie","zombies"),t.uncountable("equipment","information","rice","money","species","series","fish","sheep","jeans")}.call(this),function(){var t;Batman.developer={suppressed:!1,DevelopmentError:function(){var t;return t=function(t){return this.message=t,this.name="DevelopmentError"},t.prototype=Error.prototype,t}(),_ie_console:function(t,e){var n,r,o,i;for(1!==e.length&&"undefined"!=typeof console&&null!==console&&console[t]("..."+t+" of "+e.length+" items..."),i=[],r=0,o=e.length;o>r;r++)n=e[r],i.push("undefined"!=typeof console&&null!==console?console[t](n):void 0);return i},suppress:function(e){return t.suppressed=!0,e?(e(),t.suppressed=!1):void 0},unsuppress:function(){return t.suppressed=!1},log:function(){return t.suppressed||null==("undefined"!=typeof console&&null!==console?console.log:void 0)?void 0:console.log.apply?console.log.apply(console,arguments):t._ie_console("log",arguments)},warn:function(){return t.suppressed||null==("undefined"!=typeof console&&null!==console?console.warn:void 0)?void 0:console.warn.apply?console.warn.apply(console,arguments):t._ie_console("warn",arguments)},error:function(e){throw new t.DevelopmentError(e)},assert:function(e,n){return e?void 0:t.error(n)},"do":function(e){return t.suppressed?void 0:e()},addFilters:function(){return Batman.extend(Batman.Filters,{log:function(t){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log(arguments),t},logStack:function(e){return"undefined"!=typeof console&&null!==console&&"function"==typeof console.log&&console.log(t.currentFilterStack),e}})},deprecated:function(t,e){return Batman.developer.warn(""+t+" has been deprecated.",e||"")}},t=Batman.developer,Batman.developer.assert(function(){}.bind,"Error! Batman needs Function.bind to work! Please shim it using something like es5-shim or augmentjs!")}.call(this),function(){Batman.Event=function(){function t(t,e){this.base=t,this.key=e,this._preventCount=0}return t.forBaseAndKey=function(t,e){return t.isEventEmitter?t.event(e):new Batman.Event(t,e)},t.prototype.isEvent=!0,t.prototype.isEqual=function(t){return this.constructor===t.constructor&&this.base===t.base&&this.key===t.key},t.prototype.hashKey=function(){var t;return this.hashKey=function(){return t},t="<Batman.Event base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">'},t.prototype.addHandler=function(t){return this.handlers||(this.handlers=[]),-1===this.handlers.indexOf(t)&&this.handlers.push(t),this.oneShot&&this.autofireHandler(t),this},t.prototype.removeHandler=function(t){var e;return this.handlers&&-1!==(e=this.handlers.indexOf(t))&&this.handlers.splice(e,1),this},t.prototype.eachHandler=function(t){var e,n,r,o,i,a,s,u,c,l,p,h;if(null!=(i=this.handlers)&&i.slice().forEach(t),null!=(a=this.base)?a.isEventEmitter:void 0)for(n=this.key,u=null!=(s=this.base._batman)?s.ancestors():void 0,r=0,o=u.length;o>r;r++)e=u[r],e.isEventEmitter&&(null!=(c=e._batman)?null!=(l=c.events)?l.hasOwnProperty(n):void 0:void 0)&&null!=(p=e.event(n,!1))&&null!=(h=p.handlers)&&h.slice().forEach(t)},t.prototype.clearHandlers=function(){return this.handlers=void 0},t.prototype.handlerContext=function(){return this.base},t.prototype.prevent=function(){return++this._preventCount},t.prototype.allow=function(){return this._preventCount&&--this._preventCount,this._preventCount},t.prototype.isPrevented=function(){return this._preventCount>0},t.prototype.autofireHandler=function(t){return this._oneShotFired&&null!=this._oneShotArgs?t.apply(this.handlerContext(),this._oneShotArgs):void 0},t.prototype.resetOneShot=function(){return this._oneShotFired=!1,this._oneShotArgs=null},t.prototype.fire=function(){return this.fireWithContext(this.handlerContext(),arguments)},t.prototype.fireWithContext=function(t,e){return this.isPrevented()||this._oneShotFired?!1:(this.oneShot&&(this._oneShotFired=!0,this._oneShotArgs=e),this.eachHandler(function(n){return n.apply(t,e)}))},t.prototype.allowAndFire=function(){return this.allowAndFireWithContext(this.handlerContext(),arguments)},t.prototype.allowAndFireWithContext=function(t,e){return this.allow(),this.fireWithContext(t,e)},t}()}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PropertyEvent=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.eachHandler=function(t){return this.eachObserver(t)},r.prototype.handlerContext=function(){return this.base},r}(Batman.Event)}.call(this),function(){var t=[].slice;Batman.EventEmitter={isEventEmitter:!0,hasEvent:function(t){var e,n;return null!=(e=this._batman)?"function"==typeof e.get?null!=(n=e.get("events"))?n.hasOwnProperty(t):void 0:void 0:void 0},event:function(t,e){var n,r,o,i,a,s,u,c,l,p,h,d;if(null==e&&(e=!0),Batman.initializeObject(this),r=this.eventClass||Batman.Event,null!=(l=this._batman.events)?l.hasOwnProperty(t):void 0)return i=this._batman.events[t];for(p=this._batman.ancestors(),u=0,c=p.length;c>u&&(n=p[u],!(i=null!=(h=n._batman)?null!=(d=h.events)?d[t]:void 0:void 0));u++);return e||(null!=i?i.oneShot:void 0)?(o=(s=this._batman).events||(s.events={}),a=o[t]=new r(this,t),a.oneShot=null!=i?i.oneShot:void 0,a):i},on:function(){var e,n,r,o,i,a;for(r=2<=arguments.length?t.call(arguments,0,o=arguments.length-1):(o=0,[]),e=arguments[o++],i=0,a=r.length;a>i;i++)n=r[i],this.event(n).addHandler(e);return!0},off:function(){var e,n,r,o,i,a;for(r=2<=arguments.length?t.call(arguments,0,o=arguments.length-1):(o=0,[]),e=arguments[o++],r.length||(n=e,this.event(n).clearHandlers()),i=0,a=r.length;a>i;i++)n=r[i],this.event(n).removeHandler(e);return!0},once:function(t,e){var n,r;return n=this.event(t),r=function(){return e.apply(this,arguments),n.removeHandler(r)},n.addHandler(r)},registerAsMutableSource:function(){return Batman.Property.registerSource(this)},mutate:function(t){var e;return this.prevent("change"),e=t.call(this),this.allowAndFire("change",this,this),e},mutation:function(t){return function(){var e,n;return e=t.apply(this,arguments),null!=(n=this.event("change",!1))&&n.fire(this,this),e}},prevent:function(t){return this.event(t).prevent(),this},allow:function(t){return this.event(t).allow(),this},fire:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],null!=(r=this.event(n,!1))?r.fireWithContext(this,e):void 0},allowAndFire:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],null!=(r=this.event(n,!1))?r.allowAndFireWithContext(this,e):void 0},isPrevented:function(t){var e;return null!=(e=this.event(t,!1))?e.isPrevented():void 0}}}.call(this),function(){var t,e=[].slice;Batman.LifecycleEvents={initialize:function(){return this.prototype.fireLifecycleEvent=t},lifecycleEvent:function(t,e){var n,r,o;return o="before"+Batman.helpers.camelize(t),r="after"+Batman.helpers.camelize(t),n=function(t){return function(n,r){var o,i,a,s,u;return"Object"===Batman.typeOf(n)&&(u=[r,n],n=u[0],r=u[1]),o="String"===Batman.typeOf(n)?function(){return this[n].apply(this,arguments)}:n,r=("function"==typeof e?e(r):void 0)||r,a=this.prototype||this,Batman.initializeObject(a),i=(s=a._batman)[t]||(s[t]=[]),i.push({options:r,callback:o})}},this[o]=n(o),this.prototype[o]=n(o),this[r]=n(r),this.prototype[r]=n(r)}},t=function(){var t,n,r,o,i,a,s,u;if(o=arguments[0],t=2<=arguments.length?e.call(arguments,1):[],r=this._batman.get(o))for(a=0,s=r.length;s>a;a++)if(u=r[a],i=u.options,n=u.callback,!((null!=i?i["if"]:0)&&!i["if"].apply(this,t)||(null!=i?i.unless:void 0)&&i.unless.apply(this,t)||n.apply(this,t)!==!1))return!1}}.call(this),function(){Batman.Enumerable={isEnumerable:!0,map:function(t,e){var n;return null==e&&(e=Batman.container),n=[],this.forEach(function(){return n.push(t.apply(e,arguments))}),n},mapToProperty:function(t){var e;return e=[],this.forEach(function(n){return e.push(Batman.get(n,t))}),e},every:function(t,e){var n;return null==e&&(e=Batman.container),n=!0,this.forEach(function(){return n=n&&!!t.apply(e,arguments)}),n},some:function(t,e){var n;return null==e&&(e=Batman.container),n=!1,this.forEach(function(){return n=n||!!t.apply(e,arguments)}),n},reduce:function(t,e){var n,r;return n=0,r=null!=e,this.forEach(function(o,i){return r?(e=t(e,o,i,n,self),n++):(e=o,r=!0,void 0)}),e},filter:function(t){var e,n,r=this;return e=new this.constructor,e.add?n=function(e,n,o){return t(n,o,r)&&e.add(n),e}:e.set?n=function(e,n,o){return t(n,o,r)&&e.set(n,o),e}:(e.push||(e=[]),n=function(e,n,o){return t(n,o,r)&&e.push(n),e}),this.reduce(n,e)},count:function(t,e){var n,r=this;return null==e&&(e=Batman.container),t?(n=0,this.forEach(function(o,i){return t.call(e,o,i,r)?n++:void 0}),n):this.length},inGroupsOf:function(t){var e,n,r;return r=[],e=!1,n=0,this.forEach(function(o){return 0===n++%t&&(e=[],r.push(e)),e.push(o)}),r}}}.call(this),function(){var t,e=[].slice;t=Object.prototype.toString,Batman.SimpleHash=function(){function n(t){this._storage={},this.length=0,null!=t&&this.update(t)}return Batman.extend(n.prototype,Batman.Enumerable),n.prototype.hasKey=function(t){var e,n,r,o;if(this.objectKey(t)){if(!this._objectStorage)return!1;if(n=this._objectStorage[this.hashKeyFor(t)])for(r=0,o=n.length;o>r;r++)if(e=n[r],this.equality(e[0],t))return!0;return!1}return t=this.prefixedKey(t),this._storage.hasOwnProperty(t)},n.prototype.getObject=function(t){var e,n,r,o;if(this._objectStorage&&(n=this._objectStorage[this.hashKeyFor(t)]))for(r=0,o=n.length;o>r;r++)if(e=n[r],this.equality(e[0],t))return e[1]},n.prototype.getString=function(t){return this._storage["_"+t]},n.prototype.setObject=function(t,e){var n,r,o,i,a,s;for(this._objectStorage||(this._objectStorage={}),r=(o=this._objectStorage)[s=this.hashKeyFor(t)]||(o[s]=[]),i=0,a=r.length;a>i;i++)if(n=r[i],this.equality(n[0],t))return n[1]=e;return this.length++,r.push([t,e]),e},n.prototype.setString=function(t,e){return t="_"+t,null==this._storage[t]&&this.length++,this._storage[t]=e},n.prototype.get=function(t){var e,n,r,o;if(!this.objectKey(t))return this._storage[this.prefixedKey(t)];if(this._objectStorage&&(n=this._objectStorage[this.hashKeyFor(t)]))for(r=0,o=n.length;o>r;r++)if(e=n[r],this.equality(e[0],t))return e[1]},n.prototype.set=function(t,e){var n,r,o,i,a,s;if(this.objectKey(t)){for(this._objectStorage||(this._objectStorage={}),r=(o=this._objectStorage)[s=this.hashKeyFor(t)]||(o[s]=[]),i=0,a=r.length;a>i;i++)if(n=r[i],this.equality(n[0],t))return n[1]=e;return this.length++,r.push([t,e]),e}return t=this.prefixedKey(t),null==this._storage[t]&&this.length++,this._storage[t]=e},n.prototype.unset=function(t){var e,n,r,o,i,a,s,u,c,l;if(!this.objectKey(t))return t=this.prefixedKey(t),a=this._storage[t],null!=this._storage[t]&&(this.length--,delete this._storage[t]),a;if(this._objectStorage&&(e=this.hashKeyFor(t),i=this._objectStorage[e]))for(n=u=0,c=i.length;c>u;n=++u)if(l=i[n],r=l[0],s=l[1],this.equality(r,t))return o=i.splice(n,1),i.length||delete this._objectStorage[e],this.length--,o[0][1]},n.prototype.getOrSet=function(t,e){var n;return n=this.get(t),n||(n=e(),this.set(t,n)),n},n.prototype.prefixedKey=function(t){return"_"+t},n.prototype.unprefixedKey=function(t){return t.slice(1)},n.prototype.hashKeyFor=function(e){var n,r;return(n=null!=e?"function"==typeof e.hashKey?e.hashKey():void 0:void 0)?n:(r=t.call(e),"[object Array]"===r?r:e)},n.prototype.equality=function(t,e){return t===e?!0:t!==t&&e!==e?!0:(null!=t?"function"==typeof t.isEqual?t.isEqual(e):void 0:void 0)&&(null!=e?"function"==typeof e.isEqual?e.isEqual(t):void 0:void 0)?!0:!1},n.prototype.objectKey=function(t){return"string"!=typeof t},n.prototype.forEach=function(t,e){var n,r,o,i,a,s,u,c,l,p,h;if(o=[],this._objectStorage){c=this._objectStorage;for(n in c)for(a=c[n],l=a.slice(),s=0,u=l.length;u>s;s++)p=l[s],r=p[0],i=p[1],o.push(t.call(e,r,i,this))}h=this._storage;for(n in h)i=h[n],o.push(t.call(e,this.unprefixedKey(n),i,this));return o},n.prototype.keys=function(){var t;return t=[],Batman.SimpleHash.prototype.forEach.call(this,function(e){return t.push(e)}),t},n.prototype.toArray=n.prototype.keys,n.prototype.clear=function(){return this._storage={},delete this._objectStorage,this.length=0},n.prototype.isEmpty=function(){return 0===this.length},n.prototype.merge=function(){var t,n,r,o,i;for(r=1<=arguments.length?e.call(arguments,0):[],n=new this.constructor,r.unshift(this),o=0,i=r.length;i>o;o++)t=r[o],t.forEach(function(t,e){return n.set(t,e)});return n},n.prototype.update=function(t){var e,n;for(e in t)n=t[e],this.set(e,n)},n.prototype.replace=function(t){var e=this;return this.forEach(function(n){return n in t?void 0:e.unset(n)}),this.update(t)},n.prototype.toObject=function(){var t,e,n,r,o,i;e={},o=this._storage;for(t in o)r=o[t],e[this.unprefixedKey(t)]=r;if(this._objectStorage){i=this._objectStorage;for(t in i)n=i[t],e[t]=n[0][1]}return e},n.prototype.toJSON=function(){var t,e,n,r,o,i,a,s;e={},i=this._storage;for(t in i)r=i[t],e[this.unprefixedKey(t)]=(null!=r?"function"==typeof r.toJSON?r.toJSON():void 0:void 0)||r;if(this._objectStorage){a=this._objectStorage;for(t in a)o=a[t],s=o[0],n=s[0],r=s[1],e[t]=(null!=r?"function"==typeof r.toJSON?r.toJSON():void 0:void 0)||r}return e},n}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.AssociationCurator=function(t){function r(t){this.model=t,r.__super__.constructor.call(this),this._byTypeStorage=new Batman.SimpleHash}return e(r,t),r.availableAssociations=["belongsTo","hasOne","hasMany"],r.prototype.add=function(t){var e;return this.set(t.label,t),(e=this._byTypeStorage.get(t.associationType))||(e=new Batman.SimpleSet,this._byTypeStorage.set(t.associationType,e)),e.add(t)},r.prototype.getByType=function(t){return this._byTypeStorage.get(t)},r.prototype.getByLabel=function(t){return this.get(t)},r.prototype.getAll=function(){var t,e,n;return e=this._byTypeStorage.map(function(t,e){return e}),t=(n=new Batman.SimpleSet).merge.apply(n,e)},r.prototype.reset=function(){return this.forEach(function(t,e){return e.reset()}),!0},r.prototype.merge=function(){var t,e;return t=1<=arguments.length?n.call(arguments,0):[],e=r.__super__.merge.apply(this,arguments),e._byTypeStorage=this._byTypeStorage.merge(t.map(function(t){return t._byTypeStorage})),e},r.prototype._markDirtyAttribute=function(t,e){var n;if("loading"!==(n=this.lifecycle.get("state"))&&"creating"!==n&&"saving"!==n&&"saved"!==n){if(this.lifecycle.startTransition("set"))return this.dirtyKeys.set(t,e);throw new Batman.StateMachine.InvalidTransitionError("Can't set while in state "+this.lifecycle.get("state"))}},r}(Batman.SimpleHash)}.call(this),function(){var t=[].slice;Batman.SimpleSet=function(){function e(){var t,e;this._storage=[],this.length=0,e=function(){var e,n,r;for(r=[],e=0,n=arguments.length;n>e;e++)t=arguments[e],null!=t&&r.push(t);return r}.apply(this,arguments),e.length>0&&this.add.apply(this,e)}return Batman.extend(e.prototype,Batman.Enumerable),e.prototype.at=function(t){return this._storage[t]},e.prototype.add=function(){var e,n,r,o,i;for(r=1<=arguments.length?t.call(arguments,0):[],e=[],o=0,i=r.length;i>o;o++)n=r[o],-1===this._indexOfItem(n)&&(this._storage.push(n),e.push(n));return this.length=this._storage.length,e},e.prototype.insert=function(){return this.insertWithIndexes.apply(this,arguments).addedItems},e.prototype.insertWithIndexes=function(t,e){var n,r,o,i,a,s,u;for(n=[],r=[],o=s=0,u=t.length;u>s;o=++s)a=t[o],-1===this._indexOfItem(a)&&(i=e[o],this._storage.splice(i,0,a),r.push(a),n.push(i));return this.length=this._storage.length,{addedItems:r,addedIndexes:n}},e.prototype.remove=function(){return this.removeWithIndexes.apply(this,arguments).removedItems},e.prototype.removeWithIndexes=function(){var e,n,r,o,i,a,s;for(r=1<=arguments.length?t.call(arguments,0):[],o=[],i=[],a=0,s=r.length;s>a;a++)n=r[a],-1!==(e=this._indexOfItem(n))&&(this._storage.splice(e,1),i.push(n),o.push(e));return this.length=this._storage.length,{removedItems:i,removedIndexes:o}},e.prototype.clear=function(){var t;return t=this._storage,this._storage=[],this.length=0,t},e.prototype.replace=function(t){return this.clear(),this.add.apply(this,t.toArray())},e.prototype.has=function(t){return-1!==this._indexOfItem(t)},e.prototype.find=function(t){var e,n,r,o;for(o=this._storage,n=0,r=o.length;r>n;n++)if(e=o[n],t(e))return e},e.prototype.forEach=function(t,e){var n,r,o,i;for(i=this._storage,r=0,o=i.length;o>r;r++)n=i[r],t.call(e,n,null,this)},e.prototype.isEmpty=function(){return 0===this.length},e.prototype.toArray=function(){return this._storage.slice()},e.prototype.merge=function(){var e,n,r,o,i;for(n=1<=arguments.length?t.call(arguments,0):[],e=new this.constructor,n.unshift(this),o=0,i=n.length;i>o;o++)r=n[o],r.forEach(function(t){return e.add(t)});return e},e.prototype.mappedTo=function(t){var e=this;return this._mappings||(this._mappings=new Batman.SimpleHash),this._mappings.getOrSet(t,function(){return new Batman.SetMapping(e,t)})},e.prototype.indexedBy=function(t){return this._indexes||(this._indexes=new Batman.SimpleHash),this._indexes.get(t)||this._indexes.set(t,new Batman.SetIndex(this,t))},e.prototype.indexedByUnique=function(t){return this._uniqueIndexes||(this._uniqueIndexes=new Batman.SimpleHash),this._uniqueIndexes.get(t)||this._uniqueIndexes.set(t,new Batman.UniqueSetIndex(this,t))},e.prototype.sortedBy=function(t,e){var n;return null==e&&(e="asc"),e="desc"===e.toLowerCase()?"desc":"asc",this._sorts||(this._sorts=new Batman.SimpleHash),n=this._sorts.get(t)||this._sorts.set(t,new Batman.Object),n.get(e)||n.set(e,new Batman.SetSort(this,t,e))},e.prototype.equality=Batman.SimpleHash.prototype.equality,e.prototype._indexOfItem=function(t){var e,n,r,o,i;for(i=this._storage,e=r=0,o=i.length;o>r;e=++r)if(n=i[e],this.equality(t,n))return e;return-1},e}()}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};t=[],e=!0,Batman.Property=function(n){function o(t,e){this.base=t,this.key=e}return r(o,n),o._sourceTrackerStack=t,o._sourceTrackerStackValid=e,o.defaultAccessor={get:function(t){return this[t]},set:function(t,e){return this[t]=e},unset:function(t){var e;return e=this[t],delete this[t],e},cache:!1},o.defaultAccessorForBase=function(t){var e;return(null!=(e=t._batman)?e.getFirst("defaultAccessor"):void 0)||Batman.Property.defaultAccessor},o.accessorForBaseAndKey=function(t,e){var n,r,o,i,a,s,u,c,l;if(null!=(o=t._batman)&&(n=null!=(s=o.keyAccessors)?s.get(e):void 0,!n))for(u=o.ancestors(),i=0,a=u.length;a>i&&(r=u[i],!(n=null!=(c=r._batman)?null!=(l=c.keyAccessors)?l.get(e):void 0:void 0));i++);return n||this.defaultAccessorForBase(t)},o.forBaseAndKey=function(t,e){return t.isObservable?t.property(e):new Batman.Keypath(t,e)},o.withoutTracking=function(t){return this.wrapTrackingPrevention(t)()},o.wrapTrackingPrevention=function(t){return function(){Batman.Property.pushDummySourceTracker();try{return t.apply(this,arguments)}finally{Batman.Property.popSourceTracker()}}},o.registerSource=function(n){var r;if(n.isEventEmitter||n instanceof Batman.Property)return e?r=t[t.length-1]:(r=[],t.push(r),e=!0),null!=r&&r.push(n),void 0},o.pushSourceTracker=function(){return e?e=!1:t.push([])},o.popSourceTracker=function(){return e?t.pop():(e=!0,void 0)},o.pushDummySourceTracker=function(){return e||(t.push([]),e=!0),t.push(null)
},o.prototype._isolationCount=0,o.prototype.cached=!1,o.prototype.value=null,o.prototype.sources=null,o.prototype.isProperty=!0,o.prototype.isDead=!1,o.prototype.isBatchingChanges=!1,o.prototype.registerAsMutableSource=function(){return Batman.Property.registerSource(this)},o.prototype.isEqual=function(t){return this.constructor===t.constructor&&this.base===t.base&&this.key===t.key},o.prototype.hashKey=function(){return this._hashKey||(this._hashKey="<Batman.Property base: "+Batman.Hash.prototype.hashKeyFor(this.base)+', key: "'+Batman.Hash.prototype.hashKeyFor(this.key)+'">')},o.prototype.accessor=function(){return this._accessor||(this._accessor=this.constructor.accessorForBaseAndKey(this.base,this.key))},o.prototype.eachObserver=function(t){var e,n,r,o,i,a,s,u,c,l,p,h,d,f;if(r=this.key,n=null!=(h=this.handlers)?h.slice():void 0)for(a=0,c=n.length;c>a;a++)o=n[a],t(o);if(this.base.isObservable)for(d=this.base._batman.ancestors(),s=0,l=d.length;l>s;s++)if(e=d[s],e.isObservable&&e.hasProperty(r)&&(i=e.property(r),n=null!=(f=i.handlers)?f.slice():void 0))for(u=0,p=n.length;p>u;u++)o=n[u],t(o)},o.prototype.observers=function(){var t;return t=[],this.eachObserver(function(e){return t.push(e)}),t},o.prototype.hasObservers=function(){return this.observers().length>0},o.prototype.updateSourcesFromTracker=function(){var t,e,n,r,o,i,a,s,u;if(e=this.constructor.popSourceTracker(),t=this.sourceChangeHandler(),this.sources)for(s=this.sources,r=0,i=s.length;i>r;r++)n=s[r],null!=n&&(n.on?n.off("change",t):n.removeHandler(t));if(this.sources=e,this.sources)for(u=this.sources,o=0,a=u.length;a>o;o++)n=u[o],null!=n&&(n.on?n.on("change",t):n.addHandler(t));return null},o.prototype.getValue=function(){if(this.registerAsMutableSource(),!this.isCached()){this.constructor.pushSourceTracker();try{this.value=this.valueFromAccessor(),this.cached=!0}finally{this.updateSourcesFromTracker()}}return this.value},o.prototype.isCachable=function(){var t;return this.isFinal()?!0:(t=this.accessor().cache,null!=t?!!t:!0)},o.prototype.isCached=function(){return this.isCachable()&&this.cached},o.prototype.isFinal=function(){return this.final||(this.final=!!this.accessor()["final"])},o.prototype.refresh=function(){var t,e;return this.cached=!1,t=this.value,e=this.getValue(),e===t||this.isIsolated()||this.fire(e,t,this.key),void 0!==this.value&&this.isFinal()?this.lockValue():void 0},o.prototype.sourceChangeHandler=function(){var t=this;return this._sourceChangeHandler||(this._sourceChangeHandler=function(){return t._handleSourceChange()}),Batman.developer["do"](function(){return t._sourceChangeHandler.property=t}),this._sourceChangeHandler},o.prototype._handleSourceChange=function(){return this.isIsolated()?this._needsRefresh=!0:this.isDead?this._removeHandlers():this.isFinal()||this.hasObservers()?this.isBatchingChanges?void 0:this.refresh():(this.cached=!1,this._removeHandlers())},o.prototype.valueFromAccessor=function(){var t;return null!=(t=this.accessor().get)?t.call(this.base,this.key):void 0},o.prototype.setValue=function(t){var e;if(e=this.accessor().set)return this._changeValue(function(){return e.call(this.base,this.key,t)})},o.prototype.unsetValue=function(){var t;if(t=this.accessor().unset)return this._changeValue(function(){return t.call(this.base,this.key)})},o.prototype._changeValue=function(t){var e;this.cached=!1,this.constructor.pushDummySourceTracker();try{e=t.apply(this),this.refresh()}finally{this.constructor.popSourceTracker()}return this.isCached()||this.hasObservers()||this.die(),e},o.prototype.forget=function(t){return null!=t?this.removeHandler(t):this.clearHandlers()},o.prototype.observeAndFire=function(t){return this.observe(t),t.call(this.base,this.value,this.value,this.key)},o.prototype.observe=function(t){return this.addHandler(t),null==this.sources&&this.getValue(),this},o.prototype.observeOnce=function(t){var e,n;return n=this,e=function(){return t.apply(this,arguments),n.removeHandler(e)},this.addHandler(e),null==this.sources&&this.getValue(),this},o.prototype._removeHandlers=function(){var t,e,n,r,o;if(t=this.sourceChangeHandler(),this.sources)for(o=this.sources,n=0,r=o.length;r>n;n++)e=o[n],e.on?e.off("change",t):e.removeHandler(t);return delete this.sources,this.clearHandlers()},o.prototype.lockValue=function(){return this._removeHandlers(),this.getValue=function(){return this.value},this.setValue=this.unsetValue=this.refresh=this.observe=function(){}},o.prototype.die=function(){var t,e;return this._removeHandlers(),null!=(t=this.base._batman)&&null!=(e=t.properties)&&e.unset(this.key),this.base=null,this.isDead=!0},o.prototype.isolate=function(){return 0===this._isolationCount&&(this._preIsolationValue=this.getValue()),this._isolationCount++},o.prototype.expose=function(){return 1===this._isolationCount?(this._isolationCount--,this._needsRefresh?(this.value=this._preIsolationValue,this.refresh()):this.value!==this._preIsolationValue&&this.fire(this.value,this._preIsolationValue,this.key),this._preIsolationValue=null):this._isolationCount>0?this._isolationCount--:void 0},o.prototype.isIsolated=function(){return this._isolationCount>0},o}(Batman.PropertyEvent)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Keypath=function(t){function n(t,e){"string"==typeof e?(this.segments=e.split("."),this.depth=this.segments.length):(this.segments=[e],this.depth=1),n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.isCachable=function(){return 1===this.depth?n.__super__.isCachable.apply(this,arguments):!0},n.prototype.terminalProperty=function(){var t;return t=Batman.getPath(this.base,this.segments.slice(0,-1)),null!=t?Batman.Keypath.forBaseAndKey(t,this.segments[this.depth-1]):void 0},n.prototype.valueFromAccessor=function(){return 1===this.depth?n.__super__.valueFromAccessor.apply(this,arguments):Batman.getPath(this.base,this.segments)},n.prototype.setValue=function(t){var e;return 1===this.depth?n.__super__.setValue.apply(this,arguments):null!=(e=this.terminalProperty())?e.setValue(t):void 0},n.prototype.unsetValue=function(){var t;return 1===this.depth?n.__super__.unsetValue.apply(this,arguments):null!=(t=this.terminalProperty())?t.unsetValue():void 0},n}(Batman.Property)}.call(this),function(){var t=[].slice;Batman.Observable={isObservable:!0,hasProperty:function(t){var e,n;return null!=(e=this._batman)?null!=(n=e.properties)?"function"==typeof n.hasKey?n.hasKey(t):void 0:void 0:void 0},property:function(t){var e,n,r;return Batman.initializeObject(this),n=this.propertyClass||Batman.Keypath,e=(r=this._batman).properties||(r.properties=new Batman.SimpleHash),e.objectKey(t)?e.getObject(t)||e.setObject(t,new n(this,t)):e.getString(t)||e.setString(t,new n(this,t))},get:function(t){return this.property(t).getValue()},set:function(t,e){return this.property(t).setValue(e)},unset:function(t){return this.property(t).unsetValue()},getOrSet:Batman.SimpleHash.prototype.getOrSet,forget:function(t,e){var n;return t?this.property(t).forget(e):null!=(n=this._batman.properties)&&n.forEach(function(t,e){return e.forget()}),this},observe:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],(r=this.property(n)).observe.apply(r,e),this},observeAndFire:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],(r=this.property(n)).observeAndFire.apply(r,e),this},observeOnce:function(){var e,n,r;return n=arguments[0],e=2<=arguments.length?t.call(arguments,1):[],(r=this.property(n)).observeOnce.apply(r,e),this}}}.call(this),function(){var t,e,n,r;for(Batman.DOM={textInputTypes:["text","search","tel","url","email","password"],scrollIntoView:function(t){var e;return null!=(e=document.getElementById(t))?"function"==typeof e.scrollIntoView?e.scrollIntoView():void 0:void 0},setStyleProperty:function(t,e,n,r){return t.style.setProperty?t.style.setProperty(e,n,r):t.style.setAttribute(e,n,r)},valueForNode:function(t,e,n){var r,o,i,a,s,u,c;switch(null==e&&(e=""),null==n&&(n=!0),o=arguments.length>1,i=t.nodeName.toUpperCase()){case"INPUT":case"TEXTAREA":return o?t.value=e:t.value;case"SELECT":if(o)return t.value=e;if(t.multiple){for(u=t.children,c=[],a=0,s=u.length;s>a;a++)r=u[a],r.selected&&c.push(r.value);return c}return t.value;default:return o?("OPTION"===i&&(t.text=e),Batman.DOM.setInnerHTML(t,n?Batman.escapeHTML(e):e)):t.innerHTML}},nodeIsEditable:function(t){var e;return"INPUT"===(e=t.nodeName.toUpperCase())||"TEXTAREA"===e||"SELECT"===e},addEventListener:function(t,e,n){var r;return(r=Batman._data(t,"listeners"))||(r=Batman._data(t,"listeners",{})),r[e]||(r[e]=[]),r[e].push(n),Batman.DOM.hasAddEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)},removeEventListener:function(t,e,n){var r,o,i;return(i=Batman._data(t,"listeners"))&&(r=i[e])&&(o=r.indexOf(n),-1!==o&&r.splice(o,1)),Batman.DOM.hasAddEventListener?t.removeEventListener(e,n,!1):t.detachEvent("on"+e,n)},cleanupNode:function(t){var e,n,r,o,i,a,s;if(o=Batman._data(t,"listeners"))for(r in o)n=o[r],n.forEach(function(e){return Batman.DOM.removeEventListener(t,r,e)});for(Batman.removeData(t,null,null,!0),s=t.childNodes,i=0,a=s.length;a>i;i++)e=s[i],Batman.DOM.cleanupNode(e)},hasAddEventListener:!!("undefined"!=typeof window&&null!==window?window.addEventListener:void 0),preventDefault:function(t){return"function"==typeof t.preventDefault?t.preventDefault():t.returnValue=!1},stopPropagation:function(t){return t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}},e=["querySelector","querySelectorAll","setInnerHTML","containsNode","destroyNode","textContent"],n=0,r=e.length;r>n;n++)t=e[n],Batman.DOM[t]=function(){return Batman.developer.error("Please include a platform adapter to define "+t+".")}}.call(this),function(){Batman.DOM.ReaderBindingDefinition=function(){function t(t,e,n){this.node=t,this.keyPath=e,this.view=n}return t}(),Batman.BindingDefinitionOnlyObserve={Data:"data",Node:"node",All:"all",None:"none"},Batman.DOM.readers={target:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Node,Batman.DOM.readers.bind(t)},source:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.readers.bind(t)},bind:function(t){var e,n;switch(n=t.node,n.nodeName.toLowerCase()){case"input":switch(n.getAttribute("type")){case"checkbox":return t.attr="checked",Batman.DOM.attrReaders.bind(t),!0;case"radio":e=Batman.DOM.RadioBinding;break;case"file":e=Batman.DOM.FileBinding}break;case"select":e=Batman.DOM.SelectBinding}return e||(e=Batman.DOM.ValueBinding),new e(t)},context:function(t){return new Batman.DOM.ContextBinding(t)},showif:function(t){return new Batman.DOM.ShowHideBinding(t)},hideif:function(t){return t.invert=!0,new Batman.DOM.ShowHideBinding(t)},insertif:function(t){return new Batman.DOM.InsertionBinding(t)},removeif:function(t){return t.invert=!0,new Batman.DOM.InsertionBinding(t)},deferif:function(t){return t.invert=!0,new Batman.DOM.DeferredRenderBinding(t)},renderif:function(t){return new Batman.DOM.DeferredRenderBinding(t)},route:function(t){return new Batman.DOM.RouteBinding(t)},view:function(t){return new Batman.DOM.ViewBinding(t)},partial:function(t){var e,n,r,o;return n=t.node,e=t.keyPath,o=t.view,n.removeAttribute("data-partial"),r=new Batman.View({source:e,parentNode:n,node:n}),{skipChildren:!0,initialized:function(){return r.loadView(n),o.subviews.add(r)}}},defineview:function(t){var e,n,r;return n=t.node,r=t.view,e=t.keyPath,Batman.View.store.set(Batman.Navigator.normalizePath(e),n.innerHTML),{skipChildren:!0,initialized:function(){return n.parentNode?n.parentNode.removeChild(n):void 0}}},contentfor:function(t){var e,n,r,o;return r=t.node,n=t.keyPath,o=t.view,e=new Batman.View({html:r.innerHTML,contentFor:n}),e.addToParentNode=function(t){return t.innerHTML="",t.appendChild(this.get("node"))},o.subviews.add(e),{skipChildren:!0,initialized:function(){return r.parentNode?r.parentNode.removeChild(r):void 0}}},yield:function(t){var e;return e=Batman.DOM.Yield.withName(t.keyPath),e.set("containerNode",t.node),{skipChildren:!0}}}}.call(this),function(){var t=[].slice,e=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.DOM.events={primaryInteractionEvent:function(e,n,r,o,i){return null==o&&(o=Batman.DOM.primaryInteractionEventName),null==i&&(i=!0),Batman.DOM.addEventListener(e,o,function(){var a,s;return s=arguments[0],a=2<=arguments.length?t.call(arguments,1):[],s.metaKey||s.ctrlKey||1===s.button||(i&&Batman.DOM.preventDefault(s),!Batman.DOM.eventIsAllowed(o,s))?void 0:n.apply(null,[e,s].concat(t.call(a),[r]))}),"A"!==e.nodeName.toUpperCase()||e.href||(e.href="#"),e},click:function(t,e,n,r,o){return null==r&&(r="click"),null==o&&(o=!0),Batman.DOM.events.primaryInteractionEvent(t,e,n,r,o)},doubleclick:function(t,e,n){return Batman.DOM.events.click(t,e,n,"dblclick")},change:function(n,r,o){var i,a,s,u,c;for(a=function(){var t;switch(n.nodeName.toUpperCase()){case"TEXTAREA":return["input","keyup","change"];case"INPUT":return t=n.type.toLowerCase(),e.call(Batman.DOM.textInputTypes,t)>=0?(s=r,r=function(t,e,n){return"keyup"===e.type&&Batman.DOM.events.isEnter(e)?void 0:s(t,e,n)},["input","keyup","change"]):["input","change"];default:return["change"]}}(),u=0,c=a.length;c>u;u++)i=a[u],Batman.DOM.addEventListener(n,i,function(){var e;return e=1<=arguments.length?t.call(arguments,0):[],r.apply(null,[n].concat(t.call(e),[o]))})},isEnter:function(t){var e,n;return 13<=(e=t.keyCode)&&14>=e||13<=(n=t.which)&&14>=n||"Enter"===t.keyIdentifier||"Enter"===t.key},submit:function(e,n,r){return Batman.DOM.nodeIsEditable(e)?(Batman.DOM.addEventListener(e,"keydown",function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],Batman.DOM.events.isEnter(n[0])?Batman.DOM._keyCapturingNode=e:void 0}),Batman.DOM.addEventListener(e,"keyup",function(){var o;return o=1<=arguments.length?t.call(arguments,0):[],Batman.DOM.events.isEnter(o[0])?(Batman.DOM._keyCapturingNode===e&&(Batman.DOM.preventDefault(o[0]),n.apply(null,[e].concat(t.call(o),[r]))),Batman.DOM._keyCapturingNode=null):void 0})):Batman.DOM.addEventListener(e,"submit",function(){var o;return o=1<=arguments.length?t.call(arguments,0):[],Batman.DOM.preventDefault(o[0]),n.apply(null,[e].concat(t.call(o),[r]))}),e},other:function(e,n,r,o){return Batman.DOM.addEventListener(e,n,function(){var n;return n=1<=arguments.length?t.call(arguments,0):[],r.apply(null,[e].concat(t.call(n),[o]))})}},Batman.DOM.eventIsAllowed=function(t,e){var n,r,o;return(n=null!=(r=Batman.currentApp)?null!=(o=r.shouldAllowEvent)?o[t]:void 0:void 0)&&n(e)===!1?!1:!0},Batman.DOM.primaryInteractionEventName="click"}.call(this),function(){Batman.DOM.AttrReaderBindingDefinition=function(){function t(t,e,n,r){this.node=t,this.attr=e,this.keyPath=n,this.view=r}return t}(),Batman.DOM.attrReaders={_parseAttribute:function(t){return"false"===t&&(t=!1),"true"===t&&(t=!0),t},source:function(t){return t.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,Batman.DOM.attrReaders.bind(t)},bind:function(t){var e;return e=function(){switch(t.attr){case"checked":case"disabled":case"selected":return Batman.DOM.CheckedBinding;case"value":case"href":case"src":case"size":return Batman.DOM.NodeAttributeBinding;case"class":return Batman.DOM.ClassBinding;case"style":return Batman.DOM.StyleBinding;default:return Batman.DOM.AttributeBinding}}(),new e(t)},context:function(t){return new Batman.DOM.ContextBinding(t)},event:function(t){return new Batman.DOM.EventBinding(t)},track:function(t){return"view"===t.attr?new Batman.DOM.ViewTrackingBinding(t):"click"===t.attr?new Batman.DOM.ClickTrackingBinding(t):void 0},addclass:function(t){return new Batman.DOM.AddClassBinding(t)},removeclass:function(t){return t.invert=!0,new Batman.DOM.AddClassBinding(t)},foreach:function(t){return new Batman.DOM.IteratorBinding(t)},formfor:function(t){return new Batman.DOM.FormBinding(t)},style:function(t){return new Batman.DOM.StyleAttributeBinding(t)}}}.call(this),function(){var t,e,n,r,o,i=[].slice,a={}.hasOwnProperty,s=function(t,e){function n(){this.constructor=t}for(var r in e)a.call(e,r)&&(t[r]=e[r]);return n.prototype=e.prototype,t.prototype=new n,t.__super__=e.prototype,t};n=function(t,e){var n,r,o,i;for("function"==typeof e&&(e={get:e}),i=["cachable","cacheable"],r=0,o=i.length;o>r;r++)n=i[r],n in e&&(Batman.developer.warn('Property accessor option "'+n+'" is deprecated. Use "cache" instead.'),"cache"in e||(e.cache=e[n]));return e},r=function(t){return function(e){return{get:function(n){var r,o,i,a,s,u=this;return null!=(o=e.get.apply(this,arguments))?o:(r=!1,i=void 0,null==(a=this._batman).promises&&(a.promises={}),null==(s=this._batman.promises)[n]&&(s[n]=function(){var e,o;return e=function(t,e){return r&&u.set(n,e),i=e},o=t.call(u,e,n),null==i&&(i=o),!0}()),r=!0,i)},cache:!0}}},o=function(t,e){var n,r;e=("function"==typeof e?e(t):void 0)||e;for(n in t)r=t[n],n in e||(e[n]=r);return e},e={_defineAccessor:function(){var t,e,o,a,s,u,c,l;if(o=2<=arguments.length?i.call(arguments,0,s=arguments.length-1):(s=0,[]),t=arguments[s++],null==t)return Batman.Property.defaultAccessorForBase(this);if(0===o.length&&"Object"!==(l=Batman.typeOf(t))&&"Function"!==l)return Batman.Property.accessorForBaseAndKey(this,t);if("function"==typeof t.promise)return this._defineWrapAccessor.apply(this,i.call(o).concat([r(t.promise)]));if(Batman.initializeObject(this),0===o.length)this._batman.defaultAccessor=n(this,t);else for((a=this._batman).keyAccessors||(a.keyAccessors=new Batman.SimpleHash),u=0,c=o.length;c>u;u++)e=o[u],this._batman.keyAccessors.set(e,n(this,t));return!0},_defineWrapAccessor:function(){var t,e,n,r,a,s;if(e=2<=arguments.length?i.call(arguments,0,r=arguments.length-1):(r=0,[]),n=arguments[r++],Batman.initializeObject(this),0===e.length)this._defineAccessor(o(this._defineAccessor(),n));else for(a=0,s=e.length;s>a;a++)t=e[a],this._defineAccessor(t,o(this._defineAccessor(t),n));return!0},_resetPromises:function(){var t;if(null!=this._batman.promises)for(t in this._batman.promises)this._resetPromise(t)},_resetPromise:function(t){this.unset(t),this.property(t).cached=!1,delete this._batman.promises[t]}},t=function(t){function n(){var t;t=1<=arguments.length?i.call(arguments,0):[],this._batman=new Batman._Batman(this),this.mixin.apply(this,t)}var r;return s(n,t),Batman.initializeObject(n),Batman.initializeObject(n.prototype),Batman.mixin(n.prototype,e,Batman.EventEmitter,Batman.Observable),Batman.mixin(n,e,Batman.EventEmitter,Batman.Observable),n.classMixin=function(){return Batman.mixin.apply(Batman,[this].concat(i.call(arguments)))},n.mixin=function(){return this.classMixin.apply(this.prototype,arguments)},n.prototype.mixin=n.classMixin,n.classAccessor=n._defineAccessor,n.accessor=function(){var t;return(t=this.prototype)._defineAccessor.apply(t,arguments)},n.prototype.accessor=n._defineAccessor,n.wrapClassAccessor=n._defineWrapAccessor,n.wrapAccessor=function(){var t;return(t=this.prototype)._defineWrapAccessor.apply(t,arguments)},n.prototype.wrapAccessor=n._defineWrapAccessor,n.observeAll=function(){return this.prototype.observe.apply(this.prototype,arguments)},n.singleton=function(t){return null==t&&(t="sharedInstance"),this.classAccessor(t,{get:function(){var e;return this[e="_"+t]||(this[e]=new this)}})},n.accessor("_batmanID",function(){return this._batmanID()}),n.delegate=function(){var t,e,n,r=this;return e=2<=arguments.length?i.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++],null==t&&(t={}),t.to||Batman.developer.warn("delegate must include to option",this,e),e.forEach(function(e){return r.accessor(e,{get:function(){var n;return null!=(n=this.get(t.to))?n.get(e):void 0},set:function(n,r){var o;return null!=(o=this.get(t.to))?o.set(e,r):void 0},unset:function(){var n;return null!=(n=this.get(t.to))?n.unset(e):void 0}})})},n.classDelegate=function(){var t,e,n,r=this;return e=2<=arguments.length?i.call(arguments,0,n=arguments.length-1):(n=0,[]),t=arguments[n++],null==t&&(t={}),t.to||Batman.developer.warn("delegate must include to option",this,e),e.forEach(function(e){return r.classAccessor(e,{get:function(){var n;return null!=(n=this.get(t.to))?n.get(e):void 0},set:function(n,r){var o;return null!=(o=this.get(t.to))?o.set(e,r):void 0},unset:function(){var n;return null!=(n=this.get(t.to))?n.unset(e):void 0}})})},r=0,n.prototype._batmanID=function(){var t;return this._batman.check(this),null==(t=this._batman).id&&(t.id=r++),this._batman.id},n.prototype.hashKey=function(){var t;if("function"!=typeof this.isEqual)return(t=this._batman).hashKey||(t.hashKey="<Batman.Object "+this._batmanID()+">")},n.prototype.toJSON=function(){var t,e,n;e={};for(t in this)a.call(this,t)&&(n=this[t],"_batman"!==t&&"hashKey"!==t&&"_batmanID"!==t&&(e[t]=(null!=n?n.toJSON:void 0)?n.toJSON():n));return e},n.prototype.batchAccessorChanges=function(){var t,e,n,r,o,a,s,u,c,l,p;for(n=2<=arguments.length?i.call(arguments,0,s=arguments.length-1):(s=0,[]),a=arguments[s++],t=u=0,l=n.length;l>u;t=++u)e=n[t],r=n[t]=this.property(e),r.isBatchingChanges=!0;for(o=a.call(this),c=0,p=n.length;p>c;c++)r=n[c],r.isBatchingChanges=!1,r.refresh();return o},n}(Object),Batman.Object=t}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.BindingParser=function(t){function n(t){this.view=t,n.__super__.constructor.call(this),this.node=this.view.node,this.parseTree(this.node)}var r,o,i,a,s,u,c;for(e(n,t),r=["defineview","foreach","renderif","view","formfor","context","bind","source","target","track","event"],s=["foreach","renderif","formfor","context"],o={},a=u=0,c=r.length;c>u;a=++u)i=r[a],o[i]=a;return n.prototype._sortBindings=function(t,e){var n,i;return n=o[t[0]],i=o[e[0]],null==n&&(n=r.length),null==i&&(i=r.length),n>i?1:i>n?-1:t[0]>e[0]?1:e[0]>t[0]?-1:0},n.prototype.parseTree=function(t){for(var e;t;)e=this.parseNode(t),t=this.nextNode(t,e);this.fire("bindingsInitialized")},n.prototype.parseNode=function(t){var e,n,r,o,a,u,c,l,p,h,d,f,m,y,g,v,_,B;if(l=!1,t.getAttribute&&t.attributes){for(c=[],g=t.attributes,d=0,m=g.length;m>d;d++)r=g[d],"data-"===(null!=(v=r.nodeName)?v.substr(0,5):void 0)&&(i=r.nodeName.substr(5),n=i.indexOf("-"),c.push(-1!==n?[i.substr(0,n),i.substr(n+1),r.value]:[i,void 0,r.value]));for(_=c.sort(this._sortBindings),f=0,y=_.length;y>f;f++)if(B=_[f],i=B[0],e=B[1],h=B[2],!l||-1!==s.indexOf(i)){if(a=e?(p=Batman.DOM.attrReaders[i])?(u=new Batman.DOM.AttrReaderBindingDefinition(t,e,h,this.view),p(u)):void 0:(p=Batman.DOM.readers[i])?(u=new Batman.DOM.ReaderBindingDefinition(t,h,this.view),p(u)):void 0,(null!=a?a.initialized:void 0)&&this.once("bindingsInitialized",function(t){return function(){return t.initialized.call(t)}}(a)),null!=a?a.skipChildren:void 0)return!0;(null!=a?a.backWithView:void 0)&&(l=!0)}}return l&&(o=Batman._data(t,"view"))&&o.initializeBindings(),l},n.prototype.nextNode=function(t,e){var n,r,o,i;if(!e&&(n=t.childNodes,null!=n?n.length:void 0))return n[0];if(i=t.nextSibling,this.node!==t){if(i)return i;for(r=t;r=r.parentNode;){if(o=r.nextSibling,this.node===r)return;if(o)return o}}},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ValidationError=function(t){function n(t,e){n.__super__.constructor.call(this,{attribute:t,message:e})}return e(n,t),n.accessor("fullMessage",function(){return"base"===this.attribute?Batman.t("errors.base.format",{message:this.message}):Batman.t("errors.format",{attribute:Batman.helpers.humanize(Batman.ValidationError.singularizeAssociated(this.attribute)),message:this.message})}),n.singularizeAssociated=function(t){var e,n,r,o;for(n=t.split("."),e=r=0,o=n.length-1;o>r;e=r+=1)n[e]=Batman.helpers.singularize(n[e]);return n.join(" ")},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.StorageAdapter=function(t){function r(t){var e;r.__super__.constructor.call(this,{model:t}),e=this.constructor,e.ModelMixin&&Batman.extend(t,e.ModelMixin),e.RecordMixin&&Batman.extend(t.prototype,e.RecordMixin)}return e(r,t),r.StorageError=function(t){function n(t){n.__super__.constructor.apply(this,arguments),this.message=t}return e(n,t),n.prototype.name="StorageError",n}(Error),r.RecordExistsError=function(t){function n(t){n.__super__.constructor.call(this,t||"Can't create this record because it already exists in the store!")}return e(n,t),n.prototype.name="RecordExistsError",n}(r.StorageError),r.NotFoundError=function(t){function n(t){n.__super__.constructor.call(this,t||"Record couldn't be found in storage!")}return e(n,t),n.prototype.name="NotFoundError",n}(r.StorageError),r.UnauthorizedError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage operation denied due to invalid credentials!")}return e(n,t),n.prototype.name="UnauthorizedError",n}(r.StorageError),r.NotAllowedError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage operation denied access to the operation!")}return e(n,t),n.prototype.name="NotAllowedError",n}(r.StorageError),r.NotAcceptableError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage operation permitted but the request was malformed!")}return e(n,t),n.prototype.name="NotAcceptableError",n}(r.StorageError),r.EntityTooLargeError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage operation denied due to size constraints!")}return e(n,t),n.prototype.name="EntityTooLargeError",n}(r.StorageError),r.UnprocessableRecordError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage adapter could not process the record!")}return e(n,t),n.prototype.name="UnprocessableRecordError",n}(r.StorageError),r.InternalStorageError=function(t){function n(t){n.__super__.constructor.call(this,t||"An error occurred during the storage operation!")}return e(n,t),n.prototype.name="InternalStorageError",n}(r.StorageError),r.NotImplementedError=function(t){function n(t){n.__super__.constructor.call(this,t||"This operation is not implemented by the storage adapter!")}return e(n,t),n.prototype.name="NotImplementedError",n}(r.StorageError),r.BadGatewayError=function(t){function n(t){n.__super__.constructor.call(this,t||"Storage operation failed due to unavailability of the backend!")}return e(n,t),n.prototype.name="BadGatewayError",n}(r.StorageError),r.prototype.isStorageAdapter=!0,r.prototype.onlyCertainAttributes=function(t,e){var n;for(n in t)e.indexOf(n)<0&&delete t[n];return t},r.prototype.exceptCertainAttributes=function(t,e){var n,r,o;for(r=0,o=e.length;o>r;r++)n=e[r],delete t[n];return t},r.prototype.storageKey=function(t){var e;return e=(null!=t?t.constructor:void 0)||this.model,e.get("storageKey")||Batman.helpers.pluralize(Batman.helpers.underscore(e.get("resourceName")))},r.prototype.getRecordFromData=function(t,e){return null==e&&(e=this.model),e.createFromJSON(t)},r.prototype.getRecordsFromData=function(t,e){return null==e&&(e=this.model),e.createMultipleFromJSON(t)},r.skipIfError=function(t){return function(e,n){return null!=e.error?n():t.call(this,e,n)}},r.prototype.before=function(){return this._addFilter.apply(this,["before"].concat(n.call(arguments)))},r.prototype.after=function(){return this._addFilter.apply(this,["after"].concat(n.call(arguments)))},r.prototype._inheritFilters=function(){var t,e,n,r,o;if(!(this._batman.check(this)&&this._batman.filters||(r=this._batman.getFirst("filters"),this._batman.filters={before:{},after:{}},null==r)))for(o in r){t=r[o];for(n in t)e=t[n],this._batman.filters[o][n]=e.slice(0)}return!0},r.prototype._addFilter=function(){var t,e,r,o,i,a,s,u;for(o=arguments[0],r=3<=arguments.length?n.call(arguments,1,a=arguments.length-1):(a=1,[]),t=arguments[a++],this._inheritFilters(),s=0,u=r.length;u>s;s++)e=r[s],(i=this._batman.filters[o])[e]||(i[e]=[]),this._batman.filters[o][e].push(t);return!0},r.prototype.runFilter=function(t,e,n,r){var o,i,a,s,u=this;return this._inheritFilters(),i=this._batman.filters[t].all||[],o=this._batman.filters[t][e]||[],n.action=e,a="before"===t?o.concat(i):i.concat(o),s=function(t){var e;return null!=t&&(n=t),null!=(e=a.shift())?e.call(u,n,s):r.call(u,n)},s()},r.prototype.runBeforeFilter=function(){return this.runFilter.apply(this,["before"].concat(n.call(arguments)))},r.prototype.runAfterFilter=function(t,e,n){return this.runFilter("after",t,e,this.exportResult(n))},r.prototype.exportResult=function(t){return function(e){return t(e.error,e.result,e)}},r.prototype._jsonToAttributes=function(t){return JSON.parse(t)},r.prototype.perform=function(t,e,n,r){var o,i,a=this;return n||(n={}),o={options:n,subject:e},i=function(e){return null!=e&&(o=e),a.runAfterFilter(t,o,r)},this.runBeforeFilter(t,o,function(e){return this[t](e,i)}),void 0},r}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice,r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1};Batman.RestStorage=function(t){function o(){o.__super__.constructor.apply(this,arguments),this.defaultRequestOptions=Batman.extend({},this.defaultRequestOptions)}var i,a,s,u,c;for(e(o,t),o.CommunicationError=function(t){function n(t){n.__super__.constructor.call(this,t||"A communication error has occurred!")}return e(n,t),n.prototype.name="CommunicationError",n}(o.StorageError),o.JSONContentType="application/json",o.PostBodyContentType="application/x-www-form-urlencoded",o.BaseMixin={request:function(t,e,n){return n||(n=e,e={}),e.method||(e.method="GET"),e.action=t,this._doStorageOperation(e.method.toLowerCase(),e,n)}},o.ModelMixin=Batman.extend({},o.BaseMixin,{urlNestsUnder:function(){var t,e,r,o,i;for(e=1<=arguments.length?n.call(arguments,0):[],r={},o=0,i=e.length;i>o;o++)t=e[o],r[t+"_id"]=Batman.helpers.pluralize(t);return this.url=function(e){var n,o,i;n=this.storageKey||Batman.helpers.pluralize(this.get("resourceName").toLowerCase());for(t in r)if(i=r[t],o=e.data[t])return delete e.data[t],""+i+"/"+o+"/"+n;return n},this.prototype.url=function(){var e,n,o,i,a;e=this.constructor.storageKey||Batman.helpers.pluralize(this.constructor.get("resourceName").toLowerCase());for(t in r)if(i=r[t],o=this.get("dirtyKeys").get(t),void 0===o&&(o=this.get(t)),o){a=""+i+"/"+o+"/"+e;break}return a||(a=e),(n=this.get("id"))&&(a+="/"+n),a}}}),o.RecordMixin=Batman.extend({},o.BaseMixin),o.prototype.defaultRequestOptions={type:"json"},o.prototype._implicitActionNames=["create","read","update","destroy","readAll"],o.prototype.serializeAsForm=!0,o.prototype.recordJsonNamespace=function(t){return Batman.helpers.singularize(this.storageKey(t))},o.prototype.collectionJsonNamespace=function(t){return Batman.helpers.pluralize(this.storageKey(t.prototype))},o.prototype._execWithOptions=function(t,e,n,r){return null==r&&(r=t),"function"==typeof t[e]?t[e].call(r,n):t[e]},o.prototype._defaultCollectionUrl=function(t){return""+this.storageKey(t.prototype)},o.prototype._addParams=function(t,e){var n;return!e||!e.action||(n=e.action,r.call(this._implicitActionNames,n)>=0)||(t+="/"+e.action.toLowerCase()),t},o.prototype._addUrlAffixes=function(t,e,n){var r,o;return o=[t,this.urlSuffix(e,n)],"/"!==t.charAt(0)&&(r=this.urlPrefix(e,n),"/"!==r.charAt(r.length-1)&&o.unshift("/"),o.unshift(r)),o.join("")},o.prototype.urlPrefix=function(t,e){return this._execWithOptions(t,"urlPrefix",e.options)||""
},o.prototype.urlSuffix=function(t,e){return this._execWithOptions(t,"urlSuffix",e.options)||""},o.prototype.urlForRecord=function(t,e){var n,r,o;if(null!=(o=e.options)?o.recordUrl:void 0)r=this._execWithOptions(e.options,"recordUrl",e.options,t);else if(t.url)r=this._execWithOptions(t,"url",e.options);else if(r=t.constructor.url?this._execWithOptions(t.constructor,"url",e.options):this._defaultCollectionUrl(t.constructor),"create"!==e.action){if(null==(n=t.get("id")))throw new this.constructor.StorageError("Couldn't get/set record primary key on "+e.action+"!");r=r+"/"+n}return this._addUrlAffixes(this._addParams(r,e.options),t,e)},o.prototype.urlForCollection=function(t,e){var n,r;return n=(null!=(r=e.options)?r.collectionUrl:void 0)?this._execWithOptions(e.options,"collectionUrl",e.options,e.options.urlContext):t.url?this._execWithOptions(t,"url",e.options):this._defaultCollectionUrl(t,e.options),this._addUrlAffixes(this._addParams(n,e.options),t,e)},o.prototype.request=function(t,e){var n;return n=Batman.extend(t.options,{autosend:!1,success:function(e){return t.data=e},error:function(e){return t.error=e},loaded:function(){return t.response=t.request.get("response"),e()}}),t.request=new Batman.Request(n),t.request.send()},o.prototype.perform=function(t,e,n,r){return n||(n={}),Batman.extend(n,this.defaultRequestOptions),o.__super__.perform.call(this,t,e,n,r)},o.prototype.before("all",o.skipIfError(function(t,e){var n;if(!t.options.url)try{t.options.url=t.subject.prototype?this.urlForCollection(t.subject,t):this.urlForRecord(t.subject,t)}catch(r){n=r,t.error=n}return e()})),o.prototype.before("get","put","post","delete",o.skipIfError(function(t,e){return t.options.method=t.action.toUpperCase(),e()})),o.prototype.before("create","update",o.skipIfError(function(t,e){var n,r,o;return r=t.subject.toJSON(),t.options.only&&(r=this.onlyCertainAttributes(r,t.options.only)),t.options.except&&(r=this.exceptCertainAttributes(r,t.options.except)),(o=this.recordJsonNamespace(t.subject))?(n={},n[o]=r):n=r,t.options.data=n,e()})),o.prototype.before("create","update","put","post",o.skipIfError(function(t,e){return this.serializeAsForm?t.options.contentType=this.constructor.PostBodyContentType:null!=t.options.data&&(t.options.data=JSON.stringify(t.options.data),t.options.contentType=this.constructor.JSONContentType),e()})),o.prototype.after("all",o.skipIfError(function(t,e){var n,r;if(null==t.data)return e();if("string"==typeof t.data){if(t.data.length>0)try{r=this._jsonToAttributes(t.data)}catch(o){return n=o,t.error=n,e()}}else"object"==typeof t.data&&(r=t.data);return null!=r&&(t.json=r),e()})),o.prototype.extractFromNamespace=function(t,e){return e&&null!=t[e]?t[e]:t},o.prototype.after("create","read","update",o.skipIfError(function(t,e){var n;return null!=t.json&&(n=this.extractFromNamespace(t.json,this.recordJsonNamespace(t.subject)),t.subject._withoutDirtyTracking(function(){return this.fromJSON(n)})),t.result=t.subject,e()})),o.prototype.after("readAll",o.skipIfError(function(t,e){var n;return n=this.collectionJsonNamespace(t.subject),t.recordsAttributes=this.extractFromNamespace(t.json,n),"Array"!==Batman.typeOf(t.recordsAttributes)&&(n=this.recordJsonNamespace(t.subject.prototype),t.recordsAttributes=[this.extractFromNamespace(t.json,n)]),t.result=t.records=this.getRecordsFromData(t.recordsAttributes,t.subject),e()})),o.prototype.after("get","put","post","delete",o.skipIfError(function(t,e){var n;return null!=t.json&&(n=t.subject.prototype?this.collectionJsonNamespace(t.subject):this.recordJsonNamespace(t.subject),t.result=this.extractFromNamespace(t.json,n)),e()})),o.HTTPMethods={create:"POST",update:"PUT",read:"GET",readAll:"GET",destroy:"DELETE"},c=["create","read","update","destroy","readAll","get","post","put","delete"],a=function(t){return o.prototype[t]=o.skipIfError(function(e,n){var r;return(r=e.options).method||(r.method=this.constructor.HTTPMethods[t]),this.request(e,n)})},s=0,u=c.length;u>s;s++)i=c[s],a(i);return o.prototype.after("all",function(t,e){return t.error&&(t.error=this._errorFor(t.error,t)),e()}),o._statusCodeErrors={0:o.CommunicationError,401:o.UnauthorizedError,403:o.NotAllowedError,404:o.NotFoundError,406:o.NotAcceptableError,409:o.RecordExistsError,413:o.EntityTooLargeError,422:o.UnprocessableRecordError,500:o.InternalStorageError,501:o.NotImplementedError,502:o.BadGatewayError},o.prototype._errorFor=function(t,e){var n,r;return t instanceof Error||null==t.request?t:((n=this.constructor._statusCodeErrors[t.request.status])&&(r=t.request,t=new n,t.request=r,t.env=e),t)},o}.call(this,Batman.StorageAdapter)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.LocalStorage=function(t){function n(){return"undefined"==typeof window.localStorage?null:(n.__super__.constructor.apply(this,arguments),this.storage=localStorage,void 0)}return e(n,t),n.prototype.storageRegExpForRecord=function(t){return new RegExp("^"+this.storageKey(t)+"(\\d+)$")},n.prototype.nextIdForRecord=function(t){var e,n;return n=this.storageRegExpForRecord(t),e=1,this._forAllStorageEntries(function(t){var r;return(r=n.exec(t))?e=Math.max(e,parseInt(r[1],10)+1):void 0}),e},n.prototype._forAllStorageEntries=function(t){var e,n,r,o;for(e=r=0,o=this.storage.length;o>=0?o>r:r>o;e=o>=0?++r:--r)n=this.storage.key(e),t.call(this,n,this.storage.getItem(n));return!0},n.prototype._storageEntriesMatching=function(t,e){var n,r;return n=this.storageRegExpForRecord(t.prototype),r=[],this._forAllStorageEntries(function(o,i){var a,s;return(s=n.exec(o))&&(a=this._jsonToAttributes(i),a[t.primaryKey]=s[1],this._dataMatches(e,a))?r.push(a):void 0}),r},n.prototype._dataMatches=function(t,e){var n,r,o;r=!0;for(n in t)if(o=t[n],e[n]!==o){r=!1;break}return r},n.prototype.before("read","create","update","destroy",n.skipIfError(function(t,e){var n=this;return t.id="create"===t.action?t.subject.get("id")||t.subject._withoutDirtyTracking(function(){return t.subject.set("id",n.nextIdForRecord(t.subject))}):t.subject.get("id"),null==t.id?t.error=new this.constructor.StorageError("Couldn't get/set record primary key on "+t.action+"!"):t.key=this.storageKey(t.subject)+t.id,e()})),n.prototype.before("create","update",n.skipIfError(function(t,e){var n;return n=t.subject.toJSON(),t.options.only&&(n=this.onlyCertainAttributes(n,t.options.only)),t.options.except&&(n=this.exceptCertainAttributes(n,t.options.except)),t.recordAttributes=JSON.stringify(n),e()})),n.prototype.after("read",n.skipIfError(function(t,e){var n;if("string"==typeof t.recordAttributes)try{t.recordAttributes=this._jsonToAttributes(t.recordAttributes)}catch(r){return n=r,t.error=n,e()}return t.subject._withoutDirtyTracking(function(){return this.fromJSON(t.recordAttributes)}),e()})),n.prototype.after("read","create","update","destroy",n.skipIfError(function(t,e){return t.result=t.subject,e()})),n.prototype.after("readAll",n.skipIfError(function(t,e){return t.result=t.records=this.getRecordsFromData(t.recordsAttributes,t.subject),e()})),n.prototype.read=n.skipIfError(function(t,e){return t.recordAttributes=this.storage.getItem(t.key),t.recordAttributes||(t.error=new this.constructor.NotFoundError),e()}),n.prototype.create=n.skipIfError(function(t,e){var n,r;return n=t.key,r=t.recordAttributes,this.storage.getItem(n)?arguments[0].error=new this.constructor.RecordExistsError:this.storage.setItem(n,r),e()}),n.prototype.update=n.skipIfError(function(t,e){var n,r;return n=t.key,r=t.recordAttributes,this.storage.setItem(n,r),e()}),n.prototype.destroy=n.skipIfError(function(t,e){var n;return n=t.key,this.storage.removeItem(n),e()}),n.prototype.readAll=n.skipIfError(function(t,e){var n;try{arguments[0].recordsAttributes=this._storageEntriesMatching(t.subject,t.options.data)}catch(r){n=r,arguments[0].error=n}return e()}),n}(Batman.StorageAdapter)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SessionStorage=function(t){function n(){return"undefined"==typeof window.sessionStorage?null:(n.__super__.constructor.apply(this,arguments),this.storage=sessionStorage,void 0)}return e(n,t),n}(Batman.LocalStorage)}.call(this),function(){Batman.Encoders=new Batman.Object}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ParamsReplacer=function(t){function n(t,e){this.navigator=t,this.params=e}return e(n,t),n.prototype.redirect=function(){return this.navigator.redirect(this.toObject(),!0)},n.prototype.replace=function(t){return this.params.replace(t),this.redirect()},n.prototype.update=function(t){return this.params.update(t),this.redirect()},n.prototype.clear=function(){return this.params.clear(),this.redirect()},n.prototype.toObject=function(){return this.params.toObject()},n.accessor({get:function(t){return this.params.get(t)},set:function(t,e){var n,r;return n=this.params.get(t),r=this.params.set(t,e),n!==e&&this.redirect(),r},unset:function(t){var e,n;return e=this.params.hasKey(t),n=this.params.unset(t),e&&this.redirect(),n}}),n}(Batman.Object)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ParamsPusher=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.redirect=function(){return this.navigator.redirect(this.toObject())},r}(Batman.ParamsReplacer)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.NamedRouteQuery=function(t){function n(t,e){var r;null==e&&(e=[]),n.__super__.constructor.call(this,{routeMap:t,args:e});for(r in this.get("routeMap").childrenByName)this[r]=this._queryAccess.bind(this,r)}return e(n,t),n.prototype.isNamedRouteQuery=!0,n.accessor("route",function(){var t,e,n,r,o,i,a;for(i=this.get("routeMap"),e=i.memberRoute,t=i.collectionRoute,a=[e,t],r=0,o=a.length;o>r;r++)if(n=a[r],null!=n&&n.namedArguments.length===this.get("args").length)return n;return t||e}),n.accessor("path",function(){return this.path()}),n.accessor("routeMap","args","cardinality","hashValue",Batman.Property.defaultAccessor),n.accessor({get:function(t){return null!=t?"string"==typeof t?this.nextQueryForName(t):this.nextQueryWithArgument(t):void 0},cache:!1}),n.accessor("withHash",function(){var t=this;return new Batman.Accessible(function(e){return t.withHash(e)})}),n.prototype.withHash=function(t){var e;return e=this.clone(),e.set("hashValue",t),e},n.prototype.nextQueryForName=function(t){var e;return(e=this.get("routeMap").childrenByName[t])?new Batman.NamedRouteQuery(e,this.args):Batman.developer.error("Couldn't find a route for the name "+t+"!")},n.prototype.nextQueryWithArgument=function(t){var e;return e=this.args.slice(0),e.push(t),this.clone(e)},n.prototype.path=function(){var t,e,n,r,o,i,a;for(o={},r=this.get("route.namedArguments"),n=i=0,a=r.length;a>i;n=++i)t=r[n],null!=(e=this.get("args")[n])&&(o[t]=this._toParam(e));return null!=this.get("hashValue")&&(o["#"]=this.get("hashValue")),this.get("route").pathFromParams(o)},n.prototype.toString=function(){return this.path()},n.prototype.clone=function(t){return null==t&&(t=this.args),new Batman.NamedRouteQuery(this.routeMap,t)},n.prototype._toParam=function(t){return t instanceof Batman.AssociationProxy&&(t=t.get("target")),null!=(null!=t?t.toParam:void 0)?t.toParam():t},n.prototype._queryAccess=function(t,e){var n;return n=this.nextQueryForName(t),null!=e&&(n=n.nextQueryWithArgument(e)),n},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Dispatcher=function(t){function n(t,e){n.__super__.constructor.call(this,{app:t,routeMap:e})}var r,o;return e(n,t),n.canInferRoute=function(t){return t instanceof Batman.Model||t instanceof Batman.AssociationProxy||t.prototype instanceof Batman.Model},n.paramsFromArgument=function(t){var e;return e=function(t){return Batman.helpers.camelize(Batman.helpers.pluralize(t.get("resourceName")),!0)},this.canInferRoute(t)?t instanceof Batman.Model||t instanceof Batman.AssociationProxy?(t.isProxy&&(t=t.get("target")),null!=t?{controller:e(t.constructor),action:"show",id:("function"==typeof t.toParam?t.toParam():void 0)||t.get("id")}:{}):t.prototype instanceof Batman.Model?{controller:e(t),action:"index"}:t:t},r=function(t){function n(){return o=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor("__app",Batman.Property.defaultAccessor),n.accessor(function(t){return this.get("__app."+Batman.helpers.titleize(t)+"Controller.sharedController")}),n}(Batman.Object),n.accessor("controllers",function(){return new r({__app:this.get("app")})}),n.prototype.routeForParams=function(t){return t=this.constructor.paramsFromArgument(t),this.get("routeMap").routeForParams(t)},n.prototype.pathFromParams=function(t){var e;return"string"==typeof t?t:(t=this.constructor.paramsFromArgument(t),null!=(e=this.routeForParams(t))?e.pathFromParams(t):void 0)},n.prototype.dispatch=function(t,e){var n,r,o,i,a,s;if(r=this.constructor.paramsFromArgument(t),i=this.routeForParams(r))a=i.pathAndParamsFromArgument(r),o=a[0],t=a[1],e&&Batman.mixin(t,e),this.set("app.currentRoute",i),this.set("app.currentURL",o),this.get("app.currentParams").replace(t||{}),i.dispatch(t);else{if("Object"===Batman.typeOf(t)&&!this.constructor.canInferRoute(t))return this.get("app.currentParams").replace(t);if(this.get("app.currentParams").clear(),n={type:"404",isPrevented:!1,preventDefault:function(){return this.isPrevented=!0}},null!=(s=Batman.currentApp)&&s.fire("error",n),n.isPrevented)return t;if("/404"!==t)return Batman.redirect("/404")}return o},n}.call(this,Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Route=function(t){function n(t,e){var r,o,i,a,s,u,c,l,p,h;for(c=this.constructor.regexps,0!==t.indexOf("/")&&(t="/"+t),a=t.replace(c.escapeRegExp,"\\$&"),u=RegExp("^"+a.replace(c.openOptParam,"(?:").replace(c.closeOptParam,")?").replace(c.namedParam,"([^/]+)").replace(c.splatParam,"(.*?)")+c.queryParam+"$"),c.namedOrSplat.lastIndex=0,i=function(){var t;for(t=[];o=c.namedOrSplat.exec(a);)t.push(o[1]);return t}(),s={templatePath:t,pattern:a,regexp:u,namedArguments:i,baseParams:e},h=this.optionKeys,l=0,p=h.length;p>l;l++)r=h[l],s[r]=e[r],delete e[r];n.__super__.constructor.call(this,s)}return e(n,t),n.regexps={namedParam:/:([\w\d]+)/g,splatParam:/\*([\w\d]+)/g,queryParam:"(?:\\?.+)?",namedOrSplat:/[:|\*]([\w\d]+)/g,namePrefix:"[:|*]",escapeRegExp:/[-[\]{}+?.,\\^$|#\s]/g,openOptParam:/\(/g,closeOptParam:/\)/g},n.prototype.optionKeys=["member","collection"],n.prototype.testKeys=["controller","action"],n.prototype.isRoute=!0,n.prototype.paramsFromPath=function(t){var e,n,r,o,i,a,s,u,c;for(s=new Batman.URI(t),i=this.get("namedArguments"),a=Batman.extend({path:s.path},this.get("baseParams")),r=this.get("regexp").exec(s.path).slice(1),e=u=0,c=r.length;c>u;e=++u)n=r[e],o=i[e],null!=n&&(a[o]=decodeURIComponent(n));return Batman.extend(a,s.queryParams)},n.prototype.pathFromParams=function(t){var e,n,r,o,i,a,s,u,c,l,p,h,d,f,m;for(i=Batman.extend({},t),a=this.get("templatePath"),c=this.constructor.regexps,f=this.get("namedArguments"),l=0,h=f.length;h>l;l++)r=f[l],u=RegExp(""+c.namePrefix+r),o=a.replace(u,null!=i[r]?i[r]:""),o!==a&&(delete i[r],a=o);for(a=a.replace(c.openOptParam,"").replace(c.closeOptParam,"").replace(/([^\/])\/+$/,"$1"),m=this.testKeys,p=0,d=m.length;d>p;p++)n=m[p],delete i[n];return i["#"]&&(e=i["#"],delete i["#"]),s=Batman.URI.queryFromParams(i),s&&(a+="?"+s),e&&(a+="#"+e),a},n.prototype.test=function(t){var e,n,r,o,i,a;if("string"==typeof t)n=t;else if(null!=t.path)n=t.path;else for(n=this.pathFromParams(t),a=this.testKeys,o=0,i=a.length;i>o;o++)if(e=a[o],null!=(r=this.get(e))&&t[e]!==r)return!1;return this.get("regexp").test(n)},n.prototype.pathAndParamsFromArgument=function(t){var e,n;return"string"==typeof t?(e=this.paramsFromPath(t),n=t):(e=t,n=this.pathFromParams(t)),[n,e]},n.prototype.dispatch=function(t){return this.test(t)?this.get("callback")(t):!1},n.prototype.callback=function(){throw new Batman.DevelopmentError("Override callback in a Route subclass")},n}(Batman.Object)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ControllerActionRoute=function(e){function r(e,n){this.callback=t(this.callback,this);var o,i,a,s;n.signature&&("String"===Batman.typeOf(n.signature)?(a=n.signature.split("#"),i=a[0],o=a[1]):(s=n.signature,i=s.controller,o=s.action),o||(o="index"),n.controller=i,n.action=o,delete n.signature),r.__super__.constructor.call(this,e,n)}return n(r,e),r.prototype.optionKeys=["member","collection","app","controller","action"],r.prototype.callback=function(t){var e;return e=this.get("app.dispatcher.controllers."+this.get("controller")),e.dispatch(this.get("action"),t)},r}(Batman.Route)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.CallbackActionRoute=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.optionKeys=["member","collection","callback","app"],r.prototype.controller=!1,r.prototype.action=!1,r}(Batman.Route)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Hash=function(t){function n(){this.meta=new this.constructor.Metadata(this),Batman.SimpleHash.apply(this,arguments),n.__super__.constructor.apply(this,arguments)}var r,o,i,a,s,u,c,l;for(e(n,t),n.Metadata=function(t){function n(t){this.hash=t}return e(n,t),Batman.extend(n.prototype,Batman.Enumerable),n.accessor("length",function(){return this.hash.registerAsMutableSource(),this.hash.length}),n.accessor("isEmpty","keys","toArray",function(t){return this.hash.registerAsMutableSource(),this.hash[t]()}),n.prototype.forEach=function(){var t;return(t=this.hash).forEach.apply(t,arguments)},n}(Batman.Object),Batman.extend(n.prototype,Batman.Enumerable),n.prototype.propertyClass=Batman.Property,n.defaultAccessor={cache:!1,get:Batman.SimpleHash.prototype.get,set:n.mutation(function(t,e){var n,r;return n=Batman.SimpleHash.prototype.get.call(this,t),r=Batman.SimpleHash.prototype.set.call(this,t,e),null!=n&&n!==r?this.fire("itemsWereChanged",[t],[r],[n]):this.fire("itemsWereAdded",[t],[r]),r}),unset:n.mutation(function(t){var e;return e=Batman.SimpleHash.prototype.unset.call(this,t),null!=e&&this.fire("itemsWereRemoved",[t],[e]),e})},n.accessor(n.defaultAccessor),n.prototype._preventMutationEvents=function(t){this.prevent("change"),this.prevent("itemsWereAdded"),this.prevent("itemsWereChanged"),this.prevent("itemsWereRemoved");try{return t.call(this)}finally{this.allow("change"),this.allow("itemsWereAdded"),this.allow("itemsWereChanged"),this.allow("itemsWereRemoved")}},n.prototype.clear=n.mutation(function(){var t,e,n;return e=this.keys(),n=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],o.push(this.get(t));return o}.call(this),this._preventMutationEvents(function(){var t=this;return this.forEach(function(e){return t.unset(e)})}),Batman.SimpleHash.prototype.clear.call(this),this.fire("itemsWereRemoved",e,n),n}),n.prototype.update=n.mutation(function(t){var e,n,r,o,i;return e=[],n=[],r=[],o=[],i=[],this._preventMutationEvents(function(){var a=this;return Batman.forEach(t,function(t,s){return a.hasKey(t)?(r.push(t),i.push(a.get(t)),o.push(a.set(t,s))):(e.push(t),n.push(a.set(t,s)))})}),e.length>0&&this.fire("itemsWereAdded",e,n),r.length>0?this.fire("itemsWereChanged",r,o,i):void 0}),n.prototype.replace=n.mutation(function(t){var e,n,r,o,i,a,s;return e=[],n=[],a=[],s=[],r=[],i=[],o=[],this._preventMutationEvents(function(){var u=this;return this.forEach(function(e){return Batman.objectHasKey(t,e)?void 0:(a.push(e),s.push(u.unset(e)))}),Batman.forEach(t,function(t,a){return u.hasKey(t)?(r.push(t),i.push(u.get(t)),o.push(u.set(t,a))):(e.push(t),n.push(u.set(t,a)))})}),e.length>0&&this.fire("itemsWereAdded",e,n),r.length>0&&this.fire("itemsWereChanged",r,o,i),a.length>0?this.fire("itemsWereRemoved",a,s):void 0}),c=["equality","hashKeyFor","objectKey","prefixedKey","unprefixedKey"],i=0,s=c.length;s>i;i++)r=c[i],n.prototype[r]=Batman.SimpleHash.prototype[r];for(l=["hasKey","forEach","isEmpty","keys","toArray","merge","toJSON","toObject"],o=function(t){return n.prototype[t]=function(){return this.registerAsMutableSource(),Batman.SimpleHash.prototype[t].apply(this,arguments)}},a=0,u=l.length;u>a;a++)r=l[a],o(r);return n}.call(this,Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.RenderCache=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.keyQueue=[]}return e(n,t),n.prototype.maximumLength=4,n.prototype.viewForOptions=function(t){var e=this;return Batman.config.cacheViews||t.cache||t.viewClass.prototype.cache?this.getOrSet(t,function(){return e._newViewFromOptions(Batman.extend({},t))}):this._newViewFromOptions(t)},n.prototype._newViewFromOptions=function(t){return new t.viewClass(t)},n.wrapAccessor(function(t){return{cache:!1,get:function(e){var n;return n=t.get.call(this,e),n&&this._addOrBubbleKey(e),n},set:function(e){var n;return n=t.set.apply(this,arguments),n.set("cached",!0),this._addOrBubbleKey(e),this._evictExpiredKeys(),n},unset:function(e){var n;return n=t.unset.apply(this,arguments),n.set("cached",!1),this._removeKeyFromQueue(e),n}}}),n.prototype.equality=function(t,e){var n;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(n in t)if("view"!==n&&t[n]!==e[n])return!1;return!0},n.prototype.reset=function(){var t,e,n,r;for(r=this.keyQueue.slice(0),e=0,n=r.length;n>e;e++)t=r[e],this.unset(t)},n.prototype._addOrBubbleKey=function(t){return this._removeKeyFromQueue(t),this.keyQueue.unshift(t)},n.prototype._removeKeyFromQueue=function(t){var e,n,r,o,i;for(i=this.keyQueue,e=r=0,o=i.length;o>r;e=++r)if(n=i[e],this.equality(n,t)){this.keyQueue.splice(e,1);break}return t},n.prototype._evictExpiredKeys=function(){var t,e,n,r,o,i;if(this.length>this.maximumLength)for(t=this.keyQueue.slice(0),e=r=o=this.maximumLength,i=t.length;i>=o?i>r:r>i;e=i>=o?++r:--r)n=t[e],this.get(n).isInDOM()||this.unset(n)},n}(Batman.Hash)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].indexOf||function(t){for(var e=0,n=this.length;n>e;e++)if(e in this&&this[e]===t)return e;return-1},o=[].slice;Batman.Controller=function(e){function i(){this.redirect=t(this.redirect,this),this.handleError=t(this.handleError,this),this.errorHandler=t(this.errorHandler,this),i.__super__.constructor.apply(this,arguments),this._resetActionFrames()}return n(i,e),i.singleton("sharedController"),i.wrapAccessor("routingKey",function(){return{get:function(){return null!=this.routingKey?this.routingKey:(Batman.config.minificationErrors&&Batman.developer.error("Please define `routingKey` on the prototype of "+Batman.functionName(this.constructor)+" in order for your controller to be minification safe."),Batman.functionName(this.constructor).replace(/Controller$/,""))}}}),i.classMixin(Batman.LifecycleEvents),i.lifecycleEvent("action",function(t){var e,n,o;return null==t&&(t={}),n={},o="String"===Batman.typeOf(t.only)?[t.only]:t.only,e="String"===Batman.typeOf(t.except)?[t.except]:t.except,n["if"]=function(t,n){var i,a;return this._afterFilterRedirect?!1:o&&(i=n.action,r.call(o,i)<0)?!1:e&&(a=n.action,r.call(e,a)>=0)?!1:!0},n}),i.beforeFilter=function(){return Batman.developer.deprecated("Batman.Controller::beforeFilter","Please use beforeAction instead."),this.beforeAction.apply(this,arguments)},i.afterFilter=function(){return Batman.developer.deprecated("Batman.Controller::afterFilter","Please use afterAction instead."),this.afterAction.apply(this,arguments)},i.afterAction(function(t){return this.autoScrollToHash&&null!=t["#"]?this.scrollToHash(t["#"]):void 0}),i.catchError=function(){var t,e,n,r,i,a,s,u,c,l;for(n=2<=arguments.length?o.call(arguments,0,s=arguments.length-1):(s=0,[]),i=arguments[s++],Batman.initializeObject(this),(a=this._batman).errorHandlers||(a.errorHandlers=new Batman.SimpleHash),r="Array"===Batman.typeOf(i["with"])?i["with"]:[i["with"]],l=[],u=0,c=n.length;c>u;u++)e=n[u],t=this._batman.errorHandlers.get(e)||[],l.push(this._batman.errorHandlers.set(e,t.concat(r)));return l},i.prototype.errorHandler=function(t){var e,n,r=this;return e=null!=(n=this._actionFrames)?n[this._actionFrames.length-1]:void 0,function(n,o,i){if(!n)return"function"==typeof t?t(o,i):void 0;if((null!=e?!e.error:!0)&&(null!=e&&(e.error=n),!r.handleError(n)))throw n}},i.prototype.handleError=function(t){var e,n,r=this;return e=!1,null!=(n=this.constructor._batman.getAll("errorHandlers"))&&n.forEach(function(n){return n.forEach(function(n,o){var i,a,s,u;if(t instanceof n){for(e=!0,u=[],a=0,s=o.length;s>a;a++)i=o[a],"string"==typeof i&&(i=r[i]),u.push(i.call(r,t));return u}})}),e},i.prototype.renderCache=new Batman.RenderCache,i.prototype.defaultRenderYield="main",i.prototype.autoScrollToHash=!0,i.prototype.dispatch=function(t,e){var n;return null==e&&(e={}),e.controller||(e.controller=this.get("routingKey")),e.action||(e.action=t),e.target||(e.target=this),this._resetActionFrames(),this.set("action",t),this.set("params",e),this.executeAction(t,e),n=this._afterFilterRedirect,this._afterFilterRedirect=null,delete this._afterFilterRedirect,n?Batman.redirect(n):void 0},i.prototype.executeAction=function(t,e){var n,r,o,i,a,s,u=this;return null==e&&(e=this.get("params")),Batman.developer.assert(this[t],"Error! Controller action "+this.get("routingKey")+"."+t+" couldn't be found!"),o=this._actionFrames[this._actionFrames.length-1],n=new Batman.ControllerActionFrame({parentFrame:o,action:t,params:e},function(){var t;return u._afterFilterRedirect||u.fireLifecycleEvent("afterAction",n.params,n),u._resetActionFrames(),null!=(t=Batman.navigator)?t.redirect=r:void 0}),this._actionFrames.push(n),n.startOperation({internal:!0}),r=null!=(a=Batman.navigator)?a.redirect:void 0,null!=(s=Batman.navigator)&&(s.redirect=this.redirect),this.fireLifecycleEvent("beforeAction",n.params,n)!==!1&&(this._afterFilterRedirect||(i=this[t](e)),n.operationOccurred||this.render()),n.finishOperation(),i},i.prototype.redirect=function(t){var e;return e=this._actionFrames[this._actionFrames.length-1],e?e.operationOccurred?(Batman.developer.warn("Warning! Trying to redirect but an action has already been taken during "+this.get("routingKey")+"."+(e.action||this.get("action"))),void 0):(e.startAndFinishOperation(),null!=this._afterFilterRedirect?Batman.developer.warn("Warning! Multiple actions trying to redirect!"):this._afterFilterRedirect=t):("Object"===Batman.typeOf(t)&&(t.controller||(t.controller=this.get("routingKey"))),Batman.redirect(t))},i.prototype.render=function(t){var e,n,r,o,i,a,s,u,c,l;return null==t&&(t={}),(n=null!=(a=this._actionFrames)?a[this._actionFrames.length-1]:void 0)&&n.startOperation(),t===!1?(n.finishOperation(),void 0):(e=(null!=n?n.action:void 0)||this.get("action"),(r=t.view)?t.view=null:(t.viewClass||(t.viewClass=this._viewClassForAction(e)),t.source||(t.source=(null!=(s=t.viewClass)?s.prototype.source:void 0)||Batman.helpers.underscore(this.get("routingKey")+"/"+e)),r=this.renderCache.viewForOptions(t)),r&&(r.once("viewDidAppear",function(){return null!=n?n.finishOperation():void 0}),i=t.into||this.defaultRenderYield,(o=Batman.DOM.Yield.withName(i).contentView)&&(o===r||o.isDead||o.die()),r.contentFor||r.parentNode||r.set("contentFor",i),r.set("controller",this),null!=(u=Batman.currentApp)&&null!=(c=u.layout)&&null!=(l=c.subviews)&&l.add(r),this.set("currentView",r)),r)},i.prototype.scrollToHash=function(t){return null==t&&(t=this.get("params")["#"]),Batman.DOM.scrollIntoView(t)},i.prototype._resetActionFrames=function(){return this._actionFrames=[]},i.prototype._viewClassForAction=function(t){var e,n;return e=this.get("routingKey").replace("/","_"),(null!=(n=Batman.currentApp)?n[Batman.helpers.camelize(""+e+"_"+t+"_view")]:void 0)||Batman.View},i}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Set=function(t){function n(){Batman.SimpleSet.apply(this,arguments)}var r,o,i,a,s,u,c,l;for(e(n,t),n.prototype.isCollectionEventEmitter=!0,Batman.extend(n.prototype,Batman.Enumerable),n._applySetAccessors=function(t){var e,n,r;n={first:function(){return this.toArray()[0]},last:function(){return this.toArray()[this.length-1]},isEmpty:function(){return this.isEmpty()},toArray:function(){return this.toArray()},length:function(){return this.registerAsMutableSource(),this.length},indexedBy:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.indexedBy(e)})},indexedByUnique:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.indexedByUnique(e)})},sortedBy:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.sortedBy(e)})},sortedByDescending:function(){var t=this;return new Batman.TerminalAccessible(function(e){return t.sortedBy(e,"desc")})}};for(r in n)e=n[r],t.accessor(r,e)},n._applySetAccessors(n),c=["indexedBy","indexedByUnique","sortedBy","equality","_indexOfItem","mappedTo"],i=0,s=c.length;s>i;i++)r=c[i],n.prototype[r]=Batman.SimpleSet.prototype[r];for(l=["at","find","merge","forEach","toArray","isEmpty","has"],o=function(t){return n.prototype[t]=function(){return this.registerAsMutableSource(),Batman.SimpleSet.prototype[t].apply(this,arguments)}},a=0,u=l.length;u>a;a++)r=l[a],o(r);return n.prototype.toJSON=function(){return this.map(function(t){return("function"==typeof t.toJSON?t.toJSON():void 0)||t})},n.prototype.add=n.mutation(function(){var t;return t=Batman.SimpleSet.prototype.add.apply(this,arguments),t.length&&this.fire("itemsWereAdded",t),t}),n.prototype.insert=function(){return this.insertWithIndexes.apply(this,arguments).addedItems},n.prototype.insertWithIndexes=n.mutation(function(){var t,e,n;return n=Batman.SimpleSet.prototype.insertWithIndexes.apply(this,arguments),e=n.addedItems,t=n.addedIndexes,e.length&&this.fire("itemsWereAdded",e,t),{addedItems:e,addedIndexes:t}}),n.prototype.remove=function(){return this.removeWithIndexes.apply(this,arguments).removedItems},n.prototype.removeWithIndexes=n.mutation(function(){var t,e,n;return n=Batman.SimpleSet.prototype.removeWithIndexes.apply(this,arguments),e=n.removedItems,t=n.removedIndexes,e.length&&this.fire("itemsWereRemoved",e,t),{removedItems:e,removedIndexes:t}
}),n.prototype.clear=n.mutation(function(){var t;return t=Batman.SimpleSet.prototype.clear.call(this),t.length&&this.fire("itemsWereRemoved",t),t}),n.prototype.replace=n.mutation(function(t){var e,n;return n=Batman.SimpleSet.prototype.clear.call(this),e=Batman.SimpleSet.prototype.add.apply(this,t.toArray()),n.length&&this.fire("itemsWereRemoved",n),e.length?this.fire("itemsWereAdded",e):void 0}),n}.call(this,Batman.Object)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ErrorsSet=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.accessor(function(t){return this.indexedBy("attribute").get(t)}),r.prototype.add=function(t,e){return r.__super__.add.call(this,new Batman.ValidationError(t,e))},r}(Batman.Set)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SetProxy=function(t){function n(t){this.base=t,n.__super__.constructor.call(this),this.length=this.base.length,this.base.isCollectionEventEmitter&&(this.isCollectionEventEmitter=!0,this._setObserver=new Batman.SetObserver(this.base),this._setObserver.on("itemsWereAdded",this._handleItemsAdded.bind(this)),this._setObserver.on("itemsWereRemoved",this._handleItemsRemoved.bind(this)),this.startObserving())}var r,o,i,a,s;for(e(n,t),Batman.extend(n.prototype,Batman.Enumerable),n.prototype.startObserving=function(){var t;return null!=(t=this._setObserver)?t.startObserving():void 0},n.prototype.stopObserving=function(){var t;return null!=(t=this._setObserver)?t.stopObserving():void 0},n.prototype._handleItemsAdded=function(t,e){return this.set("length",this.base.length),this.fire("itemsWereAdded",t,e)},n.prototype._handleItemsRemoved=function(t,e){return this.set("length",this.base.length),this.fire("itemsWereRemoved",t,e)},n.prototype.filter=function(t){return this.reduce(function(e,n){return t(n)&&e.add(n),e},new Batman.Set)},n.prototype.replace=function(){var t,e;return t=this.property("length"),t.isolate(),e=this.base.replace.apply(this.base,arguments),t.expose(),e},Batman.Set._applySetAccessors(n),s=["add","insert","insertWithIndexes","remove","removeWithIndexes","at","find","clear","has","merge","toArray","isEmpty","indexedBy","indexedByUnique","sortedBy"],o=function(t){return n.prototype[t]=function(){return this.base[t].apply(this.base,arguments)}},i=0,a=s.length;a>i;i++)r=s[i],o(r);return n.accessor("length",{get:function(){return this.registerAsMutableSource(),this.length},set:function(t,e){return this.length=e}}),n}.call(this,Batman.Object)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.BinarySetOperation=function(e){function o(e,n){this.left=e,this.right=n,this._setup=t(this._setup,this),o.__super__.constructor.call(this),this._setup(this.left,this.right),this._setup(this.right,this.left)}return n(o,e),o.prototype._setup=function(t,e){var n=this;return t.on("itemsWereAdded",function(o){return n._itemsWereAddedToSource.apply(n,[t,e].concat(r.call(o)))}),t.on("itemsWereRemoved",function(o){return n._itemsWereRemovedFromSource.apply(n,[t,e].concat(r.call(o)))}),this._itemsWereAddedToSource.apply(this,[t,e].concat(r.call(t.toArray())))},o.prototype.merge=function(){var t,e,n,o,i;for(e=1<=arguments.length?r.call(arguments,0):[],t=new Batman.Set,e.unshift(this),o=0,i=e.length;i>o;o++)n=e[o],n.forEach(function(e){return t.add(e)});return t},o.prototype.filter=Batman.SetProxy.prototype.filter,o}(Batman.Set)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.SetUnion=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype._itemsWereAddedToSource=function(){var t,e,n;return n=arguments[0],e=arguments[1],t=3<=arguments.length?r.call(arguments,2):[],this.add.apply(this,t)},o.prototype._itemsWereRemovedFromSource=function(){var t,e,n,o,i;return i=arguments[0],o=arguments[1],e=3<=arguments.length?r.call(arguments,2):[],n=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)||i.push(t);return i}(),this.remove.apply(this,n)},o}(Batman.BinarySetOperation)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.SetIntersection=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype._itemsWereAddedToSource=function(){var t,e,n,o,i;return i=arguments[0],o=arguments[1],e=3<=arguments.length?r.call(arguments,2):[],n=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)&&i.push(t);return i}(),n.length>0?this.add.apply(this,n):void 0},o.prototype._itemsWereRemovedFromSource=function(){var t,e,n;return n=arguments[0],e=arguments[1],t=3<=arguments.length?r.call(arguments,2):[],this.remove.apply(this,t)},o}(Batman.BinarySetOperation)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.SetComplement=function(e){function o(){return t=o.__super__.constructor.apply(this,arguments)}return n(o,e),o.prototype._itemsWereAddedToSource=function(){var t,e,n,o,i,a;if(a=arguments[0],i=arguments[1],e=3<=arguments.length?r.call(arguments,2):[],a===this.left){if(n=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],i.has(t)||o.push(t);return o}(),n.length>0)return this.add.apply(this,n)}else if(o=function(){var n,r,o;for(o=[],n=0,r=e.length;r>n;n++)t=e[n],i.has(t)&&o.push(t);return o}(),o.length>0)return this.remove.apply(this,o)},o.prototype._itemsWereRemovedFromSource=function(){var t,e,n,o,i;return i=arguments[0],o=arguments[1],e=3<=arguments.length?r.call(arguments,2):[],i===this.left?this.remove.apply(this,e):(n=function(){var n,r,i;for(i=[],n=0,r=e.length;r>n;n++)t=e[n],o.has(t)&&i.push(t);return i}(),n.length>0?this.add.apply(this,n):void 0)},o.prototype._addComplement=function(t,e){var n,r;return r=function(){var r,o,i;for(i=[],r=0,o=t.length;o>r;r++)n=t[r],e.has(n)&&i.push(n);return i}(),r.length>0?this.add.apply(this,r):void 0},o}(Batman.BinarySetOperation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.StateMachine=function(t){function r(t){this.nextEvents=[],this.set("_state",t)}return e(r,t),r.InvalidTransitionError=function(t){this.message=null!=t?t:""},r.InvalidTransitionError.prototype=new Error,r.transitions=function(t){var e,r,o,i,a,s,u,c,l,p,h=this;for(o in t)c=t[o],c.from&&c.to&&(i={},c.from.forEach?c.from.forEach(function(t){return i[t]=c.to}):i[c.from]=c.to,t[o]=i);this.prototype.transitionTable=Batman.extend({},this.prototype.transitionTable,t),a=[],e=function(t){var e;return e="is"+Batman.helpers.titleize(t),null==h.prototype[e]?(a.push(e),h.prototype[e]=function(){return this.get("state")===t}):void 0},p=this.prototype.transitionTable,l=function(t){return h.prototype[t]=function(){return this.startTransition(t)}};for(o in p)if(u=p[o],!this.prototype[o]){l(o);for(r in u)s=u[r],e(r),e(s)}return a.length&&this.accessor.apply(this,n.call(a).concat([function(t){return this[t]()}])),this},r.accessor("state",function(){return this.get("_state")}),r.prototype.isTransitioning=!1,r.prototype.transitionTable={},r.prototype._transitionEvent=function(t,e){return""+t+"->"+e},r.prototype._enterEvent=function(t){return"enter "+t},r.prototype._exitEvent=function(t){return"exit "+t},r.prototype._beforeEvent=function(t){return"before "+t},r.prototype.onTransition=function(t,e,n){return this.on(this._transitionEvent(t,e),n)},r.prototype.onEnter=function(t,e){return this.on(this._enterEvent(t),e)},r.prototype.onExit=function(t,e){return this.on(this._exitEvent(t),e)},r.prototype.onBefore=function(t,e){return this.on(this._beforeEvent(t),e)},r.prototype.offTransition=function(t,e,n){return this.off(this._transitionEvent(t,e),n)},r.prototype.offEnter=function(t,e){return this.off(this._enterEvent(t),e)},r.prototype.offExit=function(t,e){return this.off(this._exitEvent(t),e)},r.prototype.offBefore=function(t,e){return this.off(this._beforeEvent(t),e)},r.prototype.startTransition=Batman.Property.wrapTrackingPrevention(function(t){var e,n;return this.isTransitioning?(this.nextEvents.push(t),void 0):(n=this.get("state"),(e=this.nextStateForEvent(t))?(this.fire(this._beforeEvent(e)),this.isTransitioning=!0,this.fire(this._exitEvent(n)),this.set("_state",e),this.fire(this._transitionEvent(n,e)),this.fire(this._enterEvent(e)),this.fire(t),this.isTransitioning=!1,this.nextEvents.length>0&&this.startTransition(this.nextEvents.shift()),!0):!1)}),r.prototype.canStartTransition=function(t,e){return null==e&&(e=this.get("state")),!!this.nextStateForEvent(t,e)},r.prototype.nextStateForEvent=function(t,e){var n;return null==e&&(e=this.get("state")),null!=(n=this.transitionTable[t])?n[e]:void 0},r}(Batman.Object),Batman.DelegatingStateMachine=function(t){function n(t,e){this.base=e,n.__super__.constructor.call(this,t)}return e(n,t),n.prototype.fire=function(){var t,e;return t=n.__super__.fire.apply(this,arguments),(e=this.base).fire.apply(e,arguments),t},n}(Batman.StateMachine)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.Model=function(r){function o(t){null==t&&(t={}),Batman.developer.assert(this instanceof Batman.Object,"constructors must be called with new"),"Object"===Batman.typeOf(t)?o.__super__.constructor.call(this,t):(o.__super__.constructor.call(this),this.set("id",t))}var i,a,s,u,c,l,p,h;for(e(o,r),o.storageKey=null,o.primaryKey="id",o.persist=function(){var t,e;return t=arguments[0],e=2<=arguments.length?n.call(arguments,1):[],Batman.initializeObject(this.prototype),t=t.isStorageAdapter?t:new t(this),e.length>0&&Batman.mixin.apply(Batman,[t].concat(n.call(e))),this.prototype._batman.storage=t,t},o.storageAdapter=function(){return Batman.initializeObject(this.prototype),this.prototype._batman.storage},o.encode=function(){var t,e,r,o,i,a,s,u,c;switch(i=2<=arguments.length?n.call(arguments,0,s=arguments.length-1):(s=0,[]),r=arguments[s++],Batman.initializeObject(this.prototype),(a=this.prototype._batman).encoders||(a.encoders=new Batman.SimpleHash),t={},Batman.typeOf(r)){case"String":i.push(r);break;case"Function":t.encode=r;break;default:t=r}for(u=0,c=i.length;c>u;u++)o=i[u],e=Batman.extend({as:o},this.defaultEncoder,t),this.prototype._batman.encoders.set(o,e)},o.defaultEncoder={encode:function(t){return t},decode:function(t){return t}},o.observeAndFire("primaryKey",function(t,e){return this.encode(e,{encode:!1,decode:!1}),this.encode(t,{encode:!1,decode:this.defaultEncoder.decode})}),o.validate=function(){var t,e,r,o,i,a,s,u,c,l;if(t=2<=arguments.length?n.call(arguments,0,s=arguments.length-1):(s=0,[]),r=arguments[s++],Batman.initializeObject(this.prototype),i=(a=this.prototype._batman).validators||(a.validators=[]),"function"==typeof r)i.push({keys:t,callback:r});else for(l=Batman.Validators,u=0,c=l.length;c>u;u++)o=l[u],(e=o.matches(r))&&i.push({keys:t,validator:new o(e),"if":r["if"],unless:r.unless})},o.classAccessor("resourceName",{get:function(){return null!=this.resourceName?this.resourceName:null!=this.prototype.resourceName?(Batman.config.minificationErrors&&Batman.developer.error("Please define the resourceName property of the "+Batman.functionName(this)+" on the constructor and not the prototype."),this.prototype.resourceName):(Batman.config.minificationErrors&&Batman.developer.error("Please define "+Batman.functionName(this)+".resourceName in order for your model to be minification safe."),Batman.helpers.underscore(Batman.functionName(this)))}}),o.classAccessor("all",{get:function(){return this._batman.check(this),this.prototype.hasStorage()&&!this._batman.allLoadTriggered&&(this.load(),this._batman.allLoadTriggered=!0),this.get("loaded")},set:function(t,e){return this.set("loaded",e)}}),o.classAccessor("loaded",{get:function(){return this._loaded||(this._loaded=new Batman.Set)},set:function(t,e){return this._loaded=e}}),o.classAccessor("first",function(){return this.get("all").toArray()[0]}),o.classAccessor("last",function(){var t;return t=this.get("all").toArray(),t[t.length-1]}),o.clear=function(){var t,e;return Batman.initializeObject(this),t=this.get("loaded").clear(),null!=(e=this._batman.get("associations"))&&e.reset(),this._resetPromises(),t},o.find=function(t,e){return this.findWithOptions(t,void 0,e)},o.findWithOptions=function(t,e,n){var r,o=this;return null==e&&(e={}),Batman.developer.assert(n,"Must call find with a callback!"),this._pending||(this._pending={}),r=this._loadIdentity(t)||this._pending[t],null==r&&(r=new this,r._withoutDirtyTracking(function(){return this.set("id",t)}),this._pending[t]=r),r.loadWithOptions(e,function(){return delete o._pending[t],n.apply(o,arguments)}),r},o.load=function(t,e){var n;return"function"==(n=typeof t)||"undefined"===n?(e=t,t={}):t={data:t},this.loadWithOptions(t,e)},o.loadWithOptions=function(t,e){var n=this;return this.fire("loading",t),this._doStorageOperation("readAll",t,function(t,r,o){return null!=t?(n.fire("error",t),"function"==typeof e?e(t,[]):void 0):(n.fire("loaded",r,o),"function"==typeof e?e(t,r,o):void 0)})},o.create=function(t,e){var n,r;return e||(r=[{},t],t=r[0],e=r[1]),n=new this(t),n.save(e),n},o.findOrCreate=function(t,e){var n;return n=this._loadIdentity(t[this.primaryKey]),n?(n.mixin(t),e(void 0,n)):(n=new this(t),n.save(e)),n},o.createFromJSON=function(t){return this._makeOrFindRecordFromData(t)},o.createMultipleFromJSON=function(t){return this._makeOrFindRecordsFromData(t)},o._loadIdentity=function(t){return this.get("loaded.indexedByUnique.id").get(t)},o._loadRecord=function(t){var e,n;return(e=t[this.primaryKey])&&(n=this._loadIdentity(e)),n||(n=new this),n._withoutDirtyTracking(function(){return this.fromJSON(t)}),n},o._makeOrFindRecordFromData=function(t){var e;return e=this._loadRecord(t),this._mapIdentity(e)},o._makeOrFindRecordsFromData=function(t){var e,n;return n=function(){var n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(this._loadRecord(e));return o}.call(this),this._mapIdentities(n),n},o._mapIdentity=function(t){var e,n,r;return null!=(n=t.get("id"))&&((e=this._loadIdentity(n))?(r=e.get("lifecycle"),r.load(),e._withoutDirtyTracking(function(){var e,n;return e=null!=(n=t.get("attributes"))?n.toObject():void 0,e?this.mixin(e):void 0}),r.loaded(),t=e):this.get("loaded").add(t)),t},o._mapIdentities=function(t){var e,n,r,o,i,a,s,u,c;for(i=[],r=s=0,u=t.length;u>s;r=++s)a=t[r],null!=(n=a.get("id"))&&((e=this._loadIdentity(n))?(o=e.get("lifecycle"),o.load(),e._withoutDirtyTracking(function(){var t,e;return t=null!=(e=a.get("attributes"))?e.toObject():void 0,t?this.mixin(t):void 0}),o.loaded(),t[r]=e):i.push(a));return i.length&&(c=this.get("loaded")).add.apply(c,i),t},o._doStorageOperation=function(t,e,n){var r;return Batman.developer.assert(this.prototype.hasStorage(),"Can't "+t+" model "+Batman.functionName(this.constructor)+" without any storage adapters!"),r=this.prototype._batman.get("storage"),r.perform(t,this,e,n)},l=["find","load","create"],a=0,u=l.length;u>a;a++)i=l[a],o[i]=Batman.Property.wrapTrackingPrevention(o[i]);for(o.InstanceLifecycleStateMachine=function(t){function n(){return p=n.__super__.constructor.apply(this,arguments)}return e(n,t),n.transitions({load:{from:["dirty","clean"],to:"loading"},create:{from:["dirty","clean"],to:"creating"},save:{from:["dirty","clean"],to:"saving"},destroy:{from:["dirty","clean"],to:"destroying"},failedValidation:{from:["saving","creating"],to:"dirty"},loaded:{loading:"clean"},created:{creating:"clean"},saved:{saving:"clean"},destroyed:{destroying:"destroyed"},set:{from:["dirty","clean"],to:"dirty"},error:{from:["saving","creating","loading","destroying"],to:"error"}}),n}(Batman.DelegatingStateMachine),o.accessor("lifecycle",function(){return this.lifecycle||(this.lifecycle=new Batman.Model.InstanceLifecycleStateMachine("clean",this))}),o.accessor("attributes",function(){return this.attributes||(this.attributes=new Batman.Hash)}),o.accessor("dirtyKeys",function(){return this.dirtyKeys||(this.dirtyKeys=new Batman.Hash)}),o.accessor("_dirtiedKeys",function(){return this._dirtiedKeys||(this._dirtiedKeys=new Batman.SimpleSet)}),o.accessor("errors",function(){return this.errors||(this.errors=new Batman.ErrorsSet)}),o.accessor("isNew",function(){return this.isNew()}),o.accessor("isDirty",function(){return this.isDirty()}),o.accessor(o.defaultAccessor={get:function(t){return Batman.getPath(this,["attributes",t])},set:function(t,e){return this._willSet(t)?this.get("attributes").set(t,e):this.get(t)},unset:function(t){return this.get("attributes").unset(t)}}),o.wrapAccessor("id",function(t){return{get:function(){var e;return e=this.constructor.primaryKey,"id"===e?t.get.apply(this,arguments):this.get(e)},set:function(e,n){var r;return r=this.constructor.primaryKey,"id"===r?(this._willSet(e),t.set.apply(this,arguments)):this.set(r,n)}}}),o.prototype.isNew=function(){return"undefined"==typeof this.get("id")},o.prototype.isDirty=function(){return"dirty"===this.get("lifecycle.state")},o.prototype.updateAttributes=function(t){return this.mixin(t),this},o.prototype.toString=function(){return""+this.constructor.get("resourceName")+": "+this.get("id")},o.prototype.toParam=function(){return this.get("id")},o.prototype.toJSON=function(){var t,e,n=this;return t=this._batman.get("encoders"),!t||t.isEmpty()?{}:(e={},t.forEach(function(t,r){var o,i,a;if(r.encode&&void 0!==(i=n.get(t)))return void 0!==(o=r.encode(i,t,e,n))?e[null!=(a="function"==typeof r.as?r.as(t,i,e,n):void 0)?a:r.as]=o:void 0}),e)},o.prototype.fromJSON=function(t){var e,n,r,o,i=this;if(r={},e=this._batman.get("encoders"),e&&!e.isEmpty()&&e.some(function(t,e){return null!=e.decode}))e.forEach(function(e,n){var a,s;if(n.decode&&(a=null!=(s="function"==typeof n.as?n.as(e,t[e],r,i):void 0)?s:n.as,o=t[a],void 0!==o&&(null!==o||null==i._associationForAttribute(a))))return r[e]=n.decode(o,a,t,r,i)});else for(n in t)o=t[n],r[n]=o;return"id"!==this.constructor.primaryKey&&(r.id=t[this.constructor.primaryKey]),Batman.developer["do"](function(){return!e||e.length<=1?Batman.developer.warn("Warning: Model "+Batman.functionName(i.constructor)+" has suspiciously few decoders!"):void 0}),this.mixin(r)},o.prototype.hasStorage=function(){return null!=this._batman.get("storage")},o.prototype.load=function(t,e){var n;return e?t={data:t}:(n=[{},t],t=n[0],e=n[1]),this.loadWithOptions(t,e)},o.prototype.loadWithOptions=function(t,e){var n,r,o,i=this;return r=0!==Object.keys(t).length,"destroying"===(o=this.get("lifecycle.state"))||"destroyed"===o?("function"==typeof e&&e(new Error("Can't load a destroyed record!")),void 0):this.get("lifecycle").load()?(n=[],null!=e&&n.push(e),r||(this._currentLoad=n),this._doStorageOperation("read",t,function(t,o,a){var s,u;for(t?i.get("lifecycle").error():(i.get("lifecycle").loaded(),o=i.constructor._mapIdentity(o),o.get("errors").clear()),r||(i._currentLoad=null),s=0,u=n.length;u>s;s++)e=n[s],e(t,o,a)})):"loading"!==this.get("lifecycle.state")||r?"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't load while in state "+this.get("lifecycle.state"))):void 0:null!=e?this._currentLoad.push(e):void 0},o.prototype.save=function(t,e){var n,r,o,i,a,s,u=this;return e||(a=[{},t],t=a[0],e=a[1]),r=this.isNew(),s=r?["create","create","created"]:["save","update","saved"],o=s[0],i=s[1],n=s[2],this.get("lifecycle").startTransition(o)?this.validate(function(r,o){var a,s;return r||o.length?(u.get("lifecycle").failedValidation(),"function"==typeof e?e(r||o,u):void 0):(u.fire("validated"),a=u.constructor._batman.get("associations"),u._withoutDirtyTracking(function(){var t,e=this;return null!=a?null!=(t=a.getByType("belongsTo"))?t.forEach(function(t){return t.apply(e)}):void 0:void 0}),s=Batman.extend({},t,{data:t}),u._doStorageOperation(i,s,function(t,r,o){return t?t instanceof Batman.ErrorsSet?u.get("lifecycle").failedValidation():u.get("lifecycle").error():(u.get("dirtyKeys").clear(),u.get("_dirtiedKeys").clear(),a&&r._withoutDirtyTracking(function(){var e,n;return null!=(e=a.getByType("hasOne"))&&e.forEach(function(e){return e.apply(t,r)}),null!=(n=a.getByType("hasMany"))?n.forEach(function(e){return e.apply(t,r)}):void 0}),r=u.constructor._mapIdentity(r),u.get("lifecycle").startTransition(n)),"function"==typeof e?e(t,r||u,o):void 0}))}):"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't save while in state "+this.get("lifecycle.state"))):void 0},o.prototype.destroy=function(t,e){var n,r=this;return e||(n=[{},t],t=n[0],e=n[1]),this.get("lifecycle").destroy()?this._doStorageOperation("destroy",{data:t},function(t,n,o){return t?r.get("lifecycle").error():(r.constructor.get("loaded").remove(r),r.get("lifecycle").destroyed()),"function"==typeof e?e(t,n,o):void 0}):"function"==typeof e?e(new Batman.StateMachine.InvalidTransitionError("Can't destroy while in state "+this.get("lifecycle.state"))):void 0},o.prototype.validate=function(t){var e,n,r,o,i,a,s,u,c,l,p,h,d,f;if(i=this.get("errors"),i.clear(),c=this._batman.get("validators")||[],!c||0===c.length)return"function"==typeof t&&t(void 0,i),!0;for(r=c.reduce(function(t,e){return t+e.keys.length},0),a=function(){return 0===--r?"function"==typeof t?t(void 0,i):void 0:void 0},l=0,h=c.length;h>l;l++)if(u=c[l],!u["if"]||(n="string"==typeof u["if"]?this.get(u["if"]):u["if"].call(this,i,this,s)))if(u.unless&&(n="string"==typeof u.unless?this.get(u.unless):u.unless.call(this,i,this,s)))a();else for(f=u.keys,p=0,d=f.length;d>p;p++){s=f[p],e=[i,this,s,a];try{u.validator?u.validator.validateEach.apply(u.validator,e):u.callback.apply(u,e)}catch(m){o=m,"function"==typeof t&&t(o,i)}}else a()},o.prototype.associationProxy=function(t){var e,n,r;return Batman.initializeObject(this),e=(n=this._batman).associationProxies||(n.associationProxies={}),e[r=t.label]||(e[r]=new t.proxyClass(t,this)),e[t.label]},o.prototype._willSet=function(t){return this._pauseDirtyTracking?!0:this.get("lifecycle").startTransition("set")?(this.get("_dirtiedKeys").has(t)||(this.set("dirtyKeys."+t,this.get(t)),this.get("_dirtiedKeys").add(t)),!0):!1},o.prototype._associationForAttribute=function(t){var e;return null!=(e=this.constructor._batman.get("associations"))?e.get(t):void 0},o.prototype._doStorageOperation=function(t,e,n){var r;return Batman.developer.assert(this.hasStorage(),"Can't "+t+" model "+Batman.functionName(this.constructor)+" without any storage adapters!"),r=this._batman.get("storage"),r.perform(t,this,e,function(){return n.apply(null,arguments)})},o.prototype._withoutDirtyTracking=function(t){var e;return this._pauseDirtyTracking?t.call(this):(this._pauseDirtyTracking=!0,e=t.call(this),this._pauseDirtyTracking=!1,e)},h=["load","save","validate","destroy"],s=0,c=h.length;c>s;s++)i=h[s],o.prototype[i]=Batman.Property.wrapTrackingPrevention(o.prototype[i]);return o.prototype.reflectOnAllAssociations=function(t){var e;return e=this.constructor._batman.get("associations"),null!=t?null!=e?e.getByType(t):void 0:null!=e?e.getAll():void 0},o.prototype.reflectOnAssociation=function(t){var e;return null!=(e=this.constructor._batman.get("associations"))?e.getByLabel(t):void 0},o.prototype.transaction=function(){return this._transaction([],[])},o.prototype._transaction=function(e,n){var r,o,i,a,s,u,c,l,p,h,d,f;if(i=e.indexOf(this),-1!==i)return n[i];if(e.push(this),n.push(c=new this.constructor),o=this.reflectOnAllAssociations("hasMany"))for(o=o.filter(function(t){return t.options.includeInTransaction}),d=o.mapToProperty("label"),p=0,h=d.length;h>p;p++)s=d[p],this.get(s);r=this.get("attributes").toObject();for(a in r)t.call(r,a)&&(l=r[a],l instanceof Batman.Model&&!l.isTransaction?r[a]=l._transaction(e,n):l instanceof Batman.AssociationSet&&!l.isTransaction?(u=new Batman.TransactionAssociationSet(l,e,n),r[a]=u):"Object"===Batman.typeOf(l)&&Batman.developer.warn("You're passing a mutable object ("+a+", "+l.constructor.name+") in a "+this.constructor.name+" transaction:",l));c._withoutDirtyTracking(function(){return c.updateAttributes(r)}),c._batman.base=this,f=Batman.Transaction;for(a in f)l=f[a],c[a]=l;return c.accessor("isTransaction",function(){return this.isTransaction}),c.accessor("base",function(){return this.base()}),c},o}.call(this,Batman.Object)}.call(this),function(){var t,e,n,r,o;for(o=Batman.AssociationCurator.availableAssociations,e=function(t){return Batman.Model[t]=function(e,n){var r,o;return Batman.initializeObject(this),r=(o=this._batman).associations||(o.associations=new Batman.AssociationCurator(this)),r.add(new(Batman[""+Batman.helpers.titleize(t)+"Association"])(this,e,n))}},n=0,r=o.length;r>n;n++)t=o[n],e(t)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Proxy=function(t){function n(t){n.__super__.constructor.call(this),null!=t&&this.set("target",t)}return e(n,t),n.prototype.isProxy=!0,n.accessor("target",Batman.Property.defaultAccessor),n.accessor({get:function(t){var e;return null!=(e=this.get("target"))?e.get(t):void 0},set:function(t,e){var n;return null!=(n=this.get("target"))?n.set(t,e):void 0},unset:function(t){var e;return null!=(e=this.get("target"))?e.unset(t):void 0}}),n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.AssociationProxy=function(t){function n(t,e){this.association=t,this.model=e,n.__super__.constructor.call(this)}return e(n,t),n.prototype.loaded=!1,n.prototype.toJSON=function(){var t;return t=this.get("target"),null!=t?this.get("target").toJSON():void 0},n.prototype.load=function(t){var e=this;return this.fetch(function(n,r){return n||e._setTarget(r),"function"==typeof t?t(n,r):void 0}),this.get("target")},n.prototype.loadFromLocal=function(){var t;if(this._canLoad())return(t=this.fetchFromLocal())&&this._setTarget(t),t},n.prototype.fetch=function(t){var e;return this._canLoad()?(e=this.fetchFromLocal(),e?t(void 0,e):this.fetchFromRemote(t)):t(void 0,void 0)},n.accessor("loaded",Batman.Property.defaultAccessor),n.accessor("target",{get:function(){return this.fetchFromLocal()},set:function(t,e){return e}}),n.prototype._canLoad=function(){return null!=(this.get("foreignValue")||this.get("primaryValue"))},n.prototype._setTarget=function(t){return this.set("target",t),this.set("loaded",!0),this.fire("loaded",t)},n}(Batman.Proxy)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.HasOneProxy=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.accessor("primaryValue",function(){return this.model.get(this.association.primaryKey)}),r.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("primaryValue"))},r.prototype.fetchFromRemote=function(t){var e;return e={data:{}},e.data[this.association.foreignKey]=this.get("primaryValue"),this.association.options.url&&(e.collectionUrl=this.association.options.url,e.urlContext=this.model),this.association.getRelatedModel().loadWithOptions(e,function(e,n){return!n||n.length<=0?t(e||new Error("Couldn't find related record!"),void 0):t(void 0,n[0])})},r}(Batman.AssociationProxy)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.BelongsToProxy=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.accessor("foreignValue",function(){return this.model.get(this.association.foreignKey)}),r.prototype.fetchFromLocal=function(){return this.association.setIndex().get(this.get("foreignValue"))},r.prototype.fetchFromRemote=function(t){var e;return e={},this.association.options.url&&(e.recordUrl=this.association.options.url),this.association.getRelatedModel().findWithOptions(this.get("foreignValue"),e,t)},r}(Batman.AssociationProxy)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PolymorphicBelongsToProxy=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.accessor("foreignTypeValue",function(){return this.model.get(this.association.foreignTypeKey)}),r.prototype.fetchFromLocal=function(){return this.association.setIndexForType(this.get("foreignTypeValue")).get(this.get("foreignValue"))},r.prototype.fetchFromRemote=function(t){var e;return e={},this.association.options.url&&(e.recordUrl=this.association.options.url),this.association.getRelatedModelForType(this.get("foreignTypeValue")).findWithOptions(this.get("foreignValue"),e,t)},r}(Batman.BelongsToProxy)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.Accessible=function(t){function e(){this.accessor.apply(this,arguments)}return n(e,t),e}(Batman.Object),Batman.TerminalAccessible=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.propertyClass=Batman.Property,r}(Batman.Accessible)}.call(this),function(){Batman.URI=function(){function t(t){var n,r;for(r=h.exec(t),n=14;n--;)this[e[n]]=r[n]||"";this.queryParams=this.constructor.paramsFromQuery(this.query),delete this.authority,delete this.userInfo,delete this.relative,delete this.directory,delete this.file,delete this.query}var e,n,r,o,i,a,s,u,c,l,p,h;return h=/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,e=["source","protocol","authority","userInfo","user","password","hostname","port","relative","path","directory","file","query","hash"],t.prototype.queryString=function(){return this.constructor.queryFromParams(this.queryParams)},t.prototype.toString=function(){return[this.protocol?""+this.protocol+":":void 0,this.authority()?"//":void 0,this.authority(),this.relative()].join("")},t.prototype.userInfo=function(){return[this.user,this.password?":"+this.password:void 0].join("")},t.prototype.authority=function(){return[this.userInfo(),this.user||this.password?"@":void 0,this.hostname,this.port?":"+this.port:void 0].join("")},t.prototype.relative=function(){var t;return t=this.queryString(),[this.path,t?"?"+t:void 0,this.hash?"#"+this.hash:void 0].join("")},t.prototype.directory=function(){var t;return t=this.path.split("/"),t.length>1?t.slice(0,t.length-1).join("/")+"/":""
},t.prototype.file=function(){var t;return t=this.path.split("/"),t[t.length-1]},t.paramsFromQuery=function(t){var e,n,o,i,s,c;for(n={},c=t.split("&"),i=0,s=c.length;s>i;i++)o=c[i],(e=o.match(a))?u(n,r(e[1]),r(e[2])):u(n,r(o),null);return n},t.decodeQueryComponent=r=function(t){return decodeURIComponent(t.replace(c,"%20"))},s=/^[\[\]]*([^\[\]]+)\]*(.*)/,n=[/^\[\]\[([^\[\]]+)\]$/,/^\[\](.+)$/],c=/\+/g,p=/%20/g,a=/^([^=]*)=(.*)/,u=function(t,e,r){var o,i,a,c,l;if(l=e.match(s)){if(a=l[1],o=l[2],""===o)t[a]=r;else if("[]"===o){if(null==t[a]&&(t[a]=[]),"Array"!==Batman.typeOf(t[a]))throw new Error("expected Array (got "+Batman.typeOf(t[a])+') for param "'+a+'"');t[a].push(r)}else if(l=o.match(n[0])||o.match(n[1])){if(i=l[1],null==t[a]&&(t[a]=[]),"Array"!==Batman.typeOf(t[a]))throw new Error("expected Array (got "+Batman.typeOf(t[a])+') for param "'+a+'"');c=t[a][t[a].length-1],"Object"!==Batman.typeOf(c)||i in c?t[a].push(u({},i,r)):u(c,i,r)}else{if(null==t[a]&&(t[a]={}),"Object"!==Batman.typeOf(t[a]))throw new Error("expected Object (got "+Batman.typeOf(t[a])+') for param "'+a+'"');t[a]=u(t[a],o,r)}return t}},t.queryFromParams=l=function(t,e){var n,r,o,a;if(null==t)return e;if(a=Batman.typeOf(t),null==e&&"Object"!==a)throw new Error("value must be an Object");switch(a){case"Array":return function(){var r,i;if(n=[],0===t.length)n.push(l(null,""+e+"[]"));else for(r=0,i=t.length;i>r;r++)o=t[r],n.push(l(o,""+e+"[]"));return n}().join("&");case"Object":return function(){var n;n=[];for(r in t)o=t[r],n.push(l(o,e?""+e+"["+i(r)+"]":i(r)));return n}().join("&");default:return null!=e?""+e+"="+i(t):i(t)}},t.encodeComponent=o=function(t){return null!=t?encodeURIComponent(t):""},t.encodeQueryComponent=i=function(t){return o(t).replace(p,"+")},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Request=function(t){function n(t){var e,r,o,i;r={};for(o in t)e=t[o],("success"===o||"error"===o||"loading"===o||"loaded"===o)&&(r[o]=e,delete t[o]);n.__super__.constructor.call(this,t);for(o in r)e=r[o],this.on(o,e);(null!=(i=this.get("url"))?i.length:void 0)>0?this.autosend&&this.send():this.observe("url",function(t){return null!=t?this.send():void 0})}var r;return e(n,t),n.objectToFormData=function(t){var e,n,r,o,i,a,s,u;for(r=function(t,e,n){var o,i,a;return null==n&&(n=!1),e instanceof Batman.container.File?[[t,e]]:i=function(){switch(Batman.typeOf(e)){case"Object":return i=function(){var i;i=[];for(o in e)a=e[o],i.push(r(n?o:""+t+"["+o+"]",a));return i}(),i.reduce(function(t,e){return t.concat(e)},[]);case"Array":return e.reduce(function(e,n){return e.concat(r(""+t+"[]",n))},[]);default:return[[t,null!=e?e:""]]}}()},e=new Batman.container.FormData,s=r("",t,!0),i=0,a=s.length;a>i;i++)u=s[i],n=u[0],o=u[1],e.append(n,o);return e},n.dataHasFileUploads=r=function(t){var e,n,o,i,a;if("undefined"!=typeof File&&null!==File&&t instanceof File)return!0;switch(n=Batman.typeOf(t)){case"Object":for(e in t)if(o=t[e],r(o))return!0;break;case"Array":for(i=0,a=t.length;a>i;i++)if(o=t[i],r(o))return!0}return!1},n.wrapAccessor("method",function(t){return{set:function(e,n){return t.set.call(this,e,null!=n?"function"==typeof n.toUpperCase?n.toUpperCase():void 0:void 0)}}}),n.prototype.method="GET",n.prototype.hasFileUploads=function(){return r(this.data)},n.prototype.contentType="application/x-www-form-urlencoded",n.prototype.autosend=!0,n.prototype.send=function(){return Batman.developer.error("You must add a platform library to implement Batman.Request (for example, batman.jquery)")},n.set("pendingRequestCount",0),n.classAccessor("requestIsPending",function(){return this.get("pendingRequestCount")>0}),n.prototype.on("loading",function(){return Batman.Request.set("pendingRequestCount",Batman.Request.get("pendingRequestCount")+1)}),n.prototype.on("loaded",function(){return Batman.Request.set("pendingRequestCount",Batman.Request.get("pendingRequestCount")-1)}),n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.SetObserver=function(t){function r(t){var e=this;this.base=t,this._itemObservers=new Batman.SimpleHash,this._setObservers=new Batman.SimpleHash,this._setObservers.set("itemsWereAdded",function(){return e.fire.apply(e,["itemsWereAdded"].concat(n.call(arguments)))}),this._setObservers.set("itemsWereRemoved",function(){return e.fire.apply(e,["itemsWereRemoved"].concat(n.call(arguments)))}),this.on("itemsWereAdded",this.startObservingItems.bind(this)),this.on("itemsWereRemoved",this.stopObservingItems.bind(this))}return e(r,t),r.prototype.observedItemKeys=[],r.prototype.observerForItemAndKey=function(){},r.prototype._getOrSetObserverForItemAndKey=function(t,e){var n=this;return this._itemObservers.getOrSet(t,function(){var r;return r=new Batman.SimpleHash,r.getOrSet(e,function(){return n.observerForItemAndKey(t,e)})})},r.prototype.startObserving=function(){return this._manageItemObservers("observe"),this._manageSetObservers("addHandler")},r.prototype.stopObserving=function(){return this._manageItemObservers("forget"),this._manageSetObservers("removeHandler")},r.prototype.startObservingItems=function(t){var e,n,r;for(n=0,r=t.length;r>n;n++)e=t[n],this._manageObserversForItem(e,"observe")},r.prototype.stopObservingItems=function(t){var e,n,r;for(n=0,r=t.length;r>n;n++)e=t[n],this._manageObserversForItem(e,"forget")},r.prototype._manageObserversForItem=function(t,e){var n,r,o,i;if(null!=t?t.isObservable:void 0){for(i=this.observedItemKeys,r=0,o=i.length;o>r;r++)n=i[r],t[e](n,this._getOrSetObserverForItemAndKey(t,n));if("forget"===e)return this._itemObservers.unset(t)}},r.prototype._manageItemObservers=function(t){var e=this;return this.base.forEach(function(n){return e._manageObserversForItem(n,t)})},r.prototype._manageSetObservers=function(t){var e=this;return this.base.isObservable?this._setObservers.forEach(function(n,r){return e.base.event(n)[t](r)}):void 0},r}(Batman.Object)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.SetSort=function(e){function r(e,n,o){var i=this;this.key=n,null==o&&(o="asc"),this.compareElements=t(this.compareElements,this),r.__super__.constructor.call(this,e),this.descending="desc"===o.toLowerCase(),this.isSorted=!0,this.isCollectionEventEmitter&&(this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=function(t){return function(e,n){return i._handleItemsModified(t,e,n)}}),this._reIndex()}return n(r,e),r.prototype._handleItemsModified=function(t,e,n){var r,o,i,a,s,u,c,l,p=this;return s={},s[this.key]=n,u=function(e,n){return e===t&&(e=s),n===t&&(n=s),p.compareElements(e,n)},i=this._storage.slice(),c=this.constructor._binarySearch(i,t,u),r=c.match,a=c.index,r&&(i.splice(a,1),l=this.constructor._binarySearch(i,t,this.compareElements),r=l.match,o=l.index,a!==o)?(i.splice(o,0,t),this.set("_storage",i),this.fire("itemWasMoved",t,o,a)):void 0},r.prototype._handleItemsAdded=function(t){var e,n,r,o,i,a,s,u,c;for(a=this._storage.slice(),n=[],e=[],s=0,u=t.length;u>s;s++)o=t[s],c=this.constructor._binarySearch(a,o,this.compareElements),i=c.match,r=c.index,i||(a.splice(r,0,o),n.push(o),e.push(r));return this.set("_storage",a),this.set("length",this._storage.length),this.fire("itemsWereAdded",n,e)},r.prototype._handleItemsRemoved=function(t){var e,n,r,o,i,a,s,u,c;for(o=this._storage.slice(),a=[],i=[],s=0,u=t.length;u>s;s++)n=t[s],c=this.constructor._binarySearch(o,n,this.compareElements),r=c.match,e=c.index,r&&(o.splice(e,1),a.push(n),i.push(e));return this.set("_storage",o),this.set("length",this._storage.length),this.fire("itemsWereRemoved",a,i)},r.prototype.toArray=function(){var t;return"function"==typeof(t=this.base).registerAsMutableSource&&t.registerAsMutableSource(),this._storage.slice()},r.prototype.forEach=function(t,e){var n,r,o,i,a,s;for("function"==typeof(o=this.base).registerAsMutableSource&&o.registerAsMutableSource(),s=this._storage,r=i=0,a=s.length;a>i;r=++i)n=s[r],t.call(e,n,r,this)},r.prototype.find=function(t){var e,n,r,o;for(this.base.registerAsMutableSource(),o=this._storage,n=0,r=o.length;r>n;n++)if(e=o[n],t(e))return e},r.prototype.merge=function(t){return this.base.registerAsMutableSource(),function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(Batman.Set,this._storage,function(){}).merge(t).sortedBy(this.key,this.order)},r.prototype.compare=function(t,e){return t===e?0:void 0===t?1:void 0===e?-1:null===t?1:null===e?-1:t===!1?1:e===!1?-1:t===!0?1:e===!0?-1:t!==t?e!==e?0:1:e!==e?-1:t>e?1:e>t?-1:0},r.prototype.compareElements=function(t,e){var n,r,o;return r=this.key&&null!=t?Batman.get(t,this.key):t,"function"==typeof r&&(r=r.call(t)),null!=r&&(r=r.valueOf()),o=this.key&&null!=e?Batman.get(e,this.key):e,"function"==typeof o&&(o=o.call(e)),null!=o&&(o=o.valueOf()),n=this.descending?-1:1,this.compare(r,o)*n},r.prototype._reIndex=function(){var t,e;return t=this.base.toArray().sort(this.compareElements),null!=(e=this._setObserver)&&e.startObservingItems(t),this.set("_storage",t)},r.prototype._indexOfItem=function(t){var e,n,r;return r=this.constructor._binarySearch(this._storage,t,this.compareElements),n=r.match,e=r.index,n?e:-1},r._binarySearch=function(t,e,n){var r,o,i,a,s,u,c;for(c=0,o=t.length-1,u={};o>=c;)if(a=(o-c>>1)+c,r=n(e,t[a]),r>0)c=a+1;else{if(!(0>r)){for(s=!1,i=a;i>=0&&0===n(e,t[i]);){if(e===t[i]){a=i,s=!0;break}i--}if(!s)for(i=a+1;i<t.length&&0===n(e,t[i]);){if(e===t[i]){a=i,s=!0;break}i++}return{match:s,index:a}}o=a-1}return{match:!1,index:c}},r}(Batman.SetProxy)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.AssociationSet=function(t){function n(t,e){var r;this.foreignKeyValue=t,this.association=e,r=new Batman.Set,n.__super__.constructor.call(this,r,"_batmanID")}return e(n,t),n.prototype.loaded=!1,n.accessor("loaded",Batman.Property.defaultAccessor),n.prototype.load=function(t,e){var n,r=this;return n=this._getLoadOptions(),e?n.data=Batman.extend(n.data,t):e=t,null==this.foreignKeyValue?e(void 0,this):this.association.getRelatedModel().loadWithOptions(n,function(t,n,o){return t||r.markAsLoaded(),e(t,r,o)})},n.prototype._getLoadOptions=function(){var t;return t={data:{}},t.data[this.association.foreignKey]=this.foreignKeyValue,this.association.options.url&&(t.collectionUrl=this.association.options.url,t.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),t},n.prototype.markAsLoaded=function(){return this.set("loaded",!0),this.fire("loaded")},n.accessor("parentRecord",function(){var t,e,n,r;return t=this.get("association.model"),e=t.get("primaryKey"),n=this.get("foreignKeyValue"),r={},r[e]=n,t.createFromJSON(r)}),n.prototype.build=function(t){var e,n,r,o,i,a;return null==t&&(t={}),n={},n[this.get("association.foreignKey")]=this.get("foreignKeyValue"),i=this.get("association.options"),null!=i.inverseOf&&(n[i.inverseOf]=this.get("parentRecord")),a=i.namespace||Batman.currentApp,e=a[i.name],r=Batman.extend(t,n),o=new e(r),this.add(o),o},n}(Batman.SetSort)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicAssociationSet=function(t){function n(t,e,r){this.foreignKeyValue=t,this.foreignTypeKeyValue=e,this.association=r,n.__super__.constructor.call(this,this.foreignKeyValue,this.association)}return e(n,t),n.prototype._getLoadOptions=function(){var t;return t={data:{}},t.data[this.association.foreignKey]=this.foreignKeyValue,t.data[this.association.foreignTypeKey]=this.foreignTypeKeyValue,this.association.options.url&&(t.collectionUrl=this.association.options.url,t.urlContext=this.association.parentSetIndex().get(this.foreignKeyValue)),t},n}(Batman.AssociationSet)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SetMapping=function(t){function n(t,e){var r,o=this;this.base=t,this.key=e,r=this.base.mapToProperty(this.key),this._counter=new this.constructor.PresenceCounter(r),n.__super__.constructor.apply(this,r),this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=function(t){return function(e,n){return o._handleItemModified(t,e,n)}},this._setObserver.on("itemsWereAdded",this._handleItemsAdded.bind(this)),this._setObserver.on("itemsWereRemoved",this._handleItemsRemoved.bind(this)),this._setObserver.startObserving()}return e(n,t),n.prototype._handleItemsAdded=function(t){var e,n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(this._addValueInstance(e.get(this.key)));return o},n.prototype._handleItemsRemoved=function(t){var e,n,r,o;for(o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(this._removeValueInstance(e.get(this.key)));return o},n.prototype._handleItemModified=function(t,e,n){return this._removeValueInstance(n),this._addValueInstance(e)},n.prototype._addValueInstance=function(t){return this._counter.increment(t),this.add(t)},n.prototype._removeValueInstance=function(t){var e;return e=this._counter.decrement(t),0===e?this.remove(t):void 0},n}(Batman.Set),Batman.SetMapping.PresenceCounter=function(){function t(t){var e,n,r;for(this._storage=new Batman.SimpleHash,n=0,r=t.length;r>n;n++)e=t[n],this.increment(e)}return t.prototype.increment=function(t){var e;return e=this._storage.get(t),e?this._storage.set(t,e+1):this._storage.set(t,1)},t.prototype.decrement=function(t){var e;return e=this._storage.get(t),this._storage.set(t,e-1)},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.SetIndex=function(t){function n(t,e){var r=this;this.base=t,this.key=e,n.__super__.constructor.call(this),this._storage=new Batman.Hash,this.base.isEventEmitter&&(this._setObserver=new Batman.SetObserver(this.base),this._setObserver.observedItemKeys=[this.key],this._setObserver.observerForItemAndKey=this.observerForItemAndKey.bind(this),this._setObserver.on("itemsWereAdded",function(t){return r._addItems(t)}),this._setObserver.on("itemsWereRemoved",function(t){return r._removeItems(t)})),this._addItems(this.base._storage),this.startObserving()}return e(n,t),n.accessor("toArray",function(){return this.toArray()}),Batman.extend(n.prototype,Batman.Enumerable),n.prototype.propertyClass=Batman.Property,n.accessor(function(t){return this._resultSetForKey(t)}),n.prototype.startObserving=function(){var t;return null!=(t=this._setObserver)?t.startObserving():void 0},n.prototype.stopObserving=function(){var t;return null!=(t=this._setObserver)?t.stopObserving():void 0},n.prototype.observerForItemAndKey=function(t){var e=this;return function(n,r){return e._removeItemsFromKey(r,[t]),e._addItemsToKey(n,[t])}},n.prototype.forEach=function(t,e){var n=this;return this._storage.forEach(function(r,o){return o.get("length")>0?t.call(e,r,o,n):void 0})},n.prototype.toArray=function(){var t;return t=[],this._storage.forEach(function(e,n){return n.get("length")>0?t.push(e):void 0}),t},n.prototype._addItems=function(t){var e,n,r,o,i,a,s;if(null!=t?t.length:void 0){for(i=this._keyForItem(t[0]),r=[],e=a=0,s=t.length;s>a;e=++a)n=t[e],Batman.SimpleHash.prototype.equality(i,o=this._keyForItem(n))?r.push(n):(this._addItemsToKey(i,r),r=[n],i=o);return r.length?this._addItemsToKey(i,r):void 0}},n.prototype._removeItems=function(t){var e,n,r,o,i,a,s;if(null!=t?t.length:void 0){for(i=this._keyForItem(t[0]),r=[],e=a=0,s=t.length;s>a;e=++a)n=t[e],Batman.SimpleHash.prototype.equality(i,o=this._keyForItem(n))?r.push(n):(this._removeItemsFromKey(i,r),r=[n],i=o);return r.length?this._removeItemsFromKey(i,r):void 0}},n.prototype._addItemsToKey=function(t,e){var n;return n=this._resultSetForKey(t),n.add.apply(n,e),n},n.prototype._removeItemsFromKey=function(t,e){var n;return n=this._resultSetForKey(t),n.remove.apply(n,e),n},n.prototype._resultSetForKey=function(t){return this._storage.getOrSet(t,function(){return new Batman.Set})},n.prototype._keyForItem=function(t){return Batman.Keypath.forBaseAndKey(t,this.key).getValue()},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicAssociationSetIndex=function(t){function n(t,e,r){this.association=t,this.type=e,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),r)}return e(n,t),n.prototype._resultSetForKey=function(t){return this.association.setForKey(t)},n.prototype._addItemsToKey=function(t,e){var r,o;return r=function(){var t,n,r;for(r=[],t=0,n=e.length;n>t;t++)o=e[t],this.association.modelType()===o.get(this.association.foreignTypeKey)&&r.push(o);return r}.call(this),n.__super__._addItemsToKey.call(this,t,r)},n.prototype._removeItemsFromKey=function(t,e){var r,o;return r=function(){var t,n,r;for(r=[],t=0,n=e.length;n>t;t++)o=e[t],this.association.modelType()===o.get(this.association.foreignTypeKey)&&r.push(o);return r}.call(this),n.__super__._removeItemsFromKey.call(this,t,r)},n}(Batman.SetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.AssociationSetIndex=function(t){function n(t,e){this.association=t,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),e)}return e(n,t),n.prototype._resultSetForKey=function(t){return this.association.setForKey(t)},n.prototype.forEach=function(t,e){var n=this;return this.association.proxies.forEach(function(r,o){var i;return i=n.association.indexValueForRecord(r),o.get("length")>0?t.call(e,i,o,n):void 0})},n.prototype.toArray=function(){var t;return t=[],this.forEach(function(e){return t.push(e)}),t},n}(Batman.SetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.UniqueSetIndex=function(t){function n(){this._uniqueIndex=new Batman.Hash,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.accessor(function(t){return this._uniqueIndex.get(t)}),n.prototype._addItemsToKey=function(t,e){return n.__super__._addItemsToKey.apply(this,arguments),this._uniqueIndex.hasKey(t)?void 0:this._uniqueIndex.set(t,e[0])},n.prototype._removeItemsFromKey=function(t){var e;return e=n.__super__._removeItemsFromKey.apply(this,arguments),e.isEmpty()?this._uniqueIndex.unset(t):this._uniqueIndex.set(t,e._storage[0])},n}(Batman.SetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.UniqueAssociationSetIndex=function(t){function n(t,e){this.association=t,n.__super__.constructor.call(this,this.association.getRelatedModel().get("loaded"),e)}return e(n,t),n}(Batman.UniqueSetIndex)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicUniqueAssociationSetIndex=function(t){function n(t,e,r){this.association=t,this.type=e,n.__super__.constructor.call(this,this.association.getRelatedModelForType(e).get("loaded"),r)}return e(n,t),n}(Batman.UniqueSetIndex)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e=[].slice;Batman.Navigator=function(){function n(e){this.app=e,this.handleCurrentLocation=t(this.handleCurrentLocation,this)}return n.forApp=function(t){return new(this.defaultClass())(t)},n.defaultClass=function(){return Batman.config.usePushState&&Batman.PushStateNavigator.isSupported()?Batman.PushStateNavigator:Batman.HashbangNavigator},n.prototype.start=function(){var t=this;if("undefined"!=typeof window&&!this.started)return this.started=!0,this.startWatching(),Batman.currentApp.prevent("ready"),Batman.setImmediate(function(){return t.started&&Batman.currentApp?(t.checkInitialHash(),t.handleCurrentLocation(),Batman.currentApp.allowAndFire("ready")):void 0})},n.prototype.stop=function(){return this.stopWatching(),this.started=!1},n.prototype.checkInitialHash=function(t){var e,n,r;return null==t&&(t=window.location),r=Batman.HashbangNavigator.prototype.hashPrefix,e=t.hash,e.length>r.length&&e.substr(0,r.length)!==r?this.initialHash=e.substr(r.length-1):-1!==(n=e.indexOf("##BATMAN##"))?(this.initialHash=e.substr(n+10),this.replaceState(null,"",e.substr(r.length,n-r.length),t)):void 0},n.prototype.handleCurrentLocation=function(){return this.handleLocation(window.location)},n.prototype.handleLocation=function(t){var e;return e=this.pathFromLocation(t),e!==this.cachedPath?this.dispatch(e):void 0},n.prototype.dispatch=function(t){var e,n;return e=this.app.get("dispatcher"),this.cachedPath=this.initialHash?(n={initialHash:this.initialHash},delete this.initialHash,e.dispatch(t,n)):e.dispatch(t),this.cachedPath},n.prototype.redirect=function(t,e){var n,r,o;return null==e&&(e=!1),r="function"==typeof(o=this.app.get("dispatcher")).pathFromParams?o.pathFromParams(t):void 0,r&&(this._lastRedirect=r),n=this.dispatch(t),this._lastRedirect&&(this.cachedPath=this._lastRedirect),this._lastRedirect&&this._lastRedirect!==n||this[e?"replaceState":"pushState"](null,"",n),n},n.prototype.push=function(t){return Batman.developer.deprecated("Navigator::push","Please use Batman.redirect({}) instead."),this.redirect(t)},n.prototype.replace=function(t){return Batman.developer.deprecated("Navigator::replace","Please use Batman.redirect({}, true) instead."),this.redirect(t,!0)},n.prototype.normalizePath=function(){var t,n,r;return r=1<=arguments.length?e.call(arguments,0):[],r=function(){var e,o,i;for(i=[],t=e=0,o=r.length;o>e;t=++e)n=r[t],i.push((""+n).replace(/^(?!\/)/,"/").replace(/\/+$/,""));return i}(),r.join("")||"/"},n.normalizePath=n.prototype.normalizePath,n}()}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PushStateNavigator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.isSupported=function(){var t;return null!=("undefined"!=typeof window&&null!==window?null!=(t=window.history)?t.pushState:void 0:void 0)},r.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"popstate",this.handleCurrentLocation)},r.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"popstate",this.handleCurrentLocation)},r.prototype.pushState=function(t,e,n){return n!==this.pathFromLocation(window.location)?window.history.pushState(t,e,this.linkTo(n)):void 0},r.prototype.replaceState=function(t,e,n){return n!==this.pathFromLocation(window.location)?window.history.replaceState(t,e,this.linkTo(n)):void 0},r.prototype.linkTo=function(t){return this.normalizePath(Batman.config.pathToApp,t)},r.prototype.pathFromLocation=function(t){var e,n;return e=""+(t.pathname||"")+(t.search||""),n=new RegExp("^"+this.normalizePath(Batman.config.pathToApp)),this.normalizePath(e.replace(n,""))},r.prototype.handleLocation=function(t){var e,n;return n=this.pathFromLocation(t),e=Batman.HashbangNavigator.prototype.pathFromLocation(t),"/"===n&&"/"!==e?this.redirect(e,!0):r.__super__.handleLocation.apply(this,arguments)},r}(Batman.Navigator)}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Batman.HashbangNavigator=function(n){function o(){return this.detectHashChange=e(this.detectHashChange,this),this.handleHashChange=e(this.handleHashChange,this),t=o.__super__.constructor.apply(this,arguments)}return r(o,n),o.prototype.hashPrefix="#!","undefined"!=typeof window&&null!==window&&"onhashchange"in window?(o.prototype.startWatching=function(){return Batman.DOM.addEventListener(window,"hashchange",this.handleHashChange)},o.prototype.stopWatching=function(){return Batman.DOM.removeEventListener(window,"hashchange",this.handleHashChange)}):(o.prototype.startWatching=function(){return this.interval=setInterval(this.detectHashChange,100)},o.prototype.stopWatching=function(){return this.interval=clearInterval(this.interval)}),o.prototype.handleHashChange=function(){return this.ignoreHashChange?this.ignoreHashChange=!1:this.handleCurrentLocation()},o.prototype.detectHashChange=function(){return this.previousHash!==window.location.hash?(this.previousHash=window.location.hash,this.handleHashChange()):void 0},o.prototype.pushState=function(t,e,n){var r;return r=this.linkTo(n),r!==window.location.hash?(this.ignoreHashChange=!0,window.location.hash=r):void 0},o.prototype.replaceState=function(t,e,n,r){var o;return null==r&&(r=window.location),o=this.linkTo(n),o!==r.hash?(this.ignoreHashChange=!0,r.replace(""+(r.pathname||"")+(r.search||"")+(o||""))):void 0},o.prototype.linkTo=function(t){return this.hashPrefix+t},o.prototype.pathFromLocation=function(t){var e,n;return e=t.hash,n=this.hashPrefix.length,(null!=e?e.substr(0,n):void 0)===this.hashPrefix?this.normalizePath(e.substr(n)):"/"},o.prototype.handleLocation=function(t){var e;return Batman.config.usePushState?(e=Batman.PushStateNavigator.prototype.pathFromLocation(t),"/"!==e?t.replace(this.normalizePath(""+Batman.config.pathToApp+this.linkTo(e)+(this.initialHash?"##BATMAN##"+this.initialHash:""))):o.__super__.handleLocation.apply(this,arguments)):o.__super__.handleLocation.apply(this,arguments)},o}(Batman.Navigator)}.call(this),function(){Batman.RouteMap=function(){function t(){this.childrenByOrder=[],this.childrenByName={}}return t.prototype.memberRoute=null,t.prototype.collectionRoute=null,t.prototype.routeForParams=function(t){var e,n,r,o,i;if(this._cachedRoutes||(this._cachedRoutes={}),e=this.cacheKey(t),this._cachedRoutes[e])return this._cachedRoutes[e];for(i=this.childrenByOrder,r=0,o=i.length;o>r;r++)if(n=i[r],n.test(t))return this._cachedRoutes[e]=n},t.prototype.addRoute=function(t,e){var n,r,o=this;return this.childrenByOrder.push(e),t.length>0&&(r=t.split(".")).length>0?(n=r.shift(),this.childrenByName[n]||(this.childrenByName[n]=new Batman.RouteMap),this.childrenByName[n].addRoute(r.join("."),e)):e.get("member")?(Batman.developer["do"](function(){return o.memberRoute?Batman.developer.error("Member route with name "+t+" already exists!"):void 0}),this.memberRoute=e):(Batman.developer["do"](function(){return o.collectionRoute?Batman.developer.error("Collection route with name "+t+" already exists!"):void 0}),this.collectionRoute=e),!0},t.prototype.cacheKey=function(t){return"string"==typeof t?t:null!=t.path?t.path:""+t.controller+"#"+t.action},t}()}.call(this),function(){var t=[].slice;Batman.RouteMapBuilder=function(){function e(t,e,n,r){this.app=t,this.routeMap=e,this.parent=n,this.baseOptions=null!=r?r:{},this.parent?(this.rootPath=this.parent._nestingPath(),this.rootName=this.parent._nestingName()):(this.rootPath="",this.rootName="")}return e.BUILDER_FUNCTIONS=["resources","member","collection","route","root"],e.ROUTES={index:{cardinality:"collection",path:function(t){return t},name:function(t){return t}},"new":{cardinality:"collection",path:function(t){return""+t+"/new"},name:function(t){return""+t+".new"}},show:{cardinality:"member",path:function(t){return""+t+"/:id"},name:function(t){return t}},edit:{cardinality:"member",path:function(t){return""+t+"/:id/edit"},name:function(t){return""+t+".edit"}},collection:{cardinality:"collection",path:function(t,e){return""+t+"/"+e},name:function(t,e){return""+t+"."+e}},member:{cardinality:"member",path:function(t,e){return""+t+"/:id/"+e},name:function(t,e){return""+t+"."+e}}},e.prototype.resources=function(){var e,n,r,o,i,a,s,u,c,l,p,h,d,f,m,y,g,v,_,B,b,w,O,A,S,x;if(o=1<=arguments.length?t.call(arguments,0):[],f=function(){var t,e,n;for(n=[],t=0,e=o.length;e>t;t++)r=o[t],"string"==typeof r&&n.push(r);return n}(),"function"==typeof o[o.length-1]&&(a=o.pop()),p="object"==typeof o[o.length-1]?o.pop():{},n={index:!0,"new":!0,show:!0,edit:!0},p.except){for(S=p.except,_=0,w=S.length;w>_;_++)l=S[_],n[l]=!1;delete p.except}else if(p.only){for(l in n)v=n[l],n[l]=!1;for(x=p.only,B=0,O=x.length;O>B;B++)l=x[B],n[l]=!0;delete p.only}for(b=0,A=f.length;A>b;b++){d=f[b],m=Batman.helpers.pluralize(d),u=Batman.helpers.camelize(m,!0),s=this._childBuilder({controller:u}),null!=a&&a.call(s);for(e in n)c=n[e],c&&(g=this.constructor.ROUTES[e],i=g.name(m),h=g.path(m),y=Batman.extend({controller:u,action:e,path:h,as:i},p),s[g.cardinality](e,y))}return!0},e.prototype.member=function(){return this._addRoutesWithCardinality.apply(this,["member"].concat(t.call(arguments)))},e.prototype.collection=function(){return this._addRoutesWithCardinality.apply(this,["collection"].concat(t.call(arguments)))},e.prototype.root=function(t,e){return null==e&&(e={}),this.route("/",t,e)},e.prototype.route=function(t,e,n,r){return r||("function"==typeof n?(r=n,n=void 0):"function"==typeof e&&(r=e,e=void 0)),n?e&&(n.signature=e):(n="string"==typeof e?{signature:e}:e,n||(n={})),r&&(n.callback=r),n.as||(n.as=this._nameFromPath(t)),n.path=t,this._addRoute(n)},e.prototype._addRoutesWithCardinality=function(){var e,n,r,o,i,a,s,u,c,l;for(e=arguments[0],r=3<=arguments.length?t.call(arguments,1,u=arguments.length-1):(u=1,[]),o=arguments[u++],"string"==typeof o&&(r.push(o),o={}),o=Batman.extend({},this.baseOptions,o),o[e]=!0,s=this.constructor.ROUTES[e],i=Batman.helpers.underscore(o.controller),c=0,l=r.length;l>c;c++)n=r[c],a=Batman.extend({action:n},o),null==a.path&&(a.path=s.path(i,n)),null==a.as&&(a.as=s.name(i,n)),this._addRoute(a);return!0},e.prototype._addRoute=function(t){var e,n,r,o;return null==t&&(t={}),r=this.rootPath+t.path,n=this.rootName+Batman.helpers.camelize(t.as,!0),delete t.as,delete t.path,e=t.callback?Batman.CallbackActionRoute:Batman.ControllerActionRoute,t.app=this.app,o=new e(r,t),this.routeMap.addRoute(n,o),""===n?this.routeMap.addRoute("root",o):void 0},e.prototype._nameFromPath=function(t){return t=t.replace(Batman.Route.regexps.namedOrSplat,"").replace(/\/+/g,".").replace(/(^\.)|(\.$)/g,"")},e.prototype._nestingPath=function(){var t,e;return this.parent?(t=":"+Batman.helpers.singularize(this.baseOptions.controller)+"Id",e=Batman.helpers.underscore(this.baseOptions.controller),""+this.parent._nestingPath()+e+"/"+t+"/"):""},e.prototype._nestingName=function(){return this.parent?this.parent._nestingName()+this.baseOptions.controller+".":""},e.prototype._childBuilder=function(t){return null==t&&(t={}),new Batman.RouteMapBuilder(this.app,this.routeMap,this,t)},e}()}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);
return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.App=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}var o,i,a,s,u;for(n(r,e),r.classAccessor("currentParams",{get:function(){return new Batman.Hash},"final":!0}),r.classAccessor("paramsManager",{get:function(){var t,e;if(t=this.get("navigator"))return e=this.get("currentParams"),e.replacer=new Batman.ParamsReplacer(t,e)},"final":!0}),r.classAccessor("paramsPusher",{get:function(){var t,e;if(t=this.get("navigator"))return e=this.get("currentParams"),e.pusher=new Batman.ParamsPusher(t,e)},"final":!0}),r.classAccessor("routes",function(){return new Batman.NamedRouteQuery(this.get("routeMap"))}),r.classAccessor("routeMap",function(){return new Batman.RouteMap}),r.classAccessor("routeMapBuilder",function(){return new Batman.RouteMapBuilder(this,this.get("routeMap"))}),r.classAccessor("dispatcher",function(){return new Batman.Dispatcher(this,this.get("routeMap"))}),r.classAccessor("controllers",function(){return this.get("dispatcher.controllers")}),r.layout=void 0,r.shouldAllowEvent={},u=Batman.RouteMapBuilder.BUILDER_FUNCTIONS,i=function(t){return r[t]=function(){var e;return(e=this.get("routeMapBuilder"))[t].apply(e,arguments)}},a=0,s=u.length;s>a;a++)o=u[a],i(o);return r.event("ready").oneShot=!0,r.event("run").oneShot=!0,r.run=function(){var t,e,r,o,i=this;if(Batman.currentApp){if(Batman.currentApp===this)return;Batman.currentApp.stop()}return this.hasRun?!1:this.isPrevented("run")?(this.wantsToRun=!0,!1):(delete this.wantsToRun,Batman.currentApp=this,Batman.App.set("current",this),null==this.get("dispatcher")&&(this.set("dispatcher",new Batman.Dispatcher(this,this.get("routeMap"))),this.set("controllers",this.get("dispatcher.controllers"))),null==this.get("navigator")&&(this.set("navigator",Batman.Navigator.forApp(this)),Batman.navigator=this.get("navigator"),this.on("run",function(){return Object.keys(i.get("dispatcher").routeMap).length>0?Batman.navigator.start():void 0})),this.observe("layout",function(t){return null!=t?t.on("ready",function(){return i.fire("ready")}):void 0}),e=this.get("layout"),e?"string"==typeof e&&(r=this[Batman.helpers.camelize(e)+"View"]):null!==e&&(r=t=function(t){function e(){return o=e.__super__.constructor.apply(this,arguments)}return n(e,t),e}(Batman.View)),r&&(e=this.set("layout",new r({node:document.documentElement})),e.propagateToSubviews("viewWillAppear"),e.initializeBindings(),e.propagateToSubviews("isInDOM",!0),e.propagateToSubviews("viewDidAppear")),Batman.config.translations&&this.set("t",Batman.I18N.get("translations")),this.hasRun=!0,this.fire("run"),this)},r.event("ready").oneShot=!0,r.event("stop").oneShot=!0,r.stop=function(){var t;return null!=(t=this.navigator)&&t.stop(),Batman.navigator=null,this.hasRun=!1,this.fire("stop"),this},r}.call(this,Batman.Object)}.call(this),function(){Batman.Association=function(){function t(t,e,n){var r,o,i,a,s;this.model=t,this.label=e,null==n&&(n={}),o={namespace:Batman.currentApp,name:Batman.helpers.camelize(Batman.helpers.singularize(this.label))},this.options=Batman.extend(o,this.defaultOptions,n),this.options.nestUrl&&(null==this.model.urlNestsUnder&&Batman.developer.error("You must persist the the model "+this.model.constructor.name+" to use the url helpers on an association"),this.model.urlNestsUnder(Batman.helpers.underscore(this.getRelatedModel().get("resourceName")))),null!=this.options.extend&&Batman.extend(this,this.options.extend),i={encode:this.options.saveInline?this.encoder():!1,decode:this.decoder()},a=n.encoderKey||this.label,this.model.encode(a,i),r=this,s=function(){return r.getAccessor.call(this,r,this.model,this.label)},this.model.accessor(this.label,{get:s,set:t.defaultAccessor.set,unset:t.defaultAccessor.unset})}return t.prototype.associationType="",t.prototype.isPolymorphic=!1,t.prototype.defaultOptions={saveInline:!1,autoload:!0,nestUrl:!1,includeInTransaction:!0},t.prototype.getRelatedModel=function(){var t,e,n;return n=this.options.namespace||Batman.currentApp,t=this.options.name,e=null!=n?n[t]:void 0,Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" hasn't loaded yet.")}),e},t.prototype.getFromAttributes=function(t){return t.get("attributes."+this.label)},t.prototype.setIntoAttributes=function(t,e){return t.get("attributes").set(this.label,e)},t.prototype.inverse=function(){var t,e,n=this;return(e=this.getRelatedModel()._batman.get("associations"))?this.options.inverseOf?e.getByLabel(this.options.inverseOf):(t=null,e.forEach(function(e,r){return r.getRelatedModel()===n.model?t=r:void 0}),t):void 0},t.prototype.reset=function(){return delete this.index,!0},t}()}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PluralAssociation=function(t){function n(){n.__super__.constructor.apply(this,arguments),this._resetSetHashes()}return e(n,t),n.prototype.proxyClass=Batman.AssociationSet,n.prototype.isSingular=!1,n.prototype.setForRecord=function(t){var e,n,r=this;return n=this.indexValueForRecord(t),e=this.setIndex(),Batman.Property.withoutTracking(function(){return r._setsByRecord.getOrSet(t,function(){var t,e;return null!=n&&(t=r._setsByValue.get(n),null!=t)?t:(e=r.proxyClassInstanceForKey(n),null!=n&&r._setsByValue.set(n,e),e)})}),null!=n?e.get(n):this._setsByRecord.get(t)},n.prototype.setForKey=Batman.Property.wrapTrackingPrevention(function(t){var e,n=this;return e=void 0,this._setsByRecord.forEach(function(r,o){return null==e?n.indexValueForRecord(r)===t?e=o:void 0:void 0}),null!=e?(e.foreignKeyValue=t,e):this._setsByValue.getOrSet(t,function(){return n.proxyClassInstanceForKey(t)})}),n.prototype.proxyClassInstanceForKey=function(t){return new this.proxyClass(t,this)},n.prototype.getAccessor=function(t){var e,n,r=this;if(t.getRelatedModel())return(n=t.getFromAttributes(this))?n:(e=t.setForRecord(this),t.setIntoAttributes(this,e),Batman.Property.withoutTracking(function(){return!t.options.autoload||r.isNew()||e.loaded?void 0:e.load(function(t){if(t)throw t})}),e)},n.prototype.parentSetIndex=function(){return this.parentIndex||(this.parentIndex=this.model.get("loaded").indexedByUnique(this.primaryKey)),this.parentIndex},n.prototype.setIndex=function(){return this.index||(this.index=new Batman.AssociationSetIndex(this,this[this.indexRelatedModelOn])),this.index},n.prototype.indexValueForRecord=function(t){return t.get(this.primaryKey)},n.prototype.reset=function(){return n.__super__.reset.apply(this,arguments),this._resetSetHashes()},n.prototype._resetSetHashes=function(){return this._setsByRecord=new Batman.SimpleHash,this._setsByValue=new Batman.SimpleHash},n}(Batman.Association)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HasManyAssociation=function(t){function n(t,e,r){return(null!=r?r.as:void 0)?function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(Batman.PolymorphicHasManyAssociation,arguments,function(){}):(n.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(t.get("resourceName"))+"_id",void 0)}return e(n,t),n.prototype.associationType="hasMany",n.prototype.indexRelatedModelOn="foreignKey",n.prototype.apply=function(t,e){var n,r,o=this;return t||((n=this.getFromAttributes(e))&&n.forEach(function(t){return t.set(o.foreignKey,e.get(o.primaryKey))}),e.set(this.label,r=this.setForRecord(e)),"creating"!==e.lifecycle.get("state"))?void 0:r.markAsLoaded()},n.prototype.encoder=function(){var t;return t=this,function(e,n,r,o){var i;return null!=e&&(i=[],e.forEach(function(e){var n;return n=e.toJSON(),(!t.inverse()||t.inverse().options.encodeForeignKey)&&(n[t.foreignKey]=o.get(t.primaryKey)),i.push(n)})),i}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u,c,l,p,h,d,f,m,y;if(!(d=t.getRelatedModel()))return Batman.developer.error("Can't decode model "+t.options.name+" because it hasn't been loaded yet!"),void 0;for(a=t.setForRecord(i),c=a.filter(function(t){return t.isNew()}).toArray(),h=[],p=[],f=0,m=e.length;m>f;f++)u=e[f],s=u[d.primaryKey],l=d._loadIdentity(s),null!=l?p.push(l):c.length>0?(l=c.shift(),null!=s&&h.push(l)):(l=new d,null!=s&&h.push(l),p.push(l)),l._withoutDirtyTracking(function(){return this.fromJSON(u),t.options.inverseOf?l.set(t.options.inverseOf,i):void 0});return(y=d.get("loaded")).add.apply(y,h),a.add.apply(a,p),a.markAsLoaded(),a}},n}(Batman.PluralAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicHasManyAssociation=function(t){function n(t,e,r){r.inverseOf=this.foreignLabel=r.as,delete r.as,r.foreignKey||(r.foreignKey=""+this.foreignLabel+"_id"),n.__super__.constructor.call(this,t,e,r),this.foreignTypeKey=r.foreignTypeKey||""+this.foreignLabel+"_type",this.model.encode(this.foreignTypeKey)}return e(n,t),n.prototype.proxyClass=Batman.PolymorphicAssociationSet,n.prototype.isPolymorphic=!0,n.prototype.apply=function(t,e){var r,o=this;t||(r=this.getFromAttributes(e))&&(n.__super__.apply.apply(this,arguments),r.forEach(function(t){return t.set(o.foreignTypeKey,o.modelType())}))},n.prototype.proxyClassInstanceForKey=function(t){return new this.proxyClass(t,this.modelType(),this)},n.prototype.getRelatedModelForType=function(t){var e,n;return n=this.options.namespace||Batman.currentApp,t?(e=null!=n?n[t]:void 0,e||(e=null!=n?n[Batman.helpers.camelize(t)]:void 0)):e=this.getRelatedModel(),Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" for hasMany polymorphic association "+this.label+" not found.")}),e},n.prototype.modelType=function(){return this.model.get("resourceName")},n.prototype.setIndex=function(){return this.typeIndex||(this.typeIndex=new Batman.PolymorphicAssociationSetIndex(this,this.modelType(),this[this.indexRelatedModelOn]))},n.prototype.encoder=function(){var t;return t=this,function(e,n,r,o){var i;return null!=e&&(i=[],e.forEach(function(e){var n;return n=e.toJSON(),n[t.foreignKey]=o.get(t.primaryKey),n[t.foreignTypeKey]=t.modelType(),i.push(n)})),i}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u,c,l,p,h,d,f,m;for(a=t.getFromAttributes(i)||t.setForRecord(i),c=a.filter(function(t){return t.isNew()}).toArray(),p=[],f=0,m=e.length;m>f;f++){if(u=e[f],d=u[t.options.foreignTypeKey],!(h=t.getRelatedModelForType(d)))return Batman.developer.error("Can't decode model "+t.options.name+" because it hasn't been loaded yet!"),void 0;s=u[h.primaryKey],l=h._loadIdentity(s),null!=l?(l._withoutDirtyTracking(function(){return this.fromJSON(u)}),p.push(l)):c.length>0?(l=c.shift(),l._withoutDirtyTracking(function(){return this.fromJSON(u)}),l=h._mapIdentity(l)):(l=h._makeOrFindRecordFromData(u),p.push(l)),t.options.inverseOf&&l._withoutDirtyTracking(function(){return l.set(t.options.inverseOf,i)})}return a.add.apply(a,p),a.markAsLoaded(),a}},n}(Batman.HasManyAssociation)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.SingularAssociation=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.isSingular=!0,r.prototype.getAccessor=function(t){var e,n,r;return(r=t.getFromAttributes(this))?r:t.getRelatedModel()?(e=this.associationProxy(t),n=!1,Batman.Property.withoutTracking(function(){return e.get("loaded")})||(t.options.autoload?Batman.Property.withoutTracking(function(){return e.load()}):n=e.loadFromLocal()),n||e):void 0},r.prototype.setIndex=function(){return this.index||(this.index=new Batman.UniqueAssociationSetIndex(this,this[this.indexRelatedModelOn]))},r}(Batman.Association)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HasOneAssociation=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.primaryKey=this.options.primaryKey||"id",this.foreignKey=this.options.foreignKey||""+Batman.helpers.underscore(this.model.get("resourceName"))+"_id"}return e(n,t),n.prototype.associationType="hasOne",n.prototype.proxyClass=Batman.HasOneProxy,n.prototype.indexRelatedModelOn="foreignKey",n.prototype.apply=function(t,e){var n;return!t&&(n=this.getFromAttributes(e))?n.set(this.foreignKey,e.get(this.primaryKey)):void 0},n.prototype.encoder=function(){var t;return t=this,function(e,n,r,o){var i;if(t.options.saveInline)return(i=e.toJSON())&&(i[t.foreignKey]=o.get(t.primaryKey)),i}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s;if(e)return s=t.getRelatedModel(),a=s.createFromJSON(e),t.options.inverseOf&&a.set(t.options.inverseOf,i),a}},n}(Batman.SingularAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.BelongsToAssociation=function(t){function n(t,e,r){return(null!=r?r.polymorphic:void 0)?(delete r.polymorphic,function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(Batman.PolymorphicBelongsToAssociation,arguments,function(){})):(n.__super__.constructor.apply(this,arguments),this.foreignKey=this.options.foreignKey||""+this.label+"_id",this.primaryKey=this.options.primaryKey||"id",this.options.encodeForeignKey&&this.model.encode(this.foreignKey),void 0)}return e(n,t),n.prototype.associationType="belongsTo",n.prototype.proxyClass=Batman.BelongsToProxy,n.prototype.indexRelatedModelOn="primaryKey",n.prototype.defaultOptions={saveInline:!1,autoload:!0,encodeForeignKey:!0},n.prototype.encoder=function(){return function(t){return t.toJSON()}},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u;return u=t.getRelatedModel(),s=u.createFromJSON(e),t.options.inverseOf&&(a=t.inverse())&&(a instanceof Batman.HasManyAssociation?i.set(t.foreignKey,s.get(t.primaryKey)):s.set(a.label,i)),i.set(t.label,s),s}},n.prototype.apply=function(t){var e,n;return(n=t.get(this.label))&&(e=n.get(this.primaryKey),void 0!==e)?t.set(this.foreignKey,e):void 0},n}(Batman.SingularAssociation)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.PolymorphicBelongsToAssociation=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.foreignTypeKey=this.options.foreignTypeKey||""+this.label+"_type",this.options.encodeForeignTypeKey&&this.model.encode(this.foreignTypeKey),this.typeIndices={}}return e(n,t),n.prototype.isPolymorphic=!0,n.prototype.proxyClass=Batman.PolymorphicBelongsToProxy,n.prototype.defaultOptions=Batman.mixin({},Batman.BelongsToAssociation.prototype.defaultOptions,{encodeForeignTypeKey:!0}),n.prototype.getRelatedModel=!1,n.prototype.setIndex=!1,n.prototype.inverse=!1,n.prototype.apply=function(t){var e,r;return n.__super__.apply.apply(this,arguments),(r=t.get(this.label))?(e=r instanceof Batman.PolymorphicBelongsToProxy?r.get("foreignTypeValue"):r.constructor.get("resourceName"),t.set(this.foreignTypeKey,e)):void 0},n.prototype.getAccessor=function(t){var e,n;return(n=t.getFromAttributes(this))?n:t.getRelatedModelForType(this.get(t.foreignTypeKey))?(e=this.associationProxy(t),Batman.Property.withoutTracking(function(){return!e.get("loaded")&&t.options.autoload?e.load():void 0}),e):void 0},n.prototype.url=function(t){var e,n,r,o,i,a,s,u;return a=null!=(s=t.data)?s[this.foreignTypeKey]:void 0,a&&(o=this.inverseForType(a))?(i=Batman.helpers.pluralize(a).toLowerCase(),r=null!=(u=t.data)?u[this.foreignKey]:void 0,n=o.isSingular?"singularize":"pluralize",e=Batman.helpers[n](o.label),"/"+i+"/"+r+"/"+e):void 0},n.prototype.getRelatedModelForType=function(t){var e,n;return n=this.options.namespace||Batman.currentApp,t&&(e=null!=n?n[t]:void 0,e||(e=null!=n?n[Batman.helpers.camelize(t)]:void 0)),Batman.developer["do"](function(){return null==Batman.currentApp||e?void 0:Batman.developer.warn("Related model "+t+" for belongsTo polymorphic association "+this.label+" not found.")}),e},n.prototype.setIndexForType=function(t){var e;return(e=this.typeIndices)[t]||(e[t]=new Batman.PolymorphicUniqueAssociationSetIndex(this,t,this.primaryKey)),this.typeIndices[t]},n.prototype.inverseForType=function(t){var e,n,r,o=this;return(n=null!=(r=this.getRelatedModelForType(t))?r._batman.get("associations"):void 0)?this.options.inverseOf?n.getByLabel(this.options.inverseOf):(e=null,n.forEach(function(t,n){return n.getRelatedModel()===o.model?e=n:void 0}),e):void 0},n.prototype.decoder=function(){var t;return t=this,function(e,n,r,o,i){var a,s,u,c;return a=r[t.foreignTypeKey]||i.get(t.foreignTypeKey),c=t.getRelatedModelForType(a),u=c.createFromJSON(e),t.options.inverseOf&&(s=t.inverseForType(a))&&(s instanceof Batman.PolymorphicHasManyAssociation?(i.set(t.foreignKey,u.get(t.primaryKey)),i.set(t.foreignTypeKey,a)):u.set(s.label,i)),i.set(t.label,u),u}},n}(Batman.BelongsToAssociation)}.call(this),function(){var t={}.hasOwnProperty;Batman.Transaction={isTransaction:!0,base:function(){return this._batman.base},applyChanges:function(e){var n,r,o,i,a,s;if(null==e&&(e=[]),-1!==e.indexOf(this))return this.base();e.push(this),n=this.get("attributes").toObject();for(o in n)t.call(n,o)&&(a=n[o],a instanceof Batman.Model&&a.isTransaction?(a.applyChanges(e),delete n[o]):a instanceof Batman.TransactionAssociationSet&&(i=a.applyChanges(e),n[o]=i));return r=this.base(),r.mixin(n),null!=(s="function"==typeof r.applyChanges?r.applyChanges():void 0)?s:r},save:function(t,e){var n,r,o,i=this;return e||(o=[{},t],t=o[0],e=o[1]),this.once("validated",r=function(){return i.applyChanges()}),n=function(){return i.off("validated",r),"function"==typeof e?e.apply(null,arguments):void 0},this.constructor.prototype.save.call(this,t,function(t,e){return t||(e=i.base(),e.get("dirtyKeys").clear(),e.get("_dirtiedKeys").clear(),e.get("lifecycle").startTransition("save"),e.get("lifecycle").startTransition("saved")),n(t,e)})}}}.call(this),function(){var e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.TransactionAssociationSet=function(e){function o(t,e,n){this.set("associationSet",t),this._loader=this._addFromAssociationSet.bind(this),t.on("itemsWereAdded",this._loader),this._visited=e,this._stack=n,this._storage=[],this._originalStorage=[],this._removedStorage=[],this.add.apply(this,t.toArray())}return n(o,e),o.prototype.isTransaction=!0,o.delegate("association","foreignKeyValue",{to:"associationSet"}),o.prototype._addFromAssociationSet=function(t){return this.add.apply(this,t)},o.prototype.add=o.mutation(function(){var t,e,n,o,i,a,s,u;for(n=1<=arguments.length?r.call(arguments,0):[],t=[],s=0,u=n.length;u>s;s++)e=n[s],e instanceof Batman.Model&&!e.isTransaction?(a=e._transaction(this._visited,this._stack),this._storage.push(a),t.push(a),o=this._originalStorage.indexOf(e),-1===o&&this._originalStorage.push(e),i=this._removedStorage.indexOf(e),i>-1&&this._removedStorage.splice(i,1)):Batman.developer.warn("You tried to add a "+e.constructor.name+" to a TransactionAssociationSet ("+this.get("association.label")+")",e);return this.length=this._storage.length,t.length&&this.fire("itemsWereAdded",t),t}),o.prototype.remove=o.mutation(function(){var e,n,o,i,a,s,u,c;for(s=1<=arguments.length?r.call(arguments,0):[],o=[],u=0,c=s.length;c>u;u++){if(a=s[u],!a.isTransaction)throw"Tried to remove real item from transaction set: "+t.toJSON();i=this._storage.indexOf(a),i>-1&&(this._storage.splice(i,1),o.push(a)),e=a.base(),n=this._originalStorage.indexOf(e),n>-1&&(this._removedStorage.push(e),this._originalStorage.splice(n,1))}return this.length=this._storage.length,o.length&&this.fire("itemsWereRemoved",o),o}),o.prototype.applyChanges=function(t){var e,n,r,o,i,a;for(a=this._storage,o=0,i=a.length;i>o;o++)r=a[o],r.applyChanges(t);return e=function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(Batman.Set,this._originalStorage,function(){}),n=this.get("associationSet"),n.off("itemsWereAdded",this._loader),n.replace(e),n.set("removedItems",function(t,e,n){n.prototype=t.prototype;var r=new n,o=t.apply(r,e);return Object(o)===o?o:r}(Batman.Set,this._removedStorage,function(){})),n},o.accessor("length",function(){return this.registerAsMutableSource(),this.length}),o.prototype.build=Batman.AssociationSet.prototype.build,o}(Batman.Set)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e},n=[].slice;Batman.Validator=function(t){function r(){var t,e;e=arguments[0],t=2<=arguments.length?n.call(arguments,1):[],this.options=e,r.__super__.constructor.apply(this,t)}return e(r,t),r.triggers=function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],null!=this._triggers?this._triggers.concat(t):this._triggers=t},r.options=function(){var t;return t=1<=arguments.length?n.call(arguments,0):[],null!=this._options?this._options.concat(t):this._options=t},r.matches=function(t){var e,n,r,o,i,a;n={},r=!1;for(e in t)o=t[e],~(null!=(i=this._options)?i.indexOf(e):void 0)&&(n[e]=o),~(null!=(a=this._triggers)?a.indexOf(e):void 0)&&(n[e]=o,r=!0);return r?n:void 0},r.prototype.validateEach=function(){return Batman.developer.error("You must override validateEach in Batman.Validator subclasses.")},r.prototype.format=function(t,e,n,r){return this.options.message?"function"==typeof this.options.message?this.options.message.call(r,t,e):this.options.message:Batman.t("errors.messages."+e,n)},r.prototype.handleBlank=function(t){return this.options.allowBlank&&!Batman.PresenceValidator.prototype.isPresent(t)?!0:void 0},r}(Batman.Object)}.call(this),function(){Batman.Validators=[],Batman.extend(Batman.translate.messages,{errors:{base:{format:"%{message}"},format:"%{attribute} %{message}",messages:{too_short:"must be at least %{count} characters",too_long:"must be less than %{count} characters",wrong_length:"must be %{count} characters",blank:"can't be blank",not_numeric:"must be a number",greater_than:"must be greater than %{count}",greater_than_or_equal_to:"must be greater than or equal to %{count}",equal_to:"must be equal to %{count}",less_than:"must be less than %{count}",less_than_or_equal_to:"must be less than or equal to %{count}",not_an_integer:"must be an integer",not_matching:"is not valid",invalid_association:"is not valid",not_included_in_list:"is not included in the list",included_in_list:"is included in the list",not_an_email:"is not a valid email address",confirmation_does_not_match:"and confirmation do not match"}}})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.RegExpValidator=function(t){function n(t){var e;this.regexp=null!=(e=t.regexp)?e:t.pattern,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("regexp","pattern"),n.options("allowBlank"),n.prototype.validateEach=function(t,e,n,r){var o;return o=e.get(n),this.handleBlank(o)?r():(null!=o&&""!==o&&this.regexp.test(o)||t.add(n,this.format(n,"not_matching",{},e)),r())},n}(Batman.Validator),Batman.Validators.push(Batman.RegExpValidator)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.PresenceValidator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.triggers("presence"),r.prototype.validateEach=function(t,e,n,r){var o;return o=e.get(n),this.isPresent(o)||t.add(n,this.format(n,"blank",{},e)),r()},r.prototype.isPresent=function(t){return null!=t&&""!==t},r}(Batman.Validator),Batman.Validators.push(Batman.PresenceValidator)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.NumericValidator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.triggers("numeric","greaterThan","greaterThanOrEqualTo","equalTo","lessThan","lessThanOrEqualTo","onlyInteger"),r.options("allowBlank"),r.prototype.validateEach=function(t,e,n,r){var o,i;return o=this.options,i=e.get(n),this.handleBlank(i)?r():(null==i||!this.isNumeric(i)&&!this.canCoerceToNumeric(i)?t.add(n,this.format(n,"not_numeric",{},e)):o.onlyInteger&&!this.isInteger(i)?t.add(n,this.format(n,"not_an_integer",{},e)):(null!=o.greaterThan&&i<=o.greaterThan&&t.add(n,this.format(n,"greater_than",{count:o.greaterThan},e)),null!=o.greaterThanOrEqualTo&&i<o.greaterThanOrEqualTo&&t.add(n,this.format(n,"greater_than_or_equal_to",{count:o.greaterThanOrEqualTo},e)),null!=o.equalTo&&i!==o.equalTo&&t.add(n,this.format(n,"equal_to",{count:o.equalTo},e)),null!=o.lessThan&&i>=o.lessThan&&t.add(n,this.format(n,"less_than",{count:o.lessThan},e)),null!=o.lessThanOrEqualTo&&i>o.lessThanOrEqualTo&&t.add(n,this.format(n,"less_than_or_equal_to",{count:o.lessThanOrEqualTo},e))),r())},r.prototype.isNumeric=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},r.prototype.isInteger=function(t){return parseFloat(t)===(0|t)},r.prototype.canCoerceToNumeric=function(t){return t-0==t&&t.length>0},r}(Batman.Validator),Batman.Validators.push(Batman.NumericValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.LengthValidator=function(t){function n(t){var e;(e=t.lengthIn||t.lengthWithin)&&(t.minLength=e[0],t.maxLength=e[1]||-1,delete t.lengthWithin,delete t.lengthIn),n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("minLength","maxLength","length","lengthWithin","lengthIn"),n.options("allowBlank"),n.prototype.validateEach=function(t,e,n,r){var o,i;return o=this.options,i=e.get(n),this.handleBlank(i)?r():(null==i&&(i=[]),o.minLength&&i.length<o.minLength&&t.add(n,this.format(n,"too_short",{count:o.minLength},e)),o.maxLength&&i.length>o.maxLength&&t.add(n,this.format(n,"too_long",{count:o.maxLength},e)),o.length&&i.length!==o.length&&t.add(n,this.format(n,"wrong_length",{count:o.length},e)),r())},n}(Batman.Validator),Batman.Validators.push(Batman.LengthValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.InclusionValidator=function(t){function n(t){this.acceptableValues=t.inclusion["in"],n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("inclusion"),n.options("allowBlank"),n.prototype.validateEach=function(t,e,n,r){var o;return o=e.get(n),this.handleBlank(o)||-1!==this.acceptableValues.indexOf(o)||t.add(n,this.format(n,"not_included_in_list",{},e)),r()},n}(Batman.Validator),Batman.Validators.push(Batman.InclusionValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ExclusionValidator=function(t){function n(t){this.unacceptableValues=t.exclusion["in"],n.__super__.constructor.apply(this,arguments)}return e(n,t),n.triggers("exclusion"),n.prototype.validateEach=function(t,e,n,r){return this.unacceptableValues.indexOf(e.get(n))>=0&&t.add(n,this.format(n,"included_in_list",{},e)),r()},n}(Batman.Validator),Batman.Validators.push(Batman.ExclusionValidator)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.EmailValidator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.triggers("email"),r.prototype.emailRegexp=/[a-z0-9!#$%&'*+\/=?^_`{|}~.-]+@[a-z0-9-]+(\.[a-z0-9-]+)*/,r.prototype.validateEach=function(t,e,n,r){var o;return o=e.get(n),null!=o&&""!==o&&this.emailRegexp.test(o)||t.add(n,this.format(n,"not_an_email",{},e)),r()},r}(Batman.Validator),Batman.Validators.push(Batman.EmailValidator)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.ConfirmationValidator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.triggers("confirmation"),r.prototype.validateEach=function(t,e,n,r){var o,i,a,s;return a=this.options,a.confirmation?(o="String"===Batman.typeOf(this.options.confirmation)?this.options.confirmation:n+"_confirmation",s=e.get(n),i=e.get(o),s!==i&&t.add(n,this.format(n,"confirmation_does_not_match",{},e)),r()):void 0},r}(Batman.Validator),Batman.Validators.push(Batman.ConfirmationValidator)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.AssociatedValidator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.triggers("associated"),r.prototype.validateEach=function(t,e,n,r){var o,i,a,s=this;return a=e.get(n),null!=a?(a instanceof Batman.AssociationProxy&&(a="function"==typeof a.get?a.get("target"):void 0),i=1,o=function(o,a){return a.length>0&&t.add(n,s.format(n,"invalid_association",{},e)),0===--i?r():void 0},null!=(null!=a?a.forEach:void 0)?a.forEach(function(t){return i+=1,t.validate(o)}):null!=(null!=a?a.validate:void 0)&&(i+=1,a.validate(o)),o(null,[])):r()},r}(Batman.Validator),Batman.Validators.push(Batman.AssociatedValidator)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.AssociatedFieldValidator=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.triggers("associatedFields"),r.prototype.validateEach=function(t,e,n,r){var o,i,a;return a=e.get(n),null!=a?(a instanceof Batman.AssociationProxy&&(a="function"==typeof a.get?a.get("target"):void 0),i=1,o=function(e,n){return null!=n&&n.forEach(function(e){return t.add(e.get("attribute"),e.get("message"))}),0===--i?r():void 0},null!=(null!=a?a.forEach:void 0)?a.forEach(function(t){return i+=1,t.validate(o)}):null!=(null!=a?a.validate:void 0)&&(i+=1,a.validate(o)),o(null,[])):r()},r}(Batman.Validator),Batman.Validators.push(Batman.AssociatedFieldValidator)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e
}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.ControllerActionFrame=function(t){function n(t,e){n.__super__.constructor.call(this,t),this.once("complete",e)}return e(n,t),n.prototype.operationOccurred=!1,n.prototype.remainingOperations=0,n.prototype.event("complete").oneShot=!0,n.prototype.startOperation=function(t){return null==t&&(t={}),t.internal||(this.operationOccurred=!0),this._changeOperationsCounter(1),!0},n.prototype.finishOperation=function(){return this._changeOperationsCounter(-1),!0},n.prototype.startAndFinishOperation=function(t){return this.startOperation(t),this.finishOperation(t),!0},n.prototype._changeOperationsCounter=function(t){var e;this.remainingOperations+=t,0===this.remainingOperations&&this.fire("complete"),null!=(e=this.parentFrame)&&e._changeOperationsCounter(t)},n}(Batman.Object)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.HTMLStore=function(t){function n(){n.__super__.constructor.apply(this,arguments),this._htmlContents={},this._requestedPaths=new Batman.SimpleSet}return e(n,t),n.prototype.propertyClass=Batman.Property,n.prototype.fetchHTML=function(t){var e=this;return new Batman.Request({url:Batman.Navigator.normalizePath(Batman.config.pathToHTML,""+t+".html"),type:"html",success:function(n){return e.set(t,n)},error:function(){throw new Error("Could not load html from "+t)}})},n.accessor({"final":!0,get:function(t){var e;if("/"!==t.charAt(0))return this.get("/"+t);if(this._htmlContents[t])return this._htmlContents[t];if(!this._requestedPaths.has(t)){if(e=this._sourceFromDOM(t))return e;if(!Batman.config.fetchRemoteHTML)throw new Error("Couldn't find html source for '"+t+"'!");this.fetchHTML(t)}},set:function(t,e){return"/"!==t.charAt(0)?this.set("/"+t,e):(this._requestedPaths.add(t),this._htmlContents[t]=e)}}),n.prototype.prefetch=function(t){return this.get(t),!0},n.prototype._sourceFromDOM=function(t){var e,n;return n=t.slice(1),(e=Batman.DOM.querySelector(document,"[data-defineview*='"+n+"']"))?(Batman.setImmediate(function(){var t;return null!=(t=e.parentNode)?t.removeChild(e):void 0}),Batman.View.store.set(Batman.Navigator.normalizePath(t),e.innerHTML)):void 0},n}(Batman.Object)}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t},o=[].slice;Batman.View=function(t){function e(){var t,n=this;this.bindings=[],this.subviews=new Batman.Set,this.subviews.on("itemsWereAdded",function(t){var e,r,o;for(r=0,o=t.length;o>r;r++)e=t[r],n._addSubview(e)}),this.subviews.on("itemsWereRemoved",function(t){var e,n,r;for(n=0,r=t.length;r>n;n++)e=t[n],e._removeFromSuperview()}),e.__super__.constructor.apply(this,arguments),(t=this.superview)&&(this.superview=null,t.subviews.add(this))}return r(e,t),e.store=new Batman.HTMLStore,e.option=function(){var t,e;return t=1<=arguments.length?o.call(arguments,0):[],Batman.initializeObject(this),(e=this._batman.options)&&(t=e.concat(t)),this._batman.set("options",t)},e.filter=function(t,e){var n;return Batman.initializeObject(this.prototype),n=this.prototype._batman.filters||{},n[t]=e,this.prototype._batman.set("filters",n)},e.viewForNode=function(t,e){var n;for(null==e&&(e=!0);t;){if(n=Batman._data(t,"view"))return n;if(!e)return;t=t.parentNode}},e.prototype.bindings=[],e.prototype.subviews=[],e.prototype.superview=null,e.prototype.controller=null,e.prototype.source=null,e.prototype.html=null,e.prototype.node=null,e.prototype.bindImmediately=!0,e.prototype.isBound=!1,e.prototype.isInDOM=!1,e.prototype.isView=!0,e.prototype.isDead=!1,e.prototype.isBackingView=!1,e.prototype._addChildBinding=function(t){return this.bindings.push(t)},e.prototype._addSubview=function(t){var e,n,r,o;return n=t.controller,t.removeFromSuperview(),t.set("controller",n||this.controller),t.set("superview",this),t.fireAndCall("viewDidMoveToSuperview"),(r=t.contentFor)&&!t.parentNode&&(o=Batman.DOM.Yield.withName(r),o.set("contentView",t)),(e=this._batman.get("filters"))&&t._batman.set("filters",Batman.mixin({},e,t._batman.get("filters"))),this.get("node"),t.get("node"),this.observe("node",t._nodesChanged),t.observe("node",t._nodesChanged),t.observe("parentNode",t._nodesChanged),t._nodesChanged()},e.prototype._removeFromSuperview=function(){var t;if(this.superview)return this.fireAndCall("viewWillRemoveFromSuperview"),this.forget("node",this._nodesChanged),this.forget("parentNode",this._nodesChanged),this.superview.forget("node",this._nodesChanged),t=this.get("superview"),this.removeFromParentNode(),this.set("superview",null),this.set("controller",null)},e.prototype.removeFromSuperview=function(){var t;return null!=(t=this.superview)?t.subviews.remove(this):void 0},e.prototype._nodesChanged=function(){var t,e;if(this.node)return this.bindImmediately&&this.initializeBindings(),e=this.superview.get("node"),t=this.parentNode,"string"==typeof t&&(t=Batman.DOM.querySelector(e,t)),t||(t=e),t?this.addToParentNode(t):void 0},e.prototype.addToParentNode=function(t){var e;if(this.get("node"))return e=Batman.DOM.containsNode(t),e&&this.propagateToSubviews("viewWillAppear"),this.insertIntoDOM(t),this.propagateToSubviews("isInDOM",e),e?this.propagateToSubviews("viewDidAppear"):void 0},e.prototype.insertIntoDOM=function(t){return t!==this.node?t.appendChild(this.node):void 0},e.prototype.removeFromParentNode=function(){var t,e,n,r,o;return e=this.get("node"),t=null!=(n=this.wasInDOM)?n:Batman.DOM.containsNode(e),t&&this.propagateToSubviews("viewWillDisappear"),null!=(r=this.node)&&null!=(o=r.parentNode)&&o.removeChild(this.node),this.propagateToSubviews("isInDOM",!1),t?this.propagateToSubviews("viewDidDisappear"):void 0},e.prototype.propagateToSubviews=function(t,e){var n,r,o,i,a;for(null!=e?this.set(t,e):this.fireAndCall(t),i=this.subviews._storage,a=[],r=0,o=i.length;o>r;r++)n=i[r],a.push(n.propagateToSubviews(t,e));return a},e.prototype.loadView=function(t){var e,n;return null!=(e=this.get("html"))?(n=t||document.createElement("div"),Batman.DOM.setInnerHTML(n,e),n):void 0},e.accessor("html",{get:function(){var t,e,n,r=this;if(null!=this.html)return this.html;if(n=this.get("source"))return n=Batman.Navigator.normalizePath(n),this.html=this.constructor.store.get(n),null==this.html&&(e=this.property("html"),t=function(n){return null!=n&&r.set("html",n),e.removeHandler(t)},e.addHandler(t)),this.html},set:function(t,e){return this.destroyBindings(),this.destroySubviews(),this.html=e,this.node&&null!=e&&this.loadView(this.node),this.bindImmediately?this.initializeBindings():void 0}}),e.accessor("node",{get:function(){var t;return null!=this.node||this.isDead||(t=this.loadView(),t&&this.set("node",t),this.fireAndCall("viewDidLoad")),this.node},set:function(t,e,n){var r=this;return n&&Batman.removeData(n,"view",!0),e!==this.node&&(this.destroyBindings(),this.destroySubviews(),this.node=e,e)?(Batman._data(e,"view",this),Batman.developer["do"](function(){var t,n;return t=r.get("displayName")||r.get("source"),"function"==typeof(n=e===document?document.body:e).setAttribute?n.setAttribute("batman-view",r.constructor.name+(t?": "+t:"")):void 0}),e):void 0}}),e.prototype.event("ready").oneShot=!0,e.prototype.initializeBindings=function(){return!this.isBound&&this.node?(new Batman.BindingParser(this),this.set("isBound",!0),this.fireAndCall("ready")):void 0},e.prototype.destroyBindings=function(){var t,e,n,r;for(r=this.bindings,e=0,n=r.length;n>e;e++)t=r[e],t.die();return this.bindings=[],this.isBound=!1},e.prototype.destroySubviews=function(){var t,e,n,r;if(this.isDead)return Batman.developer.warn("Tried to destroy the subviews of a dead view."),void 0;for(r=this.subviews.toArray(),e=0,n=r.length;n>e;e++)t=r[e],t.die();return this.subviews.clear()},e.prototype.die=function(){var t,e,n,r;if(this.isDead)return Batman.developer.warn("Tried to die() a view more than once."),void 0;if(this.fireAndCall("destroy"),this.destroyBindings(),this.destroySubviews(),this.node&&(this.wasInDOM=Batman.DOM.containsNode(this.node),Batman.DOM.destroyNode(this.node)),this.removeFromSuperview(),this.forget(),null!=(n=this._batman.properties)&&n.forEach(function(t,e){return e.die()}),this._batman.events){r=this._batman.events;for(e in r)t=r[e],t.clearHandlers()}return this.node=null,this.parentNode=null,this.subviews=null,this.isDead=!0},e.prototype.baseForKeypath=function(t){return t.split(".")[0].split("|")[0].trim()},e.prototype.prefixForKeypath=function(t){var e;return e=t.lastIndexOf("."),-1!==e?t.substr(0,e):t},e.prototype.targetForKeypath=function(t,e){var n,r,o,i;for(r=this;r;){if(i=this._testTargetForKeypath(r,t))return i;if(!e||o||r.isBackingView||(o=Batman.get(r,"proxiedObject")||r),!n&&r.isView&&r.controller&&(n=r.controller),r.isView&&r.superview)r=r.superview;else if(n)r=n,n=null;else{if(r.window)break;r=Batman.currentApp&&r!==Batman.currentApp?Batman.currentApp:{window:Batman.container}}}return o},e.prototype._testTargetForKeypath=function(t,e){var n;return(n=Batman.get(t,"proxiedObject"))&&"undefined"!=typeof Batman.get(n,e)?n:"undefined"!=typeof Batman.get(t,e)?t:void 0},e.prototype.lookupKeypath=function(t){var e,n;return e=this.baseForKeypath(t),n=this.targetForKeypath(e),n?Batman.get(n,t):void 0},e.prototype.setKeypath=function(t,e){var n,r,o;return n=this.prefixForKeypath(t),r=this.targetForKeypath(n,!0),r&&r!==Batman.container?null!=(o=Batman.Property.forBaseAndKey(r,t))?o.setValue(e):void 0:void 0},e.prototype.fireAndCall=function(t){return this.fire(t),"function"==typeof this[t]?this[t]():void 0},e}(Batman.Object),null==(t=Batman.container).$context&&(t.$context=function(t){for(var e;t;){if(e=Batman._data(t,"backingView")||Batman._data(t,"view"))return e;t=t.parentNode}}),null==(e=Batman.container).$subviews&&(e.$subviews=function(t){var e;return null==t&&(t=Batman.currentApp.layout),e=[],t.subviews.forEach(function(t){var n,r;return n=Batman.mixin({},t),n.constructor=t.constructor,n.subviews=(null!=(r=t.subviews)?r.length:void 0)?$subviews(t):null,Batman.unmixin(n,{_batman:!0}),e.push(n)}),e})}.call(this),function(){var t,e=function(t,e){return function(){return t.apply(e,arguments)}},n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Batman.DOM.AbstractBinding=function(t){function n(t){this._fireDataChange=e(this._fireDataChange,this);var n;this.node=t.node,this.keyPath=t.keyPath,this.view=t.view,t.onlyObserve&&(this.onlyObserve=t.onlyObserve),null!=t.skipParseFilter&&(this.skipParseFilter=t.skipParseFilter),this.skipParseFilter||this.parseFilter(),"function"==typeof this.backWithView&&(n=this.backWithView),this.backWithView&&this.setupBackingView(n,t.viewOptions),this.bindImmediately&&this.bind()}var o,i,a,s,u,c;return r(n,t),a=/(^|,)\s*(?:(true|false)|("[^"]*")|(\{[^\}]*\})|(([0-9\_\-]+[a-zA-Z\_\-]|[a-zA-Z])[\w\-\.\?\!\+]*))\s*(?=$|,)/g,o=/(?:\]\.)(.+?)(?=[\[\.]|\s*\||$)/,i=/(?!^\s*)\[(.*?)\]/g,n.accessor("filteredValue",{get:function(){var t,e,n;return n=this.get("unfilteredValue"),e=this,this.filterFunctions.length>0?t=this.filterFunctions.reduce(function(t,n,r){var o;for(o=e.filterArguments[r].map(function(t){return t._keypath?e.view.lookupKeypath(t._keypath):t}),o.unshift(t);o.length<n.length-1;)o.push(void 0);return o.push(e),n.apply(e.view,o)},n):n},set:function(t,e){return this.set("unfilteredValue",e)}}),n.accessor("unfilteredValue",{get:function(){return this._unfilteredValue(this.get("key"))},set:function(t,e){var n;return(n=this.get("key"))?this.view.setKeypath(n,e):this.set("value",e)}}),n.prototype._unfilteredValue=function(t){return t?this.view.lookupKeypath(t):this.get("value")},s=Batman.BindingDefinitionOnlyObserve.All,u=Batman.BindingDefinitionOnlyObserve.Data,c=Batman.BindingDefinitionOnlyObserve.Node,n.prototype.bindImmediately=!0,n.prototype.shouldSet=!0,n.prototype.isInputBinding=!1,n.prototype.escapeValue=!0,n.prototype.onlyObserve=s,n.prototype.skipParseFilter=!1,n.prototype.isTwoWay=function(){return null!=this.key&&0===this.filterFunctions.length},n.prototype.bind=function(){var t,e;return this.node&&((t=this.onlyObserve)===s||t===c)&&Batman.DOM.nodeIsEditable(this.node)&&(Batman.DOM.events.change(this.node,this._fireNodeChange.bind(this)),this.onlyObserve===c&&this._fireNodeChange()),((e=this.onlyObserve)===s||e===u)&&this.observeAndFire("filteredValue",this._fireDataChange),this.view._addChildBinding(this)},n.prototype._fireNodeChange=function(t){var e;return this.shouldSet=!1,e=this.value||this.get("keyContext"),"function"==typeof this.nodeChange&&this.nodeChange(this.node,e,t),this.fire("nodeChange",this.node,e),this.shouldSet=!0},n.prototype._fireDataChange=function(t){return this.shouldSet?("function"==typeof this.dataChange&&this.dataChange(t,this.node),this.fire("dataChange",t,this.node)):void 0},n.prototype.die=function(){var t;return this.forget(),null!=(t=this._batman.properties)&&t.forEach(function(t,e){return e.die()}),this.node=null,this.keyPath=null,this.view=null,this.backingView=null,this.superview=null},n.prototype.parseFilter=function(){var t,e,n,r,a,s,u,c,l,p,h,d;for(this.filterFunctions=[],this.filterArguments=[],c=this.keyPath;o.test(c);)c=c.replace(o,"]['$1']");s=c.replace(i," | get $1 ").replace(/'/g,'"').split(/(?!")\s+\|\s+(?!")/);try{u=this.parseSegment(l=s.shift())[0]}catch(f){e=f,Batman.developer.warn(e),Batman.developer.error("Error! Couldn't parse keypath in \""+l+'". Parsing error above.')}if(u&&u._keypath?this.key=u._keypath:this.value=u,s.length){for(;a=s.shift();){if(p=a.indexOf(" "),-1===p&&(p=a.length),r=a.substr(0,p),t=a.substr(p),!(n=(null!=(h=this.view)?null!=(d=h._batman.get("filters"))?d[r]:void 0:void 0)||Batman.Filters[r]))return Batman.developer.error("Unrecognized filter '"+r+"' in key \""+this.keyPath+'"!');this.filterFunctions.push(n);try{this.filterArguments.push(this.parseSegment(t))}catch(f){e=f,Batman.developer.error('Bad filter arguments "'+t+'"!')}}return!0}},n.prototype.parseSegment=function(t){return t=t.replace(a,function(t,e,n,r,o,i){var a;return null==e&&(e=""),a=i?'{"_keypath": "'+i+'"}':n||r||o,e+a}),JSON.parse("["+t+"]")},n.prototype.setupBackingView=function(t,e){return this.backingView?this.backingView:this.node&&(this.backingView=Batman._data(this.node,"view"))?this.backingView:(this.superview=this.view,e||(e={}),null==e.node&&(e.node=this.node),null==e.parentNode&&(e.parentNode=this.node),e.isBackingView=!0,this.backingView=new(t||Batman.BackingView)(e),this.superview.subviews.add(this.backingView),this.node&&Batman._data(this.node,"view",this.backingView),this.backingView)},n}(Batman.Object),Batman.BackingView=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return r(n,e),n.prototype.isBackingView=!0,n.prototype.bindImmediately=!1,n}(Batman.View)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ViewBinding=function(t){function n(t){this.superview=t.view,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.skipChildren=!0,n.prototype.bindImmediately=!1,n.prototype.initialized=function(){return this.bind()},n.prototype.dataChange=function(t){var e,n,r,o,i,a,s,u;if(null!=(u=this.viewInstance)&&u.removeFromSuperview(),t){if(t.isView?(this.fromViewClass=!1,this.viewInstance=t,this.viewInstance.removeFromSuperview()):(this.fromViewClass=!0,this.viewInstance=new t),this.node.removeAttribute("data-view"),i=this.viewInstance.constructor._batman.get("options"))for(a=0,s=i.length;s>a;a++)o=i[a],e="data-view-"+o.toLowerCase(),(r=this.node.getAttribute(e))&&(this.node.removeAttribute(e),n=new Batman.DOM.ReaderBindingDefinition(this.node,r,this.superview),new Batman.DOM.ViewArgumentBinding(n,o,this.viewInstance));return this.viewInstance.set("parentNode",this.node),this.viewInstance.set("node",this.node),this.viewInstance.loadView(this.node),this.superview.subviews.add(this.viewInstance)}},n.prototype.die=function(){return this.fromViewClass?this.viewInstance.die():this.viewInstance.removeFromSuperview(),this.superview=null,this.viewInstance=null,n.__super__.die.apply(this,arguments)},n}(Batman.DOM.AbstractBinding),Batman.DOM.ViewArgumentBinding=function(t){function n(t,e,r){var o=this;this.option=e,this.targetView=r,n.__super__.constructor.call(this,t),this.targetView.observe(this.option,this._updateValue=function(t){return o.isDataChanging?void 0:o.view.setKeypath(o.keyPath,t)})}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){return this.isDataChanging=!0,this.targetView.set(this.option,t),this.isDataChanging=!1},n.prototype.die=function(){return this.targetView.forget(this.option,this._updateValue),this.targetView=null,n.__super__.die.apply(this,arguments)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ValueBinding=function(t){function n(t){var e;this.isInputBinding="input"===(e=t.node.nodeName.toLowerCase())||"textarea"===e,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.node.value):void 0},n.prototype.dataChange=function(t){return Batman.DOM.valueForNode(this.node,t,this.escapeValue)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ShowHideBinding=function(t){function n(t){var e;e=t.node.style.display,e&&"none"!==e||(e=""),this.originalDisplay=e,this.invert=t.invert,n.__super__.constructor.apply(this,arguments)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.dataChange=function(t){var e;return e=Batman.View.viewForNode(this.node,!1),!!t==!this.invert?(null!=e&&e.fireAndCall("viewWillShow"),this.node.style.display=this.originalDisplay,null!=e?e.fireAndCall("viewDidShow"):void 0):(null!=e&&e.fireAndCall("viewWillHide"),Batman.DOM.setStyleProperty(this.node,"display","none","important"),null!=e?e.fireAndCall("viewDidHide"):void 0)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=function(t,e){return function(){return t.apply(e,arguments)}};Batman.SelectView=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype._addChildBinding=function(t){return r.__super__._addChildBinding.apply(this,arguments),this.fire("childBindingAdded",t)},r}(Batman.BackingView),Batman.DOM.SelectBinding=function(t){function e(){this.updateOptionBindings=r(this.updateOptionBindings,this),this.nodeChange=r(this.nodeChange,this),this.dataChange=r(this.dataChange,this),this.childBindingAdded=r(this.childBindingAdded,this),e.__super__.constructor.apply(this,arguments),this.node.removeAttribute("data-bind"),this.node.removeAttribute("data-source"),this.node.removeAttribute("data-target"),this.backingView.on("childBindingAdded",this.childBindingAdded),this.backingView.initializeBindings()}return n(e,t),e.prototype.backWithView=Batman.SelectView,e.prototype.isInputBinding=!0,e.prototype.canSetImplicitly=!0,e.prototype.skipChildren=!0,e.prototype.die=function(){return this.backingView.off("childBindingAdded",this.childBindingAdded),e.__super__.die.apply(this,arguments)},e.prototype.childBindingAdded=function(t){var e=this;if(t instanceof Batman.DOM.CheckedBinding)t.on("dataChange",this.nodeChange);else{if(!(t instanceof Batman.DOM.IteratorBinding))return;t.backingView.on("itemsWereRendered",function(){return e._fireDataChange(e.get("filteredValue"))})}return this._fireDataChange(this.get("filteredValue"))},e.prototype.lastKeyContext=null,e.prototype.dataChange=function(t){var e,n,r,o,i,a,s;if(this.lastKeyContext||(this.lastKeyContext=this.get("keyContext")),this.lastKeyContext!==this.get("keyContext")&&(this.canSetImplicitly=!0,this.lastKeyContext=this.get("keyContext")),null!=t?t.forEach:void 0){for(r={},s=this.node.children,o=0,i=s.length;i>o;o++)e=s[o],e.selected=!1,n=r[a=e.value]||(r[a]=[]),n.push(e);t.forEach(function(t){var e,n,o,i;if(e=r[t])for(o=0,i=e.length;i>o;o++)n=e[o],n.selected=!0})}else null==t&&this.canSetImplicitly?this.node.value&&(this.canSetImplicitly=!1,this.set("unfilteredValue",this.node.value)):(this.canSetImplicitly=!1,Batman.DOM.valueForNode(this.node,t,this.escapeValue));this.updateOptionBindings(),this.fixSelectElementWidth()},e.prototype.nodeChange=function(){var t;this.isTwoWay()&&(t=Batman.DOM.valueForNode(this.node),typeof t===Array&&1===t.length&&(t=t[0]),this.set("unfilteredValue",t),this.updateOptionBindings())},e.prototype.updateOptionBindings=function(){var t,e,n,r;for(r=this.backingView.bindings,e=0,n=r.length;n>e;e++)t=r[e],t instanceof Batman.DOM.CheckedBinding&&t._fireNodeChange()},e.prototype.fixSelectElementWidth=function(){var t=this;if(-1!==window.navigator.userAgent.toLowerCase().indexOf("msie"))return this._fixWidthTimeout&&clearTimeout(this._fixWidthTimeout),this._fixWidthTimeout=setTimeout(function(){return t._fixWidthTimeout=null,t._fixSelectElementWidth()},100)},e.prototype._fixSelectElementWidth=function(){var t,e,n;return(e=null!=(n=this.get("node"))?n.style:void 0)?(t=this.get("node").currentStyle.width,e.width="100%",e.width=null!=t?t:""):void 0},e}(Batman.DOM.AbstractBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.RouteBinding=function(e){function r(){this.routeClick=t(this.routeClick,this);var e,n;r.__super__.constructor.apply(this,arguments),(n=this.node.getAttribute("data-route-params"))&&(e=new Batman.DOM.ReaderBindingDefinition(this.node,n,this.view),this.set("queryParams",new Batman.DOM.RouteParamsBinding(e,this)))}return n(r,e),r.prototype.onAnchorTag=!1,r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,r.accessor("dispatcher",function(){return this.view.lookupKeypath("dispatcher")||Batman.App.get("current.dispatcher")}),r.prototype.bind=function(){var t;return("a"===(t=this.node.nodeName)||"A"===t)&&(this.onAnchorTag=!0),r.__super__.bind.apply(this,arguments),this.onAnchorTag&&this.node.getAttribute("target")?void 0:Batman.DOM.events.primaryInteractionEvent(this.node,this.routeClick)},r.prototype.routeClick=function(t,e){var n;if(!e.__batmanActionTaken)return e.__batmanActionTaken=!0,n=this.generatePath(this.get("filteredValue"),this.get("queryParams.filteredValue")),null!=n?Batman.redirect(n):void 0},r.prototype.dataChange=function(t,e,n){var r;return t&&(r=this.generatePath(t,n||this.get("queryParams.filteredValue"))),this.onAnchorTag?(r=r&&Batman.navigator?Batman.navigator.linkTo(r):"#",this.node.href=r):void 0},r.prototype.generatePath=function(t,e){var n,r,o;return n=(null!=t?t.isNamedRouteQuery:void 0)?t.get("path"):null!=(o=this.get("dispatcher"))?o.pathFromParams(t):void 0,e&&n?("Object"===Batman.typeOf(e)?null!=e.toObject&&(e=e.toObject()):e=Batman.URI.paramsFromQuery(e),r=new Batman.URI(n),r.queryParams=e,r.toString()):n},r}(Batman.DOM.AbstractBinding),Batman.DOM.RouteParamsBinding=function(t){function e(t,n){this.routeBinding=n,e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,e.prototype.dataChange=function(t){return this.routeBinding.dataChange(this.routeBinding.get("filteredValue"),this.node,t)},e}(Batman.DOM.AbstractBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.RadioBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.accessor("parsedNodeValue",function(){return Batman.DOM.attrReaders._parseAttribute(this.node.value)}),r.prototype.firstBind=!0,r.prototype.dataChange=function(){var t;return t=this.get("filteredValue"),null!=t?this.node.checked=t===Batman.DOM.attrReaders._parseAttribute(this.node.value):this.firstBind&&this.node.checked&&this.set("filteredValue",this.get("parsedNodeValue")),this.firstBind=!1},r.prototype.nodeChange=function(){return this.isTwoWay()?this.set("filteredValue",this.get("parsedNodeValue")):void 0},r}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.FileBinding=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.view.set("fileAttributes",null)}return e(n,t),n.prototype.isInputBinding=!0,n.prototype.nodeChange=function(t){return this.isTwoWay()?t.hasAttribute("multiple")?this.set("filteredValue",Array.prototype.slice.call(t.files)):this.set("filteredValue",t.files[0]||null):void 0},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DeferredRenderView=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.bindImmediately=!1,r}(Batman.View),Batman.DOM.DeferredRenderBinding=function(t){function e(t){this.invert=t.invert,this.attributeName=this.invert?"data-deferif":"data-renderif",e.__super__.constructor.apply(this,arguments)}return n(e,t),e.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,e.prototype.backWithView=Batman.DeferredRenderView,e.prototype.skipChildren=!0,e.prototype.dataChange=function(t){return!!t!=!this.invert||this.backingView.isBound?void 0:(this.node.removeAttribute(this.attributeName),this.backingView.initializeBindings())},e}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.developer["do"](function(){var t;return t=function(t){function n(){n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(Batman.DOM.AbstractBinding),Batman.DOM.readers.debug=function(e){return new t(e)}})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.AbstractAttributeBinding=function(t){function n(t){this.attributeName=t.attr,n.__super__.constructor.apply(this,arguments)}return e(n,t),n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.Tracking={loadTracker:function(){return Batman.Tracking.tracker?Batman.Tracking.tracker:(Batman.Tracking.tracker=Batman.currentApp.EventTracker?new Batman.currentApp.EventTracker:(Batman.developer.warn("Define "+Batman.currentApp.name+".EventTracker to use data-track"),{track:function(){}}),Batman.Tracking.tracker)},trackEvent:function(t,e,n){return Batman.Tracking.loadTracker().track(t,e,n)}},Batman.DOM.ClickTrackingBinding=function(t){function n(){var t,e=this;n.__super__.constructor.apply(this,arguments),t=function(){return Batman.Tracking.trackEvent("click",e.get("filteredValue"),e.node)},Batman.DOM.events.click(this.node,t,this.view,"click",!1),this.bind()}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,n.prototype.bindImmediately=!1,n}(Batman.DOM.AbstractAttributeBinding),Batman.DOM.ViewTrackingBinding=function(t){function n(){n.__super__.constructor.apply(this,arguments),Batman.Tracking.trackEvent("view",this.get("filteredValue"),this.node)}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.EventBinding=function(t){function n(){var t,e,r=this;n.__super__.constructor.apply(this,arguments),e=function(){var t,e;return t=r.get("filteredValue"),e=r.view.targetForKeypath(r.functionPath||r.unfilteredKey),e&&r.functionPath&&(e=Batman.get(e,r.functionPath)),null!=t?t.apply(e,arguments):void 0},(t=Batman.DOM.events[this.attributeName])?t(this.node,e,this.view):Batman.DOM.events.other(this.node,this.attributeName,e,this.view),this.bind()}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.None,n.prototype.bindImmediately=!1,n.prototype._unfilteredValue=function(t){var e,r;return this.unfilteredKey=t,this.functionName||-1===(e=t.lastIndexOf("."))||(this.functionPath=t.substr(0,e),this.functionName=t.substr(e+1)),r=n.__super__._unfilteredValue.call(this,this.functionPath||t),this.functionName?null!=r?r[this.functionName]:void 0:r},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.ContextBinding=function(t){function n(t){var e,r=this;this.contextKeypath=t.attr||"proxiedObject",n.__super__.constructor.apply(this,arguments),e=this.attributeName?"data-"+this.bindingName+"-"+this.attributeName:"data-"+this.bindingName,this.node.removeAttribute(e),this.node.insertBefore(document.createComment("batman-"+e+'="'+this.keyPath+'"'),this.node.firstChild),this.backingView.observe(this.contextKeypath,this._updateValue=function(t){return r.isDataChanging?void 0:r.view.setKeypath(r.keyPath,t)})}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.backWithView=!0,n.prototype.bindingName="context",n.prototype.dataChange=function(t){return this.isDataChanging=!0,this.backingView.set(this.contextKeypath,t),this.isDataChanging=!1},n.prototype.die=function(){return this.backingView.forget(this.contextKeypath,this._updateValue),this.backingView.unset(this.contextKeypath),n.__super__.die.apply(this,arguments)},n}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.FormBinding=function(t){function n(){n.__super__.constructor.apply(this,arguments),this.initializeErrorsList(),this.initializeChildBindings(),Batman.DOM.events.submit(this.node,function(t,e){return Batman.DOM.preventDefault(e)})}return e(n,t),n.prototype.bindingName="formfor",n.prototype.errorClass="error",n.prototype.defaultErrorsListSelector="div.errors",n.prototype.initializeChildBindings=function(){var t,e,n,r,o,i,a,s,u,c,l,p;
for(a=this.keyPath,t=this.attributeName,c=["input","textarea","select"].map(function(e){return""+e+'[data-bind^="'+t+'"]'}),u=Batman.DOM.querySelectorAll(this.node,c.join(", ")),e="data-addclass-"+this.errorClass,l=0,p=u.length;p>l;l++)s=u[l],s.getAttribute(e)||(n=s.getAttribute("data-bind"),o=n.substr(n.indexOf(t)+t.length+1),i=o.indexOf("|"),-1!==i&&(o=o.substr(0,i)),o=o.trim(),s.setAttribute(e,""+t+".errors."+o+".length"));r=Batman.DOM.querySelector(this.node,".errors"),r&&!r.getAttribute("data-showif")&&r.setAttribute("data-showif",""+t+".errors.length")},n.prototype.initializeErrorsList=function(){var t,e;return e=this.node.getAttribute("data-errors-list")||this.defaultErrorsListSelector,(t=Batman.DOM.querySelector(this.node,e))?Batman.DOM.setInnerHTML(t,this.errorsListHTML()):void 0},n.prototype.errorsListHTML=function(){return'<ul>\n  <li data-foreach-error="'+this.attributeName+'.errors" data-bind="error.fullMessage"></li>\n</ul>'},n}(Batman.DOM.ContextBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.NodeAttributeBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.dataChange=function(t){return null==t&&(t=""),this.node[this.attributeName]=t},r.prototype.nodeChange=function(t){return this.isTwoWay()?this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(t[this.attributeName])):void 0},r}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.CheckedBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.isInputBinding=!0,r.prototype.dataChange=function(t){return this.node[this.attributeName]=!!t},r}(Batman.DOM.NodeAttributeBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.AttributeBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,r.prototype.dataChange=function(t){return this.node.setAttribute(this.attributeName,t)},r.prototype.nodeChange=function(t){return this.isTwoWay()?this.set("filteredValue",Batman.DOM.attrReaders._parseAttribute(t.getAttribute(this.attributeName))):void 0},r}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};t=/[ \t]{2,}/g,Batman.DOM.AddClassBinding=function(e){function r(t){var e;this.invert=t.invert,this.classes=function(){var n,r,o,i;for(o=t.attr.split("|"),i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push({name:e,pattern:new RegExp("(?:^|\\s)"+e+"(?:$|\\s)","i")});return i}(),r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,r.prototype.dataChange=function(e){var n,r,o,i,a,s,u,c;for(n=this.node.className,u=this.classes,a=0,s=u.length;s>a;a++)c=u[a],o=c.name,i=c.pattern,r=i.test(n),!!e==!this.invert?r||(n=""+n+" "+o):r&&(n=n.replace(i," "));return this.node.className=n.trim().replace(t," "),!0},r}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.AbstractCollectionBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.dataChange=function(t){var e,n;null!=t?this.bindCollection(t)||(e=(null!=t?t.forEach:void 0)?(n=[],t.forEach(function(t){return n.push(t)}),n):Object.keys(t),this.handleArrayChanged(e)):(this.unbindCollection(),this.collection=[],this.handleArrayChanged([]))},r.prototype.bindCollection=function(t){var e;return t instanceof Batman.Hash&&(t=t.meta),t===this.collection?!0:(this.unbindCollection(),this.collection=t,(null!=(e=this.collection)?e.isObservable:void 0)?(this.collection.isCollectionEventEmitter&&this.handleItemsAdded&&this.handleItemsRemoved&&this.handleItemMoved?(this.collection.on("itemsWereAdded",this.handleItemsAdded),this.collection.on("itemsWereRemoved",this.handleItemsRemoved),this.collection.on("itemWasMoved",this.handleItemMoved),this.handleArrayChanged(this.collection.toArray())):this.collection.observeAndFire("toArray",this.handleArrayChanged),!0):!1)},r.prototype.unbindCollection=function(){var t;if(null!=(t=this.collection)?t.isObservable:void 0)return this.collection.isCollectionEventEmitter&&this.handleItemsAdded&&this.handleItemsRemoved&&this.handleItemMoved?(this.collection.off("itemsWereAdded",this.handleItemsAdded),this.collection.off("itemsWereRemoved",this.handleItemsRemoved),this.collection.off("itemWasMoved",this.handleItemMoved)):this.collection.forget("toArray",this.handleArrayChanged)},r.prototype.handleArrayChanged=function(){},r.prototype.die=function(){return this.unbindCollection(),this.collection=null,r.__super__.die.apply(this,arguments)},r}(Batman.DOM.AbstractAttributeBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t},r=[].slice;Batman.DOM.StyleBinding=function(o){function i(){this.setStyle=t(this.setStyle,this),this.handleArrayChanged=t(this.handleArrayChanged,this),this.oldStyles={},this.styleBindings={},i.__super__.constructor.apply(this,arguments)}return n(i,o),i.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,i.prototype.dataChange=function(t){var n,o,i,a,s,u,c,l;if(!t)return this.resetStyles(),void 0;if(this.unbindCollection(),"string"!=typeof t)if(t instanceof Batman.Hash)this.bindCollection(t);else{t instanceof Batman.Object&&(t=t.toJSON()),this.resetStyles();for(i in t)e.call(t,i)&&this.bindSingleAttribute(i,""+this.keyPath+"."+i)}else for(this.resetStyles(),c=t.split(";"),s=0,u=c.length;u>s;s++)a=c[s],l=a.split(":"),o=l[0],n=2<=l.length?r.call(l,1):[],this.setStyle(o,n.join(":"))},i.prototype.handleArrayChanged=function(){var t=this;return this.collection.forEach(function(e){return t.bindSingleAttribute(e,""+t.keyPath+"."+e)})},i.prototype.bindSingleAttribute=function(t,e){var n;return n=new Batman.DOM.AttrReaderBindingDefinition(this.node,t,e,this.view),this.styleBindings[t]=new Batman.DOM.StyleBinding.SingleStyleBinding(n,this)},i.prototype.setStyle=function(t,e){return t=Batman.helpers.camelize(t.trim(),!0),""===t?!1:(null==this.oldStyles[t]&&(this.oldStyles[t]=this.node.style[t]||""),(null!=e?e.trim:void 0)&&(e=e.trim()),null==e&&(e=""),this.node.style[t]=e)},i.prototype.resetStyles=function(){var t,n,r;r=this.oldStyles;for(t in r)e.call(r,t)&&(n=r[t],this.setStyle(t,n))},i.prototype.resetBindings=function(){var t,e,n;n=this.styleBindings;for(t in n)e=n[t],e._fireDataChange(""),e.die();return this.styleBindings={}},i.prototype.unbindCollection=function(){return this.resetBindings(),i.__super__.unbindCollection.apply(this,arguments)},i.SingleStyleBinding=function(t){function e(t,n){this.parent=n,e.__super__.constructor.call(this,t)}return n(e,t),e.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,e.prototype.isTwoWay=function(){return!1},e.prototype.dataChange=function(t){return this.parent.setStyle(this.attributeName,t)},e}(Batman.DOM.AbstractAttributeBinding),i}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.ClassBinding=function(r){function o(){this.handleArrayChanged=t(this.handleArrayChanged,this),this.existingClasses=arguments[0].node.className.split(" "),o.__super__.constructor.apply(this,arguments)}return n(o,r),o.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,o.prototype.dataChange=function(t){var e;return null!=t?(this.unbindCollection(),"string"==typeof t?(e=[t].concat(this.existingClasses),this.node.className=e.join(" ").trim()):(this.bindCollection(t),this.updateFromCollection())):void 0},o.prototype.updateFromCollection=function(){var t,n,r,o,i;return this.collection?(t=this.collection.map?this.collection.map(function(t){return t}):function(){var t,n;t=this.collection,n=[];for(r in t)e.call(t,r)&&(i=t[r],n.push(r));return n}.call(this),null!=t.toArray&&(t=t.toArray()),n=this.existingClasses.slice(0),o=t.filter(function(t){return-1===n.indexOf(t)}),this.node.className=n.concat(o).join(" ").trim()):void 0},o.prototype.handleArrayChanged=function(){return this.updateFromCollection()},o}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.InsertionBinding=function(t){function n(t){this.invert=t.invert,n.__super__.constructor.apply(this,arguments),this.placeholderNode=document.createComment('batman-insertif="'+this.keyPath+'"')}return e(n,t),n.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,n.prototype.bindImmediately=!1,n.prototype.initialized=function(){return this.bind()},n.prototype.dataChange=function(t){var e,n;return n=Batman.View.viewForNode(this.node,!1),e=this.placeholderNode.parentNode||this.node.parentNode,!!t==!this.invert?(null!=n&&n.fireAndCall("viewWillShow"),null==this.node.parentNode&&(e.insertBefore(this.node,this.placeholderNode),e.removeChild(this.placeholderNode)),null!=n?n.fireAndCall("viewDidShow"):void 0):(null!=n&&n.fireAndCall("viewWillHide"),null!=this.node.parentNode&&(e.insertBefore(this.placeholderNode,this.node),e.removeChild(this.node)),null!=n?n.fireAndCall("viewDidHide"):void 0)},n.prototype.die=function(){return this.placeholderNode=null,n.__super__.die.apply(this,arguments)},n}(Batman.DOM.AbstractBinding)}.call(this),function(){var t,e,n={}.hasOwnProperty,r=function(t,e){function r(){this.constructor=t}for(var o in e)n.call(e,o)&&(t[o]=e[o]);return r.prototype=e.prototype,t.prototype=new r,t.__super__=e.prototype,t};Batman.IteratorView=function(e){function n(){return t=n.__super__.constructor.apply(this,arguments)}return r(n,e),n.prototype.loadView=function(){return document.createComment("batman-iterator-"+this.iteratorName+'="'+this.iteratorPath+'"')},n.prototype.addItems=function(t,e){var n,r,o,i,a,s;if(this._beginAppendItems(),e)for(n=o=0,a=t.length;a>o;n=++o)r=t[n],this._insertItem(r,e[n]);else for(i=0,s=t.length;s>i;i++)r=t[i],this._insertItem(r);return this._finishAppendItems()},n.prototype.removeItems=function(t,e){var n,r,o,i,a,s,u,c,l;if(e){for(c=[],n=i=0,s=t.length;s>i;n=++i)r=t[n],c.push(this.subviews.at(e[n]).die());return c}for(l=[],a=0,u=t.length;u>a;a++)r=t[a],l.push(function(){var t,e,n,i;for(n=this.subviews._storage,i=[],t=0,e=n.length;e>t;t++)if(o=n[t],o.get(this.attributeName)===r){o.unset(this.attributeName),o.die();break}return i}.call(this));return l},n.prototype.moveItem=function(t,e){var n,r;return n=this.subviews.at(t),this.subviews._storage.splice(t,1),r=this.subviews.at(e),this.subviews._storage.splice(e,0,n),this.node.parentNode.insertBefore(n.node,(null!=r?r.node:void 0)||this.node)},n.prototype._beginAppendItems=function(){var t;return!this.iterationViewClass&&(t=this.prototypeNode.getAttribute("data-view"))&&(this.iterationViewClass=this.lookupKeypath(t),this.prototypeNode.removeAttribute("data-view")),this.iterationViewClass||(this.iterationViewClass=Batman.IterationView),this.fragment=document.createDocumentFragment(),this.appendedViews=[],this.get("node")},n.prototype._insertItem=function(t,e){var n;return n=new this.iterationViewClass({node:this.prototypeNode.cloneNode(!0),parentNode:this.fragment}),n.set(this.iteratorName,t),null!=e?(n._targeted=!0,this.subviews.insert([n],[e])):this.subviews.add(n),n.parentNode=null,this.appendedViews.push(n)},n.prototype._finishAppendItems=function(){var t,e,n,r,o,i,a,s,u,c,l,p,h;if(e=Batman.DOM.containsNode(this.node))for(c=this.appendedViews,o=0,s=c.length;s>o;o++)r=c[o],r.propagateToSubviews("viewWillAppear");for(l=this.subviews.toArray(),t=i=l.length-1;i>=0;t=i+=-1)r=l[t],r._targeted&&((n=null!=(p=this.subviews.at(t+1))?p.get("node"):void 0)?n.parentNode.insertBefore(r.get("node"),n):this.fragment.appendChild(r.get("node")),delete r._targeted);if(this.node.parentNode.insertBefore(this.fragment,this.node),this.fire("itemsWereRendered"),e)for(h=this.appendedViews,a=0,u=h.length;u>a;a++)r=h[a],r.propagateToSubviews("isInDOM",e),r.propagateToSubviews("viewDidAppear");return this.appendedViews=null,this.fragment=null},n}(Batman.View),Batman.IterationView=function(t){function n(){return e=n.__super__.constructor.apply(this,arguments)}return r(n,t),n}(Batman.View)}.call(this),function(){var t=function(t,e){return function(){return t.apply(e,arguments)}},e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.IteratorBinding=function(e){function r(e){this.handleItemMoved=t(this.handleItemMoved,this),this.handleItemsRemoved=t(this.handleItemsRemoved,this),this.handleItemsAdded=t(this.handleItemsAdded,this),this.handleArrayChanged=t(this.handleArrayChanged,this);var n=this;this.iteratorName=e.attr,this.prototypeNode=e.node,this.prototypeNode.removeAttribute("data-foreach-"+this.iteratorName),e.viewOptions={prototypeNode:this.prototypeNode,iteratorName:this.iteratorName,iteratorPath:e.keyPath},e.node=null,r.__super__.constructor.apply(this,arguments),this.backingView.set("attributeName",this.attributeName),this.view.prevent("ready"),this._handle=Batman.setImmediate(function(){var t;return n.backingView.isDead?(Batman.developer.warn("IteratorBinding (data-foreach-"+n.iteratorName+"='"+n.keyPath+"') trying to insert dead backing view into DOM ("+n.view.constructor.name+")"),void 0):(t=n.prototypeNode.parentNode,t.insertBefore(n.backingView.get("node"),n.prototypeNode),t.removeChild(n.prototypeNode),n.bind(),n.view.allowAndFire("ready"))})}return n(r,e),r.prototype.onlyObserve=Batman.BindingDefinitionOnlyObserve.Data,r.prototype.backWithView=Batman.IteratorView,r.prototype.skipChildren=!0,r.prototype.bindImmediately=!1,r.prototype.handleArrayChanged=function(t){return!this.backingView.isDead&&(this.backingView.destroySubviews(),null!=t?t.length:void 0)?this.handleItemsAdded(t):void 0},r.prototype.handleItemsAdded=function(t,e){return this.backingView.isDead?void 0:this.backingView.addItems(t,e)},r.prototype.handleItemsRemoved=function(t,e){return this.backingView.isDead?void 0:this.collection.length?this.backingView.removeItems(t,e):this.backingView.destroySubviews()},r.prototype.handleItemMoved=function(t,e,n){return this.backingView.isDead?void 0:this.backingView.moveItem(n,e)},r.prototype.die=function(){return this._handle&&Batman.clearImmediate(this._handle),this.prototypeNode=null,r.__super__.die.apply(this,arguments)},r}(Batman.DOM.AbstractCollectionBinding)}.call(this),function(){var t,e={}.hasOwnProperty,n=function(t,n){function r(){this.constructor=t}for(var o in n)e.call(n,o)&&(t[o]=n[o]);return r.prototype=n.prototype,t.prototype=new r,t.__super__=n.prototype,t};Batman.DOM.StyleAttributeBinding=function(e){function r(){return t=r.__super__.constructor.apply(this,arguments)}return n(r,e),r.prototype.dataChange=function(t){return this.node.style[Batman.Filters.camelize(this.attributeName,!0)]=t},r}(Batman.DOM.NodeAttributeBinding)}.call(this),function(){var t;t=function(t){var e;for(e in t)return!1;return!0},Batman.extend(Batman,{cache:{},uuid:0,expando:"batman"+Math.random().toString().replace(/\D/g,""),canDeleteExpando:function(){var t,e;try{return t=document.createElement("div"),delete t.test}catch(n){return e=n,Batman.canDeleteExpando=!1}}(),noData:{embed:!0,EMBED:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",OBJECT:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0,APPLET:!0},hasData:function(e){return e=e.nodeType?Batman.cache[e[Batman.expando]]:e[Batman.expando],!!e&&!t(e)},data:function(t,e,n,r){var o,i,a,s,u,c;if(Batman.acceptData(t)&&(s=Batman.expando,i="string"==typeof e,o=Batman.cache,a=t[Batman.expando],!(!a||r&&a&&o[a]&&!o[a][s])||!i||void 0!==n))return a||(3!==t.nodeType?t[Batman.expando]=a=++Batman.uuid:a=Batman.expando),o[a]||(o[a]={}),("object"==typeof e||"function"==typeof e)&&(r?o[a][s]=Batman.extend(o[a][s],e):o[a]=Batman.extend(o[a],e)),c=o[a],r&&(c[s]||(c[s]={}),c=c[s]),void 0!==n&&(c[e]=n),u=i?c[e]:c},removeData:function(e,n,r,o){var i,a,s,u,c,l;if(Batman.acceptData(e)&&(u=Batman.expando,c=e.nodeType,i=Batman.cache,a=e[Batman.expando],i[a]&&!(n&&(l=r?i[a][u]:i[a],l&&(delete l[n],!t(l)))||r&&(delete i[a][u],!t(i[a])))))return s=i[a][u],Batman.canDeleteExpando||!i.setInterval?delete i[a]:i[a]=null,s&&!o?(i[a]={},i[a][u]=s):Batman.canDeleteExpando?delete e[Batman.expando]:e.removeAttribute?e.removeAttribute(Batman.expando):e[Batman.expando]=null},_data:function(t,e,n){return Batman.data(t,e,n,!0)},acceptData:function(t){var e;if(t)return t.___acceptData||(t.___acceptData=t.nodeName?(e=Batman.noData[t.nodeName],e?!(e===!0||t.getAttribute("classid")!==e):!0):!0)}})}.call(this),function(){var t={}.hasOwnProperty,e=function(e,n){function r(){this.constructor=e}for(var o in n)t.call(n,o)&&(e[o]=n[o]);return r.prototype=n.prototype,e.prototype=new r,e.__super__=n.prototype,e};Batman.DOM.Yield=function(t){function n(t){this.name=t}return e(n,t),n.yields={},n.reset=function(){return this.yields={}},n.withName=function(t){var e;return(e=this.yields)[t]||(e[t]=new this(t))},n.accessor("contentView",{get:function(){return this.contentView},set:function(t,e){return this.contentView!==e?(this.contentView&&this.contentView.removeFromSuperview(),this.contentView=e,this.containerNode&&e?e.set("parentNode",this.containerNode):void 0):void 0}}),n.accessor("containerNode",{get:function(){return this.containerNode},set:function(t,e){return this.containerNode!==e?(this.containerNode=e,this.contentView?this.contentView.set("parentNode",e):void 0):void 0}}),n}(Batman.Object)}.call(this),function(){var t,e,n=[].slice;t=function(t){return function(e){return null==e?void 0:t.apply(this,arguments)}},e=function(t,e){return t||e},Batman.Filters={raw:t(function(t,e){return e.escapeValue=!1,t}),get:t(function(t,e){return null!=t.get?t.get(e):t[e]}),equals:t(function(t,e){return t===e}),eq:function(t,e){return t===e},neq:function(t,e){return t!==e},lt:t(function(t,e){return e>t}),gt:t(function(t,e){return t>e}),lteq:t(function(t,e){return e>=t}),gteq:t(function(t,e){return t>=e}),and:function(t,e){return t&&e},or:function(t,e){return t||e},not:function(t){return!t},ceil:function(t){return Math.ceil(t)},floor:function(t){return Math.floor(t)},round:function(t){return Math.round(t)},precision:function(t,e){return parseFloat(t).toPrecision(e)},fixed:function(t,e){return parseFloat(t).toFixed(e)},delimitNumber:function(t){return t=t.toString(),t.replace(/(^|[^\w.])(\d{4,})/g,function(t,e,n){return e+n.replace(/\d(?=(?:\d\d\d)+(?!\d))/g,"$&,")})},trim:t(function(t){return t.trim()}),matches:t(function(t,e){return-1!==t.indexOf(e)}),truncate:t(function(t,e,n,r){return null==n&&(n="..."),r||(r=n,n="..."),t.length>e&&(t=t.substr(0,e-n.length)+n),t}),"default":function(t,e){return null!=t&&""!==t?t:e},prepend:function(t,e){return(null!=e?e:"")+(null!=t?t:"")},append:function(t,e){return(null!=t?t:"")+(null!=e?e:"")},replace:t(function(t,e,n,r,o){return o||(o=r,r=void 0),void 0===r?t.replace(e,n):t.replace(e,n,r)}),downcase:t(function(t){return t.toLowerCase()}),upcase:t(function(t){return t.toUpperCase()}),pluralize:t(function(t,e,n,r){return r||(r=n,n=!0,r||(r=e,e=void 0)),null!=e?Batman.helpers.pluralize(e,t,void 0,n):Batman.helpers.pluralize(t)}),humanize:t(function(t){return Batman.helpers.humanize(t)}),join:t(function(t,e,n){return null==e&&(e=""),n||(n=e,e=""),t.join(e)}),sort:t(function(t){return t.sort()}),map:t(function(t,e){return t.map(function(t){return Batman.get(t,e)})}),has:function(t,e){return null==t?!1:Batman.contains(t,e)},first:t(function(t){return t[0]}),meta:t(function(t,e){return Batman.developer.assert(t.meta,"Error, value doesn't have a meta to filter on!"),t.meta.get(e)}),interpolate:function(t,e,n){var r,o,i;if(n||(n=e,e=void 0),t){i={};for(r in e)o=e[r],i[r]=this.lookupKeypath(o),null==i[r]&&(Batman.developer.warn("Warning! Undefined interpolation key "+r+" for interpolation",t),i[r]="");return Batman.helpers.interpolate(t,i)}},withArguments:function(){var t,e,r,o;return e=arguments[0],r=3<=arguments.length?n.call(arguments,1,o=arguments.length-1):(o=1,[]),t=arguments[o++],e?"function"==typeof e?function(){return e.call.apply(e,[this].concat(n.call(r),n.call(arguments)))}:"function"==typeof e.get?e.get.apply(e,r):void 0:void 0},escape:t(Batman.escapeHTML)},function(){var e,n,r,o,i;for(o=["capitalize","singularize","underscore","camelize"],i=[],n=0,r=o.length;r>n;n++)e=o[n],i.push(Batman.Filters[e]=t(Batman.helpers[e]));return i}(),Batman.developer.addFilters()}.call(this),function(){}.call(this),function(){var t=this,e=this.document,n=this.zest,r=function(){return e.compareDocumentPosition?function(t,e){return t.compareDocumentPosition(e)}:function(t,e){for(var n=t.ownerDocument.getElementsByTagName("*"),r=n.length;r--;){if(n[r]===t)return 2;if(n[r]===e)return 4}return 1}}(),o=function(t,e){return 2&r(t,e)?1:-1},i=function(t){for(;(t=t.nextSibling)&&1!==t.nodeType;);return t},a=function(t){for(;(t=t.previousSibling)&&1!==t.nodeType;);return t},s=function(t){if(t=t.firstChild)for(;1!==t.nodeType&&(t=t.nextSibling););return t},u=function(t){if(t=t.lastChild)for(;1!==t.nodeType&&(t=t.previousSibling););return t},c=function(t){if(!t)return t;var e=t[0];return'"'===e||"'"===e?t.slice(1,-1):t},l=function(){return Array.prototype.indexOf?Array.prototype.indexOf:function(t,e){for(var n=this.length;n--;)if(this[n]===e)return n;return-1}}(),p=function(t,e){var n=_.inside.source.replace(/</g,t).replace(/>/g,e);return new RegExp(n)},h=function(t,e,n){return t=t.source,t=t.replace(e,n.source||n),new RegExp(t)},d=function(t,e){return t.replace(/^(?:\w+:\/\/|\/+)/,"").replace(/(?:\/+|\/*#.*?)$/,"").split("/",e).join("/")},f=function(t){var e,t=t.replace(/\s+/g,"");return"even"===t?t="2n+0":"odd"===t?t="2n+1":~t.indexOf("n")||(t="0n"+t),e=/^([+-])?(\d+)?n([+-])?(\d+)?$/.exec(t),{group:"-"===e[1]?-(e[2]||1):+(e[2]||1),offset:e[4]?"-"===e[3]?-e[4]:+e[4]:0}},m=function(t,e,n){var t=f(t),r=t.group,o=t.offset,c=n?u:s,l=n?a:i;return function(t){if(1===t.parentNode.nodeType)for(var n=c(t.parentNode),i=0;n;){if(e(n,t)&&i++,n===t)return i-=o,r&&i?!(i%r)&&0>i==0>r:!i;n=l(n)}}},y={"*":function(){return function(){var t=e.createElement("div");return t.appendChild(e.createComment("")),!!t.getElementsByTagName("*")[0]}()?function(t){return 1===t.nodeType?!0:void 0}:function(){return!0}}(),type:function(t){return t=t.toLowerCase(),function(e){return e.nodeName.toLowerCase()===t}},attr:function(t,e,n,r){return e=g[e],function(o){var i;switch(t){case"for":i=o.htmlFor;break;case"class":i=o.className,""===i&&null==o.getAttribute("class")&&(i=null);break;case"href":i=o.getAttribute("href",2);break;case"title":i=o.getAttribute("title")||null;break;case"id":if(o.getAttribute){i=o.getAttribute("id");break}default:i=null!=o[t]?o[t]:o.getAttribute&&o.getAttribute(t)}if(null!=i)return i+="",r&&(i=i.toLowerCase(),n=n.toLowerCase()),e(i,n)}},":first-child":function(t){return!a(t)&&1===t.parentNode.nodeType},":last-child":function(t){return!i(t)&&1===t.parentNode.nodeType},":only-child":function(t){return!a(t)&&!i(t)&&1===t.parentNode.nodeType},":nth-child":function(t,e){return m(t,function(){return!0},e)},":nth-last-child":function(t){return y[":nth-child"](t,!0)},":root":function(t){return t.ownerDocument.documentElement===t},":empty":function(t){return!t.firstChild},":not":function(t){var e=S(t);return function(t){return!e(t)}},":first-of-type":function(t){if(1===t.parentNode.nodeType){for(var e=t.nodeName;t=a(t);)if(t.nodeName===e)return;return!0}},":last-of-type":function(t){if(1===t.parentNode.nodeType){for(var e=t.nodeName;t=i(t);)if(t.nodeName===e)return;return!0}},":only-of-type":function(t){return y[":first-of-type"](t)&&y[":last-of-type"](t)},":nth-of-type":function(t,e){return m(t,function(t,e){return t.nodeName===e.nodeName},e)},":nth-last-of-type":function(t){return y[":nth-of-type"](t,!0)},":checked":function(t){return!(!t.checked&&!t.selected)},":indeterminate":function(t){return!y[":checked"](t)},":enabled":function(t){return!t.disabled&&"hidden"!==t.type},":disabled":function(t){return!!t.disabled},":target":function(e){return e.id===t.location.hash.substring(1)},":focus":function(t){return t===t.ownerDocument.activeElement},":matches":function(t){return S(t)},":nth-match":function(t,e){var n=t.split(/\s*,\s*/),r=n.shift(),o=S(n.join(","));return m(r,o,e)},":nth-last-match":function(t){return y[":nth-match"](t,!0)},":links-here":function(e){return e+""==t.location+""},":lang":function(t){return function(e){for(;e;){if(e.lang)return 0===e.lang.indexOf(t);e=e.parentNode}}},":dir":function(t){return function(e){for(;e;){if(e.dir)return e.dir===t;e=e.parentNode}}},":scope":function(t,e){var n=e||t.ownerDocument;return 9===n.nodeType?t===n.documentElement:t===n},":any-link":function(t){return"string"==typeof t.href},":local-link":function(e){if(e.nodeName)return e.href&&e.host===t.location.host;var n=+e+1;return function(e){if(e.href){var r=t.location+"",o=e+"";return d(r,n)===d(o,n)}}},":default":function(t){return!!t.defaultSelected},":valid":function(t){return t.willValidate||t.validity&&t.validity.valid},":invalid":function(t){return!y[":valid"](t)},":in-range":function(t){return t.value>t.min&&t.value<=t.max},":out-of-range":function(t){return!y[":in-range"](t)},":required":function(t){return!!t.required},":optional":function(t){return!t.required},":read-only":function(t){if(t.readOnly)return!0;var e=t.getAttribute("contenteditable"),n=t.contentEditable,r=t.nodeName.toLowerCase();return r="input"!==r&&"textarea"!==r,(r||t.disabled)&&null==e&&"true"!==n},":read-write":function(t){return!y[":read-only"](t)},":hover":function(){throw new Error(":hover is not supported.")},":active":function(){throw new Error(":active is not supported.")},":link":function(){throw new Error(":link is not supported.")},":visited":function(){throw new Error(":visited is not supported.")},":column":function(){throw new Error(":column is not supported.")},":nth-column":function(){throw new Error(":nth-column is not supported.")},":nth-last-column":function(){throw new Error(":nth-last-column is not supported.")},":current":function(){throw new Error(":current is not supported.")},":past":function(){throw new Error(":past is not supported.")},":future":function(){throw new Error(":future is not supported.")},":contains":function(t){return function(e){var n=e.innerText||e.textContent||e.value||"";return!!~n.indexOf(t)}},":has":function(t){return function(e){return C(t,e).length>0}}},g={"-":function(){return!0},"=":function(t,e){return t===e},"*=":function(t,e){return-1!==t.indexOf(e)},"~=":function(t,e){var n,r,o=t.indexOf(e);if(-1!==o)return n=t[o-1],r=t[o+e.length],!(n&&" "!==n||r&&" "!==r)},"|=":function(t,e){var n,r=t.indexOf(e);if(0===r)return n=t[r+e.length],"-"===n||!n},"^=":function(t,e){return 0===t.indexOf(e)},"$=":function(t,e){return t.indexOf(e)+e.length===t.length},"!=":function(t,e){return t!==e}},v={" ":function(t){return function(e){for(;e=e.parentNode;)if(t(e))return e}},">":function(t){return function(e){return t(e=e.parentNode)&&e}},"+":function(t){return function(e){return t(e=a(e))&&e}},"~":function(t){return function(e){for(;e=a(e);)if(t(e))return e}},noop:function(t){return function(e){return t(e)&&e}},ref:function(t,e){function n(t){for(var e=t.ownerDocument,o=e.getElementsByTagName("*"),i=o.length;i--;)if(r=o[i],n.test(t))return r=null,!0;r=null}var r;return n.combinator=function(n){if(r&&r.getAttribute){var o=r.getAttribute(e)||"";return"#"===o[0]&&(o=o.substring(1)),o===n.id&&t(r)?r:void 0}},n}},_={qname:/^ *([\w\-]+|\*)/,simple:/^(?:([.#][\w\-]+)|pseudo|attr)/,ref:/^ *\/([\w\-]+)\/ */,combinator:/^(?: +([^ \w*]) +|( )+|([^ \w*]))(?! *$)/,attr:/^\[([\w\-]+)(?:([^\w]?=)(inside))?\]/,pseudo:/^(:[\w\-]+)(?:\((inside)\))?/,inside:/(?:"(?:\\"|[^"])*"|'(?:\\'|[^'])*'|<[^"'>]*>|\\["'>]|[^"'>])*/};_.inside=h(_.inside,"[^\"'>]*",_.inside),_.attr=h(_.attr,"inside",p("\\[","\\]")),_.pseudo=h(_.pseudo,"inside",p("\\(","\\)")),_.simple=h(_.simple,"pseudo",_.pseudo),_.simple=h(_.simple,"attr",_.attr);var B=function(t){for(var e,n,r,o,i,a,t=t.replace(/^\s+|\s+$/g,""),s=[],u=[];t;){if(o=_.qname.exec(t))t=t.substring(o[0].length),r=o[1],u.push(b(r,!0));else{if(!(o=_.simple.exec(t)))throw new Error("Invalid selector.");t=t.substring(o[0].length),r="*",u.push(b(r,!0)),u.push(b(o))}for(;o=_.simple.exec(t);)t=t.substring(o[0].length),u.push(b(o));if("!"===t[0]&&(t=t.substring(1),n=A(),n.qname=r,u.push(n.simple)),o=_.ref.exec(t))t=t.substring(o[0].length),a=v.ref(w(u),o[1]),s.push(a.combinator),u=[];else{if(o=_.combinator.exec(t)){if(t=t.substring(o[0].length),i=o[1]||o[2]||o[3],","===i){s.push(v.noop(w(u)));break}}else i="noop";s.push(v[i](w(u))),u=[]}}return e=O(s),e.qname=r,e.sel=t,n&&(n.lname=e.qname,n.test=e,n.qname=n.qname,n.sel=e.sel,e=n),a&&(a.test=e,a.qname=e.qname,a.sel=e.sel,e=a),e},b=function(t,e){if(e)return"*"===t?y["*"]:y.type(t);if(t[1])return"."===t[1][0]?y.attr("class","~=",t[1].substring(1)):y.attr("id","=",t[1].substring(1));if(t[2])return t[3]?y[t[2]](c(t[3])):y[t[2]];if(t[4]){var n;return t[6]&&(n=t[6].length,t[6]=t[6].replace(/ +i$/,""),n=n>t[6].length),y.attr(t[4],t[5]||"-",c(t[6]),n)}throw new Error("Unknown Selector.")},w=function(t){var e,n=t.length;return 2>n?t[0]:function(r){if(r){for(e=0;n>e;e++)if(!t[e](r))return;return!0}}},O=function(t){return t.length<2?function(e){return!!t[0](e)}:function(e){for(var n=t.length;n--;)if(!(e=t[n](e)))return;return!0}},A=function(){function t(n){for(var r=n.ownerDocument,o=r.getElementsByTagName(t.lname),i=o.length;i--;)if(t.test(o[i])&&e===n)return e=null,!0;e=null}var e;return t.simple=function(t){return e=t,!0},t},S=function(t){for(var e=B(t),n=[e];e.sel;)e=B(e.sel),n.push(e);return n.length<2?e:function(t){for(var e=n.length,r=0;e>r;r++)if(n[r](t))return!0}},x=function(t,e){for(var n,r=[],i=B(t),a=e.getElementsByTagName(i.qname),s=0;n=a[s++];)i(n)&&r.push(n);if(i.sel){for(;i.sel;)for(i=B(i.sel),a=e.getElementsByTagName(i.qname),s=0;n=a[s++];)i(n)&&!~l.call(r,n)&&r.push(n);r.sort(o)}return r},E=function(){var t=function(){try{return Array.prototype.slice.call(e.getElementsByTagName("zest")),Array.prototype.slice}catch(t){return t=null,function(){for(var t=[],e=0,n=this.length;n>e;e++)t.push(this[e]);return t}}}();return e.querySelectorAll?function(e,n){try{return t.call(n.querySelectorAll(e))}catch(r){return x(e,n)}}:function(e,n){try{if("#"===e[0]&&/^#[\w\-]+$/.test(e))return[n.getElementById(e.substring(1))];if("."===e[0]&&/^\.[\w\-]+$/.test(e))return e=n.getElementsByClassName(e.substring(1)),t.call(e);if(/^[\w\-]+$/.test(e))return t.call(n.getElementsByTagName(e))}catch(r){}return x(e,n)}}(),C=function(n,r){try{n=E(n,r||e)
}catch(o){t.ZEST_DEBUG&&console.log(o.stack||o+""),n=[]}return n};C.selectors=y,C.operators=g,C.combinators=v,C.compile=S,C.matches=function(t,e){return!!S(e)(t)},C.cache=function(){if(!B.raw){var t=B,e={};B=function(n){return e[n]||(e[n]=t(n))},B.raw=t,C._cache=e}},C.noCache=function(){B.raw&&(B=B.raw,delete C._cache)},C.noConflict=function(){return t.zest=n,C},C.noNative=function(){E=x},"undefined"!=typeof module?module.exports=C:this.zest=C,t.ZEST_DEBUG?C.noNative():C.cache()}.call(function(){return this||("undefined"!=typeof window?window:global)}()),!function(t,e){"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(t,e):this[t]=e()}("reqwest",function(){function handleReadyState(t,e,n){return function(){t&&4==t[readyState]&&(twoHundo.test(t.status)?e(t):n(t))}}function setHeaders(t,e){var n,r=e.headers||{};r.Accept=r.Accept||defaultHeaders.accept[e.type]||defaultHeaders.accept["*"],e.crossOrigin||r[requestedWith]||(r[requestedWith]=defaultHeaders.requestedWith),r[contentType]||(r[contentType]=e.contentType||defaultHeaders.contentType);for(n in r)r.hasOwnProperty(n)&&t.setRequestHeader(n,r[n])}function generalCallback(t){lastValue=t}function urlappend(t,e){return t+(/\?/.test(t)?"&":"?")+e}function handleJsonp(t,e,n,r){var o=uniqid++,i=t.jsonpCallback||"callback",a=t.jsonpCallbackName||"reqwest_"+o,s=new RegExp("((^|\\?|&)"+i+")=([^&]+)"),u=r.match(s),c=doc.createElement("script"),l=0;u?"?"===u[3]?r=r.replace(s,"$1="+a):a=u[3]:r=urlappend(r,i+"="+a),win[a]=generalCallback,c.type="text/javascript",c.src=r,c.async=!0,"undefined"!=typeof c.onreadystatechange&&(c.event="onclick",c.htmlFor=c.id="_reqwest_"+o),c.onload=c.onreadystatechange=function(){return c[readyState]&&"complete"!==c[readyState]&&"loaded"!==c[readyState]||l?!1:(c.onload=c.onreadystatechange=null,c.onclick&&c.onclick(),t.success&&t.success(lastValue),lastValue=void 0,head.removeChild(c),l=1,void 0)},head.appendChild(c)}function getRequest(t,e,n){var r,o=(t.method||"GET").toUpperCase(),i="string"==typeof t?t:t.url,a=t.processData!==!1&&t.data&&"string"!=typeof t.data?reqwest.toQueryString(t.data):t.data||null;return"jsonp"!=t.type&&"GET"!=o||!a||(i=urlappend(i,a),a=null),"jsonp"==t.type?handleJsonp(t,e,n,i):(r=xhr(),r.open(o,i,!0),setHeaders(r,t),r.onreadystatechange=handleReadyState(r,e,n),t.before&&t.before(r),r.send(a),r)}function Reqwest(t,e){this.o=t,this.fn=e,init.apply(this,arguments)}function setType(t){var e=t.match(/\.(json|jsonp|html|xml)(\?|$)/);return e?e[1]:"js"}function init(o,fn){function complete(t){o.timeout&&clearTimeout(self.timeout),self.timeout=null,o.complete&&o.complete(t)}function success(resp){var r=resp.responseText;if(r)switch(type){case"json":try{resp=win.JSON?win.JSON.parse(r):eval("("+r+")")}catch(err){return error(resp,"Could not parse JSON in response",err)}break;case"js":resp=eval(r);break;case"html":resp=r}fn(resp),o.success&&o.success(resp),complete(resp)}function error(t,e,n){o.error&&o.error(t,e,n),complete(t)}this.url="string"==typeof o?o:o.url,this.timeout=null;var type=o.type||setType(this.url),self=this;fn=fn||function(){},o.timeout&&(this.timeout=setTimeout(function(){self.abort()},o.timeout)),this.request=getRequest(o,success,error)}function reqwest(t,e){return new Reqwest(t,e)}function normalize(t){return t?t.replace(/\r?\n/g,"\r\n"):""}function serial(t,e){var n=t.name,r=t.tagName.toLowerCase(),o=function(t){t&&!t.disabled&&e(n,normalize(t.attributes.value&&t.attributes.value.specified?t.value:t.text))};if(!t.disabled&&n)switch(r){case"input":if(!/reset|button|image|file/i.test(t.type)){var i=/checkbox/i.test(t.type),a=/radio/i.test(t.type),s=t.value;(!(i||a)||t.checked)&&e(n,normalize(i&&""===s?"on":s))}break;case"textarea":e(n,normalize(t.value));break;case"select":if("select-one"===t.type.toLowerCase())o(t.selectedIndex>=0?t.options[t.selectedIndex]:null);else for(var u=0;t.length&&u<t.length;u++)t.options[u].selected&&o(t.options[u])}}function eachFormElement(){var t,e,n,r=this,o=function(t,e){for(var o=0;o<e.length;o++){var i=t[byTag](e[o]);for(n=0;n<i.length;n++)serial(i[n],r)}};for(e=0;e<arguments.length;e++)t=arguments[e],/input|select|textarea/i.test(t.tagName)&&serial(t,r),o(t,["input","select","textarea"])}function serializeQueryString(){return reqwest.toQueryString(reqwest.serializeArray.apply(null,arguments))}function serializeHash(){var t={};return eachFormElement.apply(function(e,n){e in t?(t[e]&&!isArray(t[e])&&(t[e]=[t[e]]),t[e].push(n)):t[e]=n},arguments),t}var context=this,win=window,doc=document,old=context.reqwest,twoHundo=/^20\d$/,byTag="getElementsByTagName",readyState="readyState",contentType="Content-Type",requestedWith="X-Requested-With",head=doc[byTag]("head")[0],uniqid=0,lastValue,xmlHttpRequest="XMLHttpRequest",isArray="function"==typeof Array.isArray?Array.isArray:function(t){return t instanceof Array},defaultHeaders={contentType:"application/x-www-form-urlencoded",accept:{"*":"text/javascript, text/html, application/xml, text/xml, */*",xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript",js:"application/javascript, text/javascript"},requestedWith:xmlHttpRequest},xhr=win[xmlHttpRequest]?function(){return new XMLHttpRequest}:function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Reqwest.prototype={abort:function(){this.request.abort()},retry:function(){init.call(this,this.o,this.fn)}},reqwest.serializeArray=function(){var t=[];return eachFormElement.apply(function(e,n){t.push({name:e,value:n})},arguments),t},reqwest.serialize=function(){if(0===arguments.length)return"";var t,e,n=Array.prototype.slice.call(arguments,0);return t=n.pop(),t&&t.nodeType&&n.push(t)&&(t=null),t&&(t=t.type),e="map"==t?serializeHash:"array"==t?reqwest.serializeArray:serializeQueryString,e.apply(null,n)},reqwest.toQueryString=function(t){var e,n="",r=encodeURIComponent,o=function(t,e){n+=r(t)+"="+r(e)+"&"};if(isArray(t))for(e=0;t&&e<t.length;e++)o(t[e].name,t[e].value);else for(var i in t)if(Object.hasOwnProperty.call(t,i)){var a=t[i];if(isArray(a))for(e=0;e<a.length;e++)o(i,a[e]);else o(i,t[i])}return n.replace(/&$/,"").replace(/%20/g,"+")},reqwest.compat=function(t,e){return t&&(t.type&&(t.method=t.type)&&delete t.type,t.dataType&&(t.type=t.dataType),t.jsonpCallback&&(t.jsonpCallbackName=t.jsonpCallback)&&delete t.jsonpCallback,t.jsonp&&(t.jsonpCallback=t.jsonp)),new Reqwest(t,e)},reqwest}),function(){var t,e;/Safari/.test(navigator.userAgent)&&(e=/WebKit\/(\S+)/.exec(navigator.userAgent),e&&parseFloat(e)<540&&(t=!0)),("undefined"!=typeof window&&null!==window?window:global).containsNode=function(e,n){if(e===n)return!0;if(e.contains&&!t)return e.contains(n);if(e.compareDocumentPosition)return!!(16&e.compareDocumentPosition(n));for(;n&&e!==n;)n=n.parentNode;return n===e}}.call(this),function(){Batman.extend(Batman.DOM,{querySelectorAll:function(t,e){return zest(e,t)},querySelector:function(t,e){return zest(e,t)[0]},setInnerHTML:function(t,e){return null!=t?t.innerHTML=e:void 0},containsNode:function(t,e){return e||(e=t,t=document.body),window.containsNode(t,e)},textContent:function(t){var e;return null!=(e=t.textContent)?e:t.innerText},destroyNode:function(t){var e;return Batman.DOM.cleanupNode(t),null!=t?null!=(e=t.parentNode)?e.removeChild(t):void 0:void 0}}),Batman.extend(Batman.Request.prototype,{_parseResponseHeaders:function(t){var e;return e=t.getAllResponseHeaders().split("\n").reduce(function(t,e){var n,r,o;return(r=e.match(/([^:]*):\s*(.*)/))&&(n=r[1],o=r[2],t[n]=o),t},{})},send:function(t){var e,n,r,o=this;return null==t&&(t=this.get("data")),this.fire("loading"),e={url:this.get("url"),method:this.get("method"),type:this.get("type"),headers:this.get("headers"),success:function(t){return o.mixin({xhr:n,response:t,status:"undefined"!=typeof n&&null!==n?n.status:void 0,responseHeaders:o._parseResponseHeaders(n)}),o.fire("success",t)},error:function(t){return o.mixin({xhr:t,response:t.responseText||t.content,status:t.status,responseHeaders:o._parseResponseHeaders(t)}),t.request=o,o.fire("error",t)},complete:function(){return o.fire("loaded")}},"PUT"===(r=e.method)||"POST"===r?this.hasFileUploads()?e.data=this.constructor.objectToFormData(t):(e.contentType=this.get("contentType"),e.data=Batman.URI.queryFromParams(t)):e.data=t,n=reqwest(e).request}})}.call(this),function(){}.call(this);