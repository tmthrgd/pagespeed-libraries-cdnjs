CKEDITOR.dialog.add("link",function(X){var V,T;function R(b){return b.replace(/'/g,"\\$&")}function N(j){var k,n=V,m,l;k=[T,"("];for(var i=0;i<n.length;i++){m=n[i].toLowerCase(),l=j[m],0<i&&k.push(","),k.push("'",l?R(encodeURIComponent(j[m])):"","'")}k.push(")");return k.join("")}function L(b){for(var i,l=b.length,k=[],j=0;j<l;j++){i=b.charCodeAt(j),k.push(i)}return"String.fromCharCode("+k.join(",")+")"}function J(b){return(b=b.getAttribute("class"))?b.replace(/\s*(?:cke_anchor_empty|cke_anchor)(?:\s*$)?/g,""):""}var g=CKEDITOR.plugins.link,O=function(){var b=this.getDialog(),i=b.getContentElement("target","popupFeatures"),b=b.getContentElement("target","linkTargetName"),j=this.getValue();if(i&&b){switch(i=i.getElement(),i.hide(),b.setValue(""),j){case"frame":b.setLabel(X.lang.link.targetFrameName);b.getElement().show();break;case"popup":i.show();b.setLabel(X.lang.link.targetPopupName);b.getElement().show();break;default:b.setValue(j),b.getElement().hide()}}},e=/^javascript:/,c=/^mailto:([^?]+)(?:\?(.+))?$/,a=/subject=([^;?:@&=$,\/]*)/,U=/body=([^;?:@&=$,\/]*)/,S=/^#(.*)$/,Q=/^((?:http|https|ftp|news):\/\/)?(.*)$/,P=/^(_(?:self|top|parent|blank))$/,M=/^javascript:void\(location\.href='mailto:'\+String\.fromCharCode\(([^)]+)\)(?:\+'(.*)')?\)$/,K=/^javascript:([^(]+)\(([^)]+)\)$/,h=/\s*window.open\(\s*this\.href\s*,\s*(?:'([^']*)'|null)\s*,\s*'([^']*)'\s*\)\s*;\s*return\s*false;*\s*/,f=/(?:^|,)([^=]+)=(\d+|yes|no)/gi,d=function(j,l){var p=l&&(l.data("cke-saved-href")||l.getAttribute("href"))||"",o,n,i={};p.match(e)&&("encode"==W?p=p.replace(M,function(r,s,q){return"mailto:"+String.fromCharCode.apply(String,s.split(","))+(q&&q.replace(/\\'/g,"'"))}):W&&p.replace(K,function(b,v,u){if(v==T){i.type="email";for(var b=i.email={},v=/(^')|('$)/g,u=u.match(/[^,\s]+/g),t=u.length,r,s,q=0;q<t;q++){r=decodeURIComponent,s=u[q].replace(v,"").replace(/\\'/g,"'"),s=r(s),r=V[q].toLowerCase(),b[r]=s}b.address=[b.name,b.domain].join("@")}}));if(!i.type){if(o=p.match(S)){i.type="anchor",i.anchor={},i.anchor.name=i.anchor.id=o[1]}else{if(o=p.match(c)){n=p.match(a);p=p.match(U);i.type="email";var m=i.email={};m.address=o[1];n&&(m.subject=decodeURIComponent(n[1]));p&&(m.body=decodeURIComponent(p[1]))}else{p&&(n=p.match(Q))?(i.type="url",i.url={},i.url.protocol=n[1],i.url.url=n[2]):i.type="url"}}}if(l){o=l.getAttribute("target");i.target={};i.adv={};if(o){o.match(P)?i.target.type=i.target.name=o:(i.target.type="frame",i.target.name=o)}else{if(o=(o=l.data("cke-pa-onclick")||l.getAttribute("onclick"))&&o.match(h)){i.target.type="popup";for(i.target.name=o[1];p=f.exec(o[2]);){("yes"==p[2]||"1"==p[2])&&!(p[1] in {height:1,width:1,top:1,left:1})?i.target[p[1]]=!0:isFinite(p[2])&&(i.target[p[1]]=p[2])}}}o=function(b,r){var q=l.getAttribute(r);null!==q&&(i.adv[b]=q||"")};o("advId","id");o("advLangDir","dir");o("advAccessKey","accessKey");i.adv.advName=l.data("cke-saved-name")||l.getAttribute("name")||"";o("advLangCode","lang");o("advTabIndex","tabindex");o("advTitle","title");o("advContentType","type");CKEDITOR.plugins.link.synAnchorSelector?i.adv.advCSSClasses=J(l):o("advCSSClasses","class");o("advCharset","charset");o("advStyles","style");o("advRel","rel")}o=i.anchors=[];var k;if(CKEDITOR.plugins.link.emptyAnchorFix){m=j.document.getElementsByTag("a");p=0;for(n=m.count();p<n;p++){if(k=m.getItem(p),k.data("cke-saved-name")||k.hasAttribute("name")){o.push({name:k.data("cke-saved-name")||k.getAttribute("name"),id:k.getAttribute("id")})}}}else{m=new CKEDITOR.dom.nodeList(j.document.$.anchors);p=0;for(n=m.count();p<n;p++){k=m.getItem(p),o[p]={name:k.getAttribute("name"),id:k.getAttribute("id")}}}if(CKEDITOR.plugins.link.fakeAnchor){m=j.document.getElementsByTag("img");p=0;for(n=m.count();p<n;p++){(k=CKEDITOR.plugins.link.tryRestoreFakeAnchor(j,m.getItem(p)))&&o.push({name:k.getAttribute("name"),id:k.getAttribute("id")})}}this._.selectedElement=l;return i},ab=function(b){b.target&&this.setValue(b.target[this.id]||"")},aa=function(b){b.adv&&this.setValue(b.adv[this.id]||"")},Z=function(b){b.target||(b.target={});b.target[this.id]=this.getValue()||""},Y=function(b){b.adv||(b.adv={});b.adv[this.id]=this.getValue()||""},W=X.config.emailProtection||"";W&&"encode"!=W&&(T=V=void 0,W.replace(/^([^(]+)\(([^)]+)\)$/,function(j,i,k){T=i;V=[];k.replace(/[^,\s]+/g,function(b){V.push(b)})}));var ac=X.lang.common,ad=X.lang.link;return{title:ad.title,minWidth:350,minHeight:230,contents:[{id:"info",label:ad.info,title:ad.info,elements:[{id:"linkType",type:"select",label:ad.type,"default":"url",items:[[ad.toUrl,"url"],[ad.toAnchor,"anchor"],[ad.toEmail,"email"]],onChange:function(){var j=this.getDialog(),i=["urlOptions","anchorOptions","emailOptions"],m=this.getValue(),l=j.definition.getContents("upload"),l=l&&l.hidden;if(m=="url"){X.config.linkShowTargetTab&&j.showPage("target");l||j.showPage("upload")}else{j.hidePage("target");l||j.hidePage("upload")}for(l=0;l<i.length;l++){var k=j.getContentElement("info",i[l]);if(k){k=k.getElement().getParent().getParent();i[l]==m+"Options"?k.show():k.hide()}}j.layout()},setup:function(b){b.type&&this.setValue(b.type)},commit:function(b){b.type=this.getValue()}},{type:"vbox",id:"urlOptions",children:[{type:"hbox",widths:["25%","75%"],children:[{id:"protocol",type:"select",label:ac.protocol,"default":"http://",items:[["http://","http://"],["https://","https://"],["ftp://","ftp://"],["news://","news://"],[ad.other,""]],setup:function(b){b.url&&this.setValue(b.url.protocol||"")},commit:function(b){if(!b.url){b.url={}}b.url.protocol=this.getValue()}},{type:"text",id:"url",label:ac.url,required:!0,onLoad:function(){this.allowOnChange=true},onKeyUp:function(){this.allowOnChange=false;var j=this.getDialog().getContentElement("info","protocol"),i=this.getValue(),l=/^((javascript:)|[#\/\.\?])/i,k=/^(http|https|ftp|news):\/\/(?=.)/i.exec(i);if(k){this.setValue(i.substr(k[0].length));j.setValue(k[0].toLowerCase())}else{l.test(i)&&j.setValue("")}this.allowOnChange=true},onChange:function(){if(this.allowOnChange){this.onKeyUp()}},validate:function(){var b=this.getDialog();if(b.getContentElement("info","linkType")&&b.getValueOf("info","linkType")!="url"){return true}if(/javascript\:/.test(this.getValue())){alert(ac.invalidValue);return false}return this.getDialog().fakeObj?true:CKEDITOR.dialog.validate.notEmpty(ad.noUrl).apply(this)},setup:function(b){this.allowOnChange=false;b.url&&this.setValue(b.url.url);this.allowOnChange=true},commit:function(b){this.onChange();if(!b.url){b.url={}}b.url.url=this.getValue();this.allowOnChange=false}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().show()}},{type:"button",id:"browse",hidden:"true",filebrowser:"info:url",label:ac.browseServer}]},{type:"vbox",id:"anchorOptions",width:260,align:"center",padding:0,children:[{type:"fieldset",id:"selectAnchorText",label:ad.selectAnchor,setup:function(b){b.anchors.length>0?this.getElement().show():this.getElement().hide()},children:[{type:"hbox",id:"selectAnchor",children:[{type:"select",id:"anchorName","default":"",label:ad.anchorName,style:"width: 100%;",items:[[""]],setup:function(j){this.clear();this.add("");for(var i=0;i<j.anchors.length;i++){j.anchors[i].name&&this.add(j.anchors[i].name)}j.anchor&&this.setValue(j.anchor.name);(j=this.getDialog().getContentElement("info","linkType"))&&j.getValue()=="email"&&this.focus()},commit:function(b){if(!b.anchor){b.anchor={}}b.anchor.name=this.getValue()}},{type:"select",id:"anchorId","default":"",label:ad.anchorId,style:"width: 100%;",items:[[""]],setup:function(j){this.clear();this.add("");for(var i=0;i<j.anchors.length;i++){j.anchors[i].id&&this.add(j.anchors[i].id)}j.anchor&&this.setValue(j.anchor.id)},commit:function(b){if(!b.anchor){b.anchor={}}b.anchor.id=this.getValue()}}],setup:function(b){b.anchors.length>0?this.getElement().show():this.getElement().hide()}}]},{type:"html",id:"noAnchors",style:"text-align: center;",html:'<div role="note" tabIndex="-1">'+CKEDITOR.tools.htmlEncode(ad.noAnchors)+"</div>",focus:!0,setup:function(b){b.anchors.length<1?this.getElement().show():this.getElement().hide()}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().hide()}},{type:"vbox",id:"emailOptions",padding:1,children:[{type:"text",id:"emailAddress",label:ad.emailAddress,required:!0,validate:function(){var b=this.getDialog();return !b.getContentElement("info","linkType")||b.getValueOf("info","linkType")!="email"?true:CKEDITOR.dialog.validate.notEmpty(ad.noEmail).apply(this)},setup:function(b){b.email&&this.setValue(b.email.address);(b=this.getDialog().getContentElement("info","linkType"))&&b.getValue()=="email"&&this.select()},commit:function(b){if(!b.email){b.email={}}b.email.address=this.getValue()}},{type:"text",id:"emailSubject",label:ad.emailSubject,setup:function(b){b.email&&this.setValue(b.email.subject)},commit:function(b){if(!b.email){b.email={}}b.email.subject=this.getValue()}},{type:"textarea",id:"emailBody",label:ad.emailBody,rows:3,"default":"",setup:function(b){b.email&&this.setValue(b.email.body)},commit:function(b){if(!b.email){b.email={}}b.email.body=this.getValue()}}],setup:function(){this.getDialog().getContentElement("info","linkType")||this.getElement().hide()}}]},{id:"target",requiredContent:"a[target]",label:ad.target,title:ad.target,elements:[{type:"hbox",widths:["50%","50%"],children:[{type:"select",id:"linkTargetType",label:ac.target,"default":"notSet",style:"width : 100%;",items:[[ac.notSet,"notSet"],[ad.targetFrame,"frame"],[ad.targetPopup,"popup"],[ac.targetNew,"_blank"],[ac.targetTop,"_top"],[ac.targetSelf,"_self"],[ac.targetParent,"_parent"]],onChange:O,setup:function(b){b.target&&this.setValue(b.target.type||"notSet");O.call(this)},commit:function(b){if(!b.target){b.target={}}b.target.type=this.getValue()}},{type:"text",id:"linkTargetName",label:ad.targetFrameName,"default":"",setup:function(b){b.target&&this.setValue(b.target.name)},commit:function(b){if(!b.target){b.target={}}b.target.name=this.getValue().replace(/\W/gi,"")}}]},{type:"vbox",width:"100%",align:"center",padding:2,id:"popupFeatures",children:[{type:"fieldset",label:ad.popupFeatures,children:[{type:"hbox",children:[{type:"checkbox",id:"resizable",label:ad.popupResizable,setup:ab,commit:Z},{type:"checkbox",id:"status",label:ad.popupStatusBar,setup:ab,commit:Z}]},{type:"hbox",children:[{type:"checkbox",id:"location",label:ad.popupLocationBar,setup:ab,commit:Z},{type:"checkbox",id:"toolbar",label:ad.popupToolbar,setup:ab,commit:Z}]},{type:"hbox",children:[{type:"checkbox",id:"menubar",label:ad.popupMenuBar,setup:ab,commit:Z},{type:"checkbox",id:"fullscreen",label:ad.popupFullScreen,setup:ab,commit:Z}]},{type:"hbox",children:[{type:"checkbox",id:"scrollbars",label:ad.popupScrollBars,setup:ab,commit:Z},{type:"checkbox",id:"dependent",label:ad.popupDependent,setup:ab,commit:Z}]},{type:"hbox",children:[{type:"text",widths:["50%","50%"],labelLayout:"horizontal",label:ac.width,id:"width",setup:ab,commit:Z},{type:"text",labelLayout:"horizontal",widths:["50%","50%"],label:ad.popupLeft,id:"left",setup:ab,commit:Z}]},{type:"hbox",children:[{type:"text",labelLayout:"horizontal",widths:["50%","50%"],label:ac.height,id:"height",setup:ab,commit:Z},{type:"text",labelLayout:"horizontal",label:ad.popupTop,widths:["50%","50%"],id:"top",setup:ab,commit:Z}]}]}]}]},{id:"upload",label:ad.upload,title:ad.upload,hidden:!0,filebrowser:"uploadButton",elements:[{type:"file",id:"upload",label:ac.upload,style:"height:40px",size:29},{type:"fileButton",id:"uploadButton",label:ac.uploadSubmit,filebrowser:"info:url","for":["upload","upload"]}]},{id:"advanced",label:ad.advanced,title:ad.advanced,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["45%","35%","20%"],children:[{type:"text",id:"advId",requiredContent:"a[id]",label:ad.id,setup:aa,commit:Y},{type:"select",id:"advLangDir",requiredContent:"a[dir]",label:ad.langDir,"default":"",style:"width:110px",items:[[ac.notSet,""],[ad.langDirLTR,"ltr"],[ad.langDirRTL,"rtl"]],setup:aa,commit:Y},{type:"text",id:"advAccessKey",requiredContent:"a[accesskey]",width:"80px",label:ad.acccessKey,maxLength:1,setup:aa,commit:Y}]},{type:"hbox",widths:["45%","35%","20%"],children:[{type:"text",label:ad.name,id:"advName",requiredContent:"a[name]",setup:aa,commit:Y},{type:"text",label:ad.langCode,id:"advLangCode",requiredContent:"a[lang]",width:"110px","default":"",setup:aa,commit:Y},{type:"text",label:ad.tabIndex,id:"advTabIndex",requiredContent:"a[tabindex]",width:"80px",maxLength:5,setup:aa,commit:Y}]}]},{type:"vbox",padding:1,children:[{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:ad.advisoryTitle,requiredContent:"a[title]","default":"",id:"advTitle",setup:aa,commit:Y},{type:"text",label:ad.advisoryContentType,requiredContent:"a[type]","default":"",id:"advContentType",setup:aa,commit:Y}]},{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:ad.cssClasses,requiredContent:"a(cke-xyz)","default":"",id:"advCSSClasses",setup:aa,commit:Y},{type:"text",label:ad.charset,requiredContent:"a[charset]","default":"",id:"advCharset",setup:aa,commit:Y}]},{type:"hbox",widths:["45%","55%"],children:[{type:"text",label:ad.rel,requiredContent:"a[rel]","default":"",id:"advRel",setup:aa,commit:Y},{type:"text",label:ad.styles,requiredContent:"a{cke-xyz}","default":"",id:"advStyles",validate:CKEDITOR.dialog.validate.inlineStyle(X.lang.common.invalidInlineStyle),setup:aa,commit:Y}]}]}]}],onShow:function(){var j=this.getParentEditor(),i=j.getSelection(),k=null;(k=g.getSelectedLink(j))&&k.hasAttribute("href")?i.getSelectedElement()||i.selectElement(k):k=null;this.setupContent(d.apply(this,[j,k]))},onOk:function(){var s={},r=[],q={},p=this.getParentEditor();this.commitContent(q);switch(q.type||"url"){case"url":var o=q.url&&q.url.protocol!=void 0?q.url.protocol:"http://",l=q.url&&CKEDITOR.tools.trim(q.url.url)||"";s["data-cke-saved-href"]=l.indexOf("/")===0?l:o+l;break;case"anchor":o=q.anchor&&q.anchor.id;s["data-cke-saved-href"]="#"+(q.anchor&&q.anchor.name||o||"");break;case"email":var n=q.email,o=n.address;switch(W){case"":case"encode":var l=encodeURIComponent(n.subject||""),m=encodeURIComponent(n.body||""),n=[];l&&n.push("subject="+l);m&&n.push("body="+m);n=n.length?"?"+n.join("&"):"";if(W=="encode"){o=["javascript:void(location.href='mailto:'+",L(o)];n&&o.push("+'",R(n),"'");o.push(")")}else{o=["mailto:",o,n]}break;default:o=o.split("@",2);n.name=o[0];n.domain=o[1];o=["javascript:",N(n)]}s["data-cke-saved-href"]=o.join("")}if(q.target){if(q.target.type=="popup"){for(var o=["window.open(this.href, '",q.target.name||"","', '"],k=["resizable","status","location","toolbar","menubar","fullscreen","scrollbars","dependent"],l=k.length,n=function(b){q.target[b]&&k.push(b+"="+q.target[b])},m=0;m<l;m++){k[m]=k[m]+(q.target[k[m]]?"=yes":"=no")}n("width");n("left");n("height");n("top");o.push(k.join(","),"'); return false;");s["data-cke-pa-onclick"]=o.join("");r.push("target")}else{q.target.type!="notSet"&&q.target.name?s.target=q.target.name:r.push("target");r.push("data-cke-pa-onclick","onclick")}}if(q.adv){o=function(j,i){var b=q.adv[j];b?s[i]=b:r.push(i)};o("advId","id");o("advLangDir","dir");o("advAccessKey","accessKey");q.adv.advName?s.name=s["data-cke-saved-name"]=q.adv.advName:r=r.concat(["data-cke-saved-name","name"]);o("advLangCode","lang");o("advTabIndex","tabindex");o("advTitle","title");o("advContentType","type");o("advCSSClasses","class");o("advCharset","charset");o("advStyles","style");o("advRel","rel")}o=p.getSelection();s.href=s["data-cke-saved-href"];if(this._.selectedElement){p=this._.selectedElement;l=p.data("cke-saved-href");n=p.getHtml();p.setAttributes(s);p.removeAttributes(r);q.adv&&(q.adv.advName&&CKEDITOR.plugins.link.synAnchorSelector)&&p.addClass(p.getChildCount()?"cke_anchor":"cke_anchor_empty");if(l==n||q.type=="email"&&n.indexOf("@")!=-1){p.setHtml(q.type=="email"?q.email.address:s["data-cke-saved-href"]);o.selectElement(p)}delete this._.selectedElement}else{o=o.getRanges()[0];if(o.collapsed){p=new CKEDITOR.dom.text(q.type=="email"?q.email.address:s["data-cke-saved-href"],p.document);o.insertNode(p);o.selectNodeContents(p)}p=new CKEDITOR.style({element:"a",attributes:s});p.type=CKEDITOR.STYLE_INLINE;p.applyToRange(o);o.select()}},onLoad:function(){X.config.linkShowAdvancedTab||this.hidePage("advanced");X.config.linkShowTargetTab||this.hidePage("target")},onFocus:function(){var b=this.getContentElement("info","linkType");if(b&&b.getValue()=="url"){b=this.getContentElement("info","url");b.select()}}}});