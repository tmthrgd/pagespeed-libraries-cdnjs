(function(){CKEDITOR.dialog.add("templates",function(n){function m(f,c){var g=CKEDITOR.dom.element.createFromHtml('<a href="javascript:void(0)" tabIndex="-1" role="option" ><div class="cke_tpl_item"></div></a>'),h='<table style="width:350px;" class="cke_tpl_preview" role="presentation"><tr>';f.image&&c&&(h+='<td class="cke_tpl_preview_img"><img src="'+CKEDITOR.getUrl(c+f.image)+'"'+(CKEDITOR.env.ie6Compat?' onload="this.width=this.width"':"")+' alt="" title=""></td>');h+='<td style="white-space:normal;"><span class="cke_tpl_title">'+f.title+"</span><br/>";f.description&&(h+="<span>"+f.description+"</span>");g.getFirst().setHtml(h+"</td></tr></table>");g.on("click",function(){k(f.html)});return g}function k(f){var c=CKEDITOR.dialog.getCurrent();c.getValueOf("selectTpl","chkInsertOpt")?(n.fire("saveSnapshot"),n.setData(f,function(){c.hide();var g=n.createRange();g.moveToElementEditStart(n.editable());g.select();setTimeout(function(){n.fire("saveSnapshot")},0)})):(n.insertHtml(f),c.hide())}function b(h){var g=h.data.getTarget(),p=e.equals(g);if(p||e.contains(g)){var o=h.data.getKeystroke(),i=e.getElementsByTag("a"),l;if(i){if(p){l=i.getItem(0)}else{switch(o){case 40:l=g.getNext();break;case 38:l=g.getPrevious();break;case 13:case 32:g.fire("click")}}l&&(l.focus(),h.data.preventDefault())}}}var d=CKEDITOR.plugins.get("templates");CKEDITOR.document.appendStyleSheet(CKEDITOR.getUrl(d.path+"dialogs/templates.css"));var e,d="cke_tpl_list_label_"+CKEDITOR.tools.getNextNumber(),j=n.lang.templates,a=n.config;return{title:n.lang.templates.title,minWidth:CKEDITOR.env.ie?440:400,minHeight:340,contents:[{id:"selectTpl",label:j.title,elements:[{type:"vbox",padding:5,children:[{id:"selectTplText",type:"html",html:"<span>"+j.selectPromptMsg+"</span>"},{id:"templatesList",type:"html",focus:!0,html:'<div class="cke_tpl_list" tabIndex="-1" role="listbox" aria-labelledby="'+d+'"><div class="cke_tpl_loading"><span></span></div></div><span class="cke_voice_label" id="'+d+'">'+j.options+"</span>"},{id:"chkInsertOpt",type:"checkbox",label:j.insertOption,"default":a.templates_replaceContent}]}]}],buttons:[CKEDITOR.dialog.cancelButton],onShow:function(){var c=this.getContentElement("selectTpl","templatesList");e=c.getElement();CKEDITOR.loadTemplates(a.templates_files,function(){var t=(a.templates||"default").split(",");if(t.length){var s=e;s.setHtml("");for(var r=0,p=t.length;r<p;r++){for(var q=CKEDITOR.getTemplates(t[r]),o=q.imagesPath,q=q.templates,f=q.length,l=0;l<f;l++){var g=m(q[l],o);g.setAttribute("aria-posinset",l+1);g.setAttribute("aria-setsize",f);s.append(g)}}c.focus()}else{e.setHtml('<div class="cke_tpl_empty"><span>'+j.emptyListMsg+"</span></div>")}});this._.element.on("keydown",b)},onHide:function(){this._.element.removeListener("keydown",b)}}})})();