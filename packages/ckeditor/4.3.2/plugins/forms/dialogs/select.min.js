CKEDITOR.dialog.add("select",function(t){function q(g,f,h,i,j){g=s(g);i=i?i.createElement("OPTION"):document.createElement("OPTION");if(g&&i&&"option"==i.getName()){CKEDITOR.env.ie?(isNaN(parseInt(j,10))?g.$.options.add(i.$):g.$.options.add(i.$,j),i.$.innerHTML=0<f.length?f:"",i.$.value=h):(null!==j&&j<g.getChildCount()?g.getChild(0>j?0:j).insertBeforeMe(i):g.append(i),i.setText(0<f.length?f:""),i.setValue(h))}else{return !1}return i}function b(f){for(var f=s(f),c=r(f),g=f.getChildren().count()-1;0<=g;g--){f.getChild(g).$.selected&&f.getChild(g).remove()}p(f,c)}function a(f,c,g,h){f=s(f);if(0>c){return !1}f=f.getChild(c);f.setText(g);f.setValue(h);return f}function e(c){for(c=s(c);c.getChild(0)&&c.getChild(0).remove();){}}function o(g,f,h){var g=s(g),j=r(g);if(0>j){return !1}f=j+f;f=0>f?0:f;f=f>=g.getChildCount()?g.getChildCount()-1:f;if(j==f){return !1}var j=g.getChild(j),k=j.getText(),i=j.getValue();j.remove();j=q(g,k,i,!h?null:h,f);p(g,f);return j}function r(c){return(c=s(c))?c.$.selectedIndex:-1}function p(f,c){f=s(f);if(0>c){return null}var g=f.getChildren().count();f.$.selectedIndex=c>=g?g-1:c;return f}function d(c){return(c=s(c))?c.getChildren():!1}function s(c){return c&&c.domId&&c.getInputElement().$?c.getInputElement():c&&c.$?c:!1}return{title:t.lang.forms.select.title,minWidth:CKEDITOR.env.ie?460:395,minHeight:CKEDITOR.env.ie?320:300,onShow:function(){delete this.selectBox;this.setupContent("clear");var f=this.getParentEditor().getSelection().getSelectedElement();if(f&&"select"==f.getName()){this.selectBox=f;this.setupContent(f.getName(),f);for(var f=d(f),c=0;c<f.count();c++){this.setupContent("option",f.getItem(c))}}},onOk:function(){var g=this.getParentEditor(),f=this.selectBox,h=!f;h&&(f=g.document.createElement("select"));this.commitContent(f);if(h&&(g.insertElement(f),CKEDITOR.env.ie)){var i=g.getSelection(),j=i.createBookmarks();setTimeout(function(){i.selectBookmarks(j)},0)}},contents:[{id:"info",label:t.lang.forms.select.selectInfo,title:t.lang.forms.select.selectInfo,accessKey:"",elements:[{id:"txtName",type:"text",widths:["25%","75%"],labelLayout:"horizontal",label:t.lang.common.name,"default":"",accessKey:"N",style:"width:350px",setup:function(f,c){"clear"==f?this.setValue(this["default"]||""):"select"==f&&this.setValue(c.data("cke-saved-name")||c.getAttribute("name")||"")},commit:function(c){this.getValue()?c.data("cke-saved-name",this.getValue()):(c.data("cke-saved-name",!1),c.removeAttribute("name"))}},{id:"txtValue",type:"text",widths:["25%","75%"],labelLayout:"horizontal",label:t.lang.forms.select.value,style:"width:350px","default":"",className:"cke_disabled",onLoad:function(){this.getInputElement().setAttribute("readOnly",!0)},setup:function(f,c){"clear"==f?this.setValue(""):"option"==f&&c.getAttribute("selected")&&this.setValue(c.$.value)}},{type:"hbox",widths:["175px","170px"],children:[{id:"txtSize",type:"text",labelLayout:"horizontal",label:t.lang.forms.select.size,"default":"",accessKey:"S",style:"width:175px",validate:function(){var c=CKEDITOR.dialog.validate.integer(t.lang.common.validateNumberFailed);return""===this.getValue()||c.apply(this)},setup:function(f,c){"select"==f&&this.setValue(c.getAttribute("size")||"");CKEDITOR.env.webkit&&this.getInputElement().setStyle("width","86px")},commit:function(c){this.getValue()?c.setAttribute("size",this.getValue()):c.removeAttribute("size")}},{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(t.lang.forms.select.lines)+"</span>"}]},{type:"html",html:"<span>"+CKEDITOR.tools.htmlEncode(t.lang.forms.select.opAvail)+"</span>"},{type:"hbox",widths:["115px","115px","100px"],children:[{type:"vbox",children:[{id:"txtOptName",type:"text",label:t.lang.forms.select.opText,style:"width:115px",setup:function(c){"clear"==c&&this.setValue("")}},{type:"select",id:"cmbName",label:"",title:"",size:5,style:"width:115px;height:75px",items:[],onChange:function(){var f=this.getDialog(),c=f.getContentElement("info","cmbValue"),g=f.getContentElement("info","txtOptName"),f=f.getContentElement("info","txtOptValue"),h=r(this);p(c,h);g.setValue(this.getValue());f.setValue(c.getValue())},setup:function(f,c){"clear"==f?e(this):"option"==f&&q(this,c.getText(),c.getText(),this.getDialog().getParentEditor().document)},commit:function(i){var h=this.getDialog(),l=d(this),m=d(h.getContentElement("info","cmbValue")),n=h.getContentElement("info","txtValue").getValue();e(i);for(var k=0;k<l.count();k++){var j=q(i,l.getItem(k).getValue(),m.getItem(k).getValue(),h.getParentEditor().document);m.getItem(k).getValue()==n&&(j.setAttribute("selected","selected"),j.selected=!0)}}}]},{type:"vbox",children:[{id:"txtOptValue",type:"text",label:t.lang.forms.select.opValue,style:"width:115px",setup:function(c){"clear"==c&&this.setValue("")}},{type:"select",id:"cmbValue",label:"",size:5,style:"width:115px;height:75px",items:[],onChange:function(){var f=this.getDialog(),c=f.getContentElement("info","cmbName"),g=f.getContentElement("info","txtOptName"),f=f.getContentElement("info","txtOptValue"),h=r(this);p(c,h);g.setValue(c.getValue());f.setValue(this.getValue())},setup:function(f,c){if("clear"==f){e(this)}else{if("option"==f){var g=c.getValue();q(this,g,g,this.getDialog().getParentEditor().document);"selected"==c.getAttribute("selected")&&this.getDialog().getContentElement("info","txtValue").setValue(g)}}}}]},{type:"vbox",padding:5,children:[{type:"button",id:"btnAdd",style:"",label:t.lang.forms.select.btnAdd,title:t.lang.forms.select.btnAdd,style:"width:100%;",onClick:function(){var g=this.getDialog();g.getParentEditor();var f=g.getContentElement("info","txtOptName"),h=g.getContentElement("info","txtOptValue"),i=g.getContentElement("info","cmbName"),j=g.getContentElement("info","cmbValue");q(i,f.getValue(),f.getValue(),g.getParentEditor().document);q(j,h.getValue(),h.getValue(),g.getParentEditor().document);f.setValue("");h.setValue("")}},{type:"button",id:"btnModify",label:t.lang.forms.select.btnModify,title:t.lang.forms.select.btnModify,style:"width:100%;",onClick:function(){var g=this.getDialog(),f=g.getContentElement("info","txtOptName"),h=g.getContentElement("info","txtOptValue"),i=g.getContentElement("info","cmbName"),g=g.getContentElement("info","cmbValue"),j=r(i);0<=j&&(a(i,j,f.getValue(),f.getValue()),a(g,j,h.getValue(),h.getValue()))}},{type:"button",id:"btnUp",style:"width:100%;",label:t.lang.forms.select.btnUp,title:t.lang.forms.select.btnUp,onClick:function(){var g=this.getDialog(),f=g.getContentElement("info","cmbName"),h=g.getContentElement("info","cmbValue");o(f,-1,g.getParentEditor().document);o(h,-1,g.getParentEditor().document)}},{type:"button",id:"btnDown",style:"width:100%;",label:t.lang.forms.select.btnDown,title:t.lang.forms.select.btnDown,onClick:function(){var g=this.getDialog(),f=g.getContentElement("info","cmbName"),h=g.getContentElement("info","cmbValue");o(f,1,g.getParentEditor().document);o(h,1,g.getParentEditor().document)}}]}]},{type:"hbox",widths:["40%","20%","40%"],children:[{type:"button",id:"btnSetValue",label:t.lang.forms.select.btnSetValue,title:t.lang.forms.select.btnSetValue,onClick:function(){var f=this.getDialog(),c=f.getContentElement("info","cmbValue");f.getContentElement("info","txtValue").setValue(c.getValue())}},{type:"button",id:"btnDelete",label:t.lang.forms.select.btnDelete,title:t.lang.forms.select.btnDelete,onClick:function(){var g=this.getDialog(),f=g.getContentElement("info","cmbName"),i=g.getContentElement("info","cmbValue"),h=g.getContentElement("info","txtOptName"),g=g.getContentElement("info","txtOptValue");b(f);b(i);h.setValue("");g.setValue("")}},{id:"chkMulti",type:"checkbox",label:t.lang.forms.select.chkMulti,"default":"",accessKey:"M",value:"checked",setup:function(f,c){"select"==f&&this.setValue(c.getAttribute("multiple"));CKEDITOR.env.webkit&&this.getElement().getParent().setStyle("vertical-align","middle")},commit:function(c){this.getValue()?c.setAttribute("multiple",this.getValue()):c.removeAttribute("multiple")}}]}]}]}});