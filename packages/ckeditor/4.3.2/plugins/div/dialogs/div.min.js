(function(){function a(c,d,e){if(!d.is||!d.getCustomData("block_processed")){d.is&&CKEDITOR.dom.element.setMarker(e,d,"block_processed",!0),c.push(d)}}function b(e,f){function h(){this.foreach(function(j){if(/^(?!vbox|hbox)/.test(j.type)&&(j.setup||(j.setup=function(k){j.setValue(k.getAttribute(j.id)||"",1)}),!j.commit)){j.commit=function(l){var k=this.getValue();"dir"==j.id&&l.getComputedStyle("direction")==k||(k?l.setAttribute(j.id,k):l.removeAttribute(j.id))}}})}var i=function(){var j=CKEDITOR.tools.extend({},CKEDITOR.dtd.$blockLimit);e.config.div_wrapTable&&(delete j.td,delete j.th);return j}(),g=CKEDITOR.dtd.div,d={},c=[];return{title:e.lang.div.title,minWidth:400,minHeight:165,contents:[{id:"info",label:e.lang.common.generalTab,title:e.lang.common.generalTab,elements:[{type:"hbox",widths:["50%","50%"],children:[{id:"elementStyle",type:"select",style:"width: 100%;",label:e.lang.div.styleSelectLabel,"default":"",items:[[e.lang.common.notSet,""]],onChange:function(){var n=["info:elementStyle","info:class","advanced:dir","advanced:style"],o=this.getDialog(),l=o._element&&o._element.clone()||new CKEDITOR.dom.element("div",e.document);this.commit(l,!0);for(var n=[].concat(n),j=n.length,k,m=0;m<j;m++){(k=o.getContentElement.apply(o,n[m].split(":")))&&k.setup&&k.setup(l,!0)}},setup:function(j){for(var k in d){d[k].checkElementRemovable(j,!0)&&this.setValue(k,1)}},commit:function(j){var k;(k=this.getValue())?d[k].applyToObject(j):j.removeAttribute("style")}},{id:"class",type:"text",requiredContent:"div(cke-xyz)",label:e.lang.common.cssClass,"default":""}]}]},{id:"advanced",label:e.lang.common.advancedTab,title:e.lang.common.advancedTab,elements:[{type:"vbox",padding:1,children:[{type:"hbox",widths:["50%","50%"],children:[{type:"text",id:"id",requiredContent:"div[id]",label:e.lang.common.id,"default":""},{type:"text",id:"lang",requiredContent:"div[lang]",label:e.lang.common.langCode,"default":""}]},{type:"hbox",children:[{type:"text",id:"style",requiredContent:"div{cke-xyz}",style:"width: 100%;",label:e.lang.common.cssStyle,"default":"",commit:function(j){j.setAttribute("style",this.getValue())}}]},{type:"hbox",children:[{type:"text",id:"title",requiredContent:"div[title]",style:"width: 100%;",label:e.lang.common.advisoryTitle,"default":""}]},{type:"select",id:"dir",requiredContent:"div[dir]",style:"width: 100%;",label:e.lang.common.langDir,"default":"",items:[[e.lang.common.notSet,""],[e.lang.common.langDirLtr,"ltr"],[e.lang.common.langDirRtl,"rtl"]]}]}]}],onLoad:function(){h.call(this);var j=this,k=this.getContentElement("info","elementStyle");e.getStylesSet(function(n){var l,m;if(n){for(var o=0;o<n.length;o++){m=n[o],m.element&&"div"==m.element&&(l=m.name,d[l]=m=new CKEDITOR.style(m),e.filter.check(m)&&(k.items.push([l,l]),k.add(l,l)))}}k[1<k.items.length?"enable":"disable"]();setTimeout(function(){j._element&&k.setup(j._element)},0)})},onShow:function(){"editdiv"==f&&this.setupContent(this._element=CKEDITOR.plugins.div.getSurroundDiv(e))},onOk:function(){if("editdiv"==f){c=[this._element]}else{var s=[],t={},o=[],u,n=e.getSelection(),q=n.getRanges(),k=n.createBookmarks(),p,m;for(p=0;p<q.length;p++){for(m=q[p].createIterator();u=m.getNextParagraph();){if(u.getName() in i&&!u.isReadOnly()){var r=u.getChildren();for(u=0;u<r.count();u++){a(o,r.getItem(u),t)}}else{for(;!g[u.getName()]&&!u.equals(q[p].root);){u=u.getParent()}a(o,u,t)}}}CKEDITOR.dom.element.clearAllMarkers(t);q=[];p=null;for(m=0;m<o.length;m++){u=o[m],r=e.elementPath(u).blockLimit,r.isReadOnly()&&(r=r.getParent()),e.config.div_wrapTable&&r.is(["td","th"])&&(r=e.elementPath(r.getParent()).blockLimit),r.equals(p)||(p=r,q.push([])),q[q.length-1].push(u)}for(p=0;p<q.length;p++){r=q[p][0];o=r.getParent();for(u=1;u<q[p].length;u++){o=o.getCommonAncestor(q[p][u])}m=new CKEDITOR.dom.element("div",e.document);for(u=0;u<q[p].length;u++){for(r=q[p][u];!r.getParent().equals(o);){r=r.getParent()}q[p][u]=r}for(u=0;u<q[p].length;u++){if(r=q[p][u],!r.getCustomData||!r.getCustomData("block_processed")){r.is&&CKEDITOR.dom.element.setMarker(t,r,"block_processed",!0),u||m.insertBefore(r),m.append(r)}}CKEDITOR.dom.element.clearAllMarkers(t);s.push(m)}n.selectBookmarks(k);c=s}s=c.length;for(t=0;t<s;t++){this.commitContent(c[t]),!c[t].getAttribute("style")&&c[t].removeAttribute("style")}this.hide()},onHide:function(){"editdiv"==f&&this._element.removeCustomData("elementStyle");delete this._element}}}CKEDITOR.dialog.add("creatediv",function(c){return b(c,"creatediv")});CKEDITOR.dialog.add("editdiv",function(c){return b(c,"editdiv")})})();