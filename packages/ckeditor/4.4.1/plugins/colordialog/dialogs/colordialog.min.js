CKEDITOR.dialog.add("colordialog",function(A){function F(){N.getById(E).removeStyle("background-color");D.getContentElement("picker","selectedColor").setValue("");J&&J.removeAttribute("aria-selected");J=null}function s(g){var g=g.data.getTarget(),f;if("td"==g.getName()&&(f=g.getChild(0).getHtml())){J=g,J.setAttribute("aria-selected",!0),D.getContentElement("picker","selectedColor").setValue(f)}}function b(g){for(var g=g.replace(/^#/,""),f=0,h=[];2>=f;f++){h[f]=parseInt(g.substr(2*f,2),16)}return"#"+(165<=0.2126*h[0]+0.7152*h[1]+0.0722*h[2]?"000":"fff")}function e(g){!g.name&&(g=new CKEDITOR.event(g));var f=!/mouse/.test(g.name),i=g.data.getTarget(),h;if("td"==i.getName()&&(h=i.getChild(0).getHtml())){C(g),f?M=i:d=i,f&&(i.setStyle("border-color",b(h)),i.setStyle("border-style","dotted")),N.getById(I).setStyle("background-color",h),N.getById(H).setHtml(h)}}function C(g){if(g=!/mouse/.test(g.name)&&M){var f=g.getChild(0).getHtml();g.setStyle("border-color",f);g.setStyle("border-style","solid")}!M&&!d&&(N.getById(I).removeStyle("background-color"),N.getById(H).setHtml("&nbsp;"))}function a(g){var f=g.data,j=f.getTarget(),h=f.getKeystroke(),i="rtl"==A.lang.dir;switch(h){case 38:if(g=j.getParent().getPrevious()){g=g.getChild([j.getIndex()]),g.focus()}f.preventDefault();break;case 40:if(g=j.getParent().getNext()){(g=g.getChild([j.getIndex()]))&&1==g.type&&g.focus()}f.preventDefault();break;case 32:case 13:s(g);f.preventDefault();break;case i?37:39:if(g=j.getNext()){1==g.type&&(g.focus(),f.preventDefault(!0))}else{if(g=j.getParent().getNext()){if((g=g.getChild([0]))&&1==g.type){g.focus(),f.preventDefault(!0)}}}break;case i?39:37:if(g=j.getPrevious()){g.focus(),f.preventDefault(!0)}else{if(g=j.getParent().getPrevious()){g=g.getLast(),g.focus(),f.preventDefault(!0)}}}}var B=CKEDITOR.dom.element,N=CKEDITOR.document,L=A.lang.colordialog,D,c={type:"html",html:"&nbsp;"},J,M,d,G=function(f){return CKEDITOR.tools.getNextId()+"_"+f},I=G("hicolor"),H=G("hicolortext"),E=G("selhicolor"),K;(function(){function g(k,p){for(var l=k;l<k+3;l++){var o=new B(K.$.insertRow(-1));o.setAttribute("role","row");for(var n=p;n<p+3;n++){for(var m=0;6>m;m++){f(o.$,"#"+j[n]+j[m]+j[l])}}}}function f(l,n){var k=new B(l.insertCell(-1));k.setAttribute("class","ColorCell");k.setAttribute("tabIndex",-1);k.setAttribute("role","gridcell");k.on("keydown",a);k.on("click",s);k.on("focus",e);k.on("blur",C);k.setStyle("background-color",n);k.setStyle("border","1px solid "+n);k.setStyle("width","14px");k.setStyle("height","14px");var m=G("color_table_cell");k.setAttribute("aria-labelledby",m);k.append(CKEDITOR.dom.element.createFromHtml('<span id="'+m+'" class="cke_voice_label">'+n+"</span>",CKEDITOR.document))}K=CKEDITOR.dom.element.createFromHtml('<table tabIndex="-1" aria-label="'+L.options+'" role="grid" style="border-collapse:separate;" cellspacing="0"><caption class="cke_voice_label">'+L.options+'</caption><tbody role="presentation"></tbody></table>');K.on("mouseover",e);K.on("mouseout",C);var j="00 33 66 99 cc ff".split(" ");g(0,0);g(3,0);g(0,3);g(3,3);var h=new B(K.$.insertRow(-1));h.setAttribute("role","row");for(var i=0;6>i;i++){f(h.$,"#"+j[i]+j[i]+j[i])}for(i=0;12>i;i++){f(h.$,"#000000")}})();return{title:L.title,minWidth:360,minHeight:220,onLoad:function(){D=this},onHide:function(){F();var f=M.getChild(0).getHtml();M.setStyle("border-color",f);M.setStyle("border-style","solid");N.getById(I).removeStyle("background-color");N.getById(H).setHtml("&nbsp;");M=null},contents:[{id:"picker",label:L.title,accessKey:"I",elements:[{type:"hbox",padding:0,widths:["70%","10%","30%"],children:[{type:"html",html:"<div></div>",onLoad:function(){CKEDITOR.document.getById(this.domId).append(K)},focus:function(){(M||this.getElement().getElementsByTag("td").getItem(0)).focus()}},c,{type:"vbox",padding:0,widths:["70%","5%","25%"],children:[{type:"html",html:"<span>"+L.highlight+'</span>\t\t\t\t\t\t\t\t\t\t\t\t<div id="'+I+'" style="border: 1px solid; height: 74px; width: 74px;"></div>\t\t\t\t\t\t\t\t\t\t\t\t<div id="'+H+'">&nbsp;</div><span>'+L.selected+'</span>\t\t\t\t\t\t\t\t\t\t\t\t<div id="'+E+'" style="border: 1px solid; height: 20px; width: 74px;"></div>'},{type:"text",label:L.selected,labelStyle:"display:none",id:"selectedColor",style:"width: 74px",onChange:function(){try{N.getById(E).setStyle("background-color",this.getValue())}catch(f){F()}}},c,{type:"button",id:"clear",style:"margin-top: 5px",label:L.clear,onClick:F}]}]}]}]}});