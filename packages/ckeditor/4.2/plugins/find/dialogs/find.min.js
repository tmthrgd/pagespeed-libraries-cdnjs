(function(){function g(h){return h.type==CKEDITOR.NODE_TEXT&&0<h.getLength()&&(!e||!h.isReadOnly())}function c(h){return !(h.type==CKEDITOR.NODE_ELEMENT&&h.isBlockBoundary(CKEDITOR.tools.extend({},CKEDITOR.dtd.$empty,CKEDITOR.dtd.$nonEditable)))}var e,b=function(){return{textNode:this.textNode,offset:this.offset,character:this.textNode?this.textNode.getText().charAt(this.offset):null,hitMatchBoundary:this._.matchBoundary}},a=["find","replace"],d=[["txtFindFind","txtFindReplace"],["txtFindCaseChk","txtReplaceCaseChk"],["txtFindWordChk","txtReplaceWordChk"],["txtFindCyclic","txtReplaceCyclic"]],f=function(t,m){function j(n,l){var q=t.createRange();q.setStart(n.textNode,l?n.offset:n.offset+1);q.setEndAt(t.editable(),CKEDITOR.POSITION_BEFORE_END);return q}function i(n){var l=t.getSelection(),q=t.editable();l&&!n?(n=l.getRanges()[0].clone(),n.collapse(!0)):(n=t.createRange(),n.setStartAt(q,CKEDITOR.POSITION_AFTER_START));n.setEndAt(q,CKEDITOR.POSITION_BEFORE_END);return n}var A=new CKEDITOR.style(CKEDITOR.tools.extend({attributes:{"data-cke-highlight":1},fullMatch:1,ignoreReadonly:1,childRule:function(){return 0}},t.config.find_highlight,!0)),k=function(n,l){var q=this,r=new CKEDITOR.dom.walker(n);r.guard=l?c:function(v){!c(v)&&(q._.matchBoundary=!0)};r.evaluator=g;r.breakOnFalse=1;n.startContainer.type==CKEDITOR.NODE_TEXT&&(this.textNode=n.startContainer,this.offset=n.startOffset-1);this._={matchWord:l,walker:r,matchBoundary:!1}};k.prototype={next:function(){return this.move()},back:function(){return this.move(!0)},move:function(n){var l=this.textNode;if(null===l){return b.call(this)}this._.matchBoundary=!1;if(l&&n&&0<this.offset){this.offset--}else{if(l&&this.offset<l.getLength()-1){this.offset++}else{for(l=null;!l&&!(l=this._.walker[n?"previous":"next"].call(this._.walker),this._.matchWord&&!l||this._.walker._.end);){}this.offset=(this.textNode=l)?n?l.getLength()-1:0:0}}return b.call(this)}};var h=function(n,l){this._={walker:n,cursors:[],rangeLength:l,highlightRange:null,isMatched:0}};h.prototype={toDomRange:function(){var n=t.createRange(),l=this._.cursors;if(1>l.length){var q=this._.walker.textNode;if(q){n.setStartAfter(q)}else{return null}}else{q=l[0],l=l[l.length-1],n.setStart(q.textNode,q.offset),n.setEnd(l.textNode,l.offset+1)}return n},updateFromDomRange:function(n){var l=new k(n);this._.cursors=[];do{n=l.next(),n.character&&this._.cursors.push(n)}while(n.character);this._.rangeLength=this._.cursors.length},setMatched:function(){this._.isMatched=!0},clearMatched:function(){this._.isMatched=!1},isMatched:function(){return this._.isMatched},highlight:function(){if(!(1>this._.cursors.length)){this._.highlightRange&&this.removeHighlight();var n=this.toDomRange(),l=n.createBookmark();A.applyToRange(n);n.moveToBookmark(l);this._.highlightRange=n;l=n.startContainer;l.type!=CKEDITOR.NODE_ELEMENT&&(l=l.getParent());l.scrollIntoView();this.updateFromDomRange(n)}},removeHighlight:function(){if(this._.highlightRange){var l=this._.highlightRange.createBookmark();A.removeFromRange(this._.highlightRange);this._.highlightRange.moveToBookmark(l);this.updateFromDomRange(this._.highlightRange);this._.highlightRange=null}},isReadOnly:function(){return !this._.highlightRange?0:this._.highlightRange.startContainer.isReadOnly()},moveBack:function(){var n=this._.walker.back(),l=this._.cursors;n.hitMatchBoundary&&(this._.cursors=l=[]);l.unshift(n);l.length>this._.rangeLength&&l.pop();return n},moveNext:function(){var n=this._.walker.next(),l=this._.cursors;n.hitMatchBoundary&&(this._.cursors=l=[]);l.push(n);l.length>this._.rangeLength&&l.shift();return n},getEndCharacter:function(){var l=this._.cursors;return 1>l.length?null:l[l.length-1].character},getNextCharacterRange:function(n){var l,q;q=this._.cursors;q=(l=q[q.length-1])&&l.textNode?new k(j(l)):this._.walker;return new h(q,n)},getCursors:function(){return this._.cursors}};var y=function(n,l){var q=[-1];l&&(n=n.toLowerCase());for(var r=0;r<n.length;r++){for(q.push(q[r]+1);0<q[r+1]&&n.charAt(r)!=n.charAt(q[r+1]-1);){q[r+1]=q[q[r+1]-1]+1}}this._={overlap:q,state:0,ignoreCase:!!l,pattern:n}};y.prototype={feedCharacter:function(l){for(this._.ignoreCase&&(l=l.toLowerCase());;){if(l==this._.pattern.charAt(this._.state)){return this._.state++,this._.state==this._.pattern.length?(this._.state=0,2):1}if(this._.state){this._.state=this._.overlap[this._.state]}else{return 0}}return null},reset:function(){this._.state=0}};var s=/[.,"'?!;: \u0085\u00a0\u1680\u280e\u2028\u2029\u202f\u205f\u3000]/,u=function(n){if(!n){return !0}var l=n.charCodeAt(0);return 9<=l&&13>=l||8192<=l&&8202>=l||s.test(n)},p={searchRange:null,matchRange:null,find:function(E,D,C,z,B,l){this.matchRange?(this.matchRange.removeHighlight(),this.matchRange=this.matchRange.getNextCharacterRange(E.length)):this.matchRange=new h(new k(this.searchRange),E.length);for(var v=new y(E,!D),r=0,q="%";null!==q;){for(this.matchRange.moveNext();q=this.matchRange.getEndCharacter();){r=v.feedCharacter(q);if(2==r){break}this.matchRange.moveNext().hitMatchBoundary&&v.reset()}if(2==r){if(C){var w=this.matchRange.getCursors(),n=w[w.length-1],w=w[0],x=t.createRange();x.setStartAt(t.editable(),CKEDITOR.POSITION_AFTER_START);x.setEnd(w.textNode,w.offset);w=x;n=j(n);w.trim();n.trim();w=new k(w,!0);n=new k(n,!0);if(!u(w.back().character)||!u(n.next().character)){continue}}this.matchRange.setMatched();!1!==B&&this.matchRange.highlight();return !0}}this.matchRange.clearMatched();this.matchRange.removeHighlight();return z&&!l?(this.searchRange=i(1),this.matchRange=null,arguments.callee.apply(this,Array.prototype.slice.call(arguments).concat([!0]))):!1},replaceCounter:0,replace:function(n,l,z,w,x,v,r){e=1;n=0;if(this.matchRange&&this.matchRange.isMatched()&&!this.matchRange._.isReplaced&&!this.matchRange.isReadOnly()){this.matchRange.removeHighlight();l=this.matchRange.toDomRange();z=t.document.createText(z);if(!r){var q=t.getSelection();q.selectRanges([l]);t.fire("saveSnapshot")}l.deleteContents();l.insertNode(z);r||(q.selectRanges([l]),t.fire("saveSnapshot"));this.matchRange.updateFromDomRange(l);r||this.matchRange.highlight();this.matchRange._.isReplaced=!0;this.replaceCounter++;n=1}else{n=this.find(l,w,x,v,!r)}e=0;return n}},o=t.lang.find;return{title:o.title,resizable:CKEDITOR.DIALOG_RESIZE_NONE,minWidth:350,minHeight:170,buttons:[CKEDITOR.dialog.cancelButton(t,{label:t.lang.common.close})],contents:[{id:"find",label:o.find,title:o.find,accessKey:"",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindFind",label:o.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFind",align:"left",style:"width:100%",label:o.find,onClick:function(){var l=this.getDialog();p.find(l.getValueOf("find","txtFindFind"),l.getValueOf("find","txtFindCaseChk"),l.getValueOf("find","txtFindWordChk"),l.getValueOf("find","txtFindCyclic"))||alert(o.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(o.findOptions),style:"margin-top:29px",children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtFindCaseChk",isChanged:!1,label:o.matchCase},{type:"checkbox",id:"txtFindWordChk",isChanged:!1,label:o.matchWord},{type:"checkbox",id:"txtFindCyclic",isChanged:!1,"default":!0,label:o.matchCyclic}]}]}]},{id:"replace",label:o.replace,accessKey:"M",elements:[{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtFindReplace",label:o.findWhat,isChanged:!1,labelLayout:"horizontal",accessKey:"F"},{type:"button",id:"btnFindReplace",align:"left",style:"width:100%",label:o.replace,onClick:function(){var l=this.getDialog();p.replace(l,l.getValueOf("replace","txtFindReplace"),l.getValueOf("replace","txtReplace"),l.getValueOf("replace","txtReplaceCaseChk"),l.getValueOf("replace","txtReplaceWordChk"),l.getValueOf("replace","txtReplaceCyclic"))||alert(o.notFoundMsg)}}]},{type:"hbox",widths:["230px","90px"],children:[{type:"text",id:"txtReplace",label:o.replaceWith,isChanged:!1,labelLayout:"horizontal",accessKey:"R"},{type:"button",id:"btnReplaceAll",align:"left",style:"width:100%",label:o.replaceAll,isChanged:!1,onClick:function(){var l=this.getDialog();p.replaceCounter=0;p.searchRange=i(1);p.matchRange&&(p.matchRange.removeHighlight(),p.matchRange=null);for(t.fire("saveSnapshot");p.replace(l,l.getValueOf("replace","txtFindReplace"),l.getValueOf("replace","txtReplace"),l.getValueOf("replace","txtReplaceCaseChk"),l.getValueOf("replace","txtReplaceWordChk"),!1,!0);){}p.replaceCounter?(alert(o.replaceSuccessMsg.replace(/%1/,p.replaceCounter)),t.fire("saveSnapshot")):alert(o.notFoundMsg)}}]},{type:"fieldset",label:CKEDITOR.tools.htmlEncode(o.findOptions),children:[{type:"vbox",padding:0,children:[{type:"checkbox",id:"txtReplaceCaseChk",isChanged:!1,label:o.matchCase},{type:"checkbox",id:"txtReplaceWordChk",isChanged:!1,label:o.matchWord},{type:"checkbox",id:"txtReplaceCyclic",isChanged:!1,"default":!0,label:o.matchCyclic}]}]}]}],onLoad:function(){var n=this,l,q=0;this.on("hide",function(){q=0});this.on("show",function(){q=1});this.selectPage=CKEDITOR.tools.override(this.selectPage,function(r){return function(C){r.call(n,C);var B=n._.tabs[C],x;x="find"===C?"txtFindWordChk":"txtReplaceWordChk";l=n.getContentElement(C,"find"===C?"txtFindFind":"txtFindReplace");n.getContentElement(C,x);B.initialized||(CKEDITOR.document.getById(l._.inputId),B.initialized=!0);if(q){var w,C="find"===C?1:0,B=1-C,v,z=d.length;for(v=0;v<z;v++){x=this.getContentElement(a[C],d[v][C]),w=this.getContentElement(a[B],d[v][B]),w.setValue(x.getValue())}}}})},onShow:function(){p.searchRange=i();var n=this.getParentEditor().getSelection().getSelectedText(),l=this.getContentElement(m,"find"==m?"txtFindFind":"txtFindReplace");l.setValue(n);l.select();this.selectPage(m);this[("find"==m&&this._.editor.readOnly?"hide":"show")+"Page"]("replace")},onHide:function(){var l;p.matchRange&&p.matchRange.isMatched()&&(p.matchRange.removeHighlight(),t.focus(),(l=p.matchRange.toDomRange())&&t.getSelection().selectRanges([l]));delete p.matchRange},onFocus:function(){return"replace"==m?this.getContentElement("replace","txtFindReplace"):this.getContentElement("find","txtFindFind")}}};CKEDITOR.dialog.add("find",function(h){return f(h,"find")});CKEDITOR.dialog.add("replace",function(h){return f(h,"replace")})})();