var cryptico=(function(){var b={};aes.Init();var a="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";b.b256to64=function(g){var e,m,k;var j="",d=0,h=0;var f=g.length;for(k=0;k<f;k++){m=g.charCodeAt(k);if(h==0){j+=a.charAt((m>>2)&63);e=(m&3)<<4}else{if(h==1){j+=a.charAt((e|(m>>4)&15));e=(m&15)<<2}else{if(h==2){j+=a.charAt(e|((m>>6)&3));d+=1;j+=a.charAt(m&63)}}}d+=1;h+=1;if(h==3){h=0}}if(h>0){j+=a.charAt(e);d+=1;j+="=";d+=1}if(h==1){j+="="}return j};b.b64to256=function(f){var k,j;var h="",g=0,d=0;var e=f.length;for(j=0;j<e;j++){k=a.indexOf(f.charAt(j));if(k>=0){if(g){h+=String.fromCharCode(d|(k>>(6-g))&255)}g=(g+2)&7;d=(k<<g)&255}}return h};b.b16to64=function(f){var e;var g;var d="";if(f.length%2==1){f="0"+f}for(e=0;e+3<=f.length;e+=3){g=parseInt(f.substring(e,e+3),16);d+=a.charAt(g>>6)+a.charAt(g&63)}if(e+1==f.length){g=parseInt(f.substring(e,e+1),16);d+=a.charAt(g<<2)}else{if(e+2==f.length){g=parseInt(f.substring(e,e+2),16);d+=a.charAt(g>>2)+a.charAt((g&3)<<4)}}while((d.length&3)>0){d+="="}return d};b.b64to16=function(g){var e="";var f;var c=0;var d;for(f=0;f<g.length;++f){if(g.charAt(f)=="="){break}v=a.indexOf(g.charAt(f));if(v<0){continue}if(c==0){e+=int2char(v>>2);d=v&3;c=1}else{if(c==1){e+=int2char((d<<2)|(v>>4));d=v&15;c=2}else{if(c==2){e+=int2char(d);e+=int2char(v>>2);d=v&3;c=3}else{e+=int2char((d<<2)|(v>>4));e+=int2char(v&15);c=0}}}}if(c==1){e+=int2char(d<<2)}return e};b.string2bytes=function(d){var c=new Array();for(var e=0;e<d.length;e++){c.push(d.charCodeAt(e))}return c};b.bytes2string=function(c){var d="";for(var e=0;e<c.length;e++){d+=String.fromCharCode(c[e])}return d};b.blockXOR=function(e,c){var d=new Array(16);for(var f=0;f<16;f++){d[f]=e[f]^c[f]}return d};b.blockIV=function(){var d=new SecureRandom();var c=new Array(16);d.nextBytes(c);return c};b.pad16=function(c){var d=c.slice(0);var e=(16-(c.length%16))%16;for(i=c.length;i<c.length+e;i++){d.push(0)}return d};b.depad=function(c){var d=c.slice(0);while(d[d.length-1]==0){d=d.slice(0,d.length-1)}return d};b.encryptAESCBC=function(e,k){var j=k.slice(0);aes.ExpandKey(j);var c=b.string2bytes(e);c=b.pad16(c);var l=b.blockIV();for(var g=0;g<c.length/16;g++){var h=c.slice(g*16,g*16+16);var d=l.slice((g)*16,(g)*16+16);h=b.blockXOR(d,h);aes.Encrypt(h,j);l=l.concat(h)}var f=b.bytes2string(l);return b.b256to64(f)};b.decryptAESCBC=function(j,e){var h=e.slice(0);aes.ExpandKey(h);var j=b.b64to256(j);var c=b.string2bytes(j);var g=new Array();for(var d=1;d<c.length/16;d++){var f=c.slice(d*16,d*16+16);var k=c.slice((d-1)*16,(d-1)*16+16);aes.Decrypt(f,h);f=b.blockXOR(k,f);g=g.concat(f)}g=b.depad(g);return b.bytes2string(g)};b.wrap60=function(d){var c="";for(var e=0;e<d.length;e++){if(e%60==0&&e!=0){c+="\n"}c+=d[e]}return c};b.generateAESKey=function(){var c=new Array(32);var d=new SecureRandom();d.nextBytes(c);return c};b.generateRSAKey=function(e,d){Math.seedrandom(sha256.hex(e));var c=new RSAKey();c.generate(d,"03");return c};b.publicKeyString=function(c){pubkey=b.b16to64(c.n.toString(16));return pubkey};b.publicKeyID=function(c){return MD5(c)};b.publicKeyFromString=function(c){var f=b.b64to16(c.split("|")[0]);var e="03";var d=new RSAKey();d.setPublic(f,e);return d};b.encrypt=function(h,c,g){var j="";var e=b.generateAESKey();try{var d=b.publicKeyFromString(c);j+=b.b16to64(d.encrypt(b.bytes2string(e)))+"?"}catch(f){return{status:"Invalid public key"}}if(g){signString=cryptico.b16to64(g.signString(h,"sha256"));h+="::52cee64bb3a38f6403386519a39ac91c::";h+=cryptico.publicKeyString(g);h+="::52cee64bb3a38f6403386519a39ac91c::";h+=signString}j+=b.encryptAESCBC(h,e);return{status:"success",cipher:j}};b.decrypt=function(h,e){var j=h.split("?");var f=e.decrypt(b.b64to16(j[0]));if(f==null){return{status:"failure"}}f=b.string2bytes(f);var g=b.decryptAESCBC(j[1],f).split("::52cee64bb3a38f6403386519a39ac91c::");if(g.length==3){var d=b.publicKeyFromString(g[1]);var c=b.b64to16(g[2]);if(d.verifyString(g[0],c)){return{status:"success",plaintext:g[0],signature:"verified",publicKeyString:b.publicKeyString(d)}}else{return{status:"success",plaintext:g[0],signature:"forged",publicKeyString:b.publicKeyString(d)}}}else{return{status:"success",plaintext:g[0],signature:"unsigned"}}};return b}());