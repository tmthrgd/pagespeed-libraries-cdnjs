!function(t){"use strict";function i(t,i){for(var e in i)t[e]=i[e];return t}function e(){}function n(n,o,r,p,d){function c(t,e){this.element=t,this.options=i({},this.options),i(this.options,e),this._create()}function g(){return!1}function l(t,i){t.x=void 0!==i.pageX?i.pageX:i.clientX,t.y=void 0!==i.pageY?i.pageY:i.clientY}var f=p("transform"),m=!!p("perspective");i(c.prototype,o.prototype),c.prototype.options={},c.prototype._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=i({},this.position);var t=a(this.element);"relative"!==t.position&&"absolute"!==t.position&&(this.element.style.position="relative"),this.enable(),this.setHandles()},c.prototype.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element];for(var t=0,i=this.handles.length;i>t;t++){var e=this.handles[t];r.bind(e,"mousedown",this),r.bind(e,"touchstart",this),v(e)}};var y="attachEvent"in s.documentElement,v=y?function(t){"IMG"===t.nodeName&&(t.ondragstart=g);for(var i=t.querySelectorAll("img"),e=0,n=i.length;n>e;e++){var o=i[e];o.ondragstart=g}}:e;c.prototype._getPosition=function(){var t=a(this.element),i=parseInt(t.left,10),e=parseInt(t.top,10);this.position.x=isNaN(i)?0:i,this.position.y=isNaN(e)?0:e,this._addTransformPosition(t)},c.prototype._addTransformPosition=function(t){if(f){var i=t[f];if(0===i.indexOf("matrix")){var e=i.split(","),n=0===i.indexOf("matrix3d")?12:4,o=parseInt(e[n],10),s=parseInt(e[n+1],10);this.position.x+=o,this.position.y+=s}}},c.prototype.handleEvent=function(t){var i="on"+t.type;this[i]&&this[i](t)},c.prototype.getTouch=function(t){for(var i=0,e=t.length;e>i;i++){var n=t[i];if(n.identifier===this.pointerIdentifier)return n}},c.prototype.onmousedown=function(t){this.dragStart(t,t)},c.prototype.ontouchstart=function(t){this.isDragging||this.dragStart(t,t.changedTouches[0])},c.prototype.dragStart=function(i,e){if(this.isEnabled){i.preventDefault?i.preventDefault():i.returnValue=!1;var o="touchstart"===i.type;this.pointerIdentifier=e.identifier,this._getPosition(),this.measureContainment(),l(this.startPoint,e),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this._bindEvents({events:o?["touchmove","touchend","touchcancel"]:["mousemove","mouseup"],node:i.preventDefault?t:s}),n.add(this.element,"is-dragging"),this.isDragging=!0,this.emitEvent("dragStart",[this,i,e]),this.animate()}},c.prototype._bindEvents=function(t){for(var i=0,e=t.events.length;e>i;i++){var n=t.events[i];r.bind(t.node,n,this)}this._boundEvents=t},c.prototype._unbindEvents=function(){for(var t=this._boundEvents,i=0,e=t.events.length;e>i;i++){var n=t.events[i];r.unbind(t.node,n,this)}delete this._boundEvents},c.prototype.measureContainment=function(){var t=this.options.containment;if(t){this.size=d(this.element);var i=this.element.getBoundingClientRect(),e=h(t)?t:"string"==typeof t?s.querySelector(t):this.element.parentNode;this.containerSize=d(e);var n=e.getBoundingClientRect();this.relativeStartPosition={x:i.left-n.left,y:i.top-n.top}}},c.prototype.onmousemove=function(t){this.dragMove(t,t)},c.prototype.ontouchmove=function(t){var i=this.getTouch(t.changedTouches);i&&this.dragMove(t,i)},c.prototype.dragMove=function(t,i){if(l(this.dragPoint,i),this.dragPoint.x-=this.startPoint.x,this.dragPoint.y-=this.startPoint.y,this.options.containment){var e=this.relativeStartPosition.x,n=this.relativeStartPosition.y;this.dragPoint.x=Math.max(this.dragPoint.x,-e),this.dragPoint.y=Math.max(this.dragPoint.y,-n),this.dragPoint.x=Math.min(this.dragPoint.x,this.containerSize.width-e-this.size.width),this.dragPoint.y=Math.min(this.dragPoint.y,this.containerSize.height-n-this.size.height)}this.position.x=this.startPosition.x+this.dragPoint.x,this.position.y=this.startPosition.y+this.dragPoint.y,this.emitEvent("dragMove",[this,t,i])},c.prototype.onmouseup=function(t){this.dragEnd(t,t)},c.prototype.ontouchend=function(t){var i=this.getTouch(t.changedTouches);i&&this.dragEnd(t,i)},c.prototype.dragEnd=function(t,i){this.isDragging=!1,delete this.pointerIdentifier,f&&(this.element.style[f]="",this.setLeftTop()),this._unbindEvents(),n.remove(this.element,"is-dragging"),this.emitEvent("dragEnd",[this,t,i])},c.prototype.ontouchcancel=function(t){var i=this.getTouch(t.changedTouches);this.dragEnd(t,i)},c.prototype.animate=function(){if(this.isDragging){this.positionDrag();var t=this;u(function(){t.animate()})}};var P=m?function(t,i){return"translate3d( "+t+"px, "+i+"px, 0)"}:function(t,i){return"translate( "+t+"px, "+i+"px)"};return c.prototype.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},c.prototype.positionDrag=f?function(){this.element.style[f]=P(this.dragPoint.x,this.dragPoint.y)}:c.prototype.setLeftTop,c.prototype.enable=function(){this.isEnabled=!0},c.prototype.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},c}for(var o,s=t.document,r=s.defaultView,a=r&&r.getComputedStyle?function(t){return r.getComputedStyle(t,null)}:function(t){return t.currentStyle},h="object"==typeof HTMLElement?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName},p=0,d="webkit moz ms o".split(" "),u=t.requestAnimationFrame,c=t.cancelAnimationFrame,g=0;g<d.length&&(!u||!c);g++)o=d[g],u=u||t[o+"RequestAnimationFrame"],c=c||t[o+"CancelAnimationFrame"]||t[o+"CancelRequestAnimationFrame"];u&&c||(u=function(i){var e=(new Date).getTime(),n=Math.max(0,16-(e-p)),o=t.setTimeout(function(){i(e+n)},n);return p=e+n,o},c=function(i){t.clearTimeout(i)}),"function"==typeof define&&define.amd?define(["classie","eventEmitter","eventie","get-style-property","get-size"],n):t.Draggabilly=n(t.classie,t.EventEmitter,t.eventie,t.getStyleProperty,t.getSize)}(window);