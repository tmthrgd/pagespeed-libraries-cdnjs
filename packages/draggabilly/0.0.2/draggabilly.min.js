!function(t){"use strict";function i(t,i){for(var e in i)t[e]=i[e];return t}function e(t){return"object"==typeof HTMLElement?t instanceof HTMLElement:t&&"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName}function n(t,e){this.element=t,i(this.options,e),this._create()}for(var o,s=t.classie,r=t.EventEmitter,a=t.eventie,h=t.getStyleProperty,p=t.getSize,u=t.document,c=u.defaultView,m=c&&c.getComputedStyle?function(t){return c.getComputedStyle(t,null)}:function(t){return t.currentStyle},g=0,f="webkit moz ms o".split(" "),l=t.requestAnimationFrame,d=t.cancelAnimationFrame,y=0;y<f.length&&(!l||!d);y++)o=f[y],l=l||t[o+"RequestAnimationFrame"],d=d||t[o+"CancelAnimationFrame"]||t[o+"CancelRequestAnimationFrame"];l&&d||(l=function(i){var e=(new Date).getTime(),n=Math.max(0,16-(e-g)),o=t.setTimeout(function(){i(e+n)},n);return g=e+n,o},d=function(i){t.clearTimeout(i)});var v="createTouch"in u,x=v?"touchstart":"mousedown",P=v?"touchmove":"mousemove",T=v?"touchend":"mouseup",S=h("transform"),E=!!h("perspective");i(n.prototype,r.prototype),n.prototype.options={},n.prototype._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.startPosition=i({},this.position);var t=m(this.element);"relative"!==t.position&&"absolute"!==t.position&&(this.element.style.position="relative"),a.bind(this.element,x,this)},n.prototype._getPosition=function(){var t=m(this.element),i=parseInt(t.left,10),e=parseInt(t.top,10);if(this.position.x=isNaN(i)?0:i,this.position.y=isNaN(e)?0:e,S){var n=t[S];if(0===n.indexOf("matrix")){var o=n.split(","),s=0===n.indexOf("matrix3d")?12:4,r=parseInt(o[s],10),a=parseInt(o[s+1],10);this.position.x+=r,this.position.y+=a}}},n.prototype.handleEvent=function(t){var i="on"+t.type;this[i]&&this[i](t)},n.prototype.getTouch=function(t){for(var i=0,e=t.length;e>i;i++){var n=t[i];if(n.identifier===this.pointerIdentifier)return n}},n.prototype.onmousedown=function(t){this.pointerStart(t,t)},n.prototype.ontouchstart=function(t){this.pointerIdentifier||this.pointerStart(t,t.changedTouches[0])},n.prototype.pointerStart=function(i,e){i.preventDefault(),this.pointerIdentifier=e.identifier||1,this._getPosition(),this.measureContainment(),this.startPoint.x=e.pageX,this.startPoint.y=e.pageY,this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragX=0,this.dragY=0,a.bind(t,P,this),a.bind(t,T,this),s.add(this.element,"is-dragging"),this.isDragging=!0,this.emitEvent("start",[i,e,this]),this.animate()},n.prototype.measureContainment=function(){var t=this.options.containment;if(t){this.size=p(this.element);var i=this.element.getBoundingClientRect(),n=e(t)?t:"string"==typeof t?u.querySelector(t):this.element.parentNode;this.containerSize=p(n);var o=n.getBoundingClientRect();this.relativeStartPosition={x:i.left-o.left,y:i.top-o.top}}},n.prototype.onmousemove=function(t){this.pointerMove(t,t)},n.prototype.ontouchmove=function(t){var i=this.getTouch(t.changedTouches);i&&this.pointerMove(t,i)},n.prototype.pointerMove=function(t,i){if(this.dragX=i.pageX-this.startPoint.x,this.dragY=i.pageY-this.startPoint.y,this.options.containment){var e=this.relativeStartPosition.x,n=this.relativeStartPosition.y;this.dragX=Math.max(this.dragX,-e),this.dragY=Math.max(this.dragY,-n),this.dragX=Math.min(this.dragX,this.containerSize.width-e-this.size.width),this.dragY=Math.min(this.dragY,this.containerSize.height-n-this.size.height)}this.position.x=this.startPosition.x+this.dragX,this.position.y=this.startPosition.y+this.dragY,this.emitEvent("drag",[t,i,this])},n.prototype.onmouseup=function(t){this.pointerEnd(t,t)},n.prototype.ontouchend=function(t){var i=this.getTouch(t.changedTouches);i&&this.pointerEnd(t,i)},n.prototype.pointerEnd=function(i,e){this.isDragging=!1,delete this.pointerIdentifier,S&&(this.element.style[S]="",this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"),a.unbind(t,P,this),a.unbind(t,T,this),s.remove(this.element,"is-dragging"),this.emitEvent("stop",[i,e,this])},n.prototype.animate=function(){if(this.isDragging){this.positionDrag();var t=this;l(function(){t.animate()})}};var b=E?function(t,i){return"translate3d( "+t+"px, "+i+"px, 0)"}:function(t,i){return"translate( "+t+"px, "+i+"px)"};n.prototype.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},n.prototype.positionDrag=S?function(){this.element.style[S]=b(this.dragX,this.dragY)}:n.prototype.setLeftTop,t.Draggabilly=n}(window);