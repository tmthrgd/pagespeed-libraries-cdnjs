!function(t){"use strict";function e(t,e){for(var i in e)t[i]=e[i];return t}function i(){}function n(n,o,r,p,u){function c(t,i){this.element="string"==typeof t?s.querySelector(t):t,this.options=e({},this.options),e(this.options,i),this._create()}function l(){return!1}function f(t,e){t.x=void 0!==e.pageX?e.pageX:e.clientX,t.y=void 0!==e.pageY?e.pageY:e.clientY}function g(t,e,i){return i=i||"round",e?Math[i](t/e)*e:t}var m=p("transform"),v=!!p("perspective");e(c.prototype,o.prototype),c.prototype.options={},c.prototype._create=function(){this.position={},this._getPosition(),this.startPoint={x:0,y:0},this.dragPoint={x:0,y:0},this.startPosition=e({},this.position);var t=a(this.element);"relative"!==t.position&&"absolute"!==t.position&&(this.element.style.position="relative"),this.enable(),this.setHandles()},c.prototype.setHandles=function(){this.handles=this.options.handle?this.element.querySelectorAll(this.options.handle):[this.element];for(var t=0,e=this.handles.length;e>t;t++){var i=this.handles[t];r.bind(i,"mousedown",this),r.bind(i,"touchstart",this),x(i)}};var y="attachEvent"in s.documentElement,x=y?function(t){"IMG"===t.nodeName&&(t.ondragstart=l);for(var e=t.querySelectorAll("img"),i=0,n=e.length;n>i;i++){var o=e[i];o.ondragstart=l}}:i;c.prototype._getPosition=function(){var t=a(this.element),e=parseInt(t.left,10),i=parseInt(t.top,10);this.position.x=isNaN(e)?0:e,this.position.y=isNaN(i)?0:i,this._addTransformPosition(t)},c.prototype._addTransformPosition=function(t){if(m){var e=t[m];if(0===e.indexOf("matrix")){var i=e.split(","),n=0===e.indexOf("matrix3d")?12:4,o=parseInt(i[n],10),s=parseInt(i[n+1],10);this.position.x+=o,this.position.y+=s}}},c.prototype.handleEvent=function(t){var e="on"+t.type;this[e]&&this[e](t)},c.prototype.getTouch=function(t){for(var e=0,i=t.length;i>e;e++){var n=t[e];if(n.identifier===this.pointerIdentifier)return n}},c.prototype.onmousedown=function(t){var e=t.button;e&&0!==e&&1!==e||this.dragStart(t,t)},c.prototype.ontouchstart=function(t){this.isDragging||this.dragStart(t,t.changedTouches[0])},c.prototype.dragStart=function(e,i){if(this.isEnabled){e.preventDefault?e.preventDefault():e.returnValue=!1;var o="touchstart"===e.type;this.pointerIdentifier=i.identifier,this._getPosition(),this.measureContainment(),f(this.startPoint,i),this.startPosition.x=this.position.x,this.startPosition.y=this.position.y,this.setLeftTop(),this.dragPoint.x=0,this.dragPoint.y=0,this._bindEvents({events:o?["touchmove","touchend","touchcancel"]:["mousemove","mouseup"],node:e.preventDefault?t:s}),n.add(this.element,"is-dragging"),this.isDragging=!0,this.emitEvent("dragStart",[this,e,i]),this.animate()}},c.prototype._bindEvents=function(t){for(var e=0,i=t.events.length;i>e;e++){var n=t.events[e];r.bind(t.node,n,this)}this._boundEvents=t},c.prototype._unbindEvents=function(){var t=this._boundEvents;if(t&&t.events){for(var e=0,i=t.events.length;i>e;e++){var n=t.events[e];r.unbind(t.node,n,this)}delete this._boundEvents}},c.prototype.measureContainment=function(){var t=this.options.containment;if(t){this.size=u(this.element);var e=this.element.getBoundingClientRect(),i=h(t)?t:"string"==typeof t?s.querySelector(t):this.element.parentNode;this.containerSize=u(i);var n=i.getBoundingClientRect();this.relativeStartPosition={x:e.left-n.left,y:e.top-n.top}}},c.prototype.onmousemove=function(t){this.dragMove(t,t)},c.prototype.ontouchmove=function(t){var e=this.getTouch(t.changedTouches);e&&this.dragMove(t,e)},c.prototype.dragMove=function(t,e){f(this.dragPoint,e);var i=this.dragPoint.x-this.startPoint.x,n=this.dragPoint.y-this.startPoint.y,o=this.options.grid,s=o&&o[0],r=o&&o[1];if(i=g(i,s),n=g(n,r),this.options.containment){var a=this.relativeStartPosition.x,h=this.relativeStartPosition.y,p=g(-a,s,"ceil"),u=g(-h,r,"ceil"),d=this.containerSize.width-a-this.size.width,c=this.containerSize.height-h-this.size.height;d=g(d,s,"floor"),c=g(c,r,"floor"),i=Math.min(d,Math.max(p,i)),n=Math.min(c,Math.max(u,n))}this.position.x=this.startPosition.x+i,this.position.y=this.startPosition.y+n,this.dragPoint.x=i,this.dragPoint.y=n,this.emitEvent("dragMove",[this,t,e])},c.prototype.onmouseup=function(t){this.dragEnd(t,t)},c.prototype.ontouchend=function(t){var e=this.getTouch(t.changedTouches);e&&this.dragEnd(t,e)},c.prototype.dragEnd=function(t,e){this.isDragging=!1,delete this.pointerIdentifier,m&&(this.element.style[m]="",this.setLeftTop()),this._unbindEvents(),n.remove(this.element,"is-dragging"),this.emitEvent("dragEnd",[this,t,e])},c.prototype.ontouchcancel=function(t){var e=this.getTouch(t.changedTouches);this.dragEnd(t,e)},c.prototype.animate=function(){if(this.isDragging){this.positionDrag();var t=this;d(function(){t.animate()})}};var E=v?function(t,e){return"translate3d( "+t+"px, "+e+"px, 0)"}:function(t,e){return"translate( "+t+"px, "+e+"px)"};return c.prototype.setLeftTop=function(){this.element.style.left=this.position.x+"px",this.element.style.top=this.position.y+"px"},c.prototype.positionDrag=m?function(){this.element.style[m]=E(this.dragPoint.x,this.dragPoint.y)}:c.prototype.setLeftTop,c.prototype.enable=function(){this.isEnabled=!0},c.prototype.disable=function(){this.isEnabled=!1,this.isDragging&&this.dragEnd()},c}for(var o,s=t.document,r=s.defaultView,a=r&&r.getComputedStyle?function(t){return r.getComputedStyle(t,null)}:function(t){return t.currentStyle},h="object"==typeof HTMLElement?function(t){return t instanceof HTMLElement}:function(t){return t&&"object"==typeof t&&1===t.nodeType&&"string"==typeof t.nodeName},p=0,u="webkit moz ms o".split(" "),d=t.requestAnimationFrame,c=t.cancelAnimationFrame,l=0;l<u.length&&(!d||!c);l++)o=u[l],d=d||t[o+"RequestAnimationFrame"],c=c||t[o+"CancelAnimationFrame"]||t[o+"CancelRequestAnimationFrame"];d&&c||(d=function(e){var i=(new Date).getTime(),n=Math.max(0,16-(i-p)),o=t.setTimeout(function(){e(i+n)},n);return p=i+n,o},c=function(e){t.clearTimeout(e)}),"function"==typeof define&&define.amd?define(["classie/classie","eventEmitter/EventEmitter","eventie/eventie","get-style-property/get-style-property","get-size/get-size"],n):t.Draggabilly=n(t.classie,t.EventEmitter,t.eventie,t.getStyleProperty,t.getSize)}(window);